var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,c){e instanceof String&&(e=String(e));for(var b=e.length,d=0;d<b;d++){var f=e[d];if(a.call(c,f,d,e))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,c){if(e==Array.prototype||e==Object.prototype)return e;e[a]=c.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<e.length;++a){var c=e[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,a){var c=$jscomp.propertyToPolyfillSymbol[a];if(null==c)return e[a];c=e[c];return void 0!==c?c:e[a]};
$jscomp.polyfill=function(e,a,c,b){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,a,c,b):$jscomp.polyfillUnisolated(e,a,c,b))};$jscomp.polyfillUnisolated=function(e,a,c,b){c=$jscomp.global;e=e.split(".");for(b=0;b<e.length-1;b++){var d=e[b];if(!(d in c))return;c=c[d]}e=e[e.length-1];b=c[e];a=a(b);a!=b&&null!=a&&$jscomp.defineProperty(c,e,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(e,a,c,b){var d=e.split(".");e=1===d.length;b=d[0];b=!e&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in b))return;b=b[g]}d=d[d.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?b[d]:null;a=a(c);null!=a&&(e?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:a}):a!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+c+"$"+d),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.yamaha=xnm.aio.yamaha||{};
xnm.aio.yamaha.AVR=function(){var e=function(a,c,b,d,f){this._logger=require("x.logger.js").getLogger("xnm.aio.yamaha.AVR");this.ip=a;this.port=c;this.port||(this.port="80");this.uuid=b;this.name=d;this.model=f;this.timeout=3E3;this.CommandHandler=null};e.prototype.audioModes="2ch Stereo;5ch Stereo;Surround Decoder;Standard;Spectacle;Sci-Fi;Adventure;Drama;Mono Movie;Sports;Action Game;Roleplaying Game;Hall in Munich;Hall in Vienna;Chamber;Cellar Club;The Roxy Theatre;The Bottom Line;Music Video".split(";");
e.prototype.videoModes="HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link;MULTI CH;PHONO;CD;TV;MD/CD-R;BD/HD DVD;DVD;CBL/SAT;DVR;VCR;V-AUX;DOCK;PC/MCX".split(";");e.prototype.executeCommandCreator=function(a,c,b){if(c&&c.value)if("openNative"==c.value)window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?window.XC.callHost("SYSTEM","startApp",
{scheme:"jp.co.yamaha.avkk.avcontroller://"}):"Android"==window.XCHost.getType()&&window.XC.callHost("SYSTEM","startApp",{scheme:"com.yamaha.av.avcontroller"})),b&&b();else{a="";c.path&&c.path[0]&&"global"!=c.path[0]&&(a=c.path[0]+":");var d=a+c.value;if("sleep"==c.value){if(!c.ext){b&&b(Error("command sleep ext format invalid"));return}d+=c.ext.replace(/min/g,"")}else if("setInput"==c.value){if(!c.ext){b&&b(Error("command setInput ext format invalid"));return}d=a+c.ext}else if("audioMode"==c.value){if(!c.ext){b&&
b(Error("command audioMode ext format invalid"));return}d=a+c.ext}else if("setTo"==c.value){if(null==c.ext||"undefined"==typeof c.ext){b&&b(Error("command setTo ext format invalid"));return}d+=c.ext}else if("dlgLevel"==c.value){if(null==c.ext||"undefined"==typeof c.ext){b&&b(Error("command dlgLevel ext format invalid"));return}d+=c.ext}else if("setVideoPreset"==c.value){if(null==c.ext||"undefined"==typeof c.ext){b&&b(Error("command setVideoPreset ext format invalid"));return}d+=c.ext}else if("customCMD"==
c.value){if(!c.ext){b&&b(Error("command customCMD ext format invalid"));return}d=a+c.ext}if(c.path&&c.path[0]&&"tuner"==c.path[0]&&(d=c.value,"tunerPreset"==c.value)){if(null==c.ext||"undefined"==typeof c.ext){b&&b(Error("command tunerPreset ext format invalid"));return}d="tuner"+c.ext}this.executeCommand(d,function(f){if(f)b&&b(f);else{if(c.path&&c.path[0]&&"mainzone"==c.path[0]){if("on"==c.value||"off"==c.value||"toggle"==c.value){setTimeout(function(){b&&b()},1E3);return}if("setTo"==c.value||"volumeUp"==
c.value||"volumeDown"==c.value){setTimeout(function(){b&&b()},10);return}}b&&b()}})}else b&&b(Error("command json format invalid"))};e.prototype.getStatesCreator=function(a,c,b){a=[];for(var d=0;d<c.length;d++)if(c[d]&&c[d].status&&c[d].status.path&&c[d].status.path[0]){var f=0;switch(c[d].status.path[0]){case "mainzone":f=1;break;case "zone2":f=2;break;case "zone3":f=3;break;case "zone4":f=4}f&&-1==a.indexOf(f)&&a.push(f)}this.getStates(a,function(g,k){g=[];for(var h=0;h<c.length;h++)if(c[h]&&c[h].id){var l=
"?";if(c[h].status&&c[h].status.value){var n="";c[h].status.path&&c[h].status.path[0]&&"global"!=c[h].status.path[0]&&(n=c[h].status.path[0]);var p=c[h].status.value;k&&n&&k[n]&&k[n][p]&&(l=k[n][p])}g.push({id:c[h].id,status:l})}b&&b(null,g)})};e.prototype._doRequest=function(a,c,b){a='<?xml version="1.0" encoding="utf-8"?><YAMAHA_AV cmd="'+a+'">'+(c+"</YAMAHA_AV>");var d=this;c="http://"+this.ip+":"+this.port+"/YamahaRemoteControl/ctrl";this._logger.log("trace","send data:"+a);var f=b;$.ajax({url:c,
type:"POST",timeout:this.timeout,data:a,dataType:"text",cache:!0,headers:{"Content-Length":a.length},success:function(g){d._logger.log("trace","http request success:"+g);f&&(f(null,g),f=null)},error:function(g,k){k="http request error:"+(g?g.status:"0")+"-"+k;d._logger.log("trace",k);k=Error(k);k.code=g?g.status:0;f&&(f(k),f=null)}})};e.prototype._getStateValue=function(a,c,b){var d=null;a=a.find(c);0<a.length&&(d=$(a[0]).text());d&&b&&(d=d.toLowerCase());return d};e.prototype._parseStates=function(a,
c){var b={};b.power=this._getStateValue(a,"Power_Control Power",!0);"standby"==b.power&&(b.power="off");b.sleep=this._getStateValue(a,"Power_Control Sleep",!0);b.mute=this._getStateValue(a,"Volume Mute",!0);b.mute||(b.mute=this._getStateValue(a,"Vol Mute",!0));var d=this._getStateValue(a,"Volume Lvl Val");d||(d=this._getStateValue(a,"Vol Lvl Val"));b.volume=d?(parseFloat(d)/10).toFixed(1):null;b.input=this._getStateValue(a,"Input Input_Sel");"zone2"!=c&&"zone3"!=c&&"zone4"!=c&&(b.mode=this._getStateValue(a,
"Surround Program_Sel Current Sound_Program"),b.enhancer=this._getStateValue(a,"Surround Program_Sel Current Enhancer",!0),b.straight=this._getStateValue(a,"Surround Program_Sel Current Straight",!0),b.direct=this._getStateValue(a,"Sound_Video Pure_Direct Mode",!0),b.bass=this._getStateValue(a,"Sound_Video Extra_Bass",!0),"auto"==b.bass&&(b.bass="on"),b.ypao_volume=this._getStateValue(a,"Sound_Video YPAO_Volume",!0),"auto"==b.ypao_volume&&(b.ypao_volume="on"),b.dlgLevel=this._getStateValue(a,"Sound_Video Dialogue_Adjust Dialogue_Lvl"),
b.videoPreset=this._getStateValue(a,"Sound_Video HDMI Video Preset_Sel Current",!0),b.videoPreset&&(b.videoPreset=b.videoPreset.replace("preset ","")));return b};e.prototype.getStates=function(a,c){a&&0!=a.length||(a=[1]);var b={},d=0,f=this,g=function(k,h){var l=a[d];!k&&h&&(1==l?b.mainzone=h.mainzone:2==l?b.zone2=h.zone2:3==l?b.zone3=h.zone3:4==l&&(b.zone4=h.zone4));d++;d<a.length?f._getZoneStates(a[d],g):c&&c(null,b)};this._getZoneStates(a[d],g)};e.prototype._getZoneStates=function(a,c){var b=
this;if(1==a){var d="Main_Zone";var f="mainzone"}else 2==a?(d="Zone_2",f="zone2"):3==a?(d="Zone_3",f="zone3"):4==a&&(d="Zone_4",f="zone4");this._doRequest("GET","<"+d+"><Basic_Status>GetParam</Basic_Status></"+d+">",function(g,k){if(g)c&&c(g);else try{var h=$($.parseXML(k));if(h){var l=h.find("Basic_Status");if(!l||0>=l.length)c&&c(Error(f+" status reponse has no basic status tag"));else{var n=$(l[0]);g={};g[f]=b._parseStates(n,f);c&&c(null,g)}}else c&&c(Error(f+" status reponse invalid"))}catch(p){c&&
c(p)}})};e.prototype.executeCommand=function(a,c){var b=null,d=!0,f=null,g=a.indexOf(":");0<g&&(f=a.substr(0,g),a=a.substr(g+1));var k=this;"on"==a?b="<Power_Control><Power>On</Power></Power_Control>":"off"==a||"standby"==a?b="<Power_Control><Power>Standby</Power></Power_Control>":"toggle"==a?b="<Power_Control><Power>On/Standby</Power></Power_Control>":"mute"==a?b="<Volume><Mute>On</Mute></Volume>":"unmute"==a?b="<Volume><Mute>Off</Mute></Volume>":"toggleMute"==a?b="<Volume><Mute>On/Off</Mute></Volume>":
"volumeDown"==a?b="<Volume><Lvl><Val>Down</Val><Exp></Exp><Unit></Unit></Lvl></Volume>":"volumeUp"==a?b="<Volume><Lvl><Val>Up</Val><Exp></Exp><Unit></Unit></Lvl></Volume>":"enhancerOn"==a?b="<Surround><Program_Sel><Current><Enhancer>On</Enhancer></Current></Program_Sel></Surround>":"enhancerOff"==a?b="<Surround><Program_Sel><Current><Enhancer>Off</Enhancer></Current></Program_Sel></Surround>":"directOn"==a?b="<Sound_Video><Pure_Direct><Mode>On</Mode></Pure_Direct></Sound_Video>":"directOff"==a?b=
"<Sound_Video><Pure_Direct><Mode>Off</Mode></Pure_Direct></Sound_Video>":"extraBassOn"==a?b="<Sound_Video><Extra_Bass>Auto</Extra_Bass></Sound_Video>":"extraBassOff"==a?b="<Sound_Video><Extra_Bass>Off</Extra_Bass></Sound_Video>":"straightOn"==a?b="<Surround><Program_Sel><Current><Straight>On</Straight></Current></Program_Sel></Surround>":"straightOff"==a?b="<Surround><Program_Sel><Current><Straight>Off</Straight></Current></Program_Sel></Surround>":"Scene1"==a?b="<Scene><Scene_Sel>Scene 1</Scene_Sel></Scene>":
"Scene2"==a?b="<Scene><Scene_Sel>Scene 2</Scene_Sel></Scene>":"Scene3"==a?b="<Scene><Scene_Sel>Scene 3</Scene_Sel></Scene>":"Scene4"==a?b="<Scene><Scene_Sel>Scene 4</Scene_Sel></Scene>":"play"==a?b="<Play_Control><Playback>Play</Playback></Play_Control>":"pause"==a?b="<Play_Control><Playback>Pause</Playback></Play_Control>":"stop"==a?b="<Play_Control><Playback>Stop</Playback></Play_Control>":"previous"==a?b="<Play_Control><Playback>Skip Rev</Playback></Play_Control>":"next"==a?b="<Play_Control><Playback>Skip Fwd</Playback></Play_Control>":
"up"==a?b="<Cursor_Control><Cursor>Up</Cursor></Cursor_Control>":"down"==a?b="<Cursor_Control><Cursor>Down</Cursor></Cursor_Control>":"left"==a?b="<Cursor_Control><Cursor>Left</Cursor></Cursor_Control>":"right"==a?b="<Cursor_Control><Cursor>Right</Cursor></Cursor_Control>":"enter"==a?b="<Cursor_Control><Cursor>Sel</Cursor></Cursor_Control>":"return"==a?b="<Cursor_Control><Cursor>Return</Cursor></Cursor_Control>":0==a.indexOf("sleep")?(a=a.replace(/sleep/g,"").toLowerCase(),b="off"==a?"<Power_Control><Sleep>Off</Sleep></Power_Control>":
"<Power_Control><Sleep>"+a+" min</Sleep></Power_Control>"):0==a.indexOf("dlgLevel")?(a=a.replace(/dlgLevel/g,"").toLowerCase(),b="<Sound_Video><Dialogue_Adjust><Dialogue_Lvl>"+a+"</Dialogue_Lvl></Dialogue_Adjust></Sound_Video>"):0==a.indexOf("setVideoPreset")?(a=a.replace(/setVideoPreset/g,"").toLowerCase(),f="system",b="<Sound_Video><HDMI><Video><Presetl_Sel><Current>"+a+"</Current></Presetl_Sel></Video></HDMI></Sound_Video>"):0==a.indexOf("tuner")?(d=!1,a=a.replace(/tuner/g,""),b="Up"==a?"<Tuner><Play_Control><Preset><Preset_Sel>Up</Preset_Sel></Preset></Play_Control></Tuner>":
"Down"==a?"<Tuner><Play_Control><Preset><Preset_Sel>Down</Preset_Sel></Preset></Play_Control></Tuner>":"AM"==a?"<Tuner><Play_Control><Tuning><Band>AM</Band></Tuning></Play_Control></Tuner>":"FM"==a?"<Tuner><Play_Control><Tuning><Band>FM</Band></Tuning></Play_Control></Tuner>":"<Tuner><Play_Control><Preset><Preset_Sel>"+a+"</Preset_Sel></Preset></Play_Control></Tuner>"):-1!=this.videoModes.indexOf(a)?b="<Input><Input_Sel>"+a+"</Input_Sel></Input>":-1!=this.audioModes.indexOf(a)?b="Straight"==a?"<Surround><Program_Sel><Current><Straight>On</Straight></Current></Program_Sel></Surround>":
"<Surround><Program_Sel><Current><Sound_Program>"+a+"</Sound_Program></Current></Program_Sel></Surround>":0==a.indexOf("setTo")||/^-?\d*\.{0,1}\d+$/.test(a)?(0==a.indexOf("setTo")&&(a=a.replace(/setTo/g,"")),a=a.replace(/%/g,""),a=Math.round(10*parseFloat(a)),-805>a?a=-805:165<a&&(a=165),b="<Volume><Lvl><Val>"+a+"</Val><Exp>1</Exp><Unit>dB</Unit></Lvl></Volume>"):(d=!1,b=a);d&&(b="system"==f?"<System>"+b+"</System>":"zone2"==f?"<Zone_2>"+b+"</Zone_2>":"zone3"==f?"<Zone_3>"+b+"</Zone_3>":"zone2"==
f?"<Zone_4>"+b+"</Zone_4>":"<Main_Zone>"+b+"</Main_Zone>");k=this;this._doRequest("PUT",b,function(h){h&&400==h.code&&-1!=b.indexOf("Volume")?(h=b.replace(/Volume/g,"Vol"),k._doRequest("PUT",h,c)):c&&c(h)})};e.prototype.getStateValues=function(a,c){return c};e.prototype.toJSON=function(){var a={sys:xnm.aio.yamaha.DM.SYS,type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(a.name=this.name);return a};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&
this.port==a.port:!1};e.DEVICE_1_ZONE="RX-V477 RX-V475 RX-V500D RX-V473 HTR-4067 HTR-5066 HTR-4066 HTR-5065 HTR-4065".split(" ");e.DEVICE_2_ZONE="RX-S600D RX-S600 RX-A1040 RX-A840 RX-A740 RX-A1030 RX-A830 RX-A730 RX-A1020 RX-A820 RX-A720 RX-A1010 RX-A810 RX-A710 RX-A1000 RX-V1077 RX-V777 RX-V677 RX-V577 RX-V1075 RX-V775 RX-V675 RX-V575 RX-V1073 RX-V773 RX-V673 RX-V573 RX-V1071 RX-V871 RX-V771 RX-V671 RX-V1067 RX-V867 HTR-6067 HTR-5067 HTR-6066 TSR-6750 HTR-7065 HTR-6065 HTR-6064 HTR-9063 HTR-8063".split(" ");
e.DEVICE_3_ZONE="RX-A2020 RX-A2010 RX-A2000 RX-V2073 RX-V2071 RX-V2067 RX-V2065 RX-V3900 DSP-AX3900 HTR-6295".split(" ");e.DEVICE_4_ZONE="CX-A5000 RX-A3040 RX-A2040 RX-A3030 RX-A2030 RX-A3020 RX-A3010 RX-A3000 RX-V3077 RX-V2077 RX-V3075 RX-V2075 RX-V3073 RX-V3071 RX-V3067 RX-Z7 DSP-Z7".split(" ");e.parseJSON=function(a){return a.ip?new e(a.ip,a.port,a.uuid,a.name,a.model):null};e.getZoneCount=function(a){return a&&a.model?-1!=e.DEVICE_4_ZONE.indexOf(a.model)?4:-1!=e.DEVICE_3_ZONE.indexOf(a.model)?
3:-1!=e.DEVICE_2_ZONE.indexOf(a.model)?2:1:1};return e}();
xnm.aio.yamaha.DM=function(){var e=function(c,b){this.code=c;this.message=b;this.stack=Error().stack};e.prototype=Error();e.prototype.name="YamahaDMError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var a={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open yamaha AV Controller",ref:{value:"openNative",value_t:"open_app_yamaha"}}]},
{type:"root",name:"tuner",value:"tuner",children:[{type:"enum",name:"preset up",ref:{value:"tunerUp"}},{type:"enum",name:"preset down",ref:{value:"tunerDown"}},{type:"enum",name:"AM",ref:{value:"tunerAM"}},{type:"enum",name:"FM",ref:{value:"tunerFM"}},{type:"int",name:"set preset",ref:{value:"tunerPreset",ext:"%d",extMeta:"1-40",scale:"1"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",
name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"enhancer on",ref:{value:"enhancerOn"}},{type:"enum",name:"enhancer off",ref:{value:"enhancerOff"}},{type:"enum",name:"direct on",ref:{value:"directOn"}},{type:"enum",name:"direct off",ref:{value:"directOff"}},{type:"enum",name:"extra bass on",ref:{value:"extraBassOn"}},{type:"enum",name:"extra bass off",
ref:{value:"extraBassOff"}},{type:"enum",name:"straight on",ref:{value:"straightOn"}},{type:"enum",name:"straight off",ref:{value:"straightOff"}},{type:"enum",name:"scene 1",ref:{value:"Scene1"}},{type:"enum",name:"scene 2",ref:{value:"Scene2"}},{type:"enum",name:"scene 3",ref:{value:"Scene3"}},{type:"enum",name:"scene 4",ref:{value:"Scene4"}},{type:"enum",name:"sleep",ref:{value:"sleep",ext:"%e",extMeta:["30min","60min","90min","120min","off"]}},{type:"enum",name:"set input",ref:{value:"setInput",
ext:"%e",extMeta:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link;MULTI CH;PHONO;CD;TV;MD/CD-R;BD/HD DVD;DVD;CBL/SAT;DVR;VCR;V-AUX;DOCK;PC/MCX".split(";")}},{type:"enum",name:"set dsp mode",ref:{value:"audioMode",value_t:"setDSPMode",ext:"%e",extMeta:"2ch Stereo;5ch Stereo;Surround Decoder;Standard;Spectacle;Sci-Fi;Adventure;Drama;Mono Movie;Sports;Action Game;Roleplaying Game;Hall in Munich;Hall in Vienna;Chamber;Cellar Club;The Roxy Theatre;The Bottom Line;Music Video".split(";")}},
{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",unit:"db",ext:"%f",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"up",ref:{value:"up"}},
{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",ref:{value:"return"}}]}],status:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",unit:"db",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",
options:["on","off"]}},{type:"enum",name:"sleep",ref:{value:"sleep",options:["30min","60min","90min","120min","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link;MULTI CH;PHONO;MULTI CH;PHONO;CD;TV;MD/CD-R;BD/HD DVD;DVD;CBL/SAT;DVR;VCR;V-AUX;DOCK;PC/MCX".split(";")}},{type:"enum",name:"dsp mode",ref:{value:"mode",options:"2ch Stereo;5ch Stereo;Surround Decoder;Standard;Spectacle;Sci-Fi;Adventure;Drama;Mono Movie;Sports;Action Game;Roleplaying Game;Hall in Munich;Hall in Vienna;Chamber;Cellar Club;The Roxy Theatre;The Bottom Line;Music Video;Straight".split(";")}},
{type:"enum",name:"enhancer",ref:{value:"enhancer",options:["on","off"]}},{type:"enum",name:"straight",ref:{value:"straight",options:["on","off"]}},{type:"enum",name:"extra bass",ref:{value:"bass",value_t:"extraBass",options:["on","off"]}},{type:"enum",name:"direct",ref:{value:"direct",value_t:"pureDirect",options:["on","off"]}}]}]},avr_zone_template:{command:[{type:"root",name:"@zone N",value:"zoneN",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},
{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"sleep",ref:{value:"sleep",ext:"%e",extMeta:["30min","60min","90min","120min","off"]}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";")}},
{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",unit:"db",ext:"%f",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"up",ref:{value:"up"}},
{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",ref:{value:"return"}}]}],status:[{type:"root",name:"zone N",value:"zoneN",children:[{type:"float",name:"volume",ref:{value:"volume",unit:"db",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on",
"off"]}},{type:"enum",name:"sleep",ref:{value:"sleep",options:["30min","60min","90min","120min","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";")}}]}]},"avr_RX-A3040":{command:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"int",name:"dialogue level",ref:{value:"dlgLevel",ext:"%d",extMeta:"0-3"}},
{type:"enum",name:"set HDMI video preset",ref:{value:"setVideoPreset",ext:"%e",extMeta:"123456".split("")}}]}],status:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"int",name:"dialogue level",ref:{value:"dlgLevel",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"HDMI video preset",ref:{value:"videoPreset",options:"123456".split("")}}]}]}};return{SYS:"yamaha",getIPDeviceType:function(){return[{sys:this.SYS,name:"Yamaha AV Receiver",type:"avr"}]},createDevice:function(c,b,d){b=e.ERROR_CODE;
c?c.ip?d(null,c):d(new e(b.INVALID,"ip is invalid")):d(new e(b.INVALID,"info is invalid"))},updateDevice:function(c,b,d){b=e.ERROR_CODE;c?c.ip?d(null,c):d(new e(b.INVALID,"ip is invalid")):d(new e(b.INVALID,"info is invalid"))},deleteDevice:function(c,b,d){d()},applyUIFilter:function(c,b,d){var f=function(l,n,p){var r=[];l.forEach(function(m){if("root"==m.type){m=JSON.parse(JSON.stringify(m));var q=f(m.children,n,p);q&&0<q.length&&(m.children=q,r.push(m))}else{q=p.elems;if("*"==q)q=!0;else{for(var u=
!1,t=0;t<q.length;t++)if(q[t]==m.type){u=!0;break}q=u}q&&(m=JSON.parse(JSON.stringify(m)),r.push(m))}});return r},g=function(l,n){var p=[],r=xnm.aio.yamaha.DM.getCommandStatusMap(l,d);if(r){var m=[];switch(n.catagory){case "command":r.command&&(m=f(r.command,l,n));break;case "status":r.status&&(m=f(r.status,l,n))}p=p.concat(m)}return p};if(!c.sys)return null;var k=JSON.parse(JSON.stringify(c)),h=null;switch(b.catagory){case "command":h=g(c,b);k.command=h;break;case "status":h=g(c,b);k.status=h;break;
default:return null}return h&&0!=h.length?k:null},getCommandStatusMap:function(c){if(!c||!c.type)return null;var b=a[c.type];if(!b)return null;b=JSON.parse(JSON.stringify(b));var d=xnm.aio.yamaha.AVR.getZoneCount(c);if(1<d)for(var f=2;f<=d;f++){var g=JSON.parse(JSON.stringify(a.avr_zone_template));g.command[0].name="zone "+f;g.command[0].value="zone"+f;g.status[0].name="zone "+f;g.status[0].value="zone"+f;b.command=b.command.concat(g.command);b.status=b.status.concat(g.status)}c.model&&a[c.type+"_"+
c.model]&&((c=a[c.type+"_"+c.model])&&(c=JSON.parse(JSON.stringify(c))),c&&c.command&&c.command.forEach(function(k){if(k&&"root"==k.type){var h;a:{if((h=k.value)&&b&&b.command)for(var l=0;l<b.command.length;l++)if(b.command[l]&&"root"==b.command[l].type&&b.command[l].value==h){h=b.command[l];break a}h=null}h?(h.children||(h.children=[]),h.children=h.children.concat(k.children)):b.command.push(k)}else b.command.push(k)}),c&&c.status&&c.status.forEach(function(k){if(k&&"root"==k.type){var h;a:{if((h=
k.value)&&b&&b.status)for(var l=0;l<b.status.length;l++)if(b.status[l]&&"root"==b.status[l].type&&b.status[l].value==h){h=b.status[l];break a}h=null}h?(h.children||(h.children=[]),h.children=h.children.concat(k.children)):b.status.push(k)}else b.status.push(k)}));return b}}}();
xnm.aio.yamaha.Handler=function(){var e=function(){this.detectedAVRs={}};e.prototype.devicemanager=xnm.aio.yamaha.DM;e.prototype.AVR=xnm.aio.yamaha.AVR;e.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"yamaha")};e.prototype.resolveDevice=function(a){if(!a)return null;switch(a.type){case "avr":return xnm.aio.yamaha.AVR.parseJSON(a);default:return null}};e.prototype.getDeviceCommands=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:
[];c&&c(null,a)};e.prototype.getDeviceStatus=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};e.prototype.doCommand=function(a,c,b){var d=this.resolveDevice(a);d?d.executeCommandCreator(a,c,function(f){b&&b(f)}):b&&b(Error("device json format invalid"))};e.prototype.doStatus=function(a,c,b,d){var f=this.resolveDevice(c);f?f.getStatesCreator(null,[{id:a,device:c,status:b}],function(g,k){g?d&&d(g):d&&d(null,k[0])}):d&&d(Error("device json format invalid"))};
e.prototype.discoverDevices=function(a){var c=function(f){if(!f)return f;var g;for(g=0;g<xnm.aio.yamaha.AVR.DEVICE_1_ZONE.length;g++){var k=xnm.aio.yamaha.AVR.DEVICE_1_ZONE[g];if(-1!=f.indexOf(k))return k}for(g=0;g<xnm.aio.yamaha.AVR.DEVICE_2_ZONE.length;g++)if(k=xnm.aio.yamaha.AVR.DEVICE_2_ZONE[g],-1!=f.indexOf(k))return k;for(g=0;g<xnm.aio.yamaha.AVR.DEVICE_3_ZONE.length;g++)if(k=xnm.aio.yamaha.AVR.DEVICE_3_ZONE[g],-1!=f.indexOf(k))return k;for(g=0;g<xnm.aio.yamaha.AVR.DEVICE_4_ZONE.length;g++)if(k=
xnm.aio.yamaha.AVR.DEVICE_4_ZONE[g],-1!=f.indexOf(k))return k;return f},b=require("x.upnp.js");if(b){var d=this;b.discoverDevicesWithTimeout(3E3,function(f){if(f.manufacturer&&0==f.manufacturer.indexOf("Yamaha")&&"AV Receiver"==f.modelDescription){var g=c(f.modelName);g=new xnm.aio.yamaha.AVR(f.ip,80,f.uuid,f.name,g);d.detectedAVRs["uuid:"+f.uuid]||(d.detectedAVRs["uuid:"+f.uuid]=g);a(g)}})}};e.prototype.discoverWithTimeout=function(a,c){var b={};this.discoverDevices(function(d){d&&d.uuid&&!b[d.uuid]&&
(b[d.uuid]=d)});setTimeout(function(){var d=[],f;for(f in b)b.hasOwnProperty(f)&&d.push(b[f]);c&&c(null,d)},a)};e.prototype.getStateValues=function(a,c){return(new xnm.aio.yamaha.AVR).getStateValues(a.type,c)};e.prototype.getDeviceCommandList=function(a,c,b){return[]};return e}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.yamaha.Handler);

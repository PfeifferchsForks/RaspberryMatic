var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var e=0;return function(){return e<g.length?{done:!1,value:g[e++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,e,h){if(g==Array.prototype||g==Object.prototype)return g;g[e]=h.value;return g};$jscomp.getGlobal=function(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<g.length;++e){var h=g[e];if(h&&h.Math==Math)return h}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(g,e){var h=$jscomp.propertyToPolyfillSymbol[e];if(null==h)return g[e];h=g[h];return void 0!==h?h:g[e]};
$jscomp.polyfill=function(g,e,h,k){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(g,e,h,k):$jscomp.polyfillUnisolated(g,e,h,k))};$jscomp.polyfillUnisolated=function(g,e,h,k){h=$jscomp.global;g=g.split(".");for(k=0;k<g.length-1;k++){var f=g[k];if(!(f in h))return;h=h[f]}g=g[g.length-1];k=h[g];e=e(k);e!=k&&null!=e&&$jscomp.defineProperty(h,g,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(g,e,h,k){var f=g.split(".");g=1===f.length;k=f[0];k=!g&&k in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var l=0;l<f.length-1;l++){var a=f[l];if(!(a in k))return;k=k[a]}f=f[f.length-1];h=$jscomp.IS_SYMBOL_NATIVE&&"es6"===h?k[f]:null;e=e(h);null!=e&&(g?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:e}):e!==h&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&(h=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+h+"$"+f),$jscomp.defineProperty(k,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:e})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(g){if(g)return g;var e=function(l,a){this.$jscomp$symbol$id_=l;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:a})};e.prototype.toString=function(){return this.$jscomp$symbol$id_};var h="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",k=0,f=function(l){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new e(h+(l||"")+"_"+k++,l)};return f},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(g){if(g)return g;g=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),h=0;h<e.length;h++){var k=$jscomp.global[e[h]];"function"===typeof k&&"function"!=typeof k.prototype[g]&&$jscomp.defineProperty(k.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return g},"es6",
"es3");$jscomp.iteratorPrototype=function(g){g={next:g};g[Symbol.iterator]=function(){return this};return g};$jscomp.iteratorFromArray=function(g,e){g instanceof String&&(g+="");var h=0,k=!1,f={next:function(){if(!k&&h<g.length){var l=h++;return{value:e(l,g[l]),done:!1}}k=!0;return{done:!0,value:void 0}}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");
var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.pioneer=xnm.aio.pioneer||{};
xnm.aio.pioneer.AVReceiver=function(){var g=[1,2,3,4,5],e=function(a,b,c,d){this._taskBuffer=a;this._avr=b;this._datapoints=c;this._callback=d};e.prototype.run=function(){this._avr._logger.log("debug","run status task: "+JSON.stringify(this._datapoints));var a=this,b={},c=0,d=function(n,r){if(n&&4!=n.errorCode&&5!=n.errorCode)1==n.errorCode||2==n.errorCode||3==n.errorCode?a._taskBuffer._finishAllTask(n):a._taskBuffer._finishLastTask(n);else{n=a._datapoints[c];var p=null,q=n.indexOf(":");0<q&&(p=n.substr(0,
q),n=n.substr(q+1));q="?";r&&(p||null==r[n]||"undefined"==typeof r[n]?p&&r[p]&&null!=r[p][n]&&"undefined"!=typeof r[p][n]&&(q=r[p][n]):q=r[n]);b[a._datapoints[c]]=q;c+=1;c<a._datapoints.length?(r=a._avr._getStateQuest(a._datapoints[c]),a._avr._doStateReq(r,d)):a._taskBuffer._finishLastTask(null,b)}},m=this._avr._getStateQuest(this._datapoints[c]);this._avr._doStateReq(m,d)};e.prototype.merge=function(a){if(a&&a._datapoints)if(this._datapoints){a=this._datapoints.concat(a._datapoints);for(var b=0;b<
a.length;++b)for(var c=b+1;c<a.length;++c)a[b]===a[c]&&a.splice(c,1);this._datapoints=a}else this._datapoints=a._datapoints};var h=function(a,b,c,d){this._taskBuffer=a;this._avr=b;this._commandTxt=c;this._callback=d};h.prototype.run=function(){this._avr._logger.log("debug","run command task: "+this._commandTxt);var a=this,b=this._avr._getCommandQuest(this._commandTxt);this._avr._doCommandReq(b,function(c){!c||1!=c.errorCode&&2!=c.errorCode&&3!=c.errorCode?a._taskBuffer._finishLastTask(c):a._taskBuffer._finishAllTask(c)})};
var k=function(a){this._avr=a;this._buffer=[]};k.prototype.executeTask=function(a){if(0==this._buffer.length)this._buffer.push(a),this._doNextTask();else{if(!(a instanceof h)&&a instanceof e){var b=[];if(1<this._buffer.length){for(var c=1;c<this._buffer.length;c++)this._buffer[c]&&this._buffer[c]instanceof e&&(b.push(c),a.merge(this._buffer[c]));for(c=0;c<b.length;c++)this._buffer.splice(b[c],1)}}this._buffer.push(a)}};k.prototype._doNextTask=function(){0!=this._buffer.length&&this._buffer[0].run()};
k.prototype._finishLastTask=function(a,b){if(0<this._buffer.length){var c=this._buffer[0];c&&c._callback&&(c._callback(a,b),c._callback=null);this._buffer.splice(0,1)}this._doNextTask()};k.prototype._finishAllTask=function(a){var b=this._buffer;this._buffer=[];for(var c=0;c<b.length;c++)b[c]&&b[c]._callback&&(b[c]._callback(a),b[c]._callback=null)};var f=function(a){this._avr=a;this._buffer=[];this._bufferEmptyTo=null};f.prototype.RESPONSE_TO=500;f.prototype.sendPacket=function(a,b,c){if(a){var d=
this._buffer.length;this._buffer.push({packet:a,ignoreRsp:b,callback:c});this._bufferEmptyTo&&(clearTimeout(this._bufferEmptyTo),this._bufferEmptyTo=null);0==d&&this._sendNextPacket()}else c&&c(Error("ISCP message is null"))};f.prototype._sendNextPacket=function(){if(0!=this._buffer.length){var a=this,b=this._buffer[0];this._avr._sendPacket(b.packet,function(c){c?(c.errorCode=g[0],a._finishAllPacket(c)):b.ignoreRsp?a._finishLastPacket():b.timeout=setTimeout(function(){a._avr._logger.log("warn","packet response timeout");
var d=Error("packet reponse timeout");d.errorCode=g[3];a._finishLastPacket(d)},a.RESPONSE_TO)})}};f.prototype._finishLastPacket=function(a,b){0<this._buffer.length&&(this._buffer[0]&&(this._buffer[0].timeout&&(clearTimeout(this._buffer[0].timeout),this._buffer[0].timeout=null),this._buffer[0].callback&&(this._buffer[0].callback(a,b),this._buffer[0].callback=null)),this._buffer.splice(0,1));if(0==this._buffer.length){var c=this;this._bufferEmptyTo=setTimeout(function(){c._bufferEmptyTo=null;0==c._buffer.length&&
c._avr._disconnect()},500)}else this._sendNextPacket()};f.prototype._finishAllPacket=function(a){var b=this._buffer;this._buffer=[];this._bufferEmptyTo&&(clearTimeout(this._bufferEmptyTo),this._bufferEmptyTo=null);for(var c=0;c<b.length;c++)b[c]&&(b[c].timeout&&(clearTimeout(b[c].timeout),b[c].timeout=null),b[c].callback&&(b[c].callback(a),b[c].callback=null))};f.prototype._onSocketData=function(a){a=new Buffer(a);a=a.toString("hex");a=new Buffer(a,"hex");var b=a.toString();if(0<this._buffer.length&&
this._buffer[0]&&this._buffer[0].packet)if("?"==this._buffer[0].packet.substr(0,1)){a=b.split("\r");-1!=b.indexOf("\n")&&(a=b.split("\n"));b=this._avr._getRspPrefix(this._buffer[0].packet);for(var c=!1,d="",m=0;m<a.length;m++)if(b&&a[m]&&0==a[m].indexOf(b)){this._finishLastPacket(null,a[m].trim());break}else 0==a[m].indexOf("E")&&(c=!0,d=a[m]);c&&(a=Error("pioneer response error code:"+d),a.errorCode=g[4],this._finishLastPacket(a))}else this._finishLastPacket(null,b)};f.prototype._onSocketTimeout=
function(){};f.prototype._onSocketError=function(a){a.errorCode=g[1];this._finishAllPacket(a)};f.prototype._onSocketClose=function(a){a=Error("socket closed");a.errorCode=g[2];this._finishAllPacket(a)};var l=function(a,b,c,d,m){this._ip=a;this._port=b;this._port||(this._port=23);this._uuid=c;this._name=d;this._model=m;this._logger=require("x.logger.js").getLogger("xnm.aio.pioneer.AVReceiver");this._socket=null;this._taskBuffer=new k(this);this._packetBuffer=new f(this)};l.prototype.executeCommandCreator=
function(a,b,c){if(b&&b.value)if("openNative"==b.value)window&&window.XC&&window.XC.callHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?window.XC.callHost("SYSTEM","startApp",{scheme:"icontrolav5://"}):"Android"==window.XCHost.getType()&&window.XC.callHost("SYSTEM","startApp",{scheme:"jp.pioneer.avsoft.android.icontrolav2014"})),c&&c();else{a="";b.path&&b.path[0]&&"global"!=b.path[0]&&(a=b.path[0]+":");var d=a+b.value;if("setTo"==b.value||"tuner"==b.value){if(null==b.ext||"undefined"==
typeof b.ext){c&&c(Error("command setTo ext format invalid"));return}d+=b.ext}else if("audioMode"==b.value){if(!b.ext){c&&c(Error("command audioMode ext format invalid"));return}d=a+b.ext}else if("setInput"==b.value){if(!b.ext){c&&c(Error("command setInput ext format invalid"));return}d=a+b.ext}else if("setTone"==b.value){if(!b.ext){c&&c(Error("command setTone ext format invalid"));return}d+=b.ext}else if("bassTo"==b.value||"trebleTo"==b.value){if(null==b.ext||"undefined"==typeof b.ext){c&&c(Error("command ext format invalid"));
return}d+=b.ext}else if("customCMD"==b.value){if(!b.ext){c&&c(Error("command customCMD ext format invalid"));return}d=a+b.ext}this._executeCommand(d,function(m){m?c&&c(m):b.path&&b.path[0]&&"mainzone"==b.path[0]&&("on"==b.value||"off"==b.value||"toggle"==b.value)?setTimeout(function(){c&&c()},5E3):c&&c()})}else c&&c(Error("command json format invalid"))};l.prototype.getStatesCreator=function(a,b,c){a=function(q,u){for(var t=0;t<u.length;t++)if(u[t]===q)return!0;return!1};for(var d=[],m=[],n=0;n<b.length;n++)if(b[n]&&
b[n].id&&b[n].status&&b[n].status.value){var r="";b[n].status.path&&b[n].status.path[0]&&"global"!=b[n].status.path[0]&&(r=b[n].status.path[0]+":");var p=b[n].status.value;d.push({id:b[n].id,datapoint:r+p});a(r+p,m)||m.push(r+p)}this._getStates(m,function(q,u){if(q)c&&c(q);else{q=[];for(var t=0;t<d.length;t++){var w="?",x=d[t].id,v=d[t].datapoint;u&&null!=u[v]&&"undefined"!=typeof u[v]&&(w=u[v]);q.push({id:x,status:w})}c&&c(null,q)}})};l.prototype.executeCommand=function(a,b){this._executeCommand(a,
b)};l.prototype.getStates=function(a){var b=Object.keys(l.STATUS_DPT_QUEST);this._getStates(b,function(c,d){a&&a(c,d)})};l.prototype._executeCommand=function(a,b){this._logger.log("debug","execute command: "+a);a=new h(this._taskBuffer,this,a,b);this._taskBuffer.executeTask(a)};l.prototype._getStates=function(a,b){this._logger.log("debug","get states: "+JSON.stringify(a));a=new e(this._taskBuffer,this,a,b);this._taskBuffer.executeTask(a)};l.prototype._getCommandQuest=function(a){console.log("pionner",
a);var b=a,c=null,d=a.indexOf(":");0<d&&(c=a.substr(0,d),a=a.substr(d+1));if("on"==a)b="zoneHD"==c?"ZEO":"zone3"==c?"BPO":"zone2"==c?"APO":"PO";else if("off"==a)b="zoneHD"==c?"ZEF":"zone3"==c?"BPF":"zone2"==c?"APF":"PF";else if("toggle"==a)b="zoneHD"==c?"ZEZ":"zone3"==c?"BPZ":"zone2"==c?"APZ":"PZ";else if("mute"==a)b="zoneHD"==c?"HZMO":"zone3"==c?"Z3MO":"zone2"==c?"Z2MO":"MO";else if("unmute"==a)b="zoneHD"==c?"HZMF":"zone3"==c?"Z3MF":"zone2"==c?"Z2MF":"MF";else if("toggleMute"==a)b="zoneHD"==c?"HZMZ":
"zone3"==c?"Z3MZ":"zone2"==c?"Z2MZ":"MZ";else if("volumeUp"==a)b="zoneHD"==c?"HZU":"zone3"==c?"YU":"zone2"==c?"ZU":"VU";else if("volumeDown"==a)b="zoneHD"==c?"HZD":"zone3"==c?"YD":"zone2"==c?"ZD":"VD";else if("BD"==a||"DVD"==a||"SAT/CBL"==a||"DVR/BDR"==a||"HDMI1"==a||"HDMI2"==a||"HDMI3"==a||"HDMI4"==a||"HDMI5"==a||"HDMI6"==a||"HDMI7"==a||"NETRADIO"==a||"Spotify"==a||"MEDIASERVER"==a||"FAVORITES"==a||"iPod/USB"==a||"TV"==a||"TUNER"==a||"BTAUDIO"==a||"CD"==a){switch(a){case "BD":b="25";break;case "DVD":b=
"04";break;case "SAT/CBL":b="06";break;case "DVR/BDR":b="15";break;case "HDMI1":b="19";break;case "HDMI2":b="20";break;case "HDMI3":b="21";break;case "HDMI4":b="22";break;case "HDMI5":b="23";break;case "HDMI6":b="24";break;case "HDMI7":b="34";break;case "NETRADIO":b="38";break;case "Spotify":b="53";break;case "MEDIASERVER":b="44";break;case "FAVORITES":b="45";break;case "iPod/USB":b="17";break;case "TV":b="05";break;case "TUNER":b="02";break;case "BTAUDIO":b="33";break;case "CD":b="01"}b="zoneHD"==
c?b+"ZEA":"zone3"==c?b+"ZT":"zone2"==c?b+"ZS":b+"FN"}else if("AUTO"==a||"MOVIE"==a||"MUSIC"==a||"GAME"==a||"ALC"==a||"DIRECT"==a||"PURE_DIRECT"==a||"F.S.SURR_FOCUS"==a||"DRAMA"==a||"ACTION"==a||"CLASSICAL"==a||"ROCK/POP"==a||"EXT_STEREO"==a||"ADV_GAME"==a||"SPORT"==a)"AUTO"==a?b="0006SR":"MOVIE"==a?b="0101SR":"MUSIC"==a?b="0041SR":"GAME"==a?b="0118SR":"ALC"==a?b="0151SR":"DIRECT"==a?b="0007SR":"PURE_DIRECT"==a?b="0008SR":"F.S.SURR_FOCUS"==a?b="0003SR":"DRAMA"==a?b="0103SR":"ACTION"==a?b="0101SR":
"CLASSICAL"==a?b="0107SR":"ROCK/POP"==a?b="0110SR":"EXT_STEREO"==a?b="0041SR":"ADV_GAME"==a?b="0118SR":"SPORT"==a&&(b="0117SR");else if("play"==a)switch(c){case "net":b="10NW"}else if("pause"==a)switch(c){case "net":b="11NW"}else if("stop"==a)switch(c){case "net":b="20NW"}else if("previous"==a)switch(c){case "net":b="12NW"}else if("next"==a)switch(c){case "net":b="13NW"}else if("enter"==a)switch(c){case "net":b="30NW"}else if("return"==a)switch(c){case "net":b="31NW"}else if("up"==a)switch(c){case "net":b=
"26NW"}else if("down"==a)switch(c){case "net":b="27NW"}else if("right"==a)switch(c){case "net":b="28NW"}else if("left"==a)switch(c){case "net":b="29NW"}else if(0==a.indexOf("setTone"))switch(a=a.replace(/setTone/g,""),c){case "mainzone":"ON"==a?b="1TO":"BYPASS"==a&&(b="0TO")}else if(0==a.indexOf("tuner"))a=a.replace(/tuner/g,""),b="Up"==a?"TPI":"Down"==a?"TPD":2==a.length?a.charAt(0)+"0"+a.charAt(1)+"PR":3==a.length?a+"PR":a.charAt(0)+"TP";else if(0==a.indexOf("bass"))if(a=a.replace(/bass/g,""),"Up"==
a)switch(c){case "mainzone":b="BI"}else if("Down"==a)switch(c){case "mainzone":b="BD"}else{a=a.replace(/To/g,"");a=a.replace(/%/g,"");a=parseInt(a);-6>a?a=-6:6<a&&(a=6);for(a=(6-a).toString();2>a.length;)a="0"+a;b=a+"BA"}else if(0==a.indexOf("treble"))if(a=a.replace(/treble/g,""),"Up"==a)switch(c){case "mainzone":b="TI"}else if("Down"==a)switch(c){case "mainzone":b="TD"}else{a=a.replace(/To/g,"");a=a.replace(/%/g,"");a=parseInt(a);-6>a?a=-6:6<a&&(a=6);for(a=(6-a).toString();2>a.length;)a="0"+a;b=
a+"TR"}else if(0==a.indexOf("setTo")||/^\d+$/.test(a))if(0==a.indexOf("setTo")&&(a=a.replace(/setTo/g,"")),a=a.replace(/%/g,""),"zone2"==c||"zone3"==c||"zoneHD"==c){b="ZV";"zone3"==c?b="YV":"zoneHD"==c&&(b="HZV");a=parseInt(a);-81>a?a=-81:0<a&&(a=0);for(a=(a+81).toString();2>a.length;)a="0"+a;b=a+b}else{a=parseFloat(a);-80.5>a?a=-80.5:12<a&&(a=12);for(a=((a+80.5)/.5).toString();3>a.length;)a="0"+a;b=a+"VL"}console.log("cmd",b);return b};l.STATUS_DPT_QUEST={audioMode:"?S","mainzone:power":"?P","mainzone:volume":"?V",
"mainzone:mute":"?M","mainzone:input":"?F","mainzone:tone":"?TO","mainzone:bass":"?BA","mainzone:treble":"?TR","zone2:power":"?AP","zone2:volume":"?ZV","zone2:mute":"?Z2M","zone2:input":"?ZS","zone3:power":"?BP","zone3:volume":"?YV","zone3:mute":"?Z3M","zone3:input":"?ZT","zoneHD:power":"?ZEP","zoneHD:volume":"?HZV","zoneHD:mute":"?HZM","zoneHD:input":"?ZEA"};l.prototype._getStateQuest=function(a){return a?l.STATUS_DPT_QUEST[a]:null};l.STATUS_RSP_PREFIX={"?S":"SR","?V":"VOL","?P":"PWR","?M":"MUT",
"?F":"FN","?TO":"TO","?BA":"BA","?TR":"TR","?AP":"APR","?ZV":"ZV","?ZS":"Z2F","?Z2M":"Z2MUT","?BP":"BPR","?YV":"YV","?ZT":"Z3F","?Z3M":"Z3MUT","?ZEP":"ZEP","?HZV":"XV","?HZM":"HZMUT","?ZEA":"ZEA"};l.prototype._getRspPrefix=function(a){return a?l.STATUS_RSP_PREFIX[a]:null};l.prototype._buildData=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));b.push(13);return new Buffer(b)};l.prototype._resolveStatus=function(a){var b=function(m){if("string"==typeof m){if(m)for(;"0"==m.charAt(0)&&
1<m.length;)m=m.substr(1);return parseInt(m)}return parseInt(m)},c={mainzone:{},zone2:{},zone3:{},zoneHD:{}};if(0==a.indexOf("VOL"))c.mainzone.volume=.5*b(a.substr(3,3))-80.5;else if(0==a.indexOf("BA"))c.mainzone.bass=6-b(a.substr(2,2));else if(0==a.indexOf("TR"))c.mainzone.treble=6-b(a.substr(2,2));else if(0==a.indexOf("ZV")||0==a.indexOf("YV")||0==a.indexOf("XV")){var d=c.zone2;0==a.indexOf("YV")?d=c.zone3:0==a.indexOf("XV")&&(d=c.zoneHD);d.volume=b(a.substr(2,2))-81}else if(0==a.indexOf("PWR")||
0==a.indexOf("APR")||0==a.indexOf("BPR")||0==a.indexOf("ZEP"))d=c.mainzone,0==a.indexOf("APR")?d=c.zone2:0==a.indexOf("BPR")?d=c.zone3:0==a.indexOf("ZEP")&&(d=c.zoneHD),"0"==a.substr(3,1)?d.power="on":d.power="off";else if(0==a.indexOf("MUT")||0==a.indexOf("Z2MUT")||0==a.indexOf("Z3MUT")||0==a.indexOf("HZMUT"))d=c.mainzone,b=a.substr(3,1),0==a.indexOf("Z2MUT")?(d=c.zone2,b=a.substr(5,1)):0==a.indexOf("Z3MUT")?(d=c.zone3,b=a.substr(5,1)):0==a.indexOf("HZMUT")&&(d=c.zoneHD,b=a.substr(5,1)),d.mute="0"==
b?"on":"off";else if(0==a.indexOf("SR"))switch(a=a.trim(),a.substr(2)){case "0006":c.audioMode="AUTO";break;case "0101":c.audioMode="MOVIE";break;case "0041":c.audioMode="MUSIC";break;case "0118":c.audioMode="GAME";break;case "0151":c.audioMode="ALC";break;case "0007":c.audioMode="DIRECT";break;case "0008":c.audioMode="PURE_DIRECT";break;case "0003":c.audioMode="F.S.SURR_FOCUS";break;case "0103":c.audioMode="DRAMA";break;case "0107":c.audioMode="CLASSICAL";break;case "0110":c.audioMode="ROCK/POP";
break;case "0117":c.audioMode="SPORT"}else if(0==a.indexOf("FN")||0==a.indexOf("Z2F")||0==a.indexOf("Z3F")||0==a.indexOf("ZEA"))switch(d=c.mainzone,b=a.substr(2),0==a.indexOf("Z2F")?(d=c.zone2,b=a.substr(3)):0==a.indexOf("Z3F")?(d=c.zone3,b=a.substr(3)):0==a.indexOf("ZEA")&&(d=c.zoneHD,b=a.substr(3)),b){case "25":d.input="BD";break;case "04":d.input="DVD";break;case "06":d.input="SAT/CBL";break;case "15":d.input="DVR/BDR";break;case "19":d.input="HDMI1";break;case "20":d.input="HDMI2";break;case "21":d.input=
"HDMI3";break;case "22":d.input="HDMI4";break;case "23":d.input="HDMI5";break;case "24":d.input="HDMI6";break;case "34":d.input="HDMI7";break;case "38":d.input="NETRADIO";break;case "53":d.input="Spotify";break;case "44":d.input="MEDIASERVER";break;case "45":d.input="FAVORITES";break;case "17":d.input="iPod/USB";break;case "05":d.input="TV";break;case "01":d.input="CD";break;case "02":d.input="TUNER";break;case "33":d.input="BTAUDIO"}else 0==a.indexOf("TO")&&(d=c.mainzone,"0"==a.substr(2,1)?d.tone=
"BYPASS":"1"==a.substr(2,1)&&(d.tone="ON"));return c};l.prototype._doCommandReq=function(a,b){this._packetBuffer.sendPacket(a,!0,b)};l.prototype._doStateReq=function(a,b){var c=this;this._packetBuffer.sendPacket(a,!1,function(d,m){d?b(d):(d=c._resolveStatus(m),b(null,d))})};l.prototype._sendPacket=function(a,b){if(this._socket){this._logger.log("trace","send packet:"+a);var c=this._buildData(a);this._socket.write(c,"binary");b()}else{var d=this;this._connect(function(m){m?b(m):d._sendPacket(a,b)})}};
l.prototype._connect=function(a){this._socket&&(this._socket.end(),this._socket=null);var b=this,c={port:this._port,host:this._ip},d=require("net").connect(c);d.setTimeout(1E3);d.__connected=!1;d.on("connect",function(){b._logger.log("trace","connect to pioneer avr:"+b._ip);d.__connected=!0;b._socket=d;a()});d.on("data",function(m){b._logger.log("trace","receive from pioneer avr "+(d.__disconnected?"(closed)":"")+":"+b._ip+" data:"+m);d.__disconnected||b._packetBuffer._onSocketData(m)});d.on("error",
function(m){d.__connected?(b._logger.log("trace","pioneer avr"+(d.__disconnected?"(closed)":"")+":"+b._ip+" error:"+m.message),d.destroy(),d.__disconnected||(d.__disconnected=!0,b._socket=null,b._packetBuffer._onSocketError(m))):(b._logger.log("trace","pioneer avr:"+b._ip+" connection error:"+m.message),a(m))});d.on("timeout",function(){d.__connected?(b._logger.log("trace","pioneer avr"+(d.__disconnected?"(closed)":"")+":"+b._ip+" data timeout"),d.__disconnected||b._packetBuffer._onSocketTimeout()):
(b._logger.log("trace","pioneer avr:"+b._ip+" connection timeout"),d.destroy&&d.destroy(),a(Error("timeout")))});d.on("close",function(){b._logger.log("trace","pioneer avr"+(d.__disconnected?"(closed)":"")+":"+b._ip+" close socket");d.__disconnected||(d.__disconnected=!0,b._socket=null,b._packetBuffer._onSocketClose(d))});d._doConnect&&"function"==typeof d._doConnect&&d._doConnect();return d};l.prototype._disconnect=function(){this._logger.log("debug","disconnect socket");this._socket&&(this._socket.__disconnected=
!0,this._socket.end(),this._socket=null)};l.prototype.toJSON=function(){var a={sys:xnm.aio.pioneer.DM.SYS,type:"avr",ip:this._ip,port:this._port,uuid:this._uuid};this._name&&(a.name=this._name);this._model&&(a.model=this._model);return a};l.prototype.equalsTo=function(a){return a&&a instanceof l?this._ip==a._ip&&this._port==a._port:!1};l.parseJSON=function(a){return a.ip?new l(a.ip,a.port,a.uuid,a.name,a.model):null};return l}();
xnm.aio.pioneer.DM=function(){var g=function(h,k){this.code=h;this.message=k;this.stack=Error().stack};g.prototype=Error();g.prototype.name="PioneerDMError";g.prototype.code=0;g.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var e={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"open pioneer iControlAV5",ref:{value:"openNative",value_t:"open_app_pioneer"}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},
{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"enum",name:"set tuner to preset",ref:{value:"tuner",ext:"%e",extMeta:"A1 A2 A3 A4 A5 A6 A7 A8 A9 B1 B2 B3 B4 B5 B6 B7 B8 B9 C1 C2 C3 C4 C5 C6 C7 C8 C9 D1 D2 D3 D4 D5 D6 D7 D8 D9 E1 E2 E3 E4 E5 E6 E7 E8 E9 F1 F2 F3 F4 F5 F6 F7 F8 F9 G1 G2 G3 G4 G5 G6 G7 G8 G9".split(" ")}},{type:"enum",name:"set listening mode",ref:{value:"audioMode",ext:"%e",extMeta:"MOVIE MUSIC GAME AUTO ALC DIRECT PURE_DIRECT F.S.SURR_FOCUS DRAMA CLASSICAL ROCK/POP SPORT".split(" ")}},
{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}}]},{type:"root",name:"NET Radio",value:"net",children:[{type:"enum",name:"play",ref:{path:["global"],value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",ref:{value:"return"}},{type:"enum",name:"up",ref:{value:"up"}},
{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",
value_t:"volumeTo",unit:"db",ext:"%f",extMeta:"-80.5-12.0",scale:"0.5"}},{type:"enum",name:"set tone",ref:{value:"setTone",ext:"%e",extMeta:["BYPASS","ON"]}},{type:"enum",name:"bass up",ref:{value:"bassUp"}},{type:"enum",name:"bass down",ref:{value:"bassDown"}},{type:"int",name:"bass to",ref:{value:"bassTo",unit:"db",ext:"%d",extMeta:"-6-6",scale:"1"}},{type:"enum",name:"treble up",ref:{value:"trebleUp"}},{type:"enum",name:"treble down",ref:{value:"trebleDown"}},{type:"int",name:"treble to",ref:{value:"trebleTo",
unit:"db",ext:"%d",extMeta:"-6-6",scale:"1"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]},{type:"root",name:"zone 2",value:"zone2",children:[{type:"enum",name:"power on",ref:{value:"on"}},
{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",ext:"%d",extMeta:"-81-0",scale:"1"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"set input",
ref:{value:"setInput",ext:"%e",extMeta:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]},{type:"root",name:"zone 3",value:"zone3",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},
{type:"int",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",ext:"%d",extMeta:"-81-0",scale:"1"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]},{type:"root",name:"zone HD",
value:"zoneHD",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",ext:"%d",extMeta:"-81-0",scale:"1"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",
ref:{value:"toggleMute"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]}],status:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"listening mode",ref:{value:"audioMode",options:["MOVIE","MUSIC","GAME","AUTO"]}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",
unit:"db",extMeta:"-80.5-12.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}},{type:"enum",name:"tone",ref:{value:"tone",options:["ON","BYPASS"]}},{type:"int",name:"bass",ref:{value:"bass",unit:"db",
extMeta:"-6-6",scale:"1"}},{type:"int",name:"treble",ref:{value:"treble",unit:"db",extMeta:"-6-6",scale:"1"}}]},{type:"root",name:"zone 2",value:"zone2",children:[{type:"int",name:"volume",ref:{value:"volume",extMeta:"-81-0",scale:"1"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]},
{type:"root",name:"zone 3",value:"zone3",children:[{type:"int",name:"volume",ref:{value:"volume",extMeta:"-81-0",scale:"1"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]},{type:"root",name:"zone HD",value:"zoneHD",
children:[{type:"int",name:"volume",ref:{value:"volume",extMeta:"-81-0",scale:"1"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"BD DVD SAT/CBL DVR/BDR HDMI1 HDMI2 HDMI3 HDMI4 HDMI5 HDMI6 HDMI7 NETRADIO Spotify MEDIASERVER FAVORITES iPod/USB TV TUNER BTAUDIO CD".split(" ")}}]}]}};return{SYS:"pioneer",getIPDeviceType:function(){return[{sys:this.SYS,name:"Pioneer AV Receiver",
type:"avr"}]},createDevice:function(h,k,f){k=g.ERROR_CODE;h?h.ip?f(null,h):f(new g(k.INVALID,"ip is invalid")):f(new g(k.INVALID,"info is invalid"))},updateDevice:function(h,k,f){k=g.ERROR_CODE;h?h.ip?f(null,h):f(new g(k.INVALID,"ip is invalid")):f(new g(k.INVALID,"info is invalid"))},deleteDevice:function(h,k,f){f()},applyUIFilter:function(h,k,f){var l=function(d,m,n){var r=[];d.forEach(function(p){if("root"==p.type){p=JSON.parse(JSON.stringify(p));var q=l(p.children,m,n);q&&0<q.length&&(p.children=
q,r.push(p))}else{q=n.elems;if("*"==q)q=!0;else{for(var u=!1,t=0;t<q.length;t++)if(q[t]==p.type){u=!0;break}q=u}q&&(p=JSON.parse(JSON.stringify(p)),r.push(p))}});return r},a=function(d,m){var n=[],r=xnm.aio.pioneer.DM.getCommandStatusMap(d,f);if(r){var p=[];switch(m.catagory){case "command":r.command&&(p=l(r.command,d,m));break;case "status":r.status&&(p=l(r.status,d,m))}n=n.concat(p)}return n};if(!h.sys)return null;var b=JSON.parse(JSON.stringify(h)),c=null;switch(k.catagory){case "command":c=a(h,
k);b.command=c;break;case "status":c=a(h,k);b.status=c;break;default:return null}return c&&0!=c.length?b:null},getCommandStatusMap:function(h){return h&&h.type?e[h.type]:null}}}();
xnm.aio.pioneer.Handler=function(){var g=function(){this.detected={}};g.prototype.devicemanager=xnm.aio.pioneer.DM;g.prototype.AVReceiver=xnm.aio.pioneer.AVReceiver;g.prototype.registModule=function(e){e.register(xnm.aio.pioneer.DM.SYS,"pioneer")};g.prototype.resolveDevice=function(e){if(!e)return null;switch(e.type){case "avr":return xnm.aio.pioneer.AVReceiver.parseJSON(e);default:return null}};g.prototype.getDeviceCommands=function(e,h){e=(e=xnm.aio.pioneer.DM.applyUIFilter(e,{catagory:"command",
elems:"*"}))?e.command:[];h&&h(null,e)};g.prototype.getDeviceStatus=function(e,h){e=(e=xnm.aio.pioneer.DM.applyUIFilter(e,{catagory:"status",elems:"*"}))?e.status:[];h&&h(null,e)};g.prototype.doCommand=function(e,h,k){var f=this.resolveDevice(e);f?f.executeCommandCreator(e,h,function(l){k&&k(l)}):k&&k(Error("device json format invalid"))};g.prototype.doStatus=function(e,h,k,f){var l=this.resolveDevice(h);l?l.getStatesCreator(null,[{id:e,device:h,status:k}],function(a,b){a?f&&f(a):f&&f(null,b[0])}):
f&&f(Error("device json format invalid"))};g.prototype.getDeviceCommandList=function(e,h,k){var f=[];if(h)f.push({id:window.XC_Text.on,cmd:"on"}),f.push({id:window.XC_Text.off,cmd:"off"});else if(k&&"avr"==e.type){e=[];e.push({id:"on",cmd:"on"});e.push({id:"off",cmd:"off"});e.push({id:"toggle",cmd:"toggle"});e.push({id:"volumeDown",cmd:"volumeDown"});e.push({id:"volumeUp",cmd:"volumeUp"});e.push({id:"set volume",cmd:"setTo",step:"1",max:"80"});e.push({id:"mute",cmd:"mute"});e.push({id:"unmute",cmd:"unmute"});
e.push({id:"toggleMute",cmd:"toggleMute"});e.push({id:"CBLSAT",cmd:"CBLSAT"});e.push({id:"BDDVD",cmd:"BDDVD"});e.push({id:"STRMBOX",cmd:"STRMBOX"});e.push({id:"GAME",cmd:"GAME"});e.push({id:"AUX",cmd:"AUX"});e.push({id:"PC",cmd:"PC"});e.push({id:"CD",cmd:"CD"});e.push({id:"TV",cmd:"TV"});e.push({id:"NET",cmd:"NET"});e.push({id:"BLUETOOTH",cmd:"BLUETOOTH"});e.push({id:"FM",cmd:"FM"});e.push({id:"AM",cmd:"AM"});e.push({id:"tunerUp",cmd:"tunerUp"});e.push({id:"tunerDown",cmd:"tunerDown"});e.push({id:"set tuner to",
cmd:"tuner",step:"1",min:"1",max:"40"});cl=e.length;for(h=0;h<cl;h++)k=JSON.parse(JSON.stringify(e[h])),k.ch="mainzone",f.push(k),k=JSON.parse(JSON.stringify(e[h])),k.ch="zone2",f.push(k);f.push({id:"MOVIE",cmd:"MOVIE"});f.push({id:"MUSIC",cmd:"MUSIC"});f.push({id:"GAME",cmd:"GAME"});f.push({id:"STEREO",cmd:"STEREO"});f.push({id:"play",cmd:"play"});f.push({id:"pause",cmd:"pause"});f.push({id:"stop",cmd:"stop"});f.push({id:"previous",cmd:"previous"});f.push({id:"next",cmd:"next"})}return f};g.prototype.discover=
function(e){var h=require("x.upnp.js");if(h){var k=this;h.discoverDevicesWithTimeout(3E3,function(f){if(f.manufacturer&&-1!=f.manufacturer.toLowerCase().indexOf("pioneer")&&f.modelName&&(-1!=f.modelName.toLowerCase().indexOf("vsx")||-1!=f.modelName.toLowerCase().indexOf("sc"))){var l=f.modelName,a=l.indexOf("/");-1!=a&&(l=l.substr(0,a));l=new xnm.aio.pioneer.AVReceiver(f.ip,0,f.uuid,f.name,l);k.detected[f.uuid]=l;e(l)}})}};g.prototype.discoverWithTimeout=function(e,h){var k={};this.discover(function(f){f&&
f._uuid&&!k[f._uuid]&&(k[f._uuid]=f)});setTimeout(function(){var f=[],l;for(l in k)k.hasOwnProperty(l)&&f.push(k[l]);h&&h(null,f)},e)};return g}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.pioneer.Handler);

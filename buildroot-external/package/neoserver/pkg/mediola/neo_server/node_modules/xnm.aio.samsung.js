var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.samsung=xnm.aio.samsung||{};
xnm.aio.samsung.TV=function(){var k=function(d,a){this.code=d;this.callback=a;this._socket=this._tv=null;this._state=0};k.prototype.run=function(d){this._tv=d;var a=this;this._state=1;d._connect({onError:function(b){a._finish(b)},onTimeout:function(){a._finish(Error("response timeout"))},onData:function(b){if(2==a._state)if(b=d._resolveAuthRsp(d._hex2arr(b)),1!=b){var c="";-1==b?c="data format invalid":2==b?c="access denied":3==b?c="waiting for grant":4==b&&(c="timeout or cancelled");c=Error("auth error:"+
c);c.code=b;a._socket.end();a._finish(c)}else a._state=3,a.code&&(20>a.code.length?(b=d._str2b64arr(a.code.trim()),c=[b.length+5,0,0,0,0,b.length,0],c=c.concat(b),c=d._buildReq(c)):c=d._buildReq(d._hex2arr(a.code.trim()))),d._logger&&d._logger.log("trace","send samsung request:"+d._arr2hex(c)),a._socket.write(new Buffer(c));else 3==a._state&&(a._socket.end(),a._finish())},onClose:function(){a._finish()}},function(b,c){b?a._finish(b):(a._socket=c,b=d._buildAuth(),a._state=2,d._logger&&d._logger.log("trace",
"send samsung auth request:"+d._arr2hex(b)),c.write(new Buffer(b)))})};k.prototype._finish=function(d){d&&this._tv._logger.log("warn","execute samsung command error:"+d.message);this.callback&&this.callback(d);this.callback=null;this._tv._finishTask(this)};var h=function(d,a){this.ip=d;this.port=a;this.port||(this.port=55E3);this._logger=require("x.logger.js").getLogger("xnm.aio.samsung.TV");this._tasks=[]};h.HEADER=[0,19,0,105,112,104,111,110,101,46,105,97,112,112,46,115,97,109,115,117,110,103];
h.prototype._executeCommand=function(d,a){d=new k(d,a);this._addTask(d)};h.prototype._addTask=function(d){var a=this._tasks.length;this._tasks.push(d);0==a&&this._doNextTask()};h.prototype._doNextTask=function(){this._tasks&&0<this._tasks.length&&this._tasks[0].run(this)};h.prototype._finishTask=function(d){this._tasks&&this._tasks[0]===d&&(this._tasks.splice(0,1),this._doNextTask())};h.prototype._buildAuth=function(){var d=this._str2b64arr("127.0.0.1"),a=[d.length&255,d.length>>8&255],b=this._str2b64arr("00-00-00-00-00-00"),
c=[b.length&255,b.length>>8&255],f=this._str2b64arr("aioRemote"),e=[f.length&255,f.length>>8&255],g=4+d.length+2+b.length+2+f.length;g=[g&255,g>>8&255];return[].concat(h.HEADER).concat(g).concat([100,0]).concat(a).concat(d).concat(c).concat(b).concat(e).concat(f)};h.prototype._resolveAuthRsp=function(d){if(3>d.length)return-1;var a=(d[2]<<8)+d[1];if(d.length<3+a)return-1;d=d.slice(3+a);if(2>d.length)return-1;a=(d[1]<<8)+d[0];if(d.length<2+a)return-1;d=d.slice(2,2+a);return 101==d[0]?4:10==d[0]?3:
100==d[0]&&0==d[2]?2:100==d[0]&&1==d[2]?1:-1};h.prototype._buildReq=function(d){return[].concat(h.HEADER).concat(d)};h.prototype._str2b64arr=function(d){d=(new Buffer(d)).toString("base64");for(var a=[],b=0;b<d.length;b++){var c=d.charCodeAt(b);a.push(c)}return a};h.prototype._hex2arr=function(d){for(var a=[],b=0;b<d.length;b+=2)a.push(parseInt(d.substr(b,2),16));return a};h.prototype._arr2hex=function(d){for(var a="",b=0;b<d.length;b++){for(var c=d[b].toString(16);2>c.length;)c="0"+c;a+=c.toUpperCase()}return a};
h.prototype._connect=function(d,a){var b=this,c={port:this.port,host:this.ip},f=!1,e=a,g=require("net").connect(c);d.__socket=g;g.setTimeout(1E4);g.setEncoding("hex");g.on("connect",function(){b._logger.log("trace","connect tcp to:"+b.ip);f=!0;if(e){var m=d.__socket;delete d.__socket;e(null,m)}});g.on("data",function(m){b._logger.log("trace","receive from tcp:"+b.ip+" data:"+m);d.onData(m)});g.on("error",function(m){f?(b._logger.log("trace","tcp:"+b.ip+" error:"+m.message),g.end(),d.onError(m)):(b._logger.log("trace",
"tcp:"+b.ip+" connection error:"+m.message),e&&(e(m),e=null))});g.on("timeout",function(){f?(b._logger.log("trace","tcp:"+b.ip+" data timeout"),g.end(),d.onTimeout()):(b._logger.log("trace","tcp:"+b.ip+" connection timeout"),g.end(),e&&(e(Error("connection timeout")),e=null))});g.on("close",function(){b._logger.log("trace","tcp:"+b.ip+" close socket");d.onClose()});g._doConnect&&"function"==typeof g._doConnect&&g._doConnect()};return h}();
xnm.aio.samsung.SmartHomeCloud=function(){var k=null,h=0,d=function(a,b){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.samsung.SmartHomeCloud");this._accessKey=a;this.userID=this.accessToken=null;this._appID="4199tgd4z8";this._appSecret="8913F3FF4E064526126408E0AD6E5911";this._channelKey="npbKUFXrEeIxhTwz3L3KrDI1GdooCfS37bG1dmSKctk=";this.userID=this.accessToken=null;k||(k=xnm.aio.samsung.SmartHomeCloud._StatusBuffer,h=xnm.aio.samsung.SmartHomeCloud._StatusBufferTO);
b?(this._server="simulator.cspserver.net",this._api="/api"):(this._server="api2.cspserver.net",this._api="/bridge/api");this.CommandHandler=null;this._getStateRunning=!1;this._getStateCallbacks=[]};d.prototype._sendRequest=function(a,b,c,f){var e=this;this.accessToken&&this.userID?this._doRequest(a,b,c,function(g,m,l){g&&401==l?(e._logger.log("debug","send request auth error"),e._getAuthToken(function(n){n?f&&f(n):e._doRequest(a,b,c,f)})):f&&f(g,m)}):(e._logger.log("debug","no accessToken or userID, do get auth token"),
this._getAuthToken(function(g){g?f&&f(g):e._sendRequest(a,b,c,f)}))};d.prototype._doRequest=function(a,b,c,f){a={host:this._server,path:this._api+b,method:a,headers:{"x-csp-channel-key":this._channelKey,"x-csp-appId":this._appID,"x-csp-userId":this.userID,Authorization:"Bearer "+this.accessToken,Connection:"close","Content-Type":"application/json;  charset=UTF-8"}};c&&(a.headers["Content-Length"]=c.length);b=require("https");"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED=
"0");this._logger.log("trace","do request:"+JSON.stringify(a));var e=this,g=f,m=b.request(a,function(l){l.setEncoding("utf-8");var n="";l.on("data",function(p){n+=p});l.on("end",function(){e._logger.log("trace","receive code:"+l.statusCode+" headers:"+JSON.stringify(l.headers)+" response:"+n);if(204!=l.statusCode)try{var p=n?JSON.parse(n):{}}catch(r){var q=r}204==l.statusCode?p={}:401==l.statusCode?q=Error("auth error"):200!=l.statusCode&&(q=Error("http reponse:"+l.statusCode));g&&(g(q,p,l.statusCode),
g=null)})});if(m.on)m.on("error",function(l){e._logger.log("trace","do request error:"+l.message);g&&(g(l),g=null)});m.setTimeout&&m.setTimeout(2E3,function(){e._logger.log("trace","do request timeout");m.abort();g&&(g(Error("timeout")),g=null)});c&&(this._logger.log("trace","do request send body:"+c),m.write(c));m.end()};d.prototype._getAuthToken=function(a){var b=this,c=a;$.ajax({type:"GET",url:"https://smsng.mediola.com/getAccessToken?ak="+this._accessKey,timeout:4E3,cache:!1,dataType:"json",success:function(f){b._logger.log("trace",
"get auth token response:"+JSON.stringify(f));if(f&&f.XC_SUC)b.userID=f.XC_SUC.user,b.accessToken=f.XC_SUC.token;else var e=f&&f.XC_ERR?Error(f.XC_ERR):Error("get auth token error:"+f?JSON.stringify(f):"empty");c&&(c(e,f,200),c=null)},error:function(f,e){e="get auth token error:"+(f?f.status:"0")+"-"+e;b._logger.log("trace",e);c&&(c(Error(e),f?f.responseText:null,f?f.status:null),c=null)}})};d.prototype._getBufferedStatus=function(a){for(var b in k)if(k.hasOwnProperty(b)){var c=k[b];if(c&&c.states&&
c.states[a])return c.states[a]}return null};d.prototype._getStates=function(a){var b=this;if(k[b._accessKey]&&k[b._accessKey].states){var c=k[b._accessKey].time;if(c&&(new Date).getTime()-c<h){a&&a(null,k[b._accessKey].states);return}}a&&-1==this._getStateCallbacks.indexOf(a)&&this._getStateCallbacks.push(a);this._getStateRunning||(this._getStateRunning=!0,this.getDevices(function(f,e){b._getStateRunning=!1;var g=b._getStateCallbacks;b._getStateCallbacks=[];if(f)g.forEach(function(q){q&&q(f)});else if(e&&
e.Devices){var m={};if(e=e.Devices)for(var l=0;l<e.length;l++)if(e[l]&&e[l].id){var n=xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[e[l].id],p=JSON.parse(JSON.stringify(e[l]));p.Alarms=n;n=null;switch(p.type){case "Refrigerator":n=b._resolveFridgeStates(p);break;case "Washer":n=b._resolveWasherStates(p);break;case "Air_Conditioner":n=b._resolveACStates(p);break;case "Oven":n=b._resolveOvenStates(p);break;case "Dryer":n=b._resolveDryerStates(p);break;case "Robot_Cleaner":n=b._resolveRobotStates(p);break;
case "Air_Purifier":n=b._resolveAPStates(p)}n&&(m[e[l].id]=n)}k[b._accessKey]={time:(new Date).getTime(),states:m};g.forEach(function(q){q&&q(null,m)})}else g.forEach(function(q){q&&q(null,{})})}))};d.prototype._resolveFridgeStates=function(a){var b={};"undefined"!=typeof a.connected&&null!=a.connected&&(b.frdgConn=a.connected);a.Doors&&a.Doors.forEach(function(f){f&&f.id&&(f.openState&&(b["frdgDoorState"+f.id]="Close"==f.openState?"closed":"open"),f.name&&(b["frdgDoorName"+f.id]=f.name))});if(a.Fridge&&
a.Fridge.filterState){switch(a.Fridge.filterState){case "1":var c="good";break;case "2":c="order";break;case "3":c="replace"}c&&(b.frdgFilterState=c)}a.Temperatures&&a.Temperatures.forEach(function(f){if(f&&f.id){if(f.unit)switch(f.unit){case "Fahrenheit":b["frdgTempUnit"+f.id]="\u00b0F";break;case "Celsius":b["frdgTempUnit"+f.id]="\u00b0C";break;default:b["frdgTempUnit"+f.id]=f.unit}"undefined"!=typeof f.desired&&null!=f.desired&&(b["frdgTempState"+f.id]=parseFloat(f.desired).toFixed(1))}});a.Mode&&
a.Mode.modes&&(-1!=a.Mode.modes.indexOf("WATERFILTER_DISABLE")?b.frdgWFState="good":-1!=a.Mode.modes.indexOf("WATERFILTER_ENABLE")&&(b.frdgWFState="replace"));if(a.Alarms&&a.Alarms[0]){c=a.Alarms[0].id;a=a.Alarms[0].code;switch(a){case "71E":a="Freeze_High_Temp";break;case "72E":a="Fridge_High_Temp";break;case "F-Alarm":switch(c){case "0":a="Freeze_Door_Alarm";break;case "1":a="Fridge_Door_Alarm";break;case "2":a="CV_Door_Alarm";break;case "3":a="Single_Door_Alarm"}}b.frdgError=a}b.frdgError||(b.frdgError=
"");return b};d.prototype._resolveWasherStates=function(a){var b={};"undefined"!=typeof a.connected&&null!=a.connected&&(b.wshConn=a.connected);if(a.Operation&&(a.Operation.progress&&(b.wshProgress=a.Operation.progress.toLowerCase()),a.Operation.state&&(b.wshState=a.Operation.state.toLowerCase()),a.Operation.remainingTime)){b.wshRTStr=a.Operation.remainingTime;var c=a.Operation.remainingTime.split(":");if(2<=c.length){var f=parseInt(c[0]);c=parseInt(c[1]);b.wshRT=60*f+c}}a.Configuration&&(b.wshSmC=
a.Configuration.remoteControlEnabled?"on":"off");a.Alarms&&a.Alarms[0]&&(b.wshError=a.Alarms[0].code);b.wshError||(b.wshError="");return b};d.prototype._resolveACStates=function(a){var b={};if("undefined"!=typeof a.connected&&null!=a.connected)switch(a.deviceSubType){case "FAC":b.facConn=a.connected;break;case "Room_Air_Conditioner":b.racConn=a.connected}if(a.Operation){var c;a.Operation.power&&(c=a.Operation.power.toLowerCase());switch(a.deviceSubType){case "FAC":b.facPower=c;break;case "Room_Air_Conditioner":b.racPower=
c}}a.Temperatures&&a.Temperatures.forEach(function(e){if(e&&e.id){if(e.unit){switch(e.unit){case "Fahrenheit":var g="\u00b0F";break;case "Celsius":g="\u00b0C";break;default:g=e.unit}switch(a.deviceSubType){case "FAC":b.facTempUnit=g;break;case "Room_Air_Conditioner":b.racTempUnit=g}}if("undefined"!=typeof e.desired&&null!=e.desired)switch(g=parseFloat(e.desired).toFixed(1),a.deviceSubType){case "FAC":b.facSetTemp=g;break;case "Room_Air_Conditioner":b.racSetTemp=g}if("undefined"!=typeof e.current&&
null!=e.current)switch(e=parseFloat(e.current).toFixed(1),a.deviceSubType){case "FAC":b.facTemp=e;break;case "Room_Air_Conditioner":b.racTemp=e}}});if(a.Mode&&a.Mode.modes&&a.Mode.modes&&a.Mode.modes[0])switch(c=a.Mode.modes[0],a.deviceSubType){case "FAC":b.facMode=c;break;case "Room_Air_Conditioner":b.racMode=c}if(a.Mode&&a.Mode.options){var f;-1!=a.Mode.options.indexOf("Smarton_LockOff")?f="on":-1!=a.Mode.options.indexOf("Smarton_LockOn")&&(f="off");switch(a.deviceSubType){case "FAC":b.facSmC=f}}a.Alarms&&
a.Alarms[0]&&("Room_Air_Conditioner"==a.deviceSubType?b.racError=a.Alarms[0].code:b.facError=a.Alarms[0].code);"Room_Air_Conditioner"==a.deviceSubType?b.racError||(b.racError=""):b.facError||(b.facError="");return b};d.prototype._resolveOvenStates=function(a){var b={},c=this._getBufferedStatus(a.id);c&&(b.ovenTemp=c.ovenTempRaw,b.ovenTempRaw=c.ovenTempRaw,b.ovenState=c.ovenState,b.ovenTempStr=c.ovenTempRaw);"undefined"!=typeof a.connected&&null!=a.connected&&(b.ovenConn=a.connected);a.Temperatures&&
a.Temperatures.forEach(function(e){if(e&&e.id){if(e.unit)switch(e.unit){case "Fahrenheit":b.ovenTempUnit="\u00b0F";break;case "Celsius":b.ovenTempUnit="\u00b0C";break;default:b.ovenTempUnit=e.unit}"undefined"!=typeof e.desired&&null!=e.desired&&(b.ovenTemp=parseFloat(e.desired).toFixed(1),b.ovenTempRaw=b.ovenTemp,b.ovenTempStr=b.ovenTemp)}});if(a.Operation&&(a.Operation.state&&(b.ovenOp=a.Operation.state.toLowerCase()),a.Operation.operationTime&&(b.ovenOTStr=a.Operation.operationTime),a.Operation.remainingTime)){b.ovenRTStr=
a.Operation.remainingTime;var f=a.Operation.remainingTime.split(":");2<=f.length&&(c=parseInt(f[0]),f=parseInt(f[1]),b.ovenRT=60*c+f)}a.Oven&&a.Oven.state&&(b.ovenState=a.Oven.state);if(a.Alarms&&a.Alarms[0])switch(a=a.Alarms[0].code,a){case "OV_T_0001":b.ovenError="Preheating finish";break;case "OV_T_0003":b.ovenError="Cooking finish";break;case "OV_T_0004":b.ovenError="Almost finished cooking";break;case "OV_T_0005":b.ovenError="Cooking was finished";break;case "OV_T_0006":b.ovenError="Cancellation while cooking";
break;case "OV_T_0007":b.ovenError="Cleaning mode finish";break;case "OV_T_0008":b.ovenError="Cleaning mode cancel";break;default:"OV_E_"==a.substr(0,5)&&(b.ovenError="ErrorCode_"+a.substr(5))}b.ovenError||(b.ovenError="");switch(b.ovenState){case "Preheat":case "Cleaning":case "Draining":case "Cooling":case "Rinsing":b.ovenTemp=0,b.ovenTempStr="--"}return b};d.prototype._resolveDryerStates=function(a){var b={};"undefined"!=typeof a.connected&&null!=a.connected&&(b.dryConn=a.connected);if(a.Operation&&
(a.Operation.progress&&(b.dryProgress=a.Operation.progress.toLowerCase()),a.Operation.state&&(b.dryState=a.Operation.state.toLowerCase()),a.Operation.remainingTime)){b.dryRTStr=a.Operation.remainingTime;var c=a.Operation.remainingTime.split(":");if(2<=c.length){var f=parseInt(c[0]);c=parseInt(c[1]);b.dryRT=60*f+c}}a.Configuration&&(b.drySmC=a.Configuration.remoteControlEnabled?"on":"off");a.Alarms&&a.Alarms[0]&&(b.dryError=a.Alarms[0].code);b.dryError||(b.dryError="");return b};d.prototype._resolveRobotStates=
function(a){var b={};"undefined"!=typeof a.connected&&null!=a.connected&&(b.rbtConn=a.connected);if(a.Mode&&a.Mode.modes){for(var c,f,e,g,m,l,n,p=0;p<a.Mode.modes.length;p++){var q=a.Mode.modes[p];q&&"Control"==q.substr(0,7)?c=q:q&&"Cleaning"==q.substr(0,8)?f=q:q&&"Turbo"==q.substr(0,5)?e=q:q&&"Access"==q.substr(0,6)&&(g=q);switch(q){case "Control_Homing":m="Stop cleaning & Return";break;case "Control_Idle":m="Idle";break;case "Control_Alarm":m="Alarming";break;case "Control_After":m="Returning for charging";
break;case "Control_Charging":m="Charging";break;case "Control_Pause":m="Pause";break;case "Control_PowerOff":m="Power off";break;case "Control_Reserve":m="Clean reserved (one time)";break;case "Control_Cleaning":m="Cleaning status";break;case "Control_Point":m="Point Cleaning";break;case "Cleaning_Auto":l="Start cleaning";break;case "Cleaning_Part":l="Parts Cleaning";break;case "Cleaning_Repeat":l="Repeat cleaning";break;case "Cleaning_Manual":l="Manual cleaning";break;case "Cleaning_Stop":l="Stop";
break;case "Turbo_On":n="Max";break;case "Turbo_Off":n="Normal";break;case "Turbo_Silence":n="Quiet"}}c&&m&&(b.rbtCtrMode=c,b.rbtCtrModeStr=m);f&&l&&(b.rbtClnMode=f,b.rbtClnModeStr=l);e&&n&&(b.rbtTrbMode=e,b.rbtTrbModeStr=n);"Control_Point"==b.rbtCtrMode&&(b.rbtClnMode="Cleaning_Manual",b.rbtClnModeStr="Manual cleaning");"Access_UnLock"==g?b.rbtRC="on":"Access_Lock"==g&&(b.rbtRC="off")}a.Alarms&&a.Alarms[0]&&(a=a.Alarms[0].code,b.rbtError="4"==a?"Normal":a);b.rbtError||(b.rbtError="");return b};d.prototype._resolveAPStates=
function(a){var b={};"undefined"!=typeof a.connected&&null!=a.connected&&(b.apConn=a.connected);a.Operation&&a.Operation.power&&(b.apPower=a.Operation.power.toLowerCase());a.Sensors&&a.Sensors.forEach(function(c){if(c&&c.type&&c.values)switch(c.type){case "Dust":b.apDust=c.values[0];b.apDustLvl=c.values[1];break;case "FineDust":b.apFDust=c.values[0];b.apFDustLvl=c.values[1];break;case "Odor":b.apOdorLvl=c.values[0]}});a.Wind&&(b.apWSLvl=a.Wind.speedLevel,0==a.Wind.speedLevel?b.apWS="Auto":1==a.Wind.speedLevel?
b.apWS="Sleeping":2==a.Wind.speedLevel?b.apWS="Low":3==a.Wind.speedLevel?b.apWS="Medium":4==a.Wind.speedLevel&&(b.apWS="High"));a.Alarms&&a.Alarms[0]&&(b.apError=a.Alarms[0].code);b.apError||(b.apError="");return b};d.prototype._executeCommand=function(a,b,c){if(a&&a.id&&a.type&&b&&b.value){var f=function(e){c&&c(e)};switch(a.type){case "Washer":this._execWasherCmd(a,b,f);break;case "Air_Conditioner":this._execACCmd(a,b,f);break;case "Oven":this._execOvenCmd(a,b,f);break;case "Dryer":this._execDryerCmd(a,
b,f);break;case "Robot_Cleaner":this._execRobotCmd(a,b,f);break;case "Air_Purifier":this._execAPCmd(a,b,f);break;default:c&&c(Error("unknown device type"))}}else c&&c(Error("parameter invalid"))};d.prototype._execWasherCmd=function(a,b,c){switch(b.value){case "wshRun":var f="Operation";var e={Operation:{state:"Run"}};break;case "wshPause":f="Operation";e={Operation:{state:"Pause"}};break;case "wshCancel":f="Operation",e={Operation:{state:"Ready"}}}f&&e?this._sendRequest("PUT","/devices/"+a.id+"/"+
f,JSON.stringify(e),function(g){c&&c(g)}):c&&c(Error("command invalid"))};d.prototype._execACCmd=function(a,b,c){var f=this,e=this._getBufferedStatus(a.id);switch(b.value){case "facOn":case "racOn":var g="Operation";var m={Operation:{power:"On"}};break;case "facOff":case "racOff":g="Operation";m={Operation:{power:"Off"}};break;case "facToggle":case "racToggle":this._getStates(function(l,n){l?c&&c(l):n&&n[a.id]?(l=n[a.id],l="facToggle"==b.value?l.facPower:l.racPower,"on"==l?f._execACCmd(a,{value:"facToggle"==
b.value?"facOff":"racOff"},c):"off"==l?f._execACCmd(a,{value:"facToggle"==b.value?"facOn":"racOn"},c):c&&c(Error("no valid status"))):c&&c(Error("no status"))});return;case "facSetTo":case "racSetTo":if(!b.ext){c&&c(Error("command invalid"));return}g="Temperatures";m={Temperatures:[{id:"0",desired:parseFloat(b.ext)}]};break;case "facTempUp":case "facTempDown":case "racTempUp":case "racTempDown":if(e&&("Wind"==e.racMode||"Wind"==e.facMode)){g=null;g="facTempUp"==b.value||"facTempDown"==b.value?"facError":
"racError";xnm.aio.samsung.SmartHomeNotifyManager.onDummyNotification(a,g,"no temp. change in this mode");c&&c(Error("can not change temperature in wind mode"));return}if(!b.ext){c&&c(Error("command invalid"));return}this._getStates(function(l,n){if(l)c&&c(l);else if(n&&n[a.id]){var p=n[a.id];l=18;n=30;if("facTempUp"==b.value||"facTempDown"==b.value){var q=p.facSetTemp;p=p.facTempUnit}else q=p.racSetTemp,p=p.racTempUnit;if(q){q=parseFloat(q);"\u00b0F"==p&&(l=65,n=86);p=parseFloat(b.ext);if("facTempUp"==
b.value||"racTempUp"==b.value)q+=p;else if("facTempDown"==b.value||"racTempDown"==b.value)q-=p;q>n&&(q=n);q<l&&(q=l);f._execACCmd(a,{value:"facTempUp"==b.value||"facTempDown"==b.value?"facSetTo":"racSetTo",ext:q},c)}else c&&c(Error("no valid status"))}else c&&c(Error("no status"))});return;case "facSetMode":case "racSetMode":if(!b.ext){c&&c(Error("command invalid"));return}g="Mode";m={Mode:{modes:[b.ext]}}}g&&m?this._sendRequest("PUT","/devices/"+a.id+"/"+g,JSON.stringify(m),function(l){c&&c(l)}):
c&&c(Error("command invalid"))};d.prototype._execOvenCmd=function(a,b,c){switch(b.value){case "ovenStop":var f="Operation";var e={Operation:{state:"Ready"}}}f&&e?this._sendRequest("PUT","/devices/"+a.id+"/"+f,JSON.stringify(e),function(g){c&&c(g)}):c&&c(Error("command invalid"))};d.prototype._execDryerCmd=function(a,b,c){switch(b.value){case "dryRun":var f="Operation";var e={Operation:{state:"Run"}};break;case "dryPause":f="Operation";e={Operation:{state:"Pause"}};break;case "dryCancel":f="Operation",
e={Operation:{state:"Ready"}}}f&&e?this._sendRequest("PUT","/devices/"+a.id+"/"+f,JSON.stringify(e),function(g){c&&c(g)}):c&&c(Error("command invalid"))};d.prototype._execRobotCmd=function(a,b,c){switch(b.value){case "rbtStart":var f="Mode";var e={Mode:{modes:["Cleaning_Auto"]}};break;case "rbtStop":f="Mode";e={Mode:{modes:["Control_Homing"]}};break;case "rbtTurbo":if(!b.ext){c&&c(Error("command ext invalid"));return}switch(b.ext){case "Max":b="Turbo_On";break;case "Normal":b="Turbo_Off";break;case "Quiet":b=
"Turbo_Silence";break;default:c&&c(Error("command ext invalid"));return}f="Mode";e={Mode:{modes:[b]}}}f&&e?this._sendRequest("PUT","/devices/"+a.id+"/"+f,JSON.stringify(e),function(g){c&&c(g)}):c&&c(Error("command invalid"))};d.prototype._execAPCmd=function(a,b,c){var f=this;switch(b.value){case "apOn":var e="Operation";var g={Operation:{power:"On"}};break;case "apOff":e="Operation";g={Operation:{power:"Off"}};break;case "apToggle":this._getStates(function(l,n){l?c&&c(l):n&&n[a.id]?(l=n[a.id],l=l.apPower,
"on"==l?f._execAPCmd(a,{value:"apOff"},c):"off"==l?f._execAPCmd(a,{value:"apOn"},c):c&&c(Error("no valid status"))):c&&c(Error("no status"))});return;case "rbtSetWS":case "rbtSetWSLvl":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command invalid"));return}if("rbtSetWS"==b.value)switch(b.ext){case "Auto":var m=0;break;case "Sleeping":m=1;break;case "Low":m=2;break;case "Medium":m=3;break;case "High":m=4}else m=parseInt(b.ext);4<m&&(m=4);0>m&&(m=0);e="Wind";g={Wind:{speedLevel:m}};break;case "rbtSetWSUp":case "rbtSetWSDown":this._getStates(function(l,
n){l?c&&c(l):n&&n[a.id]?(l=n[a.id].apWSLvl,"undefined"==typeof l||null==l?c&&c(Error("no valid status")):(l=parseInt(l),"rbtSetWSUp"==b.value?l+=1:"rbtSetWSDown"==b.value&&--l,4<l&&(l=4),0>l&&(l=0),f._execAPCmd(a,{value:"rbtSetWSLvl",ext:l},c))):c&&c(Error("no status"))});return}e&&g?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(g),function(l){c&&c(l)}):c&&c(Error("command invalid"))};d.prototype.subscibe=function(a,b){this._sendRequest("POST","/subscriptions",JSON.stringify({Subscriptions:a}),
function(c){b&&b(c)})};d.prototype.getDevices=function(a){this._sendRequest("GET","/devices",null,function(b,c){a&&a(b,c)})};d.prototype.getDeviceList=function(a){this.getDevices(function(b,c){if(b)a&&a(b);else if(c&&c.Devices){b=[];c=c.Devices;for(var f=0;f<c.length;f++){var e=c[f],g=null;if(e){switch(e.type){case "Refrigerator":e.sys="samsung_smarthome";delete e.resources;g=e;break;case "Washer":e.sys="samsung_smarthome";delete e.resources;delete e.Operation;delete e.Configuration;g=e;break;case "Air_Conditioner":e.sys=
"samsung_smarthome";delete e.resources;delete e.Operation;delete e.Temperatures;delete e.Mode;g=e;break;case "Oven":e.sys="samsung_smarthome";delete e.resources;delete e.Operation;delete e.Temperatures;delete e.Configuration;delete e.Oven;g=e;break;case "Dryer":e.sys="samsung_smarthome";delete e.resources;delete e.Operation;delete e.Configuration;g=e;break;case "Robot_Cleaner":e.sys="samsung_smarthome";delete e.resources;delete e.Mode;g=e;break;case "Air_Purifier":e.sys="samsung_smarthome",delete e.resources,
delete e.Operation,delete e.Sensors,delete e.Wind,g=e}g&&b.push(g)}}a&&a(null,b)}else a&&a(null,[])})};d.prototype.executeCommand=function(a,b,c){cmd=JSON.stringify({Temperatures:[{desired:23,id:"0"}]});this._doRequest("PUT","/devices/"+a.address+"/Temperatures",cmd,function(f){XC.debugf(f);c&&c()})};d.prototype.executeCommandCreator=function(a,b,c){this._executeCommand(a,b,c)};d.prototype.getStatesCreator=function(a,b,c){b?0==b.length?c&&c(null,[]):this._getStates(function(f,e){if(f)c&&c(f);else{f=
[];for(var g=0;g<b.length;g++)if(b[g]&&b[g].id){var m="?";b[g].device&&b[g].device.id&&b[g].status&&b[g].status.value&&e&&e[b[g].device.id]&&(m=e[b[g].device.id][b[g].status.value],"undefined"==typeof m||null==m)&&(m="?");f.push({id:b[g].id,status:m})}c&&c(null,f)}}):c&&c(Error("deviceList is null"))};d.prototype.equalsTo=function(a){return a&&a instanceof d?this._accessKey==a._accessKey:!1};d.prototype.toJSON=function(){return{sys:"samsung_smarthome",accessKey:this._accessKey}};d.parseJSON=function(a){return a.accessKey?
new d(a.accessKey,a.test):null};return d}();xnm.aio.samsung.SmartHomeCloud._StatusBuffer={};xnm.aio.samsung.SmartHomeCloud._StatusBufferTO=5E3;xnm.aio.samsung.SmartHomeCloud._AlarmBuffer={};
xnm.aio.samsung.SmartHomeCloud.DM=function(){var k={command:[{type:"enum",name:"run",ref:{value:"wshRun"}},{type:"enum",name:"pause",ref:{value:"wshPause"}},{type:"enum",name:"cancel",ref:{value:"wshCancel"}}],status:[{type:"enum",name:"connected",ref:{value:"wshConn",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"wshState",options:["ready","run","pause"]}},{type:"enum",name:"progress",ref:{value:"wshProgress",options:"finish delaywash weightsensing prewash wash rinse spin drying cooling wrinkleprevent airwash none".split(" ")}},
{type:"string",name:"remaining time (string)",ref:{value:"wshRTStr"}},{type:"int",name:"remaining time",ref:{value:"wshRT",extMeta:"0-180"}},{type:"enum",name:"Smart Control state",ref:{value:"wshSmC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"wshError",options:["FilterAlarm","DrumClean","ErrorCode_%d"]}}]},h={command:[{type:"enum",name:"power on",ref:{value:"facOn"}},{type:"enum",name:"power off",ref:{value:"facOff"}},{type:"enum",name:"power toggle",ref:{value:"facToggle"}},
{type:"float",name:"set desired temperature",ref:{value:"facSetTo",ext:"%f",extMeta:"18.0-30.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature up",ref:{value:"facTempUp",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature down",ref:{value:"facTempDown",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"enum",name:"set mode",ref:{value:"facSetMode",ext:"%e",extMeta:["Auto","Cool","Dry","Wind","Heat"]}}],status:[{type:"enum",
name:"connected",ref:{value:"facConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"facPower",options:["on","off"]}},{type:"float",name:"current temperature",ref:{value:"facTemp"}},{type:"float",name:"desired temperature",ref:{value:"facSetTemp"}},{type:"enum",name:"temperature unit",ref:{value:"facTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"mode",ref:{value:"facMode",options:"Auto Cool Dry Heat Wind CoolClean HeatClean DryClean NotSupported".split(" ")}},
{type:"enum",name:"Smart Control state",ref:{value:"facSmC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"facError",options:["FilterAlarm","FilterAlarm_OFF","ErrorCode_%d"]}}]},d={command:[{type:"enum",name:"power on",ref:{value:"racOn"}},{type:"enum",name:"power off",ref:{value:"racOff"}},{type:"enum",name:"power toggle",ref:{value:"racToggle"}},{type:"float",name:"set desired temperature",ref:{value:"racSetTo",ext:"%f",extMeta:"18.0-30.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",
name:"desired temperature up",ref:{value:"racTempUp",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature down",ref:{value:"racTempDown",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"enum",name:"set mode",ref:{value:"racSetMode",ext:"%e",extMeta:["Auto","Cool","Dry","Wind","Heat"]}}],status:[{type:"enum",name:"connected",ref:{value:"racConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"racPower",options:["on","off"]}},
{type:"float",name:"current temperature",ref:{value:"racTemp"}},{type:"float",name:"desired temperature",ref:{value:"racSetTemp"}},{type:"enum",name:"temperature unit",ref:{value:"racTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"mode",ref:{value:"racMode",options:"Auto Cool Dry Heat Wind NotSupported".split(" ")}},{type:"enum",name:"error state",ref:{value:"racError",options:["FilterAlarm","FilterAlarm_OFF","ErrorCode_%d"]}}]},a={command:[{type:"enum",name:"stop",ref:{value:"ovenStop"}}],
status:[{type:"enum",name:"connected",ref:{value:"ovenConn",options:["true","false"]}},{type:"enum",name:"operation",ref:{value:"ovenOp",options:["run","ready"]}},{type:"string",name:"remaining time (string)",ref:{value:"ovenRTStr"}},{type:"int",name:"remaining time",ref:{value:"ovenRT",extMeta:"0-180"}},{type:"string",name:"operation time (string)",ref:{value:"ovenOTStr"}},{type:"float",name:"desired temperature",ref:{value:"ovenTemp"}},{type:"string",name:"desired temperature (string)",ref:{value:"ovenTempStr"}},
{type:"enum",name:"temperature unit",ref:{value:"ovenTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"state",ref:{value:"ovenState",options:"Preheat Cooking Cleaning Draining Rinsing Cooling Ready".split(" ")}},{type:"enum",name:"error state",ref:{value:"ovenError",options:["ErrorCode_%d"]}}]},b={command:[{type:"enum",name:"run",ref:{value:"dryRun"}},{type:"enum",name:"pause",ref:{value:"dryPause"}},{type:"enum",name:"cancel",ref:{value:"dryCancel"}}],status:[{type:"enum",
name:"connected",ref:{value:"dryConn",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"dryState",options:["ready","run","pause"]}},{type:"enum",name:"progress",ref:{value:"dryProgress",options:"finish delaywash weightsensing drying cooling wrinkleprevent none".split(" ")}},{type:"string",name:"remaining time (string)",ref:{value:"dryRTStr"}},{type:"int",name:"remaining time",ref:{value:"dryRT",extMeta:"0-180"}},{type:"enum",name:"Smart Control state",ref:{value:"drySmC",options:["on",
"off"]}},{type:"enum",name:"error state",ref:{value:"dryError",options:["FilterAlarm","DrumClean","ErrorCode_%d"]}}]},c={command:[{type:"enum",name:"start cleaning",ref:{value:"rbtStart"}},{type:"enum",name:"stop cleaning",ref:{value:"rbtStop"}},{type:"enum",name:"set turbo mode",ref:{value:"rbtTurbo",ext:"%e",extMeta:["Max","Normal","Quiet"]}}],status:[{type:"enum",name:"connected",ref:{value:"rbtConn",options:["true","false"]}},{type:"enum",name:"control mode",ref:{value:"rbtCtrMode",options:"Control_Homing Control_Idle Control_Alarm Control_After Control_Charging Control_Pause Control_PowerOff Control_Reserve Control_Cleaning Control_Point".split(" ")}},
{type:"string",name:"control mode (description)",ref:{value:"rbtCtrModeStr"}},{type:"enum",name:"cleaning mode",ref:{value:"rbtClnMode",options:["Cleaning_Auto","Cleaning_Part","Cleaning_Repeat","Cleaning_Manual","Cleaning_Stop"]}},{type:"string",name:"cleaning mode (description)",ref:{value:"rbtClnModeStr"}},{type:"enum",name:"turbo mode",ref:{value:"rbtTrbMode",options:["Turbo_On","Turbo_Off","Turbo_Silence"]}},{type:"string",name:"turbo mode (description)",ref:{value:"rbtTrbModeStr"}},{type:"enum",
name:"Smart Control state",ref:{value:"rbtRC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"rbtError",options:["Normal","ErrorCode_%d"]}}]},f={command:[{type:"enum",name:"power on",ref:{value:"apOn"}},{type:"enum",name:"power off",ref:{value:"apOff"}},{type:"enum",name:"power toggle",ref:{value:"apToggle"}},{type:"enum",name:"set wind speed",ref:{value:"rbtSetWS",ext:"%e",extMeta:["Auto","Sleeping","Low","Medium","High"]}},{type:"int",name:"set wind speed level",ref:{value:"rbtSetWSLvl",
ext:"%d",extMeta:"0-4"}},{type:"enum",name:"wind speed up",ref:{value:"rbtSetWSUp"}},{type:"enum",name:"wind speed down",ref:{value:"rbtSetWSDown"}}],status:[{type:"enum",name:"connected",ref:{value:"apConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"apPower",options:["on","off"]}},{type:"float",name:"PM 10.0 value",ref:{value:"apDust"}},{type:"int",name:"PM 10.0 level",ref:{value:"apDustLvl"}},{type:"float",name:"PM 2.5 value",ref:{value:"apFDust"}},{type:"int",name:"PM 2.5 level",
ref:{value:"apFDustLvl"}},{type:"int",name:"Gas level",ref:{value:"apOdorLvl"}},{type:"enum",name:"wind speed",ref:{value:"apWS",options:["Auto","Sleeping","Low","Medium","High"]}},{type:"int",name:"wind speed level",ref:{value:"apWSLvl"}},{type:"enum",name:"error state",ref:{value:"apError",options:["ErrorCode_%d"]}}]};return{SYS:"samsung_smarthome",registModule:function(e){e.register(this.SYS,"samsung")},getGatewayType:function(){return{sys:this.SYS,name:"Samsung Smart Home (Cloud)"}},getGatewayDeviceType:function(e){return e.sys==
this.SYS?[{sys:this.SYS,type:"Refrigerator",name:"Smart Refrigerator"}]:null},createGateway:function(e,g,m){g=xnm.aio.samsung.DMError;var l=xnm.aio.samsung.DMError.ERROR_CODE;e?e.accessKey?m(null,e):m(new g(l.INVALID,"accessKey is invalid")):m(new g(l.INVALID,"info is invalid"))},updateGateway:function(e,g,m,l){e=xnm.aio.samsung.DMError;m=xnm.aio.samsung.DMError.ERROR_CODE;g?g.accessKey?l(null,g):l(new e(m.INVALID,"ip is invalid")):l(new e(m.INVALID,"update is invalid"))},deleteGateway:function(e,
g,m){m()},createDevice:function(e,g,m){var l=xnm.aio.samsung.DMError,n=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.gateway)if(null==e.type||"undefined"==typeof e.type)m(new l(n.INVALID,"type is invalid"));else if(null==e.id||"undefined"==typeof e.id)m(new l(n.INVALID,"address is invalid"));else if(g.data&&g.data.gateways&&0!==g.data.gateways.length){g=g.data.gateways;var p;for(p=0;p<g.length;p++)if(g[p].index===e.gateway){var q=g[p];break}q?m(null,e):m(new l(n.NOT_FOUND,"gateway with index "+e.gateway+
" not exists"))}else m(new l(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));else m(new l(n.INVALID,"gateway is invalid"));else m(new l(n.INVALID,"info is invalid"))},updateDevice:function(e,g,m){var l=xnm.aio.samsung.DMError,n=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.gateway)if(null==e.type||"undefined"==typeof e.type)m(new l(n.INVALID,"type is invalid"));else if(null==e.id||"undefined"==typeof e.id)m(new l(n.INVALID,"address is invalid"));else if(g.data&&g.data.gateways&&0!==g.data.gateways.length){g=
g.data.gateways;var p;for(p=0;p<g.length;p++)if(g[p].index===e.gateway){var q=g[p];break}q?m(null,e):m(new l(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"))}else m(new l(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));else m(new l(n.INVALID,"gateway is invalid"));else m(new l(n.INVALID,"info is invalid"))},deleteDevice:function(e,g,m){m()},getCommandStatusMap:function(e,g){if(!e)return null;switch(e.type){case "Refrigerator":return this._getFridgeMap(e);case "Washer":return k;
case "Air_Conditioner":switch(e.deviceSubType){case "FAC":return h;case "Room_Air_Conditioner":return d;default:return null}case "Oven":return a;case "Dryer":return b;case "Robot_Cleaner":return c;case "Air_Purifier":return f;default:return null}},_getFridgeMap:function(e){var g={command:[],status:[]};var m={type:"enum",name:"connected",ref:{value:"frdgConn",options:["true","false"]}};g.status.push(m);e.Doors&&e.Doors.forEach(function(l){if(l&&l.id&&l.name){var n={type:"enum",name:l.name+" state",
ref:{value:"frdgDoorState"+l.id,options:["open","closed"]}};g.status.push(n);n={type:"string",name:l.name+" name",ref:{value:"frdgDoorName"+l.id}};g.status.push(n)}});e.Fridge&&(m={type:"enum",name:"filter state",ref:{value:"frdgFilterState",options:["good","order","replace"]}},g.status.push(m));e.Temperatures&&e.Temperatures.forEach(function(l){if(l&&l.id&&l.name){var n={type:"float",name:l.name+" temperature",ref:{value:"frdgTempState"+l.id,extMeta:"-22.0-14.0"}};g.status.push(n);n={type:"enum",
name:l.name+" temperature unit",ref:{value:"frdgTempUnit"+l.id,options:["\u00b0C","\u00b0F","NotSupported"]}};g.status.push(n)}});e.Mode&&e.Mode.modes&&(m={type:"enum",name:"water filter state",ref:{value:"frdgWFState",options:["good","replace"]}},g.status.push(m));m={type:"enum",name:"error state",ref:{value:"frdgError",options:"Freeze_Door_Alarm Freeze_High_Temp Fridge_Door_Alarm Freeze_High_Temp CV_Door_Alarm CV_High_Temp Single_Door_Alarm".split(" ")}};g.status.push(m);return g}}}();
xnm.aio.samsung.SmartHomeNotifyManager={_logger:null,_inited:!1,_listeners:[],_devices:[],init:function(k){if(this._inited)k&&k();else{this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.samsung.SmartHomeNotifyManager");var h=require("xnm.aio.webhook.js");if(h){var d=this;h.start(function(a){a||(d._inited=!0,h.addHandler("samsung_smarthome",d));k&&k(a)})}else k&&k(Error("no webhook lib"))}},addListener:function(k){k&&-1==this._listeners.indexOf(k)&&
this._listeners.push(k)},clearListeners:function(){this._listeners=[]},subscribe:function(k,h,d){var a=require("xnm.aio.webhook.js");if(a){switch(k.sys){case xnm.aio.samsung.SmartHomeCloud.DM.SYS:var b=xnm.aio.samsung.SmartHomeCloud.parseJSON(k);break;default:d&&d(Error("do not support"));return}if(b){var c=this;for(k=0;k<h.length;k++){for(var f=!1,e=0;e<this._devices.length;e++)if(h[k]&&this._devices[e]&&h[k].id==this._devices[e].id){f=!0;break}f||this._devices.push(h[k])}b.getDeviceList(function(g,
m){if(g)d&&d(g);else{g=c._getDeviceIDs(m);var l=c._getSubscriptions(m);b.subscibe(g,function(n){n?d&&d(n):a.subscribe("samsung_smarthome",l,d)})}})}else d&&d(Error("gateway json format invalid"))}else d&&d(Error("no webhook lib"))},unsubscribeAll:function(k){var h=require("xnm.aio.webhook.js");h?(this._devices=[],h.unsubscribeType("samsung_smarthome",k)):k&&k(Error("no webhook lib"))},isUniqueSubscribe:function(k,h){if(!k||"samsung_smarthome"!=k.type||!k.device)return!1;for(var d=0;d<h.length;d++)if(h[d]&&
"samsung_smarthome"==h[d].type&&h[d].device==k.device)return!1;return!0},onNotification:function(k){if(k){this._logger.log("trace","receive notification:"+JSON.stringify(k));for(var h,d=0;d<this._devices.length;d++)if(this._devices[d]&&this._devices[d].id==k.id){h=this._handleNotification(this._devices[d],k);break}this._logger.log("trace",this._listeners.length+" resolve state:"+JSON.stringify(h));if(h)for(k=0;k<this._listeners.length;k++)try{this._listeners[k](h)}catch(a){this._logger.log("trace",
"call listener error:"+a.message)}}},onDummyNotification:function(k,h,d){if(k){this._logger.log("trace","receive dummy notification:"+JSON.stringify(k)+" key:"+h+" value:"+d);for(var a=null,b=0;b<this._devices.length;b++)if(this._devices[b]&&this._devices[b].id==k.id){a=this._devices[b];break}if(a)for(k=a._alias+":"+h,h=0;h<this._listeners.length;h++)try{this._listeners[h]([{id:k,status:d}])}catch(c){this._logger.log("trace","call listener error:"+c.message)}}},_handleNotification:function(k,h){var d=
function(f,e){xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[e.id]=e.Alarms;return e};"Alarms"==h.resource&&d(k,h);d=JSON.parse(JSON.stringify(h));"Device"==h.resource&&(d=h.Device,d.id=h.id);d.Alarms=xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[h.id];h=new xnm.aio.samsung.SmartHomeCloud;if(!k._alias)return null;switch(k.type){case "Refrigerator":h=h._resolveFridgeStates(d);break;case "Washer":h=h._resolveWasherStates(d);break;case "Air_Conditioner":d.deviceSubType=k.deviceSubType;h=h._resolveACStates(d);
break;case "Oven":h=h._resolveOvenStates(d);break;case "Dryer":h=h._resolveDryerStates(d);break;case "Robot_Cleaner":h=h._resolveRobotStates(d);break;case "Air_Purifier":h=h._resolveAPStates(d);break;default:return null}if(!h)return null;(function(f,e){var g=xnm.aio.samsung.SmartHomeCloud._StatusBuffer,m;for(m in g)if(g.hasOwnProperty(m)){var l=g[m],n=!1;l.states||(l.states={});l.states[f.id]||(l.states[f.id]={});for(var p in e)e.hasOwnProperty(p)&&(l.states[f.id][p]=e[p],n=!0);n&&(l.time=(new Date).getTime())}})(k,
h);var a=[],b;for(b in h){d=k._alias+":"+b;var c=h[b];a.push({id:d,status:c})}return a},_getDeviceIDs:function(k){for(var h=[],d=0;d<k.length;d++)k[d]&&k[d].id&&-1==h.indexOf(k[d].id)&&h.push(k[d].id);return h},_getSubscriptions:function(k){for(var h=[],d=[],a=0;a<k.length;a++)k[a]&&k[a].id&&-1==d.indexOf(k[a].id)&&(d.push(k[a].id),h.push({type:"samsung_smarthome",device:k[a].id}));return h}};
xnm.aio.samsung.DMError=function(){var k=function(h,d){this.code=h;this.message=d;this.stack=Error().stack};k.prototype=Error();k.prototype.name="SamsungDmError";k.prototype.code=0;k.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return k}();
xnm.aio.samsung.DM=function(){return{_getSystem:function(k){for(var h in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(h)){var d=xnm.aio.samsung[h];if(d&&d.DM&&d.DM.SYS==k)return d}return null},getGatewayType:function(){var k=[],h;for(h in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(h)){var d=xnm.aio.samsung[h];d&&d.DM&&d.DM.getGatewayType&&(d=d.DM.getGatewayType())&&k.push(d)}return k},getGatewayDeviceType:function(k){var h=[],d;for(d in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(d)){var a=
xnm.aio.samsung[d];a&&a.DM&&a.DM.getGatewayDeviceType&&(a=a.DM.getGatewayDeviceType(k))&&(Array.isArray(a)?h=h.concat(a):h.push(a))}return h},createGateway:function(k,h,d){var a=xnm.aio.samsung.DMError,b=xnm.aio.samsung.DMError.ERROR_CODE;if(k)if(k.sys){var c=this._getSystem(k.sys);c&&c.DM&&c.DM.createGateway?c.DM.createGateway(k,h,d):d&&d(new a(b.INVALID,"no such sys:"+k.sys))}else d&&d(new a(b.INVALID,"sys is invalid"));else d&&d(new a(b.INVALID,"info is invalid"))},updateGateway:function(k,h,d,
a){var b=xnm.aio.samsung.DMError,c=xnm.aio.samsung.DMError.ERROR_CODE;if(h)if(h.sys){var f=this._getSystem(h.sys);f&&f.DM&&f.DM.updateGateway?f.DM.updateGateway(k,h,d,a):a&&a(new b(c.INVALID,"no such sys:"+h.sys))}else a&&a(new b(c.INVALID,"sys is invalid"));else a(new b(c.INVALID,"info is invalid"))},deleteGateway:function(k,h,d){var a=xnm.aio.samsung.DMError,b=xnm.aio.samsung.DMError.ERROR_CODE;if(k)if(k.sys){var c=this._getSystem(k.sys);c&&c.DM&&c.DM.deleteGateway?c.DM.deleteGateway(k,h,d):d&&
d(new a(b.INVALID,"no such sys:"+k.sys))}else d&&d(new a(b.INVALID,"sys is invalid"));else d()},createDevice:function(k,h,d){var a=xnm.aio.samsung.DMError,b=xnm.aio.samsung.DMError.ERROR_CODE;if(k)if(k.sys){var c=this._getSystem(k.sys);c&&c.DM&&c.DM.createDevice?c.DM.createDevice(k,h,d):d&&d(new a(b.INVALID,"no such sys:"+k.sys))}else d&&d(new a(b.INVALID,"sys is invalid"));else d&&d(new a(b.INVALID,"info is invalid"))},updateDevice:function(k,h,d){var a=xnm.aio.samsung.DMError,b=xnm.aio.samsung.DMError.ERROR_CODE;
if(k)if(k.sys){var c=this._getSystem(k.sys);c&&c.DM&&c.DM.updateDevice?c.DM.updateDevice(k,h,d):d&&d(new a(b.INVALID,"no such sys:"+k.sys))}else d&&d(new a(b.INVALID,"sys is invalid"));else d(new a(b.INVALID,"info is invalid"))},deleteDevice:function(k,h,d){var a=xnm.aio.samsung.DMError,b=xnm.aio.samsung.DMError.ERROR_CODE;if(k)if(k.sys){var c=this._getSystem(k.sys);c&&c.DM&&c.DM.deleteDevice?c.DM.deleteDevice(k,h,d):d&&d(new a(b.INVALID,"no such sys:"+k.sys))}else d&&d(new a(b.INVALID,"sys is invalid"));
else d()},applyUIFilter:function(k,h){var d=function(e,g){if("*"==e)return!0;for(var m=!1,l=0;l<e.length;l++)if(e[l]==g){m=!0;break}return m},a=function(e,g,m){var l=[];switch(m.catagory){case "command":e.command&&e.command.forEach(function(n){d(m.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),l.push(n))});break;case "status":e.status&&e.status.forEach(function(n){d(m.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),l.push(n))})}return l},b=function(e,g){var m=[],l;if(e.sys){var n=this._getSystem(e.sys);
n&&n.DM&&n.DM.getCommandStatusMap&&(l=n.DM.getCommandStatusMap(e))}l&&(e=a(l,e,g),m=m.concat(e));return m};if(!k.sys)return null;var c=JSON.parse(JSON.stringify(k)),f=null;switch(h.catagory){case "command":f=b.call(this,k,h);c.command=f;break;case "status":f=b.call(this,k,h);c.status=f;break;default:return null}return f&&0!=f.length?c:null}}}();
xnm.aio.samsung.Handler=function(){var k=function(){};k.prototype.devicemanager=xnm.aio.samsung.DM;k.prototype.SamsungTV=xnm.aio.samsung.TV;k.prototype.SmartHomeCloud=xnm.aio.samsung.SmartHomeCloud;k.prototype.SmartHomeNotifyManager=xnm.aio.samsung.SmartHomeNotifyManager;k.prototype.registModule=function(h){for(var d in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(d)){var a=xnm.aio.samsung[d];a&&a.DM&&a.DM.registModule&&a.DM.registModule(h)}};k.prototype.resolveGateway=function(h){switch(h.sys){case xnm.aio.samsung.SmartHomeCloud.DM.SYS:return xnm.aio.samsung.SmartHomeCloud.parseJSON(h);
default:return null}};k.prototype.getDeviceCommands=function(h,d){h=(h=xnm.aio.samsung.DM.applyUIFilter(h,{catagory:"command",elems:"*"}))?h.command:[];d&&d(null,h)};k.prototype.getDeviceStatus=function(h,d){h=(h=xnm.aio.samsung.DM.applyUIFilter(h,{catagory:"status",elems:"*"}))?h.status:[];d&&d(null,h)};k.prototype.doCommand=function(h,d,a,b){h?(h=this.resolveGateway(h))?h.executeCommandCreator(d,a,function(c){b&&b(c)}):b&&b(Error("gateway json format invalid")):b&&b(Error("only support gateway"))};
k.prototype.doStatus=function(h,d,a,b,c){(d=this.resolveGateway(d))?d.getStatesCreator(null,[{id:h,device:a,status:b}],function(f,e){f?c&&c(f):c&&c(null,e[0])}):c&&c(Error("gateway json format invalid"))};k.prototype.getSmartHomeDeviceList=function(h,d){(h=this.resolveGateway(h))?h.getDeviceList(function(a,b){d&&d(a,b)}):d&&d(Error("gateway json format invalid"))};return k}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.samsung.Handler);

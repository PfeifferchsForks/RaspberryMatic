var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(f){var e=0;return function(){return e<f.length?{done:!1,value:f[e++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,e,a){if(f==Array.prototype||f==Object.prototype)return f;f[e]=a.value;return f};$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<f.length;++e){var a=f[e];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,e){var a=$jscomp.propertyToPolyfillSymbol[e];if(null==a)return f[e];a=f[a];return void 0!==a?a:f[e]};
$jscomp.polyfill=function(f,e,a,b){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,e,a,b):$jscomp.polyfillUnisolated(f,e,a,b))};$jscomp.polyfillUnisolated=function(f,e,a,b){a=$jscomp.global;f=f.split(".");for(b=0;b<f.length-1;b++){var c=f[b];if(!(c in a))return;a=a[c]}f=f[f.length-1];b=a[f];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(a,f,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(f,e,a,b){var c=f.split(".");f=1===c.length;b=c[0];b=!f&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<c.length-1;d++){var g=c[d];if(!(g in b))return;b=b[g]}c=c[c.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?b[c]:null;e=e(a);null!=e&&(f?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:e}):e!==a&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&(a=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+a+"$"+c),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:e})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(f){if(f)return f;var e=function(d,g){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};e.prototype.toString=function(){return this.$jscomp$symbol$id_};var a="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",b=0,c=function(d){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new e(a+(d||"")+"_"+b++,d)};return c},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(f){if(f)return f;f=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<e.length;a++){var b=$jscomp.global[e[a]];"function"===typeof b&&"function"!=typeof b.prototype[f]&&$jscomp.defineProperty(b.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return f},"es6",
"es3");$jscomp.iteratorPrototype=function(f){f={next:f};f[Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,e){f instanceof String&&(f+="");var a=0,b=!1,c={next:function(){if(!b&&a<f.length){var d=a++;return{value:e(d,f[d]),done:!1}}b=!0;return{done:!0,value:void 0}}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");
var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.osram=xnm.aio.osram||{};xnm.aio.osram.DMError=function(){var f=function(e,a){this.code=e;this.message=a;this.stack=Error().stack};f.prototype=Error();f.prototype.name="OsramDmError";f.prototype.code=0;f.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return f}();
xnm.aio.osram.Lightify=function(){var f={_arr2str:function(a){for(var b="",c=0,d,g,h;c<a.length&&0!=a[c];)d=a[c],128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(g=a[c+1],b+=String.fromCharCode((d&31)<<6|g&63),c+=2):(g=a[c+1],h=a[c+2],b+=String.fromCharCode((d&15)<<12|(g&63)<<6|h&63),c+=3);return b},_hex2arr:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b},_arr2hex:function(a){for(var b="",c=0;c<a.length;c++){for(var d=a[c].toString(16);2>d.length;)d="0"+
d;b+=d.toUpperCase()}return b}},e=function(a,b,c){this._logger=require("x.logger.js").getLogger("xnm.aio.osram.Lightify");this.uuid=c;this.ip=a;this.port=b;if(!b||0>b)this.port=4E3;e._SB.addBuffer(this);this._socket=null};e.SO_TIMEOUT=5E3;e._SB={_buffer:{},addBuffer:function(a){var b=this.getBuffer(a);b||(b={lightify:a,dataBuffer:"",packetBuffer:[],reqId:0,status:0},this._buffer[a.ip+":"+a.port]=b);return b},getBuffer:function(a){return this._buffer[a.ip+":"+a.port]},_getNextReqId:function(a){a=this.getBuffer(a);
a.reqId+=1;return a.reqId},addPacket:function(a,b,c){var d=this.addBuffer(a),g=this._getNextReqId(a);b.reqId=g;b={reqId:g,frame:b,callback:c,timeout:null};g=d.packetBuffer.length;switch(d.status){case 0:d.packetBuffer.push(b);d.status=1;d.lightify._connect();break;case 1:d.packetBuffer.push(b);break;case 2:d.packetBuffer.push(b);0==g&&this._sendNextPacket(a);break;case 3:c(Error("socket is closing"))}},removePacket:function(a,b){b.timeout&&(clearTimeout(b.timeout),b.timeout=null);if((a=this.getBuffer(a))&&
a.packetBuffer){for(var c=-1,d=0;d<a.packetBuffer.length;d++)if(a.packetBuffer[d]===b){c=d;break}-1!=c&&a.packetBuffer.splice(c,1)}},_sendNextPacket:function(a){var b=this.getBuffer(a);b&&b.packetBuffer&&b.packetBuffer[0]&&this._sendPacket(a,b.packetBuffer[0])},_sendPacket:function(a,b){var c=this.getBuffer(a);if(c&&c.lightify){var d=this;b.timeout=setTimeout(function(){b.timeout=null;d.removePacket(a,b);d._sendNextPacket(a);b.callback&&b.callback(Error("frame response timeout"))},5E3);c.lightify._logger.log("debug",
"send frame:"+JSON.stringify(b.frame));c.lightify._send(b.frame.flag,b.frame.cmd,b.frame.reqId,b.frame.payload)}},_clearPackets:function(a,b){if((a=this.getBuffer(a))&&a.packetBuffer){var c,d=[];for(c=0;c<a.packetBuffer.length;c++)d.push(a.packetBuffer[c]);a.packetBuffer=[];for(c=0;c<d.length;c++)d[c]&&d[c].callback&&(d[c].timeout&&clearTimeout(d[c].timeout),d[c].callback(b),d[c].callback=null)}},_resolveData:function(a){var b=this.getBuffer(a);if(b&&b.dataBuffer&&4<b.dataBuffer.length){var c=parseInt(b.dataBuffer.substr(0,
2),16);c=(parseInt(b.dataBuffer.substr(2,2),16)<<8)+c;if(b.dataBuffer.length>=4+2*c){var d=b.dataBuffer.substr(0,4+2*c);b.dataBuffer=b.dataBuffer.substr(4+2*c);(c=a._hex2frame(d))&&this._onFrame(a,c);b.dataBuffer&&this._resolveData(a)}}},_onFrame:function(a,b){var c=this.getBuffer(a);if(c&&c.packetBuffer){for(var d=null,g=0;g<c.packetBuffer.length;g++)if(c.packetBuffer[g]&&c.packetBuffer[g].reqId==b.reqId){d=c.packetBuffer[g];break}d&&(this.removePacket(a,d),this._sendNextPacket(a),d.callback&&d.callback(null,
b))}},_onSocketConnect:function(a){var b=this.getBuffer(a);b&&(b.status=2,this._sendNextPacket(a))},_onSocketTimeout:function(a){var b=this.getBuffer(a);b&&1==b.status&&(b.status=0,this._clearPackets(a,Error("socket connection timeout")))},_onSocketError:function(a,b){var c=this.getBuffer(a);if(c)switch(c.status){case 0:case 1:case 3:c.status=0;break;case 2:c.status=3,a._close()}this._clearPackets(a,b)},_onSocketClose:function(a){var b=this.getBuffer(a);b&&(b.status=0,this._clearPackets(a,Error("socket closed")))},
_onSocketData:function(a,b){var c=this.getBuffer(a);c&&(c.dataBuffer+=b);this._resolveData(a)}};e.prototype.executeCommandCreator=function(a,b,c){a?b?this._doCommand(a,b,c):c&&c(Error("command is null")):c&&c(Error("device is null"))};e.prototype.executeCommand=function(a,b,c){var d={};6==b.length||8==b.length?(d.value="rgbw",d.ext=b):4==b.length?(d.value="ct",d.ext=parseInt(b)):2==b.length&&0<=parseInt(b)&&100>=parseInt(b)?(d.value="bri",d.ext=b):d.value=b;this.executeCommandCreator(a,d,c)};e.prototype.getStateValues=
function(a,b){a={};b&&(a.state=b.onoff?"on":"off",b.level&&(a.bri=b.level));return a};e.prototype.getStates=function(a,b,c){this.getStatesCreator(a,b,c)};e.prototype.getStatesCreator=function(a,b,c){var d=this;this.CommandHandler=a;this._getAllNodeState(function(g,h){!g&&h&&d._logger.log("debug","get all node state response:"+JSON.stringify(h));var k={};if(h)for(var l=Object.keys(h),m=0;m<l.length;m++)k[l[m]]=d._resolveRawState(h[l[m]]);if(h&&d.CommandHandler&&d.CommandHandler.receivedState)for(var n in h)d.CommandHandler.receivedState("lightify",
n,h[n]);if(b){h=[];for(l=0;l<b.length;l++)(m=b[l])&&m.id&&(n="?",m.device&&m.device.address&&m.status&&m.status.value&&!g&&k&&(k[m.device.address]&&(n=k[m.device.address][m.status.value]),null==n&&"undefined"==typeof n&&(n="?")),h.push({id:m.id,status:n}));c&&c(null,h)}else c&&c(Error("deviceList is null"))})};e.prototype.listNodes=function(a){this._networkListNodes(function(b,c){if(b)a&&a(b);else{b=[];if(c)for(var d=0;d<c.length;d++)if(c[d]&&c[d].id64){var g={type:"light",data:c[d].type,name:c[d].name,
address:c[d].id64};"10"==c[d].type&&(g.type="plug");b.push(g)}a&&a(null,b)}})};e.prototype.listZones=function(a){this._networkListZones(function(b,c){if(b)a&&a(b);else{b=[];if(c)for(var d=0;d<c.length;d++)c[d]&&c[d].id&&b.push({type:"group",data:"00",address:c[d].id,name:c[d].name});a&&a(null,b)}})};e.prototype._doCommand=function(a,b,c){if(a&&b)if(b.value){var d=this;switch(b.value){case "toggle":case "up":case "down":this._getAllNodeState(function(g,h){if(g)c&&c(g);else if(g=h[a.address])switch(b.value){case "toggle":d._doCommand(a,
{value:g.onoff?"off":"on"},function(k,l){c&&c(k,l)});break;case "up":case "down":h=g.level;if("up"==b.value)h=0==g.onoff?10:h+10;else if(0==g.onoff){c&&c(null);break}else h-=10;100<h&&(h=100);0>h&&(h=0);d._doCommand(a,{value:"bri",ext:h},function(k,l){c&&c(k,l)});break;default:c&&c(null)}else c&&c(Error("no such device in network"))});break;case "bri":if(0==parseInt(b.ext)){this._doCommand(a,{value:"bri",ext:1},function(g,h){g?c&&c(g):d._doCommand(a,{value:"off"},function(k,l){c&&c(k,l)})});break}default:this._buildCommandReq(a,
b,function(g,h){g?c&&c(g):(d._logger.log("debug","send command frame:"+JSON.stringify(h)),e._SB.addPacket(d,h,function(k,l){k?(d._logger.log("debug","receive command response error:"+k.message),c&&c(k)):(d._logger.log("debug","receive command response:"+JSON.stringify(l)),(k=d._statusError(l.status))?(d._logger.log("debug","receive command response status error:"+k.message),c&&c(k)):c&&c(null,h))}))})}}else c&&c(Error("command invalid"));else c&&c(Error("invalid parameters"))};e.prototype._getAllNodeState=
function(a){this._networkListNodes(function(b,c){if(b)a&&a(b);else{b={};if(c)for(var d=0;d<c.length;d++)c[d]&&c[d].id64&&(b[c[d].id64]={online:parseInt(c[d].online,16),onoff:parseInt(c[d].onoff,16),level:parseInt(c[d].level,16),colorTemp:parseInt(c[d].cct.substr(2,2)+c[d].cct.substr(0,2),16),red:parseInt(c[d].red,16),green:parseInt(c[d].green,16),blue:parseInt(c[d].blue,16),white:parseInt(c[d].white,16)});a&&a(null,b)}})};e.prototype._networkListNodes=function(a){this._logger.log("debug","send network list node request");
var b=this;e._SB.addPacket(this,{flag:0,cmd:19,payload:[1]},function(c,d){c?(b._logger.log("debug","receive network list node response error:"+c.message),a&&a(c)):(b._logger.log("debug","receive network_list_nodes response:"+JSON.stringify(d)),c=b._statusError(d.status),a&&a(c,d.nodes))})};e.prototype._networkListZones=function(a){this._logger.log("debug","send network list zones request");var b=this;e._SB.addPacket(this,{flag:2,cmd:30,payload:[]},function(c,d){c?(b._logger.log("debug","receive network list zones response error:"+
c.message),a&&a(c)):(b._logger.log("debug","receive network_list_zones response:"+JSON.stringify(d)),c=b._statusError(d.status),a&&a(c,d.zones))})};e.prototype._buildCommandReq=function(a,b,c){if(a&&a.address&&b&&b.value){var d=!1;4==a.address.length&&(d=!0);var g=d?2:0;switch(b.value){case "on":case "off":a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);a.push("on"==b.value?1:0);d=50;break;case "bri":if(null==b.ext||"undefined"==typeof b.ext){c(Error("command invalid"));return}g|=128;b=parseInt(b.ext);
100<b&&(b=100);0>b&&(b=0);a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);a.push(b);a=a.concat([1,0]);d=49;break;case "ct":if(null==b.ext||"undefined"==typeof b.ext){c(Error("command invalid"));return}g|=128;b=parseInt(b.ext);2E3>b&&(b=2E3);a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);a.push(b&255);a.push(b>>8&255);a=a.concat([1,0]);d=51;break;case "rgbwS":case "rgbw":if(!b.ext){c(Error("command invalid"));return}b=f._hex2arr(b.ext);4>b.length&&b.push(0);4<b.length&&(b=b.slice(0,4));a=a.address;
d&&(a+="000000000000");a=f._hex2arr(a);a=a.concat(b);a=a.concat([1,0]);d=54;break;case "effect":if(!b.ext){c(Error("command invalid"));return}a=a.address;d&&(a+="000000000000");a=f._hex2arr(a);if("none"==b.ext)a.push(0),a=a.concat([0,0]);else if("colorloop"==b.ext)a.push(1),a=a.concat([15,0]);else{c(Error("command invalid"));return}d=55;break;default:c(Error("unknow command:"+b.value),null);return}c(null,{flag:g,cmd:d,payload:a})}else c(Error("build command req parameters invalid"))};e.prototype._resolveRawState=
function(a){var b=a.red.toString(16);2!=b.length&&(b="0"+b);var c=a.green.toString(16);2!=c.length&&(c="0"+c);var d=a.blue.toString(16);2!=d.length&&(d="0"+d);var g=a.white.toString(16);2!=g.length&&(g="0"+g);return{power:a.onoff?"on":"off",bri:a.onoff?a.level:0,ct:a.colorTemp,rgbw:(b+c+d+g).toUpperCase()}};e.prototype._statusError=function(a){var b=null;switch(a){case 16:case 17:case 18:case 21:case 255:b=Error("error code:"+a)}return b};e.prototype._buildFrame=function(a,b,c,d){var g=[],h=6+d.length;
g.push(h&255);g.push(h>>8&255);g.push(a);g.push(b);g.push(c&255);g.push(c>>8&255);g.push(c>>16&255);g.push(c>>24&255);return g=g.concat(d)};e.prototype._connect=function(){this._logger.log("trace","connect");var a=this,b=!1,c=require("net").connect({port:this.port,host:this.ip});c.setTimeout(e.SO_TIMEOUT);c.setEncoding("hex");c.on("connect",function(){a._logger.log("trace","connect to lightify:"+a.ip);b=!0;a._socket=c;e._SB._onSocketConnect(a,c)});c.on("data",function(d){a._logger.log("trace","receive from lightify:"+
a.ip+" data:"+d);e._SB._onSocketData(a,d)});c.on("error",function(d){b?a._logger.log("trace","lightify:"+a.ip+" error:"+d.message):a._logger.log("trace","lightify:"+a.ip+" connection error:"+d.message);e._SB._onSocketError(a,d)});c.on("timeout",function(){b?a._logger.log("trace","hub:"+a.ip+" data timeout"):a._logger.log("trace","lightify:"+a.ip+" connection timeout");e._SB._onSocketTimeout(a)});c.on("close",function(){a._logger.log("trace","hub:"+a.ip+" close socket");e._SB._onSocketClose(a)});c._doConnect&&
"function"==typeof c._doConnect&&c._doConnect()};e.prototype._send=function(a,b,c,d,g){a=this._buildFrame(a,b,c,d);this._sendRaw(a,function(h){g&&g(h,c)})};e.prototype._sendRaw=function(a,b){this._logger.log("trace","send to lightify:"+this.ip+" data:"+f._arr2hex(a));this._socket.write(new Buffer(a));b&&b()};e.prototype._close=function(){this._logger.log("trace","close");this._socket&&this._socket.end()};e.prototype._hex2frame=function(a){var b=f._hex2arr(a);if(6>(b[1]<<8)+b[0])return null;a={flag:b[2],
cmd:b[3]};a.reqId=b[4]+(b[5]<<8)+(b[6]<<16)+(b[7]<<24);a.payload=b.slice(8);a.valid=!1;switch(a.cmd){case 19:if(3<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.num=a.payload[1]+(a.payload[2]<<8),a.nodes=[],0<a.num))for(b=0;b<a.num&&!(a.payload.length<3+50*(b+1));b++){var c=a.payload.slice(3+50*b,3+50*(b+1)),d={};d.id16=f._arr2hex(c.slice(0,2));d.id64=f._arr2hex(c.slice(2,10));d.type=f._arr2hex(c.slice(10,11));d.majorVer=f._arr2hex(c.slice(11,12));d.minorVer=f._arr2hex(c.slice(12,13));d.patchVer=
f._arr2hex(c.slice(13,14));d.buildVer=f._arr2hex(c.slice(14,15));d.online=f._arr2hex(c.slice(15,16));d.groupMember=f._arr2hex(c.slice(16,18));d.onoff=f._arr2hex(c.slice(18,19));d.level=f._arr2hex(c.slice(19,20));d.cct=f._arr2hex(c.slice(20,22));d.red=f._arr2hex(c.slice(22,23));d.green=f._arr2hex(c.slice(23,24));d.blue=f._arr2hex(c.slice(24,25));d.white=f._arr2hex(c.slice(25,26));d.name=c.slice(26,42);d.name=f._arr2str(d.name);a.nodes.push(d)}break;case 30:if(3<=a.payload.length&&(a.valid=!0,a.status=
a.payload[0],a.num=a.payload[1]+(a.payload[2]<<8),a.zones=[],0<a.num))for(b=0;b<a.num&&!(a.payload.length<3+18*(b+1));b++)c={},c.id=a.payload.slice(3+18*b,18*b+5),c.id=f._arr2hex(c.id),c.name=a.payload.slice(18*b+5,18*b+21),c.name=f._arr2str(c.name),a.zones.push(c);break;case 49:case 50:case 51:case 54:case 55:12<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.result=a.payload.slice(3));break;case 98:13<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.num=a.payload[1]+(a.payload[2]<<
8),a.result=a.payload.slice(3,12),a.onoff=a.payload[12]);break;case 104:13<=a.payload.length&&(a.valid=!0,a.status=a.payload[0],a.num=a.payload[1]+(a.payload[2]<<8),a.result=a.payload.slice(3,12),a.online=a.payload[12],a.onoff=a.payload[13],a.level=a.payload[14],a.colorTemp=a.payload[15]+(a.payload[16]<<8),a.red=a.payload[17],a.green=a.payload[18],a.blue=a.payload[19],a.white=a.payload[20]);break;default:a.valid=!0}return a};e.prototype.toJSON=function(){return{sys:xnm.aio.osram.Lightify.DM.SYS,ip:this.ip,
port:this.port,uuid:this.uuid}};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port:!1};e.parseJSON=function(a){return a.ip?new e(a.ip,a.port):null};e.discoveryWithTimeout=function(a,b){var c=require("x.mdns.js");c.clearRecordBuffer();c.discoverServiceWithTimeout("_http._tcp.local",a,function(d,g){if(d)b&&b(d);else{for(var h=[],k=0;k<g.length;k++){var l=g[k];if(l.target&&l.ip&&0<l.ip.length&&0==l.target.indexOf("Lightify")){var m=l.target.substr(9);m=m.replace(".local",
"");l=new e(l.ip[0]);l.uuid=m;h.push(l)}}b&&b(d,h)}})};return e}();
xnm.aio.osram.Lightify.DM=function(){var f=xnm.aio.osram.DMError,e=xnm.aio.osram.DMError.ERROR_CODE,a=function(b,c,d){if(b)if(b.gateway)if(b.type)if(null==b.data||"undefined"==typeof b.data)d(new f(e.INVALID,"data is invalid"));else if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var g;for(g=0;g<c.length;g++)if(c[g].index===b.gateway){var h=c[g];break}h?d():d(new f(e.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else d(new f(e.NOT_FOUND,"gateway with index "+
b.gateway+" not exists"));else d(new f(e.INVALID,"type is invalid"));else d(new f(e.INVALID,"gateway is invalid"));else d(new f(e.INVALID,"info is invalid"))};return{SYS:"lightify",MAP:{onoff:{command:[{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"on",ref:{value:"on"}}],status:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},dimmable:{command:[{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},
{type:"int",name:"brightness",ref:{value:"bri",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"brightness",ref:{value:"bri",extMeta:"0-100"}}]},colortemp:{command:[{type:"int",name:"color temperature",ref:{value:"ct",ext:"%d",extMeta:"2700-6500",scale:"38"}}],status:[{type:"int",name:"color temperature",ref:{value:"ct",extMeta:"2700-6500",scale:"38"}}]},colorlight:{command:[{type:"string",name:"rgbw color",ref:{value:"rgbwS",ext:"%s"}},{type:"rgbw",name:"rgbw color",ref:{value:"rgbw",ext:"%s"}},
{type:"enum",name:"effect",ref:{value:"effect",ext:"%e",extMeta:["none","colorloop"]}}],status:[{type:"rgbw",name:"rgbw color",ref:{value:"rgbw"}}]},extendcolor:{},group:{command:[{type:"int",name:"do scene",ref:{value:"doScene",ext:"%d"}}]}},registModule:function(b){b.register(this.SYS,"osram")},getGatewayType:function(){return{sys:this.SYS,name:"OSRAM LIGHTIFY / LEDvance Gateway",port:4E3}},getGatewayDeviceType:function(){var b={sys:this.SYS,type:"light",name:"Light",subtypes:[]};b.subtypes.push({id:"OnOff Light",
data:1});b.subtypes.push({id:"Color Dimmer Light",data:2});b.subtypes.push({id:"Dimmer Light",data:4});b.subtypes.push({id:"Color Light",data:8});b.subtypes.push({id:"Extended Color Light",data:10});return[b,{sys:this.SYS,type:"group",name:"Group"}]},createGateway:function(b,c,d){b?b.ip?d(null,b):d(new f(e.INVALID,"ip is invalid")):d(new f(e.INVALID,"info is invalid"))},updateGateway:function(b,c,d,g){c?c.ip?g(null,c):g(new f(e.INVALID,"ip is invalid")):g(new f(e.INVALID,"update is invalid"))},deleteGateway:function(b,
c,d){d()},createDevice:function(b,c,d){a(b,c,function(g){d(g,b)})},updateDevice:function(b,c,d){a(b,c,function(g){d(g,b)})},deleteDevice:function(b,c,d){d(null,b)},getCommandStatusMap:function(b){var c=function(l){return JSON.parse(JSON.stringify(l))};if(!b)return null;var d={command:[],status:[]},g=0;if("light"==b.type||"plug"==b.type)g=10,null!=b.data&&"undefined"!=typeof b.data&&(g=parseInt(b.data,16));switch(g){case 0:d.command=d.command.concat(c(this.MAP.group.command));d.command=d.command.concat(c(this.MAP.colorlight.command));
d.command=d.command.concat(c(this.MAP.colortemp.command));d.command.push(c(this.MAP.dimmable.command[2]));d.command.push(c(this.MAP.onoff.command[1]));d.command.push(c(this.MAP.onoff.command[2]));break;case 10:case 8:d.command=d.command.concat(c(this.MAP.colorlight.command)),d.status=d.status.concat(c(this.MAP.colorlight.status));case 2:b=c(this.MAP.colortemp.command);var h=c(this.MAP.colortemp.status);if(10==g){for(var k=0;k<b.length;k++)b[k]&&b[k].ref&&"ct"==b[k].ref.value&&(b[k].ref.extMeta="2000-6500",
b[k].ref.scale="15");for(k=0;k<h.length;k++)h[k]&&h[k].ref&&"ct"==h[k].ref.value&&(b[k].ref.extMeta="2000-6500",b[k].ref.scale="15")}d.command=d.command.concat(b);d.status=d.status.concat(h);case 4:d.command=d.command.concat(c(this.MAP.dimmable.command)),d.status=d.status.concat(c(this.MAP.dimmable.status));case 1:case 16:d.command=d.command.concat(c(this.MAP.onoff.command)),d.status=d.status.concat(c(this.MAP.onoff.status))}0==g&&delete d.status;return d}}}();
xnm.aio.osram.DM=function(){var f=xnm.aio.osram.DMError,e=xnm.aio.osram.DMError.ERROR_CODE;return{getGatewayType:function(){var a=[],b;for(b in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(b)){var c=xnm.aio.osram[b];c&&c.DM&&c.DM.getGatewayType&&(c=c.DM.getGatewayType())&&a.push(c)}return a},getGatewayDeviceType:function(a){var b=[],c;for(c in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(c)){var d=xnm.aio.osram[c];d&&d.DM&&d.DM.getGatewayDeviceType&&(d=d.DM.getGatewayDeviceType(a))&&(Array.isArray(d)?
b=b.concat(d):b.push(d))}return b},getIPDeviceType:function(a,b){var c=[],d;for(d in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(d)){var g=xnm.aio.osram[d];g&&g.DM&&g.DM.getIPDeviceType&&(g=g.DM.getIPDeviceType(a,b))&&c.push(g)}return c},_getSystem:function(a){for(var b in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(b)){var c=xnm.aio.osram[b];if(c&&c.DM&&c.DM.SYS&&c.DM.SYS==a)return c}return null},_checkSystemMethod:function(a,b,c){if(a)if(a.sys){var d=this._getSystem(a.sys);d&&d.DM&&d.DM[b]?
c&&c(null,d):c&&c(new f(e.INVALID,"no such sys:"+a.sys))}else c&&c(new f(e.INVALID,"sys is invalid"));else c&&c(new f(e.INVALID,"info is invalid"))},createGateway:function(a,b,c){this._checkSystemMethod(a,"createGateway",function(d,g){d?c&&c(d):g.DM.createGateway(a,b,c)})},updateGateway:function(a,b,c,d){this._checkSystemMethod(b,"updateGateway",function(g,h){g?d&&d(g):h.DM.updateGateway(a,b,c,d)})},deleteGateway:function(a,b,c){this._checkSystemMethod(a,"deleteGateway",function(d,g){d?c&&c(d):g.DM.deleteGateway(a,
b,c)})},createDevice:function(a,b,c){this._checkSystemMethod(a,"createDevice",function(d,g){d?c&&c(d):g.DM.createDevice(a,b,c)})},updateDevice:function(a,b,c){this._checkSystemMethod(a,"updateDevice",function(d,g){d?c&&c(d):g.DM.updateDevice(a,b,c)})},deleteDevice:function(a,b,c){this._checkSystemMethod(a,"deleteDevice",function(d,g){d?c&&c(d):g.DM.deleteDevice(a,b,c)})},applyUIFilter:function(a,b){var c=function(l,m){if("*"==l)return!0;for(var n=!1,q=0;q<l.length;q++)if(l[q]==m){n=!0;break}return n},
d=function(l,m,n){var q=[];switch(n.catagory){case "command":l.command&&l.command.forEach(function(p){c(n.elems,p.type)&&(p=JSON.parse(JSON.stringify(p)),q.push(p))});break;case "status":l.status&&l.status.forEach(function(p){c(n.elems,p.type)&&(p=JSON.parse(JSON.stringify(p)),q.push(p))})}return q},g=function(l,m){var n=[],q;if(l.sys){var p=this._getSystem(l.sys);p&&p.DM&&p.DM.getCommandStatusMap&&(q=p.DM.getCommandStatusMap(l))}q&&(l=d(q,l,m),n=n.concat(l));return n};if(!a.sys)return null;var h=
JSON.parse(JSON.stringify(a)),k=null;switch(b.catagory){case "command":k=g.call(this,a,b);h.command=k;break;case "status":k=g.call(this,a,b);h.status=k;break;default:return null}return k&&0!=k.length?h:null}}}();
xnm.aio.osram.Handler=function(){var f=function(){};f.prototype.devicemanager=xnm.aio.osram.DM;f.prototype.Lightify=xnm.aio.osram.Lightify;f.prototype.registModule=function(e){for(var a in xnm.aio.osram)if(xnm.aio.osram.hasOwnProperty(a)){var b=xnm.aio.osram[a];b&&b.DM&&b.DM.registModule&&b.DM.registModule(e)}};f.prototype.getStateValues=function(e,a){return(new xnm.aio.osram.Lightify).getStateValues(e,a)};f.prototype.resolveGateway=function(e){switch(e.sys){case xnm.aio.osram.Lightify.DM.SYS:return xnm.aio.osram.Lightify.parseJSON(e);
default:return null}};f.prototype.getDeviceCommands=function(e,a){e=(e=xnm.aio.osram.DM.applyUIFilter(e,{catagory:"command",elems:"*"}))?e.command:[];a&&a(null,e)};f.prototype.getDeviceCommandList=function(e,a){var b=[];if("color-light"==e.data||"ext-color-light"==e.data||"group"==e.data)a||b.push({id:window.XC_Text.colorvalue,cmd:"colorvalue"});b.push({id:window.XC_Text.on,cmd:"on"});b.push({id:window.XC_Text.off,cmd:"off"});if(("dimmer"==e.data||"color-temp-dimmer"==e.data||"color-light"==e.data||
"ext-color-light"==e.data||"group"==e.data)&&!a)for(var c=0;100>=c;c+=5)b.push({id:window.XC_Text.dimTo+c+"%",cmd:""+c});if(("color-temp-dimmer"==e.data||"color-light"==e.data||"ext-color-light"==e.data||"group"==e.data)&&!a)for(e=2700;6500>=e;e+=380)b.push({id:window.XC_Text.colortemp+e,cmd:""+e});return b};f.prototype.getDeviceStatus=function(e,a){e=(e=xnm.aio.osram.DM.applyUIFilter(e,{catagory:"status",elems:"*"}))?e.status:[];a&&a(null,e)};f.prototype.doCommand=function(e,a,b,c){(e=this.resolveGateway(e))?
e.executeCommandCreator(a,b,function(d){c&&c(d)}):c&&c(Error("gateway json format invalid"))};f.prototype.doStatus=function(e,a,b,c,d){(a=this.resolveGateway(a))?a.getStatesCreator(null,[{id:e,device:b,status:c}],function(g,h){g?d&&d(g):d&&d(null,h[0])}):d&&d(Error("gateway json format invalid"))};f.prototype.searchLightifyWithTimeout=function(e,a){xnm.aio.osram.Lightify.discoveryWithTimeout(e,a)};f.prototype.getDeviceList=function(e,a){var b=this.resolveGateway(e);b?b instanceof xnm.aio.osram.Lightify?
b.listNodes(function(c,d){c?a&&a(c):b.listZones(function(g,h){g?a&&a(g):(g={lights:d,groups:h},a&&a(null,g))})}):a&&a(Error("gateway do not support get device list")):a&&a(Error("gateway json format invalid"))};return f}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.osram.Handler);

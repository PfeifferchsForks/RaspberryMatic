var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.harmony=xnm.aio.harmony||{};
xnm.aio.harmony.Hub=function(){var l=function(a,b,f){this._hub=a;this._closeSocket=b;this._callback=f;this._data="";this._devices={devices:[],activities:[]}};l.prototype.execute=function(a){a.write('<iq type="get" id="2320426445" from="e01b88af-b4cd-4d1c-8e76-85562ea3fad5"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?config"></oa></iq>')};l.prototype._onSocketData=function(a){if("<iq/>"!=a&&(this._data+=a,-1!=this._data.indexOf("</iq>"))){a=this._data.indexOf("<![CDATA");
var b=this._data.indexOf("]]\x3e</oa>");if(0<a&&b>a&&(a=JSON.parse(this._data.substring(a+9,b)))&&a.activity&&a.device){for(b=0;b<a.device.length;b++){for(var f=[],d=0;d<a.device[b].controlGroup.length;d++)for(var k=a.device[b].controlGroup[d]["function"],h=0;h<k.length;h++)try{var p=JSON.parse(k[h].action);p&&p.command&&f.push({key:p.command})}catch(n){}this._devices.devices.push({sys:xnm.aio.harmony.DM.SYS,id:a.device[b].id,type:g.DEVICE_TYPE.IR,name:a.device[b].label,ircodes:{sys:xnm.aio.harmony.DM.SYS,
codes:f}})}for(b=0;b<a.activity.length;b++)this._devices.activities.push({sys:xnm.aio.harmony.DM.SYS,id:a.activity[b].id,type:g.DEVICE_TYPE.ACTIVITY,name:a.activity[b].label})}this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this,this._closeSocket)}};l.prototype._onSocketTimeout=function(){this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this,!0)};l.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};
var c=function(a,b,f,d){this._type="send command";this._hub=a;this._closeSocket=b;this._callback=d;this._type=f.type;this._id=f.id;this._command=f.command;this._socket=null;this._released=!1};c.prototype.execute=function(a){if("IRCommand"==this._type){this._hub&&this._hub._logger.log("debug","send press");var b='<iq type="render" id="3669650010" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?holdAction">status=press:action={"command"::"'+
this._command+'","type"::"'+this._type+'","deviceId"::"'+this._id+'"}</oa></iq>\r\n'}else this._hub&&this._hub._logger.log("debug","send activity"),b='<iq type="startActivity" id="1028178097" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?startActivity">activityId='+this._id+"</oa></iq>\r\n";this._socket=a;a.write(b)};c.prototype._onSocketData=function(){var a=!1;"IRCommand"==this._type&&this._released?a=!0:"IRCommand"!=this._type&&
(a=!0);"IRCommand"!=this._type||this._released||(this._hub&&this._hub._logger.log("debug","send release"),this._socket.write('<iq type="render" id="3669650010" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?holdAction">status=release:action={"command"::"'+this._command+'","type"::"'+this._type+'","deviceId"::"'+this._id+'"}</oa></iq>\r\n'),this._released=!0);a&&(this._callback&&this._callback(null),this._hub&&this._hub._onJobFinish(this))};
c.prototype._onSocketTimeout=function(){this._callback&&this._callback(Error("harmony response timeout"));this._hub&&this._hub._onJobFinish(this)};c.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};var e=function(a,b){this._type="ping";this._hub=a;this._callback=b;this._socket=null;this._released=!1};e.prototype.execute=function(a){this._socket=a;a.write('<iq type="get" id="ping"><ping xmlns="urn:xmpp:ping"/></iq>\r\n')};e.prototype._onSocketData=function(a){var b=
!1;-1!=a.indexOf("id='ping'")&&(b=!0);b&&(this._callback&&this._callback(null),this._hub&&this._hub._onJobFinish(this))};e.prototype._onSocketTimeout=function(){this._callback&&this._callback(Error("harmony response timeout"));this._hub&&this._hub._onJobFinish(this)};e.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};var m=function(a,b){this._hub=a;this._callback=b;this._data="";this._devices={devices:[],activities:[]}};m.prototype.execute=function(a){a.write('<iq type="get" id="current_activity"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?getCurrentActivity"></oa></iq>')};
m.prototype._onSocketData=function(a){if("<iq/>"!=a&&(this._data+=a,-1!=this._data.indexOf("</iq>"))){a=null;var b=this._data.indexOf("<![CDATA["),f=this._data.indexOf("]]\x3e");0<b&&f>b&&(b=this._data.substring(b+9,f),0==b.indexOf("result=")&&(a=b.substr(7)));this._callback&&this._callback(null,a);this._hub&&this._hub._onJobFinish(this)}};m.prototype._onSocketTimeout=function(){this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this)};m.prototype._onJobCancelled=
function(){this._callback&&this._callback(Error("job cancelled"))};var g=function(a,b,f,d,k,h){this._logger=require("x.logger.js").getLogger("xnm.aio.harmony.Hub");this.ip=a;this.port=5222;b&&(this.port=b);this.user=f;this.password=d;this.uuid=h;this._authToken=k;this._socket=this._sessionToken=null;this._fsm=0;this._jobQueue=[];this._listener=this._pingIT=null};g.SO_TIMEOUT=5E3;g.FSM_STATE={IDLE:0,CONNECTING:1,CONNECTED:2};g.DEVICE_TYPE={IR:"IRCommand",ACTIVITY:"Activity"};g.prototype.startMonitor=
function(a){var b=this;this._createSession(function(f){b._logger.log("debug","create session finish:"+f);f?(b._fsm=g.FSM_STATE.IDLE,b._clean()):(b._fsm=g.FSM_STATE.CONNECTED,b._startPing());a&&a(f)})};g.prototype.setMonitorListener=function(a){this._listener=a};g.prototype.executeCommandCreator=function(a,b,f,d){b&&b.value?a&&a.id?a.type?(this._logger.log("debug","execute command:"+b.value),this._sendCommand(a.type,b.value,a.id,d,function(k){f&&f(k)})):f&&f(Error("device has no type")):f&&f(Error("device has no id")):
f&&f(Error("command invalid"))};g.prototype.getStatesCreator=function(a,b,f){b?this.getCurrentActivity(function(d,k){for(var h=[],p=0;p<b.length;p++){var n=b[p];n&&n.id&&b[p].device&&(n=d?"?":-1==k?"off":n.device.id==k?"on":"off",h.push({id:b[p].id,status:n}))}f&&f(null,h)}):f&&f(Error("deviceList is null"))};g.prototype.getDevices=function(a,b){a=new l(this,a,b);this._addJob(a)};g.prototype.getCurrentActivity=function(a){a=new m(this,a);this._addJob(a)};g.prototype._getAuthToken=function(a){this._logger.log("debug",
"get auth token");var b='{"password":"'+this.password+'", "email":"'+this.user+'"}',f=this,d=require("url").parse("https://svcs.myharmony.com/CompositeSecurityServices/Security.svc/json/GetUserAuthToken");d.port||(d.port=80);d={host:d.hostname,port:d.port,path:d.path,method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","Content-Length":b.length,Connection:"close"}};var k=a;a=require("http").request(d,function(h){if(200==h.statusCode){h.setEncoding("binary");var p="";h.on("data",
function(n){p+=n});h.on("end",function(){var n=JSON.parse(p);n&&n.GetUserAuthTokenResult&&n.GetUserAuthTokenResult.UserAuthToken?((n=n.GetUserAuthTokenResult.UserAuthToken)||(n="dummy_token"),k&&(f._logger.log("trace","get auth token:"+n),k(null,n),k=null)):k&&(f._logger.log("trace","get token http reponse has no token, use dummy token"),k(null,"dummy_token"),k=null)})}else k&&(k(Error("get auth token http response:"+h.statusCode)),k=null)});if(a.on&&"function"==typeof a.on)a.on("error",function(h){k&&
(k(h),k=null)});a.write(b);a.end()};g.prototype._getSessionToken=function(a){this._logger.log("debug","get session token");if(this._sessionToken)a&&a(null,this._sessionToken);else{var b='<iq type="get" id="3174962747" from="guest"><oa xmlns="connect.logitech.com" mime="vnd.logitech.connect/vnd.logitech.pair">token='+this._authToken+":name=1vm7ATw/tN6HXGpQcCs/A5MkuvI#iOS6.0.1#iPhone</oa></iq>",f=!1,d=a,k=this;a={port:this.port,host:this.ip};var h=require("net").connect(a);h.setTimeout(g.SO_TIMEOUT);
h.setEncoding("utf8");h.on("connect",function(){k._logger.log("trace","get session token connect to hub:"+k.ip);f=!0;h.write(b)});h.on("data",function(p){k._logger.log("trace","get session token receive from hub:"+k.ip+" data:"+p);if("<iq/>"!=p){var n=p.indexOf(":identity=");0<n?d&&(d(null,p.substr(n+10,36)),d=null):d&&(d(Error("get session token response has no token")),d=null);h.end()}});h.on("error",function(p){f?(k._logger.log("trace","get session token hub:"+k.ip+" error:"+p.message),h.end()):
k._logger.log("trace","get session token hub:"+k.ip+" connection error:"+p.message);d&&(d(p),d=null)});h.on("timeout",function(){f?(k._logger.log("trace","get session token hub:"+k.ip+" data timeout"),d&&(d(Error("read timeout")),d=null),h.end()):(k._logger.log("trace","get session token hub:"+k.ip+" connection timeout"),d&&(d(Error("connection timeout")),d=null))});h.on("close",function(){k._logger.log("trace","get session token hub:"+k.ip+" close socket");d&&(d(Error("get session token socket closed")),
d=null)});h._doConnect&&"function"==typeof h._doConnect&&h._doConnect()}};g.prototype._login=function(a){this._logger.log("debug","login");var b='<auth xmlns="urn:ietf:params:xml:ns:xmpp-sasl" mechanism="PLAIN">'+(new Buffer(this._sessionToken+"@x.com"+this._sessionToken)).toString("base64")+"</auth>\r\n",f=!1,d=!1,k=a,h=this;a={port:this.port,host:this.ip};var p="",n=require("net").connect(a);n.setTimeout(g.SO_TIMEOUT);n.setEncoding("utf8");n.on("connect",function(){h._logger.log("trace","connect to hub:"+
h.ip);f=!0;n.write("<stream:stream xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams' version='1.0' to='x.com'>\r\n");n.write(b)});n.on("data",function(q){h._logger.log("trace","receive from hub:"+h.ip+" data:"+q);d?h._onSocketData(q):(p+=q,-1!=p.indexOf("<success")&&(h._logger.log("trace","loggin success"),d=!0,k&&(k(null,n),k=null)))});n.on("error",function(q){f?d?(h._logger.log("trace","hub:"+h.ip+" error:"+q.message),h._onSocketError(q)):(h._logger.log("trace","hub:"+h.ip+" login socket error:"+
q.message),k&&(k(q),k=null),n.end()):(h._logger.log("trace","hub:"+h.ip+" connection error:"+q.message),k&&(k(q),k=null))});n.on("timeout",function(){f?d?(h._logger.log("trace","hub:"+h.ip+" data timeout"),h._onSocketTimeout()):(h._logger.log("trace","hub:"+h.ip+" login data timeout"),p?(h._logger.log("trace","authentication fail"),k&&(k(Error("authentication fail")),k=null)):k&&(k(Error("login timeout")),k=null)):(h._logger.log("trace","hub:"+h.ip+" connection timeout"),k&&(k(Error("connection timeout")),
k=null))});n.on("close",function(){h._logger.log("trace","hub:"+h.ip+" close socket");f&&d&&h._onSocketClose()});n._doConnect&&"function"==typeof n._doConnect&&n._doConnect()};g.prototype._startPing=function(){var a=this;this._pingIT=setInterval(function(){var b=new e(a);a._addJob(b)},15E3)};g.prototype._parseNotify=function(a){var b=null;if(!a||-1==a.indexOf('type="connect.stateDigest?notify"'))return null;var f=a.indexOf("<![CDATA[");if(-1==f)return null;f+=9;var d=a.indexOf("]]\x3e",f);if(-1==
d)return null;a=a.substring(f,d);try{var k=JSON.parse(a);if(k.activityId)switch(b={activityId:k.activityId},k.activityStatus){case 3:b.activityStatus="POWERING_OFF";break;case 2:b.activityStatus="RUNNING";break;case 1:b.activityStatus="STARTING";break;case 0:b.activityStatus="NO_ACTIVITY"}return b}catch(h){return null}};g.prototype._sendCommand=function(a,b,f,d,k){a=new c(this,d,{type:a,command:b,id:f},k);this._addJob(a)};g.prototype._addJob=function(a){var b=this._jobQueue.length;this._jobQueue.push(a);
0==b&&this._doNextJob()};g.prototype._onSocketTimeout=function(){if(this._jobQueue&&0<this._jobQueue.length){var a=this._jobQueue[0];a&&a._onSocketTimeout&&a._onSocketTimeout()}};g.prototype._onSocketError=function(){this._closeSocket()};g.prototype._onSocketClose=function(){this._clean();if(this._listener&&this._listener.onClose)this._listener.onClose()};g.prototype._onSocketData=function(a){if(this._jobQueue&&0<this._jobQueue.length){var b=this._jobQueue[0];b&&b._onSocketData&&b._onSocketData(a)}this._listener&&
this._listener.onData&&(b=this._parseNotify(a),this._listener.onData(a,b))};g.prototype._onJobFinish=function(a,b){a&&this._jobQueue&&this._jobQueue[0]===a&&(this._jobQueue.splice(0,1),b&&this._closeSocket(),this._doNextJob())};g.prototype._closeSocket=function(){this._logger.log("trace","manually close socket");this._socket&&this._socket.end();this._clean()};g.prototype._clean=function(){if(this._jobQueue)for(var a=0;a<this._jobQueue.length;a++)this._jobQueue[a]._onJobCancelled();this._jobQueue=
[];this._pingIT&&clearInterval(this._pingIT);this._sessionToken=this._socket=this._pingIT=null;this._fsm=g.FSM_STATE.IDLE};g.prototype._doNextJob=function(){var a=this;this._jobQueue&&0<this._jobQueue.length&&(this._fsm==g.FSM_STATE.IDLE?(this._logger.log("debug","not connected"),this._fsm=g.FSM_STATE.CONNECTING,this._createSession(function(b){a._logger.log("debug","create session finish:"+b);b?(a._fsm=g.FSM_STATE.IDLE,a._clean()):(a._fsm=g.FSM_STATE.CONNECTED,a._doNextJob())})):this._fsm==g.FSM_STATE.CONNECTED&&
(this._logger.log("debug","execute next job"),this._jobQueue[0].execute(this._socket)))};g.prototype._createSession=function(a){var b=this;this._authToken?this._sessionToken?this._login(function(f,d){f||!d?(b._sessionToken=null,a&&a(f?f:Error("socket is null"))):(b._socket=d,a&&a(f))}):this._getSessionToken(function(f,d){f?a&&a(f):d?(b._sessionToken=d,b._createSession(a)):a&&a(Error("invalid session token"))}):this._getAuthToken(function(f,d){f?a&&a(f):d?(b._authToken=d,b._createSession(a)):a&&a(Error("invalid auth token"))})};
g.prototype.toJSON=function(){return{sys:xnm.aio.harmony.DM.SYS,ip:this.ip,port:this.port,username:this.user,password:this.password,token:this._authToken,uuid:this.uuid}};g.prototype.equalsTo=function(a){return a&&a instanceof g?this.ip==a.ip&&this.port==a.port&&this.user==a.user&&this.password==a.password:!1};g.parseJSON=function(a){return a&&a.ip&&a.username&&a.password?new xnm.aio.harmony.Hub(a.ip,a.port,a.username,a.password,a.token,a.uuid):null};return g}();
xnm.aio.harmony.Discovery=function(){var l=function(){this.Hubs={};this._sockets=[];var c=this;this._server=require("net").createServer(function(b){b.on("data",function(f){var d={};f=f.toString().split(";");for(var k=0;k<f.length;k++){var h=f[k].split(":");2==h.length&&(d[h[0]]=h[1])}d.ip&&d.port&&d.uuid&&(c.Hubs[d.uuid]?c.Hubs[d.uuid].ip=d.ip:c.Hubs[d.uuid]=new xnm.aio.harmony.Hub(d.ip,d.port,d.email,null,null,d.uuid))});b.on("end",function(){});b.on("error",function(f){})});this._server.listen();
var e=require("os");require("dgram");if(e&&e.networkInterfaces){e=e.networkInterfaces();for(var m in e)for(var g=e[m],a=0;a<g.length;a++)this._addDiscoverSocket(null,g[a])}else this._addDiscoverSocket(null,null)};l.prototype._addDiscoverSocket=function(c,e){c=require("dgram");if(e)"IPv4"==e.family&&0==e.internal&&(m=c.createSocket("udp4"),m.on("listening",function(){m.setBroadcast(!0)}),m.ip=e.address,this._sockets.push(m));else{var m=c.createSocket("udp4");this._sockets.push(m)}};l.prototype._sendDiscoveryMessages=
function(){for(var c=0;c<this._sockets.length;c++)if(this._sockets[c].ip){var e=this._sockets[c].ip.substr(0,this._sockets[c].ip.lastIndexOf("."))+".255",m=new Buffer("_logitech-reverse-bonjour._tcp.local.\n"+this._server.address().port);this._sockets[c].send(m,0,m.length,5224,e)}};l.prototype.discoverHubs=function(){var c=this,e=0,m=setInterval(function(){c._sendDiscoveryMessages();1<=e++&&clearInterval(m)},250)};return l}();
xnm.aio.harmony.DM=function(){var l=function(c,e){this.code=c;this.message=e;this.stack=Error().stack};l.prototype=Error();l.prototype.name="HarmonyDeviceManagerError";l.prototype.code=0;l.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"harmony",getGatewayType:function(){return{sys:this.SYS,name:"Logitech Harmony Hub"}},createGateway:function(c,e,m){e=l.ERROR_CODE;c?c.ip?c.port?c.username?c.password?m(null,c):m(new l(e.INVALID,"password is invalid")):
m(new l(e.INVALID,"username is invalid")):m(new l(e.INVALID,"port is invalid")):m(new l(e.INVALID,"ip is invalid")):m(new l(e.INVALID,"info is invalid"))},updateGateway:function(c,e,m,g){c=l.ERROR_CODE;e?e.ip?e.port?e.username?e.password?g(null,e):g(new l(c.INVALID,"password is invalid")):g(new l(c.INVALID,"username is invalid")):g(new l(c.INVALID,"port is invalid")):g(new l(c.INVALID,"ip is invalid")):g(new l(c.INVALID,"update is invalid"))},deleteGateway:function(c,e,m){m()},createDevice:function(c,
e,m){var g=l.ERROR_CODE;if(c)if(c.gateway)if(e.data&&e.data.gateways&&0!==e.data.gateways.length){e=e.data.gateways;var a;for(a=0;a<e.length;a++)if(e[a].index===c.gateway){var b=e[a];break}b?m(null,c):m(new l(g.NOT_FOUND,"gateway with index "+c.gateway+" not exists"))}else m(new l(g.NOT_FOUND,"gateway with index "+c.gateway+" not exists"));else m(new l(g.INVALID,"gateway is invalid"));else m(new l(g.INVALID,"info is invalid"))},updateDevice:function(c,e,m){var g=l.ERROR_CODE;if(c)if(c.gateway){e=
e.data.gateways;var a;for(a=0;a<e.length;a++)if(e[a].index===c.gateway){var b=e[a];break}b?m(null,c):m(new l(g.NOT_FOUND,"gateway with index "+c.gateway+" not exists"))}else m(new l(g.INVALID,"gateway is invalid"));else m(new l(g.INVALID,"info is invalid"))},deleteDevice:function(c,e,m){m()},getCommandStatusMap:function(c){var e={command:[]};if(c&&c.type&&c.type==xnm.aio.harmony.Hub.DEVICE_TYPE.IR){if(c&&c.ircodes&&c.ircodes.codes){for(var m=0;m<c.ircodes.codes.length;m++){var g=c.ircodes.codes[m];
e.command.push({type:"enum",name:g.key,ref:{value:g.key}})}return e}}else if(c&&c.type&&c.type==xnm.aio.harmony.Hub.DEVICE_TYPE.ACTIVITY)return e.command.push({type:"enum",name:"execute",ref:{value:"execute"}}),e.status=[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}],e.ipevt="-1"==c.id?[{type:"enum",name:"event",ref:{value:"event",options:["allOff"]}}]:[{type:"enum",name:"event",ref:{value:"event",options:["on","off"]}}],e;return null},applyUIFilter:function(c,e){var m=function(d,
k){if("*"==d)return!0;for(var h=!1,p=0;p<d.length;p++)if(d[p]==k){h=!0;break}return h},g=function(d,k,h){var p=[];switch(h.catagory){case "command":d.command&&d.command.forEach(function(n){m(h.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),p.push(n))});break;case "status":d.status&&d.status.forEach(function(n){m(h.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),p.push(n))})}return p},a=function(d,k){var h=[],p=xnm.aio.harmony.DM.getCommandStatusMap(d);p&&(d=g(p,d,k),h=h.concat(d));return h};if(!c.sys)return null;
var b=JSON.parse(JSON.stringify(c)),f=null;switch(e.catagory){case "command":f=a(c,e);b.command=f;break;case "status":f=a(c,e);b.status=f;break;default:return null}return f&&0!=f.length?b:null},applyIPEventFilter:function(c,e){if(!c.sys)return null;e=JSON.parse(JSON.stringify(c));c=xnm.aio.harmony.DM.getCommandStatusMap(c);if(!c)return e;e.ipevt=c.ipevt;return e}}}();xnm.aio.harmony.Handler=function(){this._Discovery=null};xnm.aio.harmony.Handler.prototype.devicemanager=xnm.aio.harmony.DM;
xnm.aio.harmony.Handler.prototype.Hub=xnm.aio.harmony.Hub;xnm.aio.harmony.Handler.prototype.discoverHubs=function(l,c){this._Discovery||(this._Discovery=new xnm.aio.harmony.Discovery);this._Discovery.discoverHubs();var e=this;setTimeout(function(){c&&c(null,e._Discovery.Hubs)},l)};xnm.aio.harmony.Handler.prototype.registModule=function(l){l.register(xnm.aio.harmony.DM.SYS,"harmony")};xnm.aio.harmony.Handler.prototype.resolveGateway=function(l){return xnm.aio.harmony.Hub.parseJSON(l)};
xnm.aio.harmony.Handler.prototype.getDeviceCommands=function(l,c){l=(l=xnm.aio.harmony.DM.applyUIFilter(l,{catagory:"command",elems:"*"}))?l.command:[];c&&c(null,l)};xnm.aio.harmony.Handler.prototype.getDeviceStatus=function(l,c){l=(l=xnm.aio.harmony.DM.applyUIFilter(l,{catagory:"status",elems:"*"}))?l.status:[];c&&c(null,l)};xnm.aio.harmony.Handler.prototype.getDevices=function(l,c){(l=this.resolveGateway(l))?l.getDevices(!0,c):c&&c(Error("gateway json format invalid"))};
xnm.aio.harmony.Handler.prototype.doCommand=function(l,c,e,m){(l=this.resolveGateway(l))?l.executeCommandCreator(c,e,m,!0):m&&m(Error("gateway json format invalid"))};xnm.aio.harmony.Handler.prototype.doStatus=function(l,c,e,m,g){(c=this.resolveGateway(c))?c.getStatesCreator(null,[{id:l,device:e,status:m}],function(a,b){a?g&&g(a):g&&g(null,b[0])}):g&&g(Error("gateway json format invalid"))};
xnm.aio.harmony.Handler.prototype.getAuthToken=function(l,c){(l=this.resolveGateway(l))?l._getAuthToken(c):c&&c(Error("gateway json format invalid"))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.harmony.Handler);

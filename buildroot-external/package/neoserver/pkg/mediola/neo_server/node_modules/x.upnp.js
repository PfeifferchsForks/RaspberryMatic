var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,b){e instanceof String&&(e=String(e));for(var c=e.length,d=0;d<c;d++){var f=e[d];if(a.call(b,f,d,e))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,b){if(e==Array.prototype||e==Object.prototype)return e;e[a]=b.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<e.length;++a){var b=e[a];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,a){var b=$jscomp.propertyToPolyfillSymbol[a];if(null==b)return e[a];b=e[b];return void 0!==b?b:e[a]};
$jscomp.polyfill=function(e,a,b,c){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,a,b,c):$jscomp.polyfillUnisolated(e,a,b,c))};$jscomp.polyfillUnisolated=function(e,a,b,c){b=$jscomp.global;e=e.split(".");for(c=0;c<e.length-1;c++){var d=e[c];if(!(d in b))return;b=b[d]}e=e[e.length-1];c=b[e];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(b,e,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(e,a,b,c){var d=e.split(".");e=1===d.length;c=d[0];c=!e&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in c))return;c=c[g]}d=d[d.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?c[d]:null;a=a(b);null!=a&&(e?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:a}):a!==b&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(b=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+b+"$"+d),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");
$jscomp.checkStringArgs=function(e,a,b){if(null==e)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.startsWith",function(e){return e?e:function(a,b){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var d=c.length,f=a.length;b=Math.max(0,Math.min(b|0,c.length));for(var g=0;g<f&&b<d;)if(c[b++]!=a[g++])return!1;return g>=f}},"es6","es3");$jscomp.polyfill("Object.is",function(e){return e?e:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(e){return e?e:function(a,b){var c=this;c instanceof String&&(c=String(c));var d=c.length;b=b||0;for(0>b&&(b=Math.max(b+d,0));b<d;b++){var f=c[b];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(e){return e?e:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");var x=x||{};x.upnp=x.upnp||{};
x.upnp._DeviceCache={_cache:{},setDescLoaded:function(e,a){this._cache[e]||(this._cache[e]={});this._cache[e].loaded=a},addTarget:function(e,a){this._cache[e]&&(this._cache[e].targets||(this._cache[e].targets=[]),-1==this._cache[e].targets.indexOf(a)&&this._cache[e].targets.push(a))},putDevice:function(e,a,b){this._cache[e]||(this._cache[e]={loaded:!0});this._cache[e].device=a;this.addTarget(e,b)},getDevice:function(e){return(e=e?this._cache[e]:null)?e.device:null},getDeviceCache:function(e){return e?
this._cache[e]:null},removeDevices:function(e){for(var a=0;a<e.length;a++)delete this._cache[e[a]]},getDevices:function(){return this._cache},getDevicesWithTarget:function(e){var a=[],b;for(b in this._cache)if(this._cache.hasOwnProperty(b)){var c=this._cache[b];c.targets&&-1!=c.targets.indexOf(e)&&c.device&&a.push(c.device)}return a},removeDevicesWithTarget:function(e){var a={},b;for(b in this._cache){var c=!1,d=this._cache[b];d.targets&&-1!=d.targets.indexOf(e)&&d.device&&(c=!0);c||(a[b]=d)}this._cache=
a}};x.upnp._SSDPCache={_cache:{},putSSDP:function(e,a){if(e&&a){var b=a.getUUID();if(b){var c=a.getMaxAge(),d=Math.round((new Date).getTime()/1E3);this._cache[b]={ip:e,expire:d+c,location:a.location}}}},removeExpired:function(){var e=[],a=Math.round((new Date).getTime()/1E3),b;for(b in this._cache)if(this._cache.hasOwnProperty(b)){var c=this._cache[b].expire;-1==c?e.push(b):a>c&&e.push(b)}x.upnp._DeviceCache.removeDevices(e);for(a=0;a<e.length;a++)delete this._cache[e[a]]}};
x.upnp.SSDP=function(){var e=function(){this._usnObj=null};e.prototype.getUUID=function(){return this._usnObj?this._usnObj.uuid:null};e.prototype.getMaxAge=function(){if(!this["cache-control"])return-1;var a=this["cache-control"];a=a.replace("max-age","");a=a.replace("=","");a=parseInt(a.trim());a=parseInt(a);return isNaN(a)?-1:a};e.resolve=function(a){if(!a)return null;a=a.split("\n");var b=new e;switch(a[0].trim()){case "HTTP/1.1 200 OK":b.type="RESULT";break;case "NOTIFY * HTTP/1.1":b.type="NOTIFY";
break;case "M-SEARCH * HTTP/1.1":b.type="M-SEARCH";break;default:return null}for(var c=1;c<a.length&&"\r"!=a[c];c++){var d=a[c].trim(),f=d.indexOf(":");if(-1!=f){var g=d.substr(0,f);d=d.substr(f+1);g&&(b[g.toLowerCase()]=d.trim())}}if(!b.usn)return null;b._usnObj=x.upnp.Util.parseUSN(b.usn);return b};return e}();
x.upnp.UDPListener=function(){var e=function(){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("x.upnp.UDPListener"):{log:{}};this._callbacks=[];this._sockets=[];var a=require("os");require("dgram");if(a&&a.networkInterfaces){a=a.networkInterfaces();for(var b in a)for(var c=a[b],d=0;d<c.length;d++)this._addDiscoverSocket(c[d])}else this._addDiscoverSocket(null)};e.prototype._addDiscoverSocket=function(a){var b=require("dgram"),c=this;a?"IPv4"==a.family&&0==a.internal&&
(b=b.createSocket("udp4"),b.bind(null,a.address),b.on("message",function(d,f){c._onResponse(d,f)}),this._sockets.push(b)):(b=b.createSocket("udp4"),b.on("message",function(d,f){c._onResponse(d,f)}),this._sockets.push(b))};e.prototype.addCallback=function(a){a&&-1==this._callbacks.indexOf(a)&&this._callbacks.push(a)};e.prototype.removeCallback=function(a){a&&(a=this._callbacks.indexOf(a),-1!=a&&this._callbacks.splice(a,1))};e.prototype.sendMessage=function(a,b,c){a=new Buffer(a);for(var d=0;d<this._sockets.length;d++)this._sockets[d].send(a,
0,a.length,c,b)};e.prototype._onResponse=function(a,b){a=a.toString();this._logger.log("trace","receive ssdp from: "+(b?b.address:"unknown address"));var c=x.upnp.SSDP.resolve(a);c&&(this._logger.log("trace","usn:"+(c.usn?c.usn:"")+" location:"+(c.location?c.location:"")),x.upnp._SSDPCache.putSSDP(b.address,c),this._callbacks.forEach(function(d){d&&d(b.address,c)}))};return e}();
x.upnp.DescLoader=function(){var e=function(a,b){this.ip=a;this.port=80;this.uuid=b;this.subtype=this.type=this.name=null;this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("x.upnp.DescLoader"):{log:{}}};e.prototype.load=function(a,b){if("string"!==typeof a)b&&b(Error('Provided "url" argument is not a string.'));else{var c=null;try{c=require("url").parse(a)}catch(f){b&&b(f);return}c.port&&(this.port=c.port);var d=this;this._loadDeviceDesc2(a,function(f,g){f?b&&b(f):
(f=d._parseDesc(g))?b&&b(null,f):b&&b(Error("device desc parse error"))})}};e.prototype._loadDeviceDesc=function(a,b){var c=this;this._logger.log("trace","load device description from URL: "+a);var d=b;$.ajax({url:a,type:"get",timeout:5E3,dataType:"text",cache:!0,success:function(f){c._logger.log("trace","http request success for: "+a);d&&(d(null,f),d=null)},error:function(f,g){f="http request error:"+(f?f.status:"0")+"-"+g;c._logger.log("trace",f);d&&(d(Error(f)),d=null)}})};e.prototype._loadDeviceDesc2=
function(a,b){this._logger.log("trace","load device description from URL: "+a);var c=require("url").parse(a);c={host:c.hostname,port:c.port,path:c.path,method:"GET"};var d=this,f="",g=require("http"),h=b;try{var k=g.request(c,function(l){l.on("data",function(m){f+=m});l.on("end",function(){if(200==l.statusCode)d._logger.log("trace","http request success for: "+a),h&&h(null,f);else{var m="http request error: "+l.statusCode+"-"+f;d._logger.log("trace",m);h&&h(Error(m))}h=null})});k.setTimeout&&k.setTimeout(2E3,
function(){k.abort()});if(k.on&&"function"==typeof k.on)k.on("error",function(l){l||(l=Error("http request error"));h&&h(l);h=null});k.end()}catch(l){h&&h(l),h=null}};e.prototype._parseDesc=function(a){-1!=a.indexOf('xmlns:ms=" urn:microsoft-com:wmc-1-0"')&&(a=a.replace('xmlns:ms=" urn:microsoft-com:wmc-1-0"','xmlns:ms="urn:microsoft-com:wmc-1-0"'));var b=null;try{b=$($.parseXML(a))}catch(f){}if(!b)return null;a=b.find("device");if(!a||0==a.length)return null;a=$(a[0]);var c=this._parseDescXml(a);
if(!c)return null;c.embeddedDevices=[];var d=this;b.find("deviceList device").each(function(){var f=$(this);(f=d._parseDescXml(f))&&c.embeddedDevices.push(f)});return c};e.prototype._parseDescXml=function(a){if(!a)return null;var b=null,c=a.find("friendlyName");0<c.length&&(this.name=$(c[0]).text(),c=String(this.name).toLowerCase(),c.startsWith("wemo switch")||c.startsWith("wemo insight")?(this.type="wemo",c.startsWith("wemo insight")&&(this.subtype="insight")):c.includes("sonos")&&(this.type="sonos"));
(c=a.find("deviceType"))&&0<c.length&&(this.deviceType=$(c[0]).text());(c=a.find("manufacturer"))&&0<c.length&&(this.manufacturer=$(c[0]).text());(c=a.find("modelName"))&&0<c.length&&(this.modelName=$(c[0]).text(),c=this.modelName.toLowerCase(),c.startsWith("philips hue bridge")?this.type="hue":c.startsWith("sonos")&&(this.type="sonos"));(c=a.find("modelDescription"))&&0<c.length&&(this.modelDescription=$(c[0]).text());(c=a.find("serialNumber"))&&0<c.length&&(this.serialNumber=$(c[0]).text());c=a.find("UDN");
0<c.length&&(b=$(c[0]).text());c=a.find("X_DLNACAP");0<c.length&&(this.X_DLNACAP=$(c[0]).text());if(!this.name||!this.deviceType||!b)return null;6<b.length&&"uuid:"===b.substr(0,5)&&!this.uuid&&(this.uuid=b.substr(5));b=x.upnp.Util.parseURN(this.deviceType);if(!b)return null;b.device&&"MediaServer"===b.device.type?a=this.parseServer(a):b.device&&"MediaRenderer"===b.device.type?a=this.parseRenderer(a):(a=new x.upnp.Device,a.init(this.ip,this.port,this.uuid,{name:this.name,type:this.type,subtype:this.subtype,
modelName:this.modelName,manufacturer:this.manufacturer,modelDescription:this.modelDescription,deviceType:this.deviceType,dlnaCap:this.X_DLNACAP,serialNumber:this.serialNumber}));return a};e.prototype.parseServer=function(a){var b=null,c=null;a.find("serviceList service").each(function(){var d=$(this),f=d.find("serviceType");d=d.find("controlURL");if(0<f.length&&0<d.length)if(f=$(f[0]).text(),(d=$(d[0]).text())&&"/"==d.charAt(0)||(d="/"+d),-1!=f.indexOf("ContentDirectory"))b={type:f,url:d};else if("urn:schemas-upnp-org:service:ConnectionManager:1"==
f||"urn:schemas-upnp-org:service:ConnectionManager:2"==f)c={type:f,url:d}});return b&&c?(a=new x.upnp.MediaServer,a.init(this.ip,this.port,this.uuid,{name:this.name,type:this.type,subtype:this.subtype,modelName:this.modelName,manufacturer:this.manufacturer,modelDescription:this.modelDescription,deviceType:this.deviceType,dlnaCap:this.X_DLNACAP,serialNumber:this.serialNumber}),a.contentDirectory=b,a.connectionManager=c,a):null};e.prototype.parseRenderer=function(a){var b=null,c=null,d=null,f=null,
g=null;a.find("serviceList service").each(function(){var h=$(this),k=h.find("serviceType");h=h.find("controlURL");0<k.length&&0<h.length&&(k=$(k[0]).text(),(h=$(h[0]).text())&&"/"==h.charAt(0)||(h="/"+h),-1!=k.indexOf("GroupRenderingControl")?f={type:k,url:h}:-1!=k.indexOf("RenderingControl")?b={type:k,url:h}:-1!=k.indexOf("ConnectionManager")?c={type:k,url:h}:-1!=k.indexOf("AVTransport")?d={type:k,url:h}:-1!=k.indexOf("Queue")&&(g={type:k,url:h}))});return b&&d?(a=new x.upnp.MediaRenderer,a.init(this.ip,
this.port,this.uuid,{name:this.name,type:this.type,subtype:this.subtype,modelName:this.modelName,manufacturer:this.manufacturer,modelDescription:this.modelDescription,deviceType:this.deviceType,dlnaCap:this.X_DLNACAP,serialNumber:this.serialNumber}),a.renderingControl=b,a.connectionManager=c,a.avTransport=d,a.groupRenderingControl=f,a.queue=g,a):null};return e}();
x.upnp.DiscoveryService=function(){var e=function(a){this._udpListener=a;this._callbacks={};this._autoSearchITV=null;var b=this;this._udpListener.addCallback(function(c,d){b._onReceiveSSDP(c,d)})};e.prototype.M_SEARCH='M-SEARCH * HTTP/1.1\r\nHost: 239.255.255.250:1900\r\nMan: "ssdp:discover"\r\nMX: 5\r\n';e.prototype._findDevice=function(a,b){b&&this._callbacks["ssdp:all"]&&this._callbacks["ssdp:all"].forEach(function(c){c&&c(b)});b&&this._callbacks[a]&&this._callbacks[a].forEach(function(c){c&&c(b)})};
e.prototype.addCallback=function(a,b){a||(a="upnp:rootdevice");this._callbacks[a]||(this._callbacks[a]=[]);b&&-1==this._callbacks[a].indexOf(b)&&this._callbacks[a].push(b)};e.prototype.removeCallback=function(a,b){a||(a="upnp:rootdevice");this._callbacks[a]&&b&&(b=this._callbacks[a].indexOf(b),-1!=b&&this._callbacks[a].splice(b,1))};e.prototype.startAutoSearch=function(){if(!this._autoSearchITV){var a=this;this._autoSearchITV=setInterval(function(){a.discoverTarget("upnp:rootdevice")},3E4);this.discoverTarget("upnp:rootdevice")}};
e.prototype.stopAutoSearch=function(){this._autoSearchITV&&(clearInterval(this._autoSearchITV),this._autoSearchITV=null)};e.prototype.discoverWithTimeout=function(a,b){this.discoverTargetWithTimeout("upnp:rootdevice",a,b)};e.prototype.discoverTargetWithTimeout=function(a,b,c){var d=function(g){g&&d.devices.push(g)};d.devices=[];this.addCallback(a,d);var f=this;this.discoverTarget(a);setTimeout(function(){f.removeCallback(a,d);c&&c(d.devices)},b)};e.prototype.discoverTarget=function(a){x.upnp._SSDPCache.removeExpired();
x.upnp._DeviceCache.removeDevicesWithTarget(a);this._udpListener.sendMessage(this.M_SEARCH+"ST: "+a+"\r\n\r\n","239.255.255.250",1900)};e.prototype._onReceiveSSDP=function(a,b){if("RESULT"==b.type){var c=b.getUUID(),d=b.st,f=x.upnp._DeviceCache.getDeviceCache(c);if(f&&f.device)f.targets&&-1!=f.targets.indexOf(d)||(x.upnp._DeviceCache.addTarget(c,d),this._findDevice(d,f.device));else if(!f||!f.loaded){var g=this;x.upnp._DeviceCache.setDescLoaded(c,!0);(new x.upnp.DescLoader(a,c)).load(b.location,function(h,
k){h||!k?x.upnp._DeviceCache.setDescLoaded(c,!1):(x.upnp._DeviceCache.putDevice(c,k,d),g._findDevice(d,k))})}}};return e}();
x.upnp.Util={parseUSN:function(e){if(!e||5>=e.length||"uuid:"!=e.substr(0,5))return null;var a={},b=e.indexOf("::",5);if(5==b)return null;if(-1==b)return a.uuid=e.substr(5),a;a.uuid=e.substring(5,b);if(e=e.substr(b+2))a.urn=this.parseURN(e);return a},parseURN:function(e){if(!e)return null;if("upnp:rootdevice"==e.substr(0,15))return{domain:"upnp",device:{type:"rootdevice"}};if("urn:"==e.substr(0,4)){var a=null;if(e=e.substr(4))e=e.split(":"),e[0]&&(a={domain:e[0]},"device"==e[1]&&e[2]&&e[3]?a.device=
{type:e[2],ver:e[3]}:"service"==e[1]&&e[2]&&e[3]&&(a.service={type:e[2],ver:e[3]}));return a}return null},findTag:function(e,a,b){var c=e.find(a);return c&&0<c.length?c:b?(c=e.find(b+"\\:"+a))&&0<c.length?c:c=this._iterateTag(e,a,b):[]},_iterateTag:function(e,a,b){var c=[],d=e.prop("tagName");d&&(d==a||d==b+":"+a)&&c.push(e);if((e=e.children())&&0<e.length)for(d=0;d<e.length;d++){var f=this._iterateTag($(e[d]),a,b);f&&0<f.length&&(c=c.concat(f))}return c}};
x.upnp.SOAPClient=function(){var e=function(){this._logger="undefined"!=typeof require&&require?require("x.logger.js").getLogger("x.upnp.SOAPClient"):{log:{}}};e.prototype._getSOAPMessage=function(a){return'<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><s:Body>'+a+"</s:Body>\n</s:Envelope>"};e.prototype.doRequest=function(a,b,c,d){c=this._getSOAPMessage(c);var f=require("url").parse(a);b={host:f.hostname,port:f.port,path:f.path,
method:"POST",headers:{"Content-Type":'text/xml; charset="utf-8"',"Content-Length":c.length,SOAPACTION:b,"User-Agent":"",Connection:"close"}};var g=this,h=require("http");b.port||(b.port=80);"https"==f.protocol&&(h=require("https"),"undefined"!=typeof process&&process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"),b.port||(b.port=443));this._logger.log("trace","send post to url:"+a);this._logger.log("trace","with headers:"+JSON.stringify(b.headers));this._logger.log("trace","with data:"+
c);var k=d,l=h.request(b,function(m){var n="";m.setEncoding("utf8");m.on("data",function(p){n+=p});m.on("end",function(){g._logger.log("trace","http reponse status code:"+m.statusCode);g._logger.log("trace","http reponse:"+n);var p;200!=m.statusCode&&(p=Error("http reponse status code:"+m.statusCode));k&&k(p,n,m.statusCode);k=null})});l.setTimeout&&l.setTimeout(2E4,function(){l.abort()});if(l.on&&"function"==typeof l.on)l.on("error",function(m){m||(m=Error("soap request error"));g._logger.log("trace",
"soap request error:"+m.message);k&&k(m);k=null});l.write(c);l.end()};return e}();
x.upnp.Device=function(){var e=function(){this.serialNumber=this.modelDescription=this.manufacturer=this.modelName=this.deviceType=this.subtype=this.type=this.name=this.uuid=this.port=this.ip=null};e.prototype.init=function(a,b,c,d){this.ip=a;this.port=b;this.uuid=c;for(var f in d)d.hasOwnProperty(f)&&(this[f]=d[f])};e.prototype._parseItemMetaData=function(a){var b=null,c=null,d=a.find("container");d&&d[0]&&(c=$(d[0]),b=c.getAttributes(),b=JSON.parse(JSON.stringify(b)));(a=a.find("item"))&&a[0]&&
(c=$(a[0]),b=c.getAttributes(),b=JSON.parse(JSON.stringify(b)));if(c)for(c=c.children(),a=0;a<c.length;a++)if(d=$(c[a])){var f=d.prop("tagName"),g=f.indexOf(":");-1!=g&&(f=f.substr(g+1));b[f]=d.text()}return b};e.prototype._maskMetaData=function(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/'/g,"&apos;");a=a.replace(/\r/g,"");a=a.replace(/\n/g,"");return a=a.replace(/\t/g,"")};e.prototype._unmaskMetaData=function(a){if(!a)return a;a=a.replace(/&lt;/g,
"<");a=a.replace(/&gt;/g,">");a=a.replace(/&amp;/g,"&");a=a.replace(/&quot;/g,'"');return a=a.replace(/&apos;/g,"'")};e.prototype._parseSOAPResponse=function(a,b){if(!a)return null;try{var c=$($.parseXML(a))}catch(f){return null}if(!c)return null;try{var d=x.upnp.Util.findTag(c,b,"u");return d&&0<d.length?$(d[0]):null}catch(f){return null}};e.prototype.getURL=function(a){var b="http://"+this.ip;this.port&&80!=this.port&&(b+=":"+this.port);return b+a};e.prototype._getDuration=function(a){var b=a.split(":");
3==b.length&&(a=3600*parseInt(b[0])+60*parseInt(b[1])+parseInt(b[2]));return a};e.prototype._doSOAPRequest=function(a,b,c,d,f){var g="<u:"+c+' xmlns:u="'+b+'">',h;for(h in d)if(d.hasOwnProperty(h)){var k=d[h]+"";g+="<"+h+">"+(k?this._maskMetaData(k):"")+"</"+h+">"}var l=this;this._doRequest(a,'"'+b+"#"+c+'"',g+("</u:"+c+">"),function(m,n,p){m?f&&f(m):200!=p?f&&f(Error("http response code:"+p)):(m=l._parseSOAPResponse(n,c+"Response"))?f&&f(null,m):f&&f(Error(c+" reponse format invalid"))})};e.prototype._doRequest=
function(a,b,c,d){(new x.upnp.SOAPClient).doRequest(a,b,c,function(f,g,h){d&&d(null,g,h)})};return e}();
x.upnp.MediaServer=function(){var e=function(){this.connectionManager=this.contentDirectory=null};e.prototype=new x.upnp.Device;e.prototype.constructor=e;e.prototype.search=function(a,b,c,d){var f=this;b||(b="dc:title,upnp:artist,upnp:album,upnp:albumArtURI,res,res@protocolInfo,res@duration,res@resolution,res@size");var g='<u:Search xmlns:u="urn:schemas-upnp-org:service:ContentDirectory:1"><ContainerID>0</ContainerID><SearchCriteria>'+(a+"</SearchCriteria><Filter>")+(b+"</Filter><StartingIndex>")+
(c+"</StartingIndex>");g+="<RequestedCount>"+this.chunkSize+"</RequestedCount>";g+="<SortCriteria></SortCriteria>";g+="</u:Search>";(new XCUPNPSOAPRequest).doRequest(this.getURL(this.contentDirectory),'"urn:schemas-upnp-org:service:ContentDirectory:1#Search"',g,function(h){if(h=f._parseSOAPResponse(h,!0)){var k=0,l=[];try{var m=$($.parseXML(h));l=f._getItems(m);k=$(m.children()[0]).children().length}catch(n){}k==f.chunkSize?(setTimeout(function(){f.search(a,b,c+f.chunkSize,d)},0),d(l,!1)):d(l,!0)}})};
e.prototype.browseMetaData=function(a,b){this._browseMetaData(a,function(c,d){c?b&&b(c):d&&d?b&&b(c,d):b&&b(Error("meta data invalid"))})};e.prototype.browseChildren=function(a,b,c,d,f){this._browseChildren(a,"*",b,c,null,function(g,h){if(g)f&&f(g);else if(h&&h.result){g=[];for(var k=0;k<h.result.length;k++){var l=h.result[k];d&&l["class"]?"object.container"==l["class"]?g.push(l):-1!=d.indexOf(l["class"])&&g.push(l):g.push(l)}f&&f(null,g,h.totalMatches)}else f&&f(null,[],0)})};e.prototype._getRes=
function(a){var b=null,c=0;a.find("res").each(function(){var d=$(this),f=d.attr("size");if(!b||f&&f>c)b=d,c=f});return b};e.prototype._getItems=function(a){var b=[],c=this;a.find("container").each(function(){var d=$(this),f=x.upnp.Util.findTag(d,"title","dc"),g=x.upnp.Util.findTag(d,"class","upnp");if(0<g.length&&0<f.length){g=$(g[0]).text();f=$(f[0]).text();f={type:"container","class":g,parentID:d.attr("parentID"),id:d.attr("id"),title:f};if(g=c._getRes(d)){var h=g.text(),k=null;g.attr("duration")&&
(k=c._getDuration(g.attr("duration")));f.res={url:h,dur:k}}d=x.upnp.Util.findTag(d,"albumArtURI","upnp");0<d.length&&(f.albumArtURI=$(d[0]).text());b.push(f)}});a.find("item").each(function(){var d=$(this),f=x.upnp.Util.findTag(d,"class","upnp"),g=x.upnp.Util.findTag(d,"title","dc");if(0<f.length&&0<g.length){f=$(f[0]).text();g=$(g[0]).text();g={type:"item",parentID:d.attr("parentID"),id:d.attr("id"),"class":f,title:g};var h=c._getRes(d,f);if(h){var k=h.text(),l=null;h.attr("duration")&&(l=c._getDuration(h.attr("duration")));
g.res={url:k,dur:l}}0==f.indexOf("object.item.audioItem")&&(g.info={},f=x.upnp.Util.findTag(d,"genre","upnp"),0<f.length&&(g.info.genre=$(f[0]).text()),f=x.upnp.Util.findTag(d,"artist","upnp"),0<f.length&&(g.info.artist=$(f[0]).text()),f=x.upnp.Util.findTag(d,"album","upnp"),0<f.length&&(g.info.album=$(f[0]).text()),f=x.upnp.Util.findTag(d,"albumArtURI","upnp"),0<f.length&&(g.info.albumArtURI=$(f[0]).text()));b.push(g)}});return b};e.prototype._browseMetaData=function(a,b){var c=this;this._browse(a,
"BrowseMetadata","*",0,0,null,function(d,f){if(d)b&&b(d);else{if(f.result)try{var g=$($.parseXML(f.result));f.meta=c._parseItemMetaData(g)}catch(h){b&&b(h);return}b(null,f)}})};e.prototype._browseChildren=function(a,b,c,d,f,g){var h=this;this._browse(a,"BrowseDirectChildren",b,c,d,f,function(k,l){if(k)g&&g(k);else{if(l.result)try{var m=$($.parseXML(l.result));l.result=h._getItems(m)}catch(n){g&&g(n);return}g(null,l)}})};e.prototype._browse=function(a,b,c,d,f,g,h){b||(b="BrowseDirectChildren");c||
(c="");g||(g="");a={ObjectID:a,BrowseFlag:b,Filter:c,StartingIndex:d,RequestedCount:f,SortCriteria:g};this._doSOAPRequest(this.getURL(this.contentDirectory.url),this.contentDirectory.type,"Browse",a,function(k,l){if(k)h&&h(k);else{k={};var m=l.find("Result");m&&0<m.length&&(k.result=$(m[0]).text());(m=l.find("NumberReturned"))&&0<m.length&&(k.numberReturned=$(m[0]).text());(m=l.find("TotalMatches"))&&0<m.length&&(k.totalMatches=$(m[0]).text());(m=l.find("UpdateID"))&&0<m.length&&(k.updateID=$(m[0]).text());
h&&h(null,k)}})};return e}();
x.upnp.MediaRenderer=function(){var e=function(){this.avTransport=this.connectionManager=this.renderingControl=null};e.prototype=new x.upnp.Device;e.prototype.constructor=e;e.prototype.PLAY_MODE="NORMAL SHUFFLE REPEAT_ONE REPEAT_ALL RANDOM DIRECT_1 INTRO".split(" ");e.prototype.TRANSPORT_STATE="STOPPED PLAYING TRANSITIONING PAUSED_PLAYBACK PAUSED_RECORDING RECORDING NO_MEDIA_PRESENT".split(" ");e.prototype.getPlayState=function(a){this.getPlayState_cbs||(this.getPlayState_cbs=[]);var b=this.getPlayState_cbs.length;
a&&-1==this.getPlayState_cbs.indexOf(a)&&this.getPlayState_cbs.push(a);if(0==b){var c=this,d=function(f,g){var h=c.getPlayState_cbs;c.getPlayState_cbs=[];h.forEach(function(k){k&&k(f,g)})};this._getTransportInfo(0,function(f,g){d&&d(f,g?g.currentTransportState:null)})}};e.prototype.getPlayInfo=function(a){this.getPlayInfo_cbs||(this.getPlayInfo_cbs=[]);var b=this.getPlayInfo_cbs.length;a&&-1==this.getPlayInfo_cbs.indexOf(a)&&this.getPlayInfo_cbs.push(a);if(0==b){var c=function(f,g){var h=d.getPlayInfo_cbs;
d.getPlayInfo_cbs=[];h.forEach(function(k){k&&k(f,g)})},d=this;this._getPositionInfo(0,function(f,g){f?c&&c(f):(f={},g.trackDuration&&(f.duration=g.trackDuration,f.durationSec=d._getDuration(g.trackDuration)),g.relTime&&(f.position=g.relTime,f.positionSec=d._getDuration(g.relTime)),f.trackMetaDataRaw=g.trackMetaDataRaw,f.trackMetaData=g.trackMetaData,c&&c(null,f))})}};e.prototype.getMediaInfo=function(a){this.getMediaInfo_cbs||(this.getMediaInfo_cbs=[]);var b=this.getMediaInfo_cbs.length;a&&-1==this.getMediaInfo_cbs.indexOf(a)&&
this.getMediaInfo_cbs.push(a);if(0==b){var c=function(f,g){var h=d.getMediaInfo_cbs;d.getMediaInfo_cbs=[];h.forEach(function(k){k&&k(f,g)})},d=this;this._getMediaInfo(0,function(f,g){c&&c(f,g)})}};e.prototype.getPlayMode=function(a){this.getPlayMode_cbs||(this.getPlayMode_cbs=[]);var b=this.getPlayMode_cbs.length;a&&-1==this.getPlayMode_cbs.indexOf(a)&&this.getPlayMode_cbs.push(a);if(0==b){var c=function(f,g){var h=d.getPlayMode_cbs;d.getPlayMode_cbs=[];h.forEach(function(k){k&&k(f,g)})},d=this;this._getTransportSettings(0,
function(f,g){c&&c(f,g?g.playMode:null)})}};e.prototype.playResource=function(a,b,c){var d=this;this._setAVTransportURI(0,a.url,b,function(f){f?c&&c(f):d.play(c)})};e.prototype.playContainer=function(a,b,c){var d="dlna-playcontainer://"+encodeURIComponent("uuid:"+a.server_uuid)+"?sid="+encodeURIComponent("urn:upnp-org:serviceId:ContentDirectory")+"&cid="+encodeURIComponent(a.containerID)+"&md=0";"undefined"!=typeof a.firstIdx&&null!=a.firstIdx&&(d+="&fii="+a.firstIdx);var f=this;this._setAVTransportURI(0,
d,b,function(g){g?c&&c(g):f.play(c)})};e.prototype.play=function(a){this._play(0,1,a)};e.prototype.pause=function(a){this._pause(0,a)};e.prototype.stop=function(a){this._stop(0,a)};e.prototype.previous=function(a){this._previous(0,1,a)};e.prototype.next=function(a){this._next(0,1,a)};e.prototype.seekRelTime=function(a,b){this._seek(0,"REL_TIME",a,b)};e.prototype.seekRelTimeSec=function(a,b){var c=a%60,d=(a-c)/60%60;a=(a-c-60*d)/3600;for(c+="";2>c.length;)c="0"+c;for(d+="";2>d.length;)d="0"+d;for(a+=
"";2>a.length;)a="0"+a;this._seek(0,"REL_TIME",a+":"+d+":"+c,b)};e.prototype.seekTrack=function(a,b){this._seek(0,"TRACK_NR",a,b)};e.prototype.setPlayMode=function(a,b){this._setPlayMode(0,a,b)};e.prototype.mute=function(a){this._setMute(0,"Master",1,a)};e.prototype.unmute=function(a){this._setMute(0,"Master",0,a)};e.prototype.toggleMute=function(a){var b=this;this.isMuted(function(c,d){c?a&&a(c):d?b.unmute(a):b.mute(a)})};e.prototype.isMuted=function(a){this.isMuted_cbs||(this.isMuted_cbs=[]);var b=
this.isMuted_cbs.length;a&&-1==this.isMuted_cbs.indexOf(a)&&this.isMuted_cbs.push(a);if(0==b){var c=function(f,g){var h=d.isMuted_cbs;d.isMuted_cbs=[];h.forEach(function(k){k&&k(f,g)})},d=this;this._getMute(0,"Master",function(f,g){f?c&&c(f):c&&c(null,"1"==g.mute)})}};e.prototype.setVolume=function(a,b){a=parseInt(a);0>a&&(a=0);100<a&&(a=100);this._setVolume(0,"Master",a,b)};e.prototype.volumeUp=function(a){var b=this;this.getVolume(function(c,d){c||100==d?a&&a(c):b.setVolume(d+5,a)})};e.prototype.volumeDown=
function(a){var b=this;this.getVolume(function(c,d){c||0==d?a&&a(c):b.setVolume(d-5,a)})};e.prototype.getVolume=function(a){this.getVolume_cbs||(this.getVolume_cbs=[]);var b=this.getVolume_cbs.length;a&&-1==this.getVolume_cbs.indexOf(a)&&this.getVolume_cbs.push(a);if(0==b){var c=function(f,g){var h=d.getVolume_cbs;d.getVolume_cbs=[];h.forEach(function(k){k&&k(f,g)})},d=this;this._getVolume(0,"Master",function(f,g){f?c&&c(f):c&&c(null,parseInt(g.volume))})}};e.prototype._setAVTransportURI=function(a,
b,c,d){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"SetAVTransportURI",{InstanceID:a,CurrentURI:b,CurrentURIMetaData:c},d)};e.prototype._seek=function(a,b,c,d){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"Seek",{InstanceID:a,Unit:b,Target:c},d)};e.prototype._play=function(a,b,c){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"Play",{InstanceID:a,Speed:b},c)};e.prototype._pause=function(a,b){this._doSOAPRequest(this.getURL(this.avTransport.url),
this.avTransport.type,"Pause",{InstanceID:a},b)};e.prototype._stop=function(a,b){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"Stop",{InstanceID:a},b)};e.prototype._previous=function(a,b,c){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"Previous",{InstanceID:a,Speed:b},c)};e.prototype._next=function(a,b,c){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"Next",{InstanceID:a,Speed:b},c)};e.prototype._setPlayMode=
function(a,b,c){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"SetPlayMode",{InstanceID:a,NewPlayMode:b},c)};e.prototype._getTransportInfo=function(a,b){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"GetTransportInfo",{InstanceID:a},function(c,d){if(c)b&&b(c);else{c={};var f=d.find("CurrentTransportState");0<f.length&&(c.currentTransportState=$(f[0]).text());f=d.find("CurrentTransportStatus");0<f.length&&(c.currentTransportStatus=$(f[0]).text());
f=d.find("CurrentSpeed");0<f.length&&(c.currentSpeed=$(f[0]).text());b&&b(null,c)}})};e.prototype._getPositionInfo=function(a,b){var c=this;this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"GetPositionInfo",{InstanceID:a},function(d,f){if(d)b&&b(d);else{d={};var g=f.find("Track");0<g.length&&(d.track=$(g[0]).text());g=f.find("TrackDuration");0<g.length&&(d.trackDuration=$(g[0]).text());g=f.find("TrackMetaData");if(0<g.length)if(g=$(g[0]).text())try{var h=$($.parseXML(g));
d.trackMetaDataRaw=h;d.trackMetaData=c._parseItemMetaData(h)}catch(k){b&&b(k);return}else d.trackMetaDataRaw="",d.trackMetaData=null;g=f.find("TrackURI");0<g.length&&(d.trackURI=$(g[0]).text());g=f.find("RelTime");0<g.length&&(d.relTime=$(g[0]).text());g=f.find("AbsTime");0<g.length&&(d.absTime=$(g[0]).text());g=f.find("RelCount");0<g.length&&(d.relCount=$(g[0]).text());g=f.find("AbsCount");0<g.length&&(d.absCount=$(g[0]).text());b&&b(null,d)}})};e.prototype._getMediaInfo=function(a,b){var c=this;
this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"GetMediaInfo",{InstanceID:a},function(d,f){if(d)b&&b(d);else{d={};var g=f.find("NrTracks");0<g.length&&(d.nrTracks=$(g[0]).text());g=f.find("MediaDuration");0<g.length&&(d.mediaDuration=$(g[0]).text());g=f.find("CurrentURI");0<g.length&&(d.currentURI=$(g[0]).text());g=f.find("CurrentURIMetaData");if(0<g.length)if((g=$(g[0]).text())&&"null"!=g.toLowerCase())try{var h=$($.parseXML(g));d.currentURIMetaDataRaw=h;d.currentURIMetaData=
c._parseItemMetaData(h)}catch(k){b&&b(k);return}else d.currentURIMetaDataRaw="",d.currentURIMetaData=null;g=f.find("NextURI");0<g.length&&(d.nextURI=$(g[0]).text());g=f.find("NextURIMetaData");if(0<g.length)if(g=$(g[0]).text())try{h=$($.parseXML(g)),d.nextURIMetaDataRaw=h,d.nextURIMetaData=c._parseItemMetaData(h)}catch(k){b&&b(k);return}else d.nextURIMetaDataRaw="",d.nextURIMetaData=null;g=f.find("PlayMedium");0<g.length&&(d.playMedium=$(g[0]).text());g=f.find("RecordMedium");0<g.length&&(d.ecordMedium=
$(g[0]).text());g=f.find("WriteStatus");0<g.length&&(d.writeStatus=$(g[0]).text());b&&b(null,d)}})};e.prototype._getTransportSettings=function(a,b){this._doSOAPRequest(this.getURL(this.avTransport.url),this.avTransport.type,"GetTransportSettings",{InstanceID:a},function(c,d){if(c)b&&b(c);else{c={};var f=d.find("PlayMode");0<f.length&&(c.playMode=$(f[0]).text());f=d.find("RecQualityMode");0<f.length&&(c.recQualityMode=$(f[0]).text());b&&b(null,c)}})};e.prototype._setMute=function(a,b,c,d){this._doSOAPRequest(this.getURL(this.renderingControl.url),
this.renderingControl.type,"SetMute",{InstanceID:a,Channel:b,DesiredMute:c},d)};e.prototype._getMute=function(a,b,c){this._doSOAPRequest(this.getURL(this.renderingControl.url),this.renderingControl.type,"GetMute",{InstanceID:a,Channel:b},function(d,f){d?c&&c(d):(d={},f=f.find("CurrentMute"),0<f.length&&(d.mute=$(f[0]).text()),c&&c(null,d))})};e.prototype._setVolume=function(a,b,c,d){this._doSOAPRequest(this.getURL(this.renderingControl.url),this.renderingControl.type,"SetVolume",{InstanceID:a,Channel:b,
DesiredVolume:c},d)};e.prototype._getVolume=function(a,b,c){this._doSOAPRequest(this.getURL(this.renderingControl.url),this.renderingControl.type,"GetVolume",{InstanceID:a,Channel:b},function(d,f){d?c&&c(d):(d={},f=f.find("CurrentVolume"),0<f.length&&(d.volume=$(f[0]).text()),c&&c(null,d))})};return e}();
x.upnp.XCUPNP=function(){var e=function(){this._udpListener=new x.upnp.UDPListener;this._discoveryService=new x.upnp.DiscoveryService(this._udpListener)};e.prototype.MediaServer=x.upnp.MediaServer;e.prototype.MediaRenderer=x.upnp.MediaRenderer;e.prototype.Device=x.upnp.Device;e.prototype.DescLoader=x.upnp.DescLoader;e.prototype.discoverDevices=function(a){this.discoverTargetWithTimeout("upnp:rootdevice",5E3,a)};e.prototype.discoverDevicesWithTarget=function(a,b){this.discoverTargetWithTimeout(a,5E3,
b)};e.prototype.discoverDevicesWithTimeout=function(a,b){this.discoverTargetWithTimeout("upnp:rootdevice",a,b)};e.prototype.discoverTargetWithTimeout=function(a,b,c){this._discoveryService.addCallback(a,c);this._discoveryService.discoverTarget(a);var d=this;setTimeout(function(){d._discoveryService.removeCallback(a,c)},b)};e.prototype.getDiscoveryService=function(){return this._discoveryService};return e}();var XCUPNP=x.upnp.XCUPNP;
"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.upnp.XCUPNP);

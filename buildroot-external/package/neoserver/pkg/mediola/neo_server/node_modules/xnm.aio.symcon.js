var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];if(!(f in c))return;c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var f=a.split(".");a=1===f.length;d=f[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<f.length-1;e++){var g=f[e];if(!(g in d))return;d=d[g]}f=f[f.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[f]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+c+"$"+f),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,f=function(e){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new b(c+(e||"")+"_"+d++,e)};return f},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,f={next:function(){if(!d&&c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d=!0;return{done:!0,value:void 0}}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.symcon=xnm.aio.symcon||{};xnm.aio.symcon.TYPE_BOOL=0;xnm.aio.symcon.TYPE_INT=1;xnm.aio.symcon.TYPE_FLOAT=2;xnm.aio.symcon.TYPE_STRING=3;xnm.aio.symcon.Util={clearHttpOptionForLog:function(a){try{var b=JSON.parse(JSON.stringify(a));b.auth&&(b.auth="xxxxxx:xxxxxx");if(b.headers)for(var c in headers)if(c&&"authorization"==c.toLocaleLowerCase()){var d=headers[c];if(d){var f=d.indexOf(" ");headers[c]=-1==f?"xxxxxx":d.substr(0,f)+" xxxxxx"}}return b}catch(e){return a}}};
xnm.aio.symcon.Server=function(a,b,c,d,f,e,g){try{this._logger=require("x.logger.js").getLogger("xnm.aio.symcon.Server")}catch(n){this._logger={log:function(){}}}this.ip=a;this.port=b?b:82;this.user=c;this.password=d;this.webusr="webfront";this.webid=f;this.webpwd=e;this.ver=g;this._id=1;this.scripts={};this.instances={};this.variables={};this._scanning=!1;this._scanCallbacks=[];this._scanListener=[];this.CommandHandler=null};
xnm.aio.symcon.Server.prototype._doRequest=function(a,b,c){b='{"jsonrpc": "2.0", "params": '+JSON.stringify(b)+', "method": "'+a+'", "id": '+this._id++ +"}";"WFC_"==a.substr(0,4)?(this._logger.log("trace","do WFC_ request with cred:xxxxxx pwd:xxxxxx"),a=this.webpwd?"Basic "+(new Buffer(this.webusr+":"+this.webpwd)).toString("base64"):null):(this._logger.log("trace","do request with cred:xxxxxx pwd:xxxxxx"),a=this.user||this.password?"Basic "+(new Buffer(this.user+":"+this.password)).toString("base64"):
null);var d={host:this.ip,port:this.port,path:"/api/",method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8","Content-Length":b.length,"User-Agent":"mediola",Connection:"close"}};a&&(d.headers.Authorization=a);this._logger.log("trace","do request:"+JSON.stringify(xnm.aio.symcon.Util.clearHttpOptionForLog(d)));this._logger.log("trace","with data:"+b);var f=this,e=require("http").request(d,function(g){g.setEncoding("utf-8");var n="";g.on("data",function(h){n+=h});g.on("end",function(){f._logger.log("trace",
"do request reponse:"+g.statusCode);f._logger.log("trace",n);if(200==g.statusCode){var h={};try{var m=JSON.parse(n);m&&m.error?(h.error="unknown",m.error.message&&(h.error=m.error.message),m.error.code&&(h.errorCode=m.error.code)):h.data=m.result}catch(l){}c&&c(h)}else c&&c(null)})});e.setTimeout(5E3,function(){f._logger.log("trace","do request timeout");e.abort()});e.on("error",function(g){f._logger.log("error","do request error:"+g.message);f._logger.log("error",g.stack);c&&c({error:g&&g.message?
g.message:"http requeset error"})});b&&e.write(b);e.end()};
xnm.aio.symcon.Server.prototype._scanInstanceFunctions=function(a,b){var c=this;this._doRequest("IPS_GetFunctionList",[a],function(d){if(d)if(d.error)b(Error(d.error));else{var f=[];if(d.data)for(var e=d.data.length,g=0;g<d.data.length;g++){var n=d.data[g];"IPS_"==n.substr(0,4)?(e--,0==e&&b(null,f)):functions[n]?(e--,f.push(functions[n])):c._scanFunction(d.data[g],function(h,m){e--;!h&&m&&(functions[m.FunctionName]=m,f.push(m));0==e&&b(null,f)})}else b(null,f)}else b(Error("http error"))})};
xnm.aio.symcon.Server.prototype._scanFunction=function(a,b){this._doRequest("IPS_GetFunction",[a],function(c){if(c)if(c.error)b(Error(c.error));else{var d=null;c&&c.data&&(d=c.data);b(null,d)}else b(Error("http error"))})};xnm.aio.symcon.Server.prototype._scanWebfront=function(a){this._doRequest("WFC_GetConfigurators",[],function(b){if(b)if(b.error)a(Error(b.error));else{var c=[];b&&b.data&&0<b.data.length&&b.data.forEach(function(d){d.id&&c.push({id:d.id,requirepwd:d.password})});a(null,c)}else a(Error("http error"))})};
xnm.aio.symcon.Server.prototype.scanObjects=function(a,b){var c=function(h,m){if(!h||!m)return null;for(var l=0;l<h.length;l++)if(h[l]===m)return!0;return!1},d=function(h,m,l){h._scanListener.forEach(function(k){k.finish&&"function"==typeof k.finish&&k.finish(m,l)});h._scanCallbacks.forEach(function(k){k&&k(m,l)});h._scanning=!1;h._scanCallbacks=[];h._scanListener=[]},f=function(h,m,l){h._doRequest("IPS_GetVariable",[m],function(k){if(k)if(k.error)l(Error(k.error));else{var p=null;if(k&&k.data)if(p=
{},p.id=m,null!=k.data.VariableType&&"undefined"!=typeof k.data.VariableType)p.valuetype=parseInt(k.data.VariableType),p.value=k.data.VariableValue;else if(null!=k.data.VariableValue&&"undefined"!=typeof k.data.VariableValue&&(k=k.data.VariableValue,null!=k.ValueType&&"undefined"!=typeof k.ValueType))switch(p.valuetype=k.ValueType,parseInt(p.valuetype)){case 0:p.value=k.ValueBoolean;break;case 1:p.value=k.ValueInteger;break;case 2:p.value=k.ValueFloat;break;case 3:p.value=k.ValueString}l(null,p)}else l(Error("http error"))})},
e=function(h,m,l){g(h,m,{instances:{},variables:{},scripts:{}},function(k,p){if(k)l(k);else{var q;k={};var r={};for(q in p.variables)if(p.variables.hasOwnProperty(q))if(p.variables[q].parentid){var u=p.instances[p.variables[q].parentid];u?(u.variables||(u.variables=[]),u.variables.push(p.variables[q])):r[q]=p.variables[q]}else r[q]=p.variables[q];k.instances={};for(q in p.instances)p.instances.hasOwnProperty(q)&&p.instances[q]&&p.instances[q].variables&&0<p.instances[q].variables.length&&(k.instances[q]=
p.instances[q]);k.scripts=p.scripts;k.variables=r;h.instances=k.instances;h.scripts=k.scripts;h.variables=k.variables;l(null,k)}})},g=function(h,m,l,k){if(0==m.length)k(null,l);else{var p=m.pop();h._doRequest("IPS_GetObject",[p],function(q){if(q)if(q.error)g(h,m,l,k);else if(h._scanListener.forEach(function(t){if(t.one&&"function"==typeof t.one)t.one()}),q.data){var r=q.data.ObjectID;switch(q.data.ObjectType){case 1:var u=q.data.ChildrenIDs;u&&0<u.length&&!l.instances[r]&&(l.instances[r]={name:q.data.ObjectName,
type:1,objectid:r});g(h,m,l,k);break;case 2:l.variables[r]?g(h,m,l,k):(l.variables[r]={name:q.data.ObjectName,parentid:q.data.ParentID,type:2,objectid:r},f(h,r,function(t,v){t?k(t):(v&&(l.variables[r].valuetype=v.valuetype,l.variables[r].value=v.value),g(h,m,l,k))}));break;case 3:l.scripts[r]||(l.scripts[r]={name:q.data.ObjectName,parentid:q.data.ParentID,hidden:q.data.ObjectIsHidden,type:3,objectid:r});g(h,m,l,k);break;default:g(h,m,l,k)}}else g(h,m,l,k);else k(Error("http error"))})}};b&&!c(this._scanCallbacks,
b)&&this._scanCallbacks.push(b);a&&!c(this._scanListener,a)&&this._scanListener.push(a);if(!this._scanning){this.scripts={};this.instances={};var n=this;this._scanListener.forEach(function(h){h.start&&"function"==typeof h.start&&h.start()});this._doRequest("IPS_GetObjectList",[],function(h){var m;h?h.error&&(m=Error(h.error)):m=Error("http request error");m?d(n,m):h.data&&0!=h.data.length?(n._scanListener.forEach(function(l){l.total&&"function"==typeof l.total&&l.total(h.data.length)}),e(n,h.data,
function(l,k){d(n,l,k)})):d(n,m,{instance:{},scripts:{}})})}};xnm.aio.symcon.Server.prototype.getState=function(a,b,c){c&&this._doRequest(b?"GetValueFormatted":"GetValue",[a.id],function(d){d?d.error?c&&c(Error(d.error)):c&&c(null,d.data):(d=Error("http request error"),d._code=1,c&&c(d))})};xnm.aio.symcon.Server.prototype.executeCommand=function(a,b,c){var d=!1;"on"==b&&(d=!0);this._doRequest("SetValue",[a.id,d],function(f){c&&c()})};xnm.aio.symcon.Server.prototype.getStates=function(a,b,c){};
xnm.aio.symcon.Server.prototype.getStateValues=function(a,b){return sv};xnm.aio.symcon.Server.prototype._getVariableFromInstance=function(a,b){if(!b.variables)return null;for(var c=0;c<b.variables.length;c++)if(b.variables[c].objectid==a)return b.variables[c];return null};
xnm.aio.symcon.Server.prototype.executeCommandCreator=function(a,b,c){if(a&&a.objectid&&b&&b.value){var d=b.value,f=a.objectid,e=d.indexOf("#");0<e&&(f=d.substr(0,e),d=d.substr(e+1));e=a.parentid?a.parentid:0;if(1==a.type){a=this._getVariableFromInstance(f,a);if(!a){c&&c(Error("no such variable"));return}a.parentid&&(e=a.parentid)}var g;switch(parseInt(a.type)){case 2:switch(parseInt(a.valuetype)){case 0:"on"==d?g=!0:"off"==d&&(g=!1);break;case 1:"setValue"==d&&(g=parseInt(b.ext));break;case 2:"setValue"==
d&&(g=parseFloat(b.ext));break;case 3:"setValue"==d&&(g=b.ext)}break;case 3:"run"==d&&(g=0);break;default:c&&c(Error("device type not supported"));return}if(null==g||"undefined"==typeof g)c&&c(Error("command invalid"));else if(this.webid){var n=this;d="WFC_Execute";e=[parseInt(this.webid),parseInt(e),parseInt(f),g];"5.0"==this.ver&&(d="RequestAction",e=[parseInt(f),g]);this._doRequest(d,e,function(h){if(!h)var m=Error("http requeset error");else if(h.error&&(n._logger.log("trace","execute command error:"+
JSON.stringify(h)),m=Error(h.error),h.errorCode)){"run"==b.value?(h="IPS_RunScript",m=[parseInt(f)]):(h="SetValue",m=[parseInt(f),g]);n._doRequest(h,m,function(l){var k;l?l.error&&(k=Error(l.error)):k=Error("http requeset error");c&&c(k)});return}c&&c(m)})}else c&&c(Error("no web front object id"))}else c&&c(Error("argument invalid"))};
xnm.aio.symcon.Server.prototype.getStatesCreator=function(a,b,c){if(b&&0!=b.length){a=!0;for(var d={},f={},e=0;e<b.length;e++)if(b[e]&&b[e].device&&b[e].id){var g=b[e].device.objectid,n=b[e].status.value,h=b[e].status.value.indexOf("#");0<h&&(n=b[e].status.value.substr(h+1));1==b[e].device.type&&b[e].status.value&&0<h&&(g=b[e].status.value.substr(0,h));g&&(a=!1,"stateF"==n?(d[g]||(d[g]=[]),d[g].push(b[e])):(f[g]||(f[g]=[]),f[g].push(b[e])))}if(a)c&&c(null,[]);else{var m=this;this._getNextState(0,
Object.keys(f),{},function(l,k){if(l)c&&c(l);else{var p=[];if(k)for(var q in k)if(k.hasOwnProperty(q)&&(l=f[q])&&0<l.length)for(var r=0;r<l.length;r++){var u=m._resolveState(l[r].device,l[r].status,k[q]);null!=u&&"undefined"!=typeof u&&p.push({id:l[r].id,status:u})}m._getNextFormattedState(0,Object.keys(d),{},function(t,v){if(!t&&v)for(var x in v)if(v.hasOwnProperty(x)&&(t=d[x])&&0<t.length)for(var w=0;w<t.length;w++){var y=m._resolveState(t[w].device,t[w].status,v[x]);null!=y&&"undefined"!=typeof y&&
p.push({id:t[w].id,status:y})}c&&c(null,p)})}})}}else c&&c(null,[])};
xnm.aio.symcon.Server.prototype._resolveState=function(a,b,c){if(!a||!b||null==c||"undefined"==typeof c)return null;var d=!1;"stateF"==b.value&&(d=!0);var f=b.value.indexOf("#");0<f&&"stateF"==b.value.substr(f+1)&&(d=!0);if(1==a.type){var e=a.objectid;0<f&&(e=b.value.substr(0,f));a=this._getVariableFromInstance(e,a);if(!a)return null}if(d)return c;switch(parseInt(a.valuetype)){case 0:if("string"==typeof c)if("true"==c.toLowerCase())c=!0;else if("false"==c.toLowerCase())c=!1;else return null;return c?
"on":"off";case 1:return parseInt(c);case 2:return parseFloat(c).toFixed(2);case 3:return c.toString();default:return null}};xnm.aio.symcon.Server.prototype._getNextState=function(a,b,c,d){if(a==b.length)d&&d(null,c);else{var f=this,e=b[a];"string"==typeof e&&(e=parseInt(e));this.getState({id:e},!1,function(g,n){g&&1==g._code?d&&d(g):(g||null==n||"undefined"==typeof n||(c[b[a]]=n),a+=1,f._getNextState(a,b,c,d))})}};
xnm.aio.symcon.Server.prototype._getNextFormattedState=function(a,b,c,d){if(a==b.length)d&&d(null,c);else{var f=this,e=b[a];"string"==typeof e&&(e=parseInt(e));this.getState({id:e},!0,function(g,n){g&&1==g._code?d&&d(g):(g||null==n||"undefined"==typeof n||(c[b[a]]=n),a+=1,f._getNextFormattedState(a,b,c,d))})}};xnm.aio.symcon.Server.prototype.toJSON=function(){return{sys:xnm.aio.symcon.DM.SYS,ip:this.ip,port:this.port,username:this.user,password:this.password,webid:this.webid,webpwd:this.webpwd,ver:this.ver}};
xnm.aio.symcon.Server.prototype.equalsTo=function(a){return a&&a instanceof xnm.aio.symcon.Server?this.ip==a.ip&&this.port==a.port&&this.user==a.user&&this.password==a.password:!1};
xnm.aio.symcon.DM=function(){var a=function(b,c){this.code=b;this.message=c;this.stack=Error().stack};a.prototype=Error();a.prototype.name="IPSymconDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"ipsync",getGatewayType:function(){return{sys:this.SYS,name:"IP-Symcon",port:82}},createGateway:function(b,c,d){c=a.ERROR_CODE;b?b.ip?b.port?b.password?d(null,b):d(new a(c.INVALID,"password is invalid")):d(new a(c.INVALID,
"port is invalid")):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"info is invalid"))},updateGateway:function(b,c,d,f){b=a.ERROR_CODE;c?c.ip?c.port?c.password?f(null,c):f(new a(b.INVALID,"password is invalid")):f(new a(b.INVALID,"port is invalid")):f(new a(b.INVALID,"ip is invalid")):f(new a(b.INVALID,"update is invalid"))},deleteGateway:function(b,c,d){d()},createDevice:function(b,c,d){var f=a.ERROR_CODE;if(b)if(b.gateway)if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;
var e;for(e=0;e<c.length;e++)if(c[e].index===b.gateway){var g=c[e];break}g?b.type?b.objectid?d(null,b):d(new a(f.INVALID,"address is invalid")):d(new a(f.INVALID,"type is invalid")):d(new a(f.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else d(new a(f.NOT_FOUND,"gateway with index "+b.gateway+" not exists"));else d(new a(f.INVALID,"gateway is invalid"));else d(new a(f.INVALID,"info is invalid"))},updateDevice:function(b,c,d){var f=a.ERROR_CODE;if(b)if(b.gateway){c=c.data.gateways;var e;
for(e=0;e<c.length;e++)if(c[e].index===b.gateway){var g=c[e];break}g?b.type?b.objectid?d(null,b):d(new a(f.INVALID,"address is invalid")):d(new a(f.INVALID,"type is invalid")):d(new a(f.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else d(new a(f.INVALID,"gateway is invalid"));else d(new a(f.INVALID,"info is invalid"))},deleteDevice:function(b,c,d){d()},getCommandStatusMap:function(b){var c=function(e){if(null==e.valuetype||"undefined"==typeof e.valuetype)return null;switch(parseInt(e.valuetype)){case 0:var g=
{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}}],status:[{type:"enum",name:"status",ref:{value:"state",options:["off","on"]}},{type:"string",name:"formatted status",ref:{value:"stateF"}}]};break;case 1:g={command:[{type:"int",name:"set value",ref:{value:"setValue",ext:"%d"}}],status:[{type:"int",name:"status",ref:{value:"state",ext:"%d"}},{type:"string",name:"formatted status",ref:{value:"stateF"}}]};break;case 2:g={command:[{type:"float",name:"set value",
ref:{value:"setValue",ext:"%f"}}],status:[{type:"float",name:"status",ref:{value:"state",ext:"%f"}},{type:"string",name:"formatted status",ref:{value:"stateF"}}]};break;case 3:g={command:[{type:"string",name:"set value",ref:{value:"setValue",ext:"%s"}}],status:[{type:"string",name:"status",ref:{value:"state",ext:"%s"}},{type:"string",name:"formatted status",ref:{value:"stateF"}}]};break;default:return null}g&&(g.command&&g.command.forEach(function(n){n.name=e.name?e.name+" "+n.name:n.name;n.ref.value=
e.objectid+"#"+n.ref.value}),g.status&&g.status.forEach(function(n){n.name=e.name?e.name+" "+n.name:n.name;n.ref.value=e.objectid+"#"+n.ref.value}));return g};if(null==b.type||"undefined"==typeof b.type)return null;switch(parseInt(b.type)){case 1:if(b.variables){var d=[],f=[];b.variables.forEach(function(e){(e=c(e))&&e.command&&(d=d.concat(e.command));e&&e.status&&(f=f.concat(e.status))});return{command:d,status:f}}return null;case 2:return c(b);case 3:return{command:[{type:"enum",name:"run",ref:{value:"run"}}]};
default:return null}},applyUIFilter:function(b,c){var d=function(h,m){if("*"==h)return!0;for(var l=!1,k=0;k<h.length;k++)if(h[k]==m){l=!0;break}return l},f=function(h,m,l){var k=[];switch(l.catagory){case "command":h.command&&h.command.forEach(function(p){d(l.elems,p.type)&&(p=JSON.parse(JSON.stringify(p)),k.push(p))});break;case "status":h.status&&h.status.forEach(function(p){d(l.elems,p.type)&&(p=JSON.parse(JSON.stringify(p)),k.push(p))})}return k},e=function(h,m){var l=[],k=xnm.aio.symcon.DM.getCommandStatusMap(h);
k&&(h=f(k,h,m),l=l.concat(h));return l};if(!b.sys)return null;var g=JSON.parse(JSON.stringify(b)),n=null;switch(c.catagory){case "command":n=e(b,c);g.command=n;break;case "status":n=e(b,c);g.status=n;break;default:return null}return n&&0!=n.length?g:null}}}();xnm.aio.symcon.Handler=function(){};xnm.aio.symcon.Handler.prototype.Server=xnm.aio.symcon.Server;xnm.aio.symcon.Handler.prototype.getStateValues=function(a,b){return(new xnm.aio.symcon.Server).getStateValues(a.type,b)};
xnm.aio.symcon.Handler.prototype.getDeviceCommandList=function(a,b){return[]};xnm.aio.symcon.Handler.prototype.TYPE_BOOL=xnm.aio.symcon.TYPE_BOOL;xnm.aio.symcon.Handler.prototype.TYPE_INT=xnm.aio.symcon.TYPE_INT;xnm.aio.symcon.Handler.prototype.TYPE_FLOAT=xnm.aio.symcon.TYPE_FLOAT;xnm.aio.symcon.Handler.prototype.TYPE_STRING=xnm.aio.symcon.TYPE_STRING;xnm.aio.symcon.Handler.prototype.devicemanager=xnm.aio.symcon.DM;
xnm.aio.symcon.Handler.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"symcon")};xnm.aio.symcon.Handler.prototype.resolveGateway=function(a){return a&&a.ip&&a.password?new xnm.aio.symcon.Server(a.ip,a.port,a.username,a.password,a.webid,a.webpwd,a.ver):null};xnm.aio.symcon.Handler.prototype.getWebfronts=function(a,b){(a=this.resolveGateway(a))?a._scanWebfront(function(c,d){b&&b(c,d)}):b&&b(Error("gateway json invalid"))};
xnm.aio.symcon.Handler.prototype.getDeviceList=function(a,b){(a=this.resolveGateway(a))?a.scanObjects(null,function(c,d){var f={webfront:[],devices:[]},e;if(!c&&d){for(e in d.instances)d.instances.hasOwnProperty(e)&&f.devices.push(d.instances[e]);for(e in d.scripts)d.scripts.hasOwnProperty(e)&&f.devices.push(d.scripts[e]);for(e in d.variables)d.variables.hasOwnProperty(e)&&f.devices.push(d.variables[e]);f.webfront=d.webfront}b&&b(c,f)}):b&&b(Error("gateway json invalid"))};
xnm.aio.symcon.Handler.prototype.getDeviceCommands=function(a,b){a=(a=xnm.aio.symcon.DM.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};xnm.aio.symcon.Handler.prototype.getDeviceStatus=function(a,b){a=(a=xnm.aio.symcon.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};xnm.aio.symcon.Handler.prototype.doCommand=function(a,b,c,d){(a=this.resolveGateway(a))?a.executeCommandCreator(b,c,function(f){d&&d(f)}):d&&d(Error("gateway json invalid"))};
xnm.aio.symcon.Handler.prototype.doStatus=function(a,b,c,d,f){(b=this.resolveGateway(b))?b.getStatesCreator(null,[{id:a,device:c,status:d}],function(e,g){e?f&&f(e):f&&f(null,g[0])}):f&&f(Error("gateway json invalid"))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.symcon.Handler);

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(k,m,f){k instanceof String&&(k=String(k));for(var c=k.length,b=0;b<c;b++){var a=k[b];if(m.call(f,a,b,k))return{i:b,v:a}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,m,f){if(k==Array.prototype||k==Object.prototype)return k;k[m]=f.value;return k};$jscomp.getGlobal=function(k){k=["object"==typeof globalThis&&globalThis,k,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var m=0;m<k.length;++m){var f=k[m];if(f&&f.Math==Math)return f}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(k,m){var f=$jscomp.propertyToPolyfillSymbol[m];if(null==f)return k[m];f=k[f];return void 0!==f?f:k[m]};
$jscomp.polyfill=function(k,m,f,c){m&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(k,m,f,c):$jscomp.polyfillUnisolated(k,m,f,c))};$jscomp.polyfillUnisolated=function(k,m,f,c){f=$jscomp.global;k=k.split(".");for(c=0;c<k.length-1;c++){var b=k[c];if(!(b in f))return;f=f[b]}k=k[k.length-1];c=f[k];m=m(c);m!=c&&null!=m&&$jscomp.defineProperty(f,k,{configurable:!0,writable:!0,value:m})};
$jscomp.polyfillIsolated=function(k,m,f,c){var b=k.split(".");k=1===b.length;c=b[0];c=!k&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var a=0;a<b.length-1;a++){var e=b[a];if(!(e in c))return;c=c[e]}b=b[b.length-1];f=$jscomp.IS_SYMBOL_NATIVE&&"es6"===f?c[b]:null;m=m(f);null!=m&&(k?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:m}):m!==f&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&(f=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+f+"$"+b),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:m})))};$jscomp.polyfill("Array.prototype.find",function(k){return k?k:function(m,f){return $jscomp.findInternal(this,m,f).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.fritz=xnm.aio.fritz||{};
xnm.aio.fritz.SessionCache={_cache:{},STATE_TO:5E3,setSessionID:function(k,m){if(k){var f=this._cache[k];f||(this._cache[k]={},f=this._cache[k]);f.sessionID=m}},getSessionID:function(k){return k?this._cache[k]?this._cache[k].sessionID:null:null}};
xnm.aio.fritz.Box=function(){function k(c,b){var a=360,e=-1,d=null,g;for(g in m){var l=m[g];var h=Math.abs(c-l.hue);h<a&&(a=h,e=l.hue,d=g)}l=m[d];return[e,b>l.sat[0]?l.sat[0]:b>l.sat[1]?l.sat[1]:b>l.sat[2]?l.sat[2]:0]}var m={red:{hue:358,sat:[180,112,54],val:[255,255,255]},orange:{hue:35,sat:[214,140,72],val:[252,252,255]},yellow:{hue:52,sat:[153,102,51],val:[255,255,255]},lime:{hue:92,sat:[123,79,38],val:[248,250,252]},green:{hue:120,sat:[160,82,38],val:[220,232,242]},turquoise:{hue:160,sat:[145,
84,41],val:[235,242,248]},cyan:{hue:195,sat:[179,118,59],val:[255,255,255]},lightblue:{hue:212,sat:[169,110,56],val:[252,252,255]},blue:{hue:225,sat:[204,135,67],val:[255,255,255]},purple:{hue:266,sat:[169,110,54],val:[250,250,252]},magenta:{hue:296,sat:[140,92,46],val:[250,252,255]},pink:{hue:335,sat:[180,107,51],val:[255,248,250]}},f=function(c,b,a,e){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.fritz.Box");this.ip=c;this.port=
e;this.protocol="http";c&&"http://"==c.substr(0,7)?this.ip=c.substr(7):c&&"https://"==c.substr(0,8)&&(this.ip=c.substr(8),this.protocol="https");this.port||(this.port="https"==this.protocol?443:80);this.password=b;this.user="";a&&(this.user=a);this.CommandHandler=null};f.prototype._doRequest=function(c,b){var a=this;this._cachedSessionID()&&(c+="&sid="+this._cachedSessionID());var e=b;b={host:this.ip,port:this.port,path:c,method:"GET"};this._logger.log("trace","send ("+this.protocol+") req to:"+JSON.stringify(b));
var d="";c=require("http");"https"==this.protocol&&(c=require("https"),"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"),b.port||(b.port=443));var g=c.request(b,function(l){l.on("data",function(h){d+=h});l.on("end",function(){var h=null;200==l.statusCode?a._logger.log("trace","http request success:"+d):(a._logger.log("trace","http request error:"+l.statusCode+"-"+d),h=Error("request failed with status code:"+l.statusCode));e&&e(h,d,l.statusCode);
e=null})});g.setTimeout&&g.setTimeout(6E4,function(){g.abort()});if(g.on&&"function"==typeof g.on)g.on("error",function(l){l||(l=Error("http request error"));a._logger.log("trace","http request error:"+l.message);e&&e(l);e=null});g.end()};f.prototype._sendRequest=function(c,b){var a=this;this._doRequest(c,function(e,d,g){e&&403==g?(a._setSessionID(null),a._getSessionID(function(l,h){l?(a._logger.log("trace","create new session error:"+l.message),b&&b(l)):(a._setSessionID(h),a._sendRequest(c,b))})):
b&&b(e,d)})};f.prototype._setSessionID=function(c){return xnm.aio.fritz.SessionCache.setSessionID(this.ip,c)};f.prototype._cachedSessionID=function(){return xnm.aio.fritz.SessionCache.getSessionID(this.ip)};f.prototype._getSessionID=function(c){var b=this;this._logger.log("trace","create new session");this._doRequest("/login_sid.lua",function(a,e){if(a)c&&c(a);else try{var d=$($.parseXML(e));if(d){var g=null;a=null;var l=d.find("SID");l&&(g=$(l[0]).text());(l=d.find("Challenge"))&&(a=$(l[0]).text());
if("0000000000000000"!=g)c&&c(null,g);else if(a){g=null;var h=require("x.crypt.js"),n=a+"-"+h.MD5(a+"-"+b.password,!0);b._doRequest("/login_sid.lua?username="+b.user+"&response="+n,function(p,q){if(p)c&&c(p);else try{var r=$($.parseXML(q));if(r){var t=r.find("SID");t&&(g=$(t[0]).text());"0000000000000000"==g&&(g=null)}g||(p=Error("session challenge fail"));c&&c(p,g)}catch(u){c&&c(u)}})}}}catch(p){c&&c(p)}})};f.prototype._getDeviceInfos=function(c){var b=this;b._sendRequest("/webservices/homeautoswitch.lua?switchcmd=getdevicelistinfos",
function(a,e){a?c&&c(a):(a=[],e&&(e=$($.parseXML(e)),a=b._resolveDevices(e)),c&&c(null,a))})};f.prototype._resolveDevices=function(c){var b=this,a=[];c.find("device").each(function(){var e=$(this);(e=b._resolveDevice(e))&&a.push(e)});c.find("group").each(function(){var e=$(this);(e=b._resolveGroup(e))&&a.push(e)});return a};f.prototype._resolveDevice=function(c){var b=c.attr("identifier");if(!b)return null;var a=c.find("name"),e="";a&&a[0]&&(e=$(a[0]).text());b=b.replace(" ","");a=c.attr("productname");
var d=c.attr("functionbitmask");d=parseInt(d);var g=null;if(d&1){if(!(d&8192))return null;var l=c.find("etsiunitinfo");if(l&&l[0]){g={};var h=$(l[0]).find("unittype");g.unittype=h&&h[0]?$(h[0]).text():null;l=$(l[0]).find("interfaces");g.interfaces=l&&l[0]?$(l[0]).text().split(","):null}}switch(a){case "Comet DECT":l="thermo";break;case "FRITZ!DECT 500":l="colorlight";break;default:l="switch"}d&262144&&(l="blind");b={sys:"fritz",name:e,type:"fritz_dect",typeName:a,bitmask:parseInt(d),address:b,data:l,
etsiunitinfo:g};b.states=this._resolveStates(b,c);return b};f.prototype._resolveGroup=function(c){var b=c.attr("identifier");if(!b)return null;var a=c.find("name"),e="";a&&a[0]&&(e=$(a[0]).text());b=b.replace(" ","");(a=c.attr("productname"))||(a="Group");var d=c.attr("functionbitmask");b={sys:"fritz",name:e,type:"fritz_dect",typeName:a,bitmask:parseInt(d),address:b,data:"group"};b.states=this._resolveStates(b,c);return b};f.prototype._resolveStates=function(c,b){var a={},e=!1,d,g=b.find("present");
if(g&&g[0])switch(e=!0,g=$(g[0]).text(),g){case "1":a.connected="true";break;case "0":a.connected="false";break;default:a.connected="?"}if((g=b.find("switch"))&&g[0]){e=!0;if((d=$(g[0]).find("state"))&&d[0])switch(d=$(d[0]).text(),d){case "1":a.state="on";break;case "0":a.state="off";break;default:a.state="?"}if((d=$(g[0]).find("mode"))&&d[0])switch(d=$(d[0]).text(),d){case "auto":a.switchMode="auto";break;case "manuell":a.switchMode="manu";break;default:a.switchMode="?"}}(g=b.find("powermeter"))&&
g[0]&&(e=!0,(d=$(g[0]).find("power"))&&d[0]&&(d=$(d[0]).text(),a.current=d?(parseInt(d)/1E3).toFixed(2):"?"),(d=$(g[0]).find("energy"))&&d[0]&&(d=$(d[0]).text(),a.energy=d?parseInt(d):"?"));(g=b.find("temperature"))&&g[0]&&(e=!0,(d=$(g[0]).find("celsius"))&&d[0]&&(d=$(d[0]).text(),a.tempC=d?(parseInt(d)/10).toFixed(1):"?"));(g=b.find("hkr"))&&g[0]&&(e=!0,(d=$(g[0]).find("tsoll"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.temp=254==d?28.5:253==d?7.5:(d/2).toFixed(1)):a.temp="?"),(d=$(g[0]).find("komfort"))&&
d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.comfort=254==d?28.5:253==d?7.5:(d/2).toFixed(1)):a.comfort="?"),(d=$(g[0]).find("absenk"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.absenk=254==d?28.5:253==d?7.5:(d/2).toFixed(1)):a.absenk="?"),(d=$(g[0]).find("batterylow"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.batlow=1==d?!0:!1):a.batlow="?"),(d=$(g[0]).find("battery"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.battery=d):a.battery="?"));if((g=b.find("simpleonoff"))&&g[0]&&(e=!0,(d=$(g[0]).find("state"))&&
d[0]))switch(d=$(d[0]).text(),d){case "1":a.state="on";break;case "0":a.state="off";break;default:a.state="?"}(g=b.find("levelcontrol"))&&g[0]&&(e=!0,(d=$(g[0]).find("levelpercentage"))&&d[0]&&(d=$(d[0]).text(),d=parseInt(d),"colorlight"==c.data?a.brightness=d:a.level="blind"===c.data?100-d:d));if((g=b.find("colorcontrol"))&&g[0])if(e=!0,c=d=$(g[0]).attr("current_mode"),a.colormode=1==c?"color":4==c?"color_temperature":"unknonw",1==c?a.colortemperature=null:(d=$(g[0]).find("temperature"))&&d[0]&&
(d=$(d[0]).text(),a.colortemperature=parseInt(d)),4==c)a.rgb="";else{if((d=$(g[0]).find("hue"))&&d[0]){d=$(d[0]).text();var l=parseInt(d);l/=360}if((d=$(g[0]).find("saturation"))&&d[0]){d=$(d[0]).text();var h=parseInt(d);h/=255}d=this._HSVToRGB(l,h,a.brightness/100);g=("0"+parseInt(d[0]).toString(16)).slice(-2);g+=("0"+parseInt(d[1]).toString(16)).slice(-2);g+=("0"+parseInt(d[2]).toString(16)).slice(-2);a.rgb=g}e&&"off"==a.state&&"undefined"!=typeof a.brightness&&null!=a.brightness&&(a.brightness=
0);return e?a:null};f.prototype.getDevices=function(c){this._getDeviceInfos(function(b,a){var e=[];if(!b&&a)for(b=0;b<a.length;b++){var d=a[b];delete d.states;e.push(d)}c&&c(e)})};f.prototype.getStates=function(c){this._getDeviceInfos(function(b,a){var e={};if(a)for(var d=0;d<a.length;d++){var g=a[d];g.address&&g.states&&(e[g.address]=g.states)}c&&c(b,e)})};f.prototype.executeCommand=function(c,b,a){var e=b;b.value&&(e=b.value);var d=this;switch(e){case "on":var g="colorlight"==c.type?"setsimpleonoff&onoff=1":
c.bitmask&&parseInt(c.bitmask)&32768?"setsimpleonoff&onoff=1":"setswitchon";break;case "off":g="colorlight"==c.type?"setsimpleonoff&onoff=0":c.bitmask&&parseInt(c.bitmask)&32768?"setsimpleonoff&onoff=0":"setswitchoff";break;case "toggle":g="colorlight"==c.type?"setsimpleonoff&onoff=2":"setswitchtoggle";break;case "up":"blind"===c.data?d.executeCommand(c,{value:"setblind",ext:"open"},a):this.getStates(function(h,n){h?a&&a(h):n&&n[c.address]?(h=n[c.address].brightness,"undefined"==typeof h||null==h||
isNaN(parseInt(h))?a&&a(Error("invalid brightness state")):(h=parseInt(h),h+=5,100<h&&(h=100),d.executeCommand(c,{value:"brightness",ext:h},a))):a&&a(Error("get device states failed"))});return;case "down":"blind"===c.data?d.executeCommand(c,{value:"setblind",ext:"close"},a):this.getStates(function(h,n){h?a&&a(h):n&&n[c.address]?(h=n[c.address].brightness,"undefined"==typeof h||null==h||isNaN(parseInt(h))?a&&a(Error("invalid brightness state")):(h=parseInt(h),h-=5,0>h&&(h=0),d.executeCommand(c,{value:"brightness",
ext:h},a))):a&&a(Error("get device states failed"))});return;case "brightness":"undefined"!=typeof b.ext&&null!=b.ext?(e=parseInt(b.ext),isNaN(e)||(0>e&&(e=0),100<e&&(e=100)),0!=e?(g="setlevelpercentage&level="+e,this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(h){h?a&&a(h):d.executeCommand(c,{value:"on"},a)})):this.executeCommand(c,{value:"off"},a)):a&&a(Error("invalid command "+b));return;case "set_level":"undefined"!=typeof b.ext&&null!=b.ext?(e=parseInt(b.ext),
isNaN(e)||(0>e&&(e=0),100<e&&(e=100)),"blind"===c.data&&(e=100-e),g="setlevelpercentage&level="+e,this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(h){a&&a(h)})):a&&a(Error("invalid command "+b));return;case "stop":"blind"===c.data&&d.executeCommand(c,{value:"setblind",ext:"stop"},a);return;case "setblind":"undefined"!=typeof b.ext&&null!=b.ext?(g="setblind&target="+b.ext,this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(h){a&&
a(h)})):a&&a(Error("invalid command "+b));return;case "rgb":if("undefined"!=typeof b.ext&&null!=b.ext&&6==b.ext.length){e=parseInt(b.ext.substr(0,2),16);var l=parseInt(b.ext.substr(2,2),16);b=parseInt(b.ext.substr(4,2),16);b=this._RGBToHSV(e,l,b);b=k(Math.round(b[0]),Math.round(255*b[1]));g=0==b[1]?"setcolortemperature&temperature=4200&duration=0":"setcolor&hue="+b[0]+"&saturation="+b[1]+"&duration=0";this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(h){h?
a&&a(h):d.executeCommand(c,{value:"on"},a)})}else a&&a(Error("invalid command "+b));return;case "colortemperature":"undefined"!=typeof b.ext&&null!=b.ext&&(e=parseInt(b.ext),isNaN(e)||(2700>e&&(e=2700),6500<e&&(e=6500)),g="setcolortemperature&temperature="+(6200<e?6500:5600<e?5900:5E3<e?5300:4500<e?4700:4E3<e?4200:3600<e?3800:3200<e?3400:2850<e?3E3:2700)+"&duration=0");break;case "thermoOn":g="sethkrtsoll&param=254";break;case "thermoOff":g="sethkrtsoll&param=253";break;case "tempUp":this.getStates(function(h,
n){h?a&&a(h):n&&n[c.address]?(h=n[c.address].temp,!h||isNaN(parseFloat(h))?a&&a(Error("invalid setpoint state")):(h=parseFloat(h),h+=.5,28.5<h&&(h=28.5),g="sethkrtsoll&param="+2*h,d._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(p){a&&setTimeout(function(){a(p)},250)}))):a&&a(Error("get device states failed"))});return;case "tempDown":this.getStates(function(h,n){h?a&&a(h):n&&n[c.address]?(h=n[c.address].temp,!h||isNaN(parseFloat(h))?a&&a(Error("invalid setpoint state")):
(h=parseFloat(h),h-=.5,7.5>h&&(h=7.5),g="sethkrtsoll&param="+2*h,d._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(p){a&&setTimeout(function(){a(p)},250)}))):a&&a(Error("get device states failed"))});return;default:0==b.indexOf("temp")&&(g=b.replace("temp",""),g=parseFloat(g),g=7.5>=g||253==g?"sethkrtsoll&param=253":28.5<=g||254==g?"sethkrtsoll&param=254":"sethkrtsoll&param="+2*g)}g?this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+
g,function(h){a&&setTimeout(function(){a(h)},250)}):a&&a(Error("no such command "+b))};f.prototype.executeCommandCreator=function(c,b,a){if(c&&c.address&&b&&b.value){var e=b.value;if("temp"==b.value){if(!b.ext){a&&a(Error("parameter ext invalid"));return}e+=b.ext}else if("brightness"==b.value||"set_level"==b.value||"colortemperature"==b.value||"rgb"==b.value)e=b;this.executeCommand(c,e,function(){a&&a()})}else a&&a(Error("parameter invalid"))};f.prototype.getStatesCreator=function(c,b,a){b?0==b.length?
a&&a(null,[]):this.getStates(function(e,d){if(e)a&&a(e);else{e=[];for(var g=0;g<b.length;g++)if(b[g]&&b[g].id){var l="?";b[g].device&&b[g].device.address&&b[g].status&&b[g].status.value&&d&&d[b[g].device.address]&&(l=d[b[g].device.address][b[g].status.value],"undefined"==typeof l||null==l)&&(l="?");e.push({id:b[g].id,status:l})}a&&a(null,e)}}):a&&a(Error("deviceList is null"))};f.prototype._RGBToHSV=function(c,b,a){c/=255;b/=255;a/=255;var e=Math.min(c,Math.min(b,a)),d=Math.max(c,Math.max(b,a));return e==
d?[0,0,e]:[60*((c==e?3:a==e?1:5)-(c==e?b-a:a==e?c-b:a-c)/(d-e)),(d-e)/d,d]};f.prototype._HSVToRGB=function(c,b,a){var e=Math.floor(6*c),d=6*c-e;c=a*(1-b);var g=a*(1-d*b);b=a*(1-(1-d)*b);switch(e%6){case 0:var l=a;var h=b;var n=c;break;case 1:l=g;h=a;n=c;break;case 2:l=c;h=a;n=b;break;case 3:l=c;h=g;n=a;break;case 4:l=b;h=c;n=a;break;case 5:l=a,h=c,n=g}return[Math.round(255*l),Math.round(255*h),Math.round(255*n)]};f.prototype.toJSON=function(){return{sys:"fritz",ip:this.ip,port:this.port,username:this.user,
password:this.password}};f.prototype.equalsTo=function(c){return c&&c instanceof xnm.aio.fritz.Box?this.protocol==c.protocol&&this.ip==c.ip&&this.port==c.port&&this.user==c.user&&this.password==c.password:!1};return f}();
xnm.aio.fritz.DM=function(){var k=function(f,c){this.code=f;this.message=c;this.stack=Error().stack};k.prototype=Error();k.prototype.name="FritzDMError";k.prototype.code=0;k.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var m={fritz_dect:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},
{type:"float",name:"current power",ref:{value:"current",value_t:"currentPower"}}]},hkr:{command:[{type:"float",name:"set temperature",ref:{value:"temp",value_t:"themoTemp",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"enum",name:"temperature up",ref:{value:"tempUp"}},{type:"enum",name:"temperature down",ref:{value:"tempDown"}},{type:"enum",name:"thermostat on",ref:{value:"thermoOn"}},{type:"enum",name:"thermostat off",ref:{value:"thermoOff"}}],status:[{type:"float",name:"set temperature",ref:{value:"temp",
ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"float",name:"comfort temperature",ref:{value:"comfort",value_t:"tempComfort",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"float",name:"spar temperature",ref:{value:"absenk",value_t:"tempAbsenk",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"enum",name:"battery low",ref:{value:"batlow",options:["true","false"]}}]},temp:{status:[{type:"float",name:"current temperature",ref:{value:"tempC",scale:"0.1"}}]},powermeter:{status:[{type:"float",name:"energy",
ref:{value:"energy"}},{type:"float",name:"current power",ref:{value:"current",value_t:"currentPower"}}]},"switch":{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"switch mode",ref:{value:"switchMode",options:["auto","manu"]}}]},error:{status:[{type:"enum",name:"connected",ref:{value:"connected",options:["true",
"false"]}}]},simpleswitch:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}]},brightness:{command:[{type:"enum",name:"brightness up",ref:{value:"up"}},{type:"enum",name:"brightness down",ref:{value:"down"}},{type:"int",name:"brightness",ref:{value:"brightness",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"brightness",ref:{value:"brightness",
extMeta:"0-100"}}]},blind:{command:[{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"int",name:"position",ref:{value:"set_level",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"position",ref:{value:"level",extMeta:"0-100"}}]},colortemperature:{command:[{type:"int",name:"color temperature",ref:{value:"colortemperature",value_t:"setColorTemp",ext:"%d",extMeta:"2700-6500",scale:"100"}}],status:[{type:"int",
name:"color temperature",ref:{value:"colortemperature",value_t:"colortemp",extMeta:"2700-6500"}}]},color:{command:[{type:"rgb",name:"rgb color",ref:{value:"rgb",ext:"%s"}}],status:[{type:"string",name:"rgb color",ref:{value:"rgb",ext:"%s"}}]},colormode:{status:[{type:"enum",name:"color mode",ref:{value:"colormode",value_t:"colorMode",options:["color","color_temperature","unknown"]}}]}};return{SYS:"fritz",getGatewayType:function(){return[{sys:this.SYS,name:"FRITZ!Box",port:80}]},getGatewayDeviceType:function(){return[{sys:this.SYS,
type:"fritz_dect",name:"FRITZ! Smart Home"}]},createGateway:function(f,c,b){c=k.ERROR_CODE;f?f.ip?b(null,f):b(new k(c.INVALID,"ip is invalid")):b(new k(c.INVALID,"info is invalid"))},updateGateway:function(f,c,b,a){f=k.ERROR_CODE;c?c.ip?a(null,c):a(new k(f.INVALID,"ip is invalid")):a(new k(f.INVALID,"update is invalid"))},deleteGateway:function(f,c,b){b()},createDevice:function(f,c,b){var a=k.ERROR_CODE;if(f)if(f.gateway)if(null==f.address||"undefined"==typeof f.address)b(new k(a.INVALID,"address is invalid"));
else if(null==f.type||"undefined"==typeof f.type)b(new k(a.INVALID,"type is invalid"));else if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var e;for(e=0;e<c.length;e++)if(c[e].index===f.gateway){var d=c[e];break}d?b(null,f):b(new k(a.NOT_FOUND,"gateway with index "+f.gateway+" not exists"))}else b(new k(a.NOT_FOUND,"gateway with index "+f.gateway+" not exists"));else b(new k(a.INVALID,"gateway is invalid"));else b(new k(a.INVALID,"info is invalid"))},updateDevice:function(f,
c,b){var a=k.ERROR_CODE;if(f)if(f.gateway)if(null==f.address||"undefined"==typeof f.address)b(new k(a.INVALID,"address is invalid"));else if(null==f.type||"undefined"==typeof f.type)b(new k(a.INVALID,"type is invalid"));else if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var e;for(e=0;e<c.length;e++)if(c[e].index===f.gateway){var d=c[e];break}d?b(null,f):b(new k(a.NOT_FOUND,"gateway with index "+f.gateway+" not exists"))}else b(new k(a.NOT_FOUND,"gateway with index "+f.gateway+
" not exists"));else b(new k(a.INVALID,"gateway is invalid"));else b(new k(a.INVALID,"info is invalid"))},deleteDevice:function(f,c,b){b()},applyUIFilter:function(f,c){var b=this,a=function(l,h,n){var p=[];l.forEach(function(q){if("root"==q.type){q=JSON.parse(JSON.stringify(q));var r=a(q.children,h,n);r&&0<r.length&&(q.children=r,p.push(q))}else{r=n.elems;if("*"==r)r=!0;else{for(var t=!1,u=0;u<r.length;u++)if(r[u]==q.type){t=!0;break}r=t}r&&(q=JSON.parse(JSON.stringify(q)),p.push(q))}});return p},
e=function(l,h){var n=[],p=b.getCommandStatusMap(l);if(p){var q=[];switch(h.catagory){case "command":p.command&&(q=a(p.command,l,h));break;case "status":p.status&&(q=a(p.status,l,h))}n=n.concat(q)}return n};if(!f.sys)return null;var d=JSON.parse(JSON.stringify(f)),g=null;switch(c.catagory){case "command":g=e(f,c);d.command=g;break;case "status":g=e(f,c);d.status=g;break;default:return null}return g&&0!=g.length?d:null},getCommandStatusMap:function(f){if(!f||!f.type)return null;var c=parseInt(f.bitmask),
b=[];c?(c&64&&b.push("hkr"),c&128&&b.push("powermeter"),c&256&&b.push("temp"),c&512&&b.push("switch"),c&32768&&b.push("simpleswitch"),c&65536&&("blind"===f.data?b.push("blind"):b.push("brightness")),c&131072&&(b.push("colortemperature"),b.push("color"),b.push("colormode"))):"colorlight"==f.type?b=["simpleswitch","brightness","colortemperature","color","colormode"]:b.push(f.type);if(0==b.length)return null;var a={command:[],status:[]};b.forEach(function(e){m[e]&&(m[e].command&&(a.command=a.command.concat(m[e].command)),
m[e].status&&(a.status=a.status.concat(m[e].status)))});if(0<a.command.length||0<a.status.length)a.status=a.status.concat(m.error.status);return a},toGeneralDevice:function(f,c){var b=c=!1,a=!1,e=!1,d=!1,g=!1,l=parseInt(f.bitmask);l?(l&64&&(d=!0),l&128&&(b=!0),l&256&&(e=!0),l&512&&(c=!0),l&32768&&(c=!0),l&131072&&(a=!0),l&262144&&(g=!0)):"switch"==f.data?c=!0:"thermo"==f.data?d=!0:"colorlight"==f.data&&(a=!0);f=null;a?f={type:"dimmer",commands:{on:{},off:{},toggle:{},up:{},down:{},brightness:{value:{type:"INT",
min:0,max:100,step:1}},colorTemperature:{value:{type:"INT",min:2700,max:6500,step:100}},color:{type:"RGB"}},states:{state:{values:["on","off"]},brightness:{min:0,max:100,unit:"%"},colorTemperature:{min:2700,max:6500}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"},up:{value:"up"},down:{value:"down"},brightness:{value:"brightness",ext:"%d"},colorTemperature:{value:"colortemperature",ext:"%d",extMeta:"2700-6500",scale:"100"},color:{value:"rgb",ext:"%s"}},states:{state:{value:"state"},
brightness:{value:"brightness"},colorTemperature:{value:"colortemperature"}}}}:d?f={type:"heater",commands:{up:{},down:{},tempTo:{value:{type:"FLOAT",min:7.5,max:28.5,step:.5}}},states:{setpoint:{type:"FLOAT",min:6,max:30,step:.5,unit:"\u00b0C"},temperature:{type:"FLOAT"}},details:{commands:{up:{value:"tempUp"},down:{value:"tempDown"},tempTo:{value:"temp",ext:"%f"}},states:{setpoint:{value:"temp"},temperature:{value:"tempC"}}}}:c?(f={type:"switch",commands:{on:{},off:{},toggle:{}},states:{state:{values:["on",
"off"]}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"}}}},b&&(f.states.power={type:"FLOAT"},f.states.consumption={type:"FLOAT"},f.details.states.power={value:"current"},f.details.states.consumption={value:"energy"})):e?f={type:"temperature",states:{temperature:{type:"FLOAT"}},details:{states:{temperature:{value:"tempC"}}}}:g&&(f={type:"blind",commands:{up:{},down:{},stop:{},position:{value:{type:"INT",min:0,max:100}}},states:{position:{min:0,
max:100,unit:"%"}},details:{commands:{up:{value:"up"},down:{value:"down"},stop:{value:"stop"},position:{value:"set_level",ext:"%d",extMeta:"0-100"}},states:{position:{value:"level"}}}});return f}}}();
xnm.aio.fritz.Handler=function(){var k=function(){};k.prototype.Box=xnm.aio.fritz.Box;k.prototype.devicemanager=xnm.aio.fritz.DM;k.prototype.registModule=function(m){m.register(this.devicemanager.SYS,"fritz")};k.prototype.resolveGateway=function(m){return m&&m.ip?new xnm.aio.fritz.Box(m.ip,m.password,m.username,m.port):null};k.prototype.getDeviceCommands=function(m,f){m=(m=xnm.aio.fritz.DM.applyUIFilter(m,{catagory:"command",elems:"*"}))?m.command:[];f&&f(null,m)};k.prototype.getDeviceStatus=function(m,
f){m=(m=xnm.aio.fritz.DM.applyUIFilter(m,{catagory:"status",elems:"*"}))?m.status:[];f&&f(null,m)};k.prototype.doCommand=function(m,f,c,b){(m=this.resolveGateway(m))?m.executeCommandCreator(f,c,function(a){b&&b(a)}):b&&b(Error("gateway json format invalid"))};k.prototype.doStatus=function(m,f,c,b,a){(f=this.resolveGateway(f))?f.getStatesCreator(null,[{id:m,device:c,status:b}],function(e,d){e?a&&a(e):a&&a(null,d[0])}):a&&a(Error("gateway json format invalid"))};k.prototype.getDeviceList=function(m,
f){(m=this.resolveGateway(m))?m.getDevices(function(c){f&&f(null,c)}):f&&f(Error("gateway json format invalid"))};return k}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.fritz.Handler);

var x=x||{};x.aws=x.aws||{};
x.aws.S3Client=function(){var e=function(a){this._options=a;this._clientInitErr=this._clientID=null;this._init()};e.prototype._init=function(a){var c=this;XC.callHost("aws","buildS3Client",{accessKey:this._options.accessKeyId,secretKey:this._options.secretAccessKey,sessionKey:this._options.sessionToken},function(b){b.error?c._clientInitErr=b.error:b.clientID&&(c._clientID=b.clientID)})};e.prototype.getObject2File=function(a,c,b){this._clientID?XC.callHost("aws","getS3Object2File",{clientID:this._clientID,
bucket:a.Bucket,key:a.Key,filePath:c},function(f){var g=null;f&&f.error&&(g=Error(f.error));b&&b(g,f?f.file:null)}):((a=this._clientInitErr)||(a=Error("native s3 client not properly initialized")),b&&b(a))};e.prototype.release=function(a){if(this._clientID){var c=this;XC.callHost("aws","releaseS3Client",{clientID:this._clientID},function(b){c._clientID=null;a&&a(b?b.error:null)})}else a&&a()};var d=function(a){this._options=a;this._nativeS3Client=this._s3Client=null;window.XCHost&&window.XCHost.getType&&
("iOS"==window.XCHost.getType()||"Android"==window.XCHost.getType())?this._nativeS3Client=new e(a):this._s3Client=new (require("aws-sdk").S3)({apiVersion:"2006-03-01",region:"eu-central-1",accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken})};d.prototype.getObject2File=function(a,c,b){if(a&&a.Bucket&&a.Key){var f=require("fs");this._s3Client?c?this._s3Client.getObject(a,function(g,h){g?b&&b(g):f.writeFile(c,h.Body,function(k){b&&b(k,c)})}):b&&b(Error("dstFile invalid")):
this._nativeS3Client?this._nativeS3Client.getObject2File(a,c,function(g,h){b&&b(g,h)}):b&&b(Error("aws s3 client not properly initialized"))}else b&&b(Error("params invalid"))};d.prototype.release=function(){this._s3Client&&(this._s3Client=null);if(this._nativeS3Client){var a=this;this._nativeS3Client.release(function(){a._nativeS3Client=null})}};return d}();
x.aws.Handler=function(){var e=function(){};e.prototype.getS3Client=function(d){if(!d||!d.accessKeyId||!d.secretAccessKey)throw Error("options invalid");return new x.aws.S3Client(d)};return e}();"undefined"!=typeof module&&null!=module&&(module.exports=new x.aws.Handler);

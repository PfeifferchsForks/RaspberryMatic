var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(f){return f.raw=f};$jscomp.createTemplateTagFirstArgWithRaw=function(f,a){f.raw=a;return f};$jscomp.arrayIteratorImpl=function(f){var a=0;return function(){return a<f.length?{done:!1,value:f[a++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.makeIterator=function(f){var a="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return a?a.call(f):$jscomp.arrayIterator(f)};
$jscomp.arrayFromIterator=function(f){for(var a,c=[];!(a=f.next()).done;)c.push(a.value);return c};$jscomp.arrayFromIterable=function(f){return f instanceof Array?f:$jscomp.arrayFromIterator($jscomp.makeIterator(f))};$jscomp.owns=function(f,a){return Object.prototype.hasOwnProperty.call(f,a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,a,c){if(f==Array.prototype||f==Object.prototype)return f;f[a]=c.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<f.length;++a){var c=f[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,a){var c=$jscomp.propertyToPolyfillSymbol[a];if(null==c)return f[a];c=f[c];return void 0!==c?c:f[a]};$jscomp.polyfill=function(f,a,c,g){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,a,c,g):$jscomp.polyfillUnisolated(f,a,c,g))};
$jscomp.polyfillUnisolated=function(f,a,c,g){c=$jscomp.global;f=f.split(".");for(g=0;g<f.length-1;g++){var b=f[g];if(!(b in c))return;c=c[b]}f=f[f.length-1];g=c[f];a=a(g);a!=g&&null!=a&&$jscomp.defineProperty(c,f,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(f,a,c,g){var b=f.split(".");f=1===b.length;g=b[0];g=!f&&g in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<b.length-1;e++){var k=b[e];if(!(k in g))return;g=g[k]}b=b[b.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?g[b]:null;a=a(c);null!=a&&(f?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:a}):a!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+c+"$"+b),$jscomp.defineProperty(g,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:a})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(f,a){for(var c=1;c<arguments.length;c++){var g=arguments[c];if(g)for(var b in g)$jscomp.owns(g,b)&&(f[b]=g[b])}return f};$jscomp.polyfill("Object.assign",function(f){return f||$jscomp.assign},"es6","es3");
$jscomp.atMethod=function(f){f=Math.trunc(f)||0;0>f&&(f+=this.length);if(!(0>f||f>=this.length))return this[f]};$jscomp.polyfill("Array.prototype.at",function(f){return f?f:$jscomp.atMethod},"es_next","es5");$jscomp.typedArrayAt=function(f){return f?f:$jscomp.atMethod};$jscomp.polyfill("Int8Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("Uint8Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("Int16Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("Uint16Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("Int32Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("Uint32Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("Float32Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");
$jscomp.polyfill("Float64Array.prototype.at",$jscomp.typedArrayAt,"es_next","es5");$jscomp.polyfill("String.prototype.at",function(f){return f?f:$jscomp.atMethod},"es_next","es5");$jscomp.checkStringArgs=function(f,a,c){if(null==f)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return f+""};
$jscomp.polyfill("String.prototype.startsWith",function(f){return f?f:function(a,c){var g=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var b=g.length,e=a.length;c=Math.max(0,Math.min(c|0,g.length));for(var k=0;k<e&&c<b;)if(g[c++]!=a[k++])return!1;return k>=e}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(f){if(f)return f;var a=function(e,k){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:k})};a.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",g=0,b=function(e){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new a(c+(e||"")+"_"+g++,e)};return b},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(f){if(f)return f;f=Symbol("Symbol.iterator");for(var a="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<a.length;c++){var g=$jscomp.global[a[c]];"function"===typeof g&&"function"!=typeof g.prototype[f]&&$jscomp.defineProperty(g.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return f},"es6",
"es3");$jscomp.iteratorPrototype=function(f){f={next:f};f[Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,a){f instanceof String&&(f+="");var c=0,g=!1,b={next:function(){if(!g&&c<f.length){var e=c++;return{value:a(e,f[e]),done:!1}}g=!0;return{done:!0,value:void 0}}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");$jscomp.polyfill("Object.is",function(f){return f?f:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(f){return f?f:function(a,c){var g=this;g instanceof String&&(g=String(g));var b=g.length;c=c||0;for(0>c&&(c=Math.max(c+b,0));c<b;c++){var e=g[c];if(e===a||Object.is(e,a))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(f){return f?f:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};
xnm.aio.cloudservice=xnm.aio.cloudservice||{};
xnm.aio.cloudservice.Ivideon=function(){var f=function(a,c,g,b){this._connectionID=a;this._camID=c;this._cloudService=g;this._format=b;this._jpegCam=null};f.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};f.prototype.getLivePreview=function(a){var c=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("ivideon","GET",c,null,null,function(g,b){a&&a(g,b)})};f.prototype.getLiveStream=function(a,c){var g=this.getBaseURL()+"/live_stream";a||(a={});a.format||
(a.format="hls");"string"!==typeof a.q&&"number"!==typeof a.q&&(a.q=1);this._cloudService.doEAPIRequest("ivideon","GET",g,a,null,function(b,e){c&&c(b,e)})};f.prototype.getArchiveStream=function(a,c){var g=this.getBaseURL()+"/record_stream";a||(a={});a.format||(a.format="hls");"string"!==typeof a.q&&"number"!==typeof a.q&&(a.q=1);this._cloudService.doEAPIRequest("ivideon","GET",g,a,null,function(b,e){if(b)c(b,e);else{var k=null;e&&"object"===typeof e&&(k=e.url);if("string"!==typeof k||0===k.length)b=
Error("Result did not contain an URL or it was an empty string: "+k);c(b,k)}})};f.prototype.getEvents=function(a,c){var g=this.getBaseURL()+"/events";a||(a={});a.limit||(a.limit=20);this._cloudService.doEAPIRequest("ivideon","POST",g,null,a,function(b,e){c&&c(b,e)})};f.prototype.getRecords=function(a,c){var g=this.getBaseURL()+"/records";this._cloudService.doEAPIRequest("ivideon","GET",g,a,null,function(b,e){c&&c(b,e)})};f.prototype.loadImage=function(a,c){var g=this;this._jpegCam?this._jpegCam.loadImage(function(b,
e){b?a&&a(b):b||!e||401!=e.statusCode||c?a&&a():(g._jpegCam=null,g.loadImage(a,!0))}):this.getLivePreview(function(b,e){!b&&e&&e.url&&e.token?(b="https://"+e.host+"/cameras/"+g._camID+"/live_preview",g._jpegCam=require("xnm.aio.cams.js").createJPEGCam(b,{headers:{Authorization:"Bearer "+e.token},imageName:g._camID+".jpg"}),g.loadImage(a,!0)):a&&a()})};f.parseJSON=function(a,c){return a&&a.connection&&a.id?new f(a.connection,a.id,c,a.format):null};return f}();
xnm.aio.cloudservice.Ring=function(){var f=function(a,c,g){this._connectionID=a;this._deviceID=c;this._cloudService=g;this._last_file_path=this._last_timestap=null};f.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._deviceID};f.prototype.getLastSnapshot=function(a){var c=this.getBaseURL()+"/last_snapshot";this._cloudService.doEAPIRequest("ring","GET",c,null,null,function(g,b){a&&a(g,b)})};f.prototype.getEvents=function(a,c){var g=this.getBaseURL()+"/history";a||(a={});
a.limit||(a.limit=20);this._cloudService.doEAPIRequest("ring","GET",g,a,null,function(b,e){c&&c(b,e)})};f.prototype.getRecordStream=function(a,c){var g=this.getBaseURL()+"/record_stream";a||(a={});a.eventID?this._cloudService.doEAPIRequest("ring","GET",g,a,null,function(b,e){if(b)c(b,e);else{var k=null;e&&"object"===typeof e&&(k=e.url);if("string"!==typeof k||0===k.length)b=Error("Result did not contain an URL or it was an empty string: "+k);c(b,k)}}):c(Error("no eventID"))};f.prototype.loadImage=
function(a,c){var g=this;c=new Date;!this._last_timestap||6E4<=c-this._last_timestap?(this._last_file_path=this._last_timestap=null,this.getLastSnapshot(function(b,e){!b&&e&&e.url&&e.timestamp&&e.access_token?(g._last_timestap=e.timestamp,require("xnm.aio.cams.js").createJPEGCam(e.url,{headers:{Authorization:"Bearer "+e.access_token}}).loadImage(function(k,h){k?(g._last_file_path=k,a&&a(k,e.timestamp)):(g._last_timestap=null,a&&a())})):a&&a()})):a&&a(this._last_file_path,this._last_timestap)};return{parseJSON:function(a,
c){return a&&a.type&&a.connection&&a.id?"doorbell"==a.type?new f(a.connection,a.id,c,a.format):null:null}}}();
xnm.aio.cloudservice.Bosch=function(){var f=function(a,c,g,b){this._connectionID=a;this._camID=c;this._cloudService=g;this._format=b;this._jpegCam=null};f.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};f.prototype.getStates=function(a){this._cloudService.doEAPIRequest("bosch","GET","/states/"+this._connectionID+"/"+this._camID,null,null,function(c,g){a&&a(c,g)})};f.prototype.getLivePreview=function(a,c){var g=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("bosch",
"GET",g,a,null,function(b,e){c&&c(b,e)})};f.prototype.getLiveStream=function(a,c){var g=this.getBaseURL()+"/live_stream";a||(a={});a.endpoint||(a.endpoint="cloud");a.profile||(a.profile="hd");this._cloudService.doEAPIRequest("bosch","GET",g,a,null,function(b,e){c&&c(b,e)})};f.prototype.getEvents=function(a,c){var g=this.getBaseURL()+"/events";a||(a={});if("undefined"==typeof a.page||null==a.page)a.page=0;if("undefined"==typeof a.pageSize||null==a.pageSize)a.pageSize=10;var b={filter:{},paging:{page:a.page,
pageSize:a.pageSize}};a.eventType&&(b.filter.eventType=a.eventType);this._cloudService.doEAPIRequest("bosch","POST",g,null,b,function(e,k,h,d){c&&c(e,k,d?d["x-token"]:null)})};f.prototype.getWifiInfo=function(a){var c=this.getBaseURL()+"/wifi";this._cloudService.doEAPIRequest("bosch","GET",c,null,null,function(g,b){a&&a(g,b)})};f.prototype.loadImage=function(a,c){var g=this;this._jpegCam?this.getStates(function(b,e){!b&&e&&e.states?"on"!=e.states.state?(g._jpegCam=null,a&&a()):g._jpegCam.loadImage(function(k,
h){k?a&&a(k):k||!h||401!=h.statusCode||c?a&&a():(g._jpegCam=null,g.loadImage(a,!0))}):a&&a()}):this.getLivePreview({endpoint:"cloud"},function(b,e){if(!b&&e&&e.mediaUri){b=e.mediaUri;var k={headers:{},imageName:g._camID+".jpg"};e.accessCredentials&&e.accessCredentials.credentials&&(e=e.accessCredentials.credentials.split(":"),k.user=e[0],k.password=e[1]);g._jpegCam=require("xnm.aio.cams.js").createJPEGCam(b,k);g.loadImage(a,!0)}else a&&a()})};f.parseJSON=function(a,c){return a&&a.connection&&a.id?
new f(a.connection,a.id,c,a.format):null};return f}();xnm.aio.cloudservice.DoorBird=function(f,a,c,g){this._connectionID=f;this._camID=a;this._cloudService=c;this._camMAC=g;this._cacheID=f+":"+a+":"+g;this._viewImageFailures=0;f=xnm.aio.cloudservice.DoorBird;f._cacheImage[this._cacheID]=f._cacheImage[this._cacheID]||{last:0,url:null};this._jpegCam=null};xnm.aio.cloudservice.DoorBird._cacheImage={};
xnm.aio.cloudservice.DoorBird.prototype={getBaseURL:function(){return"/devices/"+this._connectionID+"/"+this._camID},getStates:function(f){this._cloudService.doEAPIRequest("doorbird","GET","/states/"+this._connectionID+"/"+this._camID,null,null,function(a,c){f&&f(a,c)})},getAppScheme:function(f){this._cloudService.doEAPIRequest("doorbird","POST","/command",null,{connection:this._connectionID,device:this._camID,command:"view_scheme",value:{}},function(a,c){"string"===typeof c&&(c={url:c});f&&f(a,c)})},
getLivePreview:function(f,a){if(3<=this._viewImageFailures)f=Error('"view_image" request failed 3 times in a row. No more attempts until page reload.'),a&&a(f,null);else{var c=xnm.aio.cloudservice.DoorBird._cacheImage[this._cacheID];if(c&&(c.error||c.url)){var g=5;c.error&&(g=1);if(Date.now()-c.last<6E4*g){a&&a(c.error,{url:c.url});return}}f||(f=null);var b=this;this._cloudService.doEAPIRequest("doorbird","POST","/command",f,{connection:this._connectionID,device:this._camID,command:"view_image",value:{}},
function(e,k){"string"===typeof k&&(k={url:k});e?(b._viewImageFailures+=1,b._cloudService._logger.log("error","[DoorBird.getLivePreview] "+e.message),c||(xnm.aio.cloudservice.DoorBird._cacheImage[b._cacheID]={},c=xnm.aio.cloudservice.DoorBird._cacheImage[b._cacheID]),c.last=Date.now(),c.error=e):k&&k.url&&(b._viewImageFailures=0,c||(xnm.aio.cloudservice.DoorBird._cacheImage[b._cacheID]={},c=xnm.aio.cloudservice.DoorBird._cacheImage[b._cacheID]),c.last=Date.now(),c.url=k.url,delete c.error);a&&a(e,
k)})}},getLiveStream:function(f,a){f||(f=null);this._cloudService.doEAPIRequest("doorbird","POST","/command",f,{connection:this._connectionID,device:this._camID,command:"view_live",value:{}},function(c,g){"string"===typeof g&&(g={url:g});a&&a(c,g)})},loadImage:function(f,a){var c=this;this._cacheImage&&this._cacheImage.url&&3E5<=Date.now()-this._cacheImage.last&&(this._jpegCam=null);this._jpegCam?c._jpegCam.loadImage(function(g,b){g?f&&f(g):g||!b||401!=b.statusCode||a?f&&f():(c._jpegCam=null,c.loadImage(f,
!0))}):this.getLivePreview(null,function(g,b){!g&&b&&b.url?(g={headers:{},imageName:c._camID+".jpg"},c._jpegCam=require("xnm.aio.cams.js").createJPEGCam(b.url,g),c.loadImage(f,!0)):f&&f()})}};xnm.aio.cloudservice.DoorBird.parseJSON=function(f,a){if(!f||!f.connection||!f.id)return null;var c=null;f.data.metaData?c=f.data.metaData.mac:f.data.mac&&(c=f.data.mac);return new xnm.aio.cloudservice.DoorBird(f.connection,f.id,a,c)};
xnm.aio.cloudservice.CloudService=function(){var f=function(b){this._cloudservice=b};f.prototype.getRules=function(b){this._cloudservice._doJsonRequest("GET","/rules",null,null,b)};f.prototype.addRule=function(b,e){b?this._cloudservice._doJsonRequest("POST","/rules",null,b,e):e&&e(Error("rule is null"))};f.prototype.updateRule=function(b,e,k){b?e?this._cloudservice._doJsonRequest("POST","/rules/"+b,null,e,k):k&&k(Error("rule is null")):k&&k(Error("rule id is null"))};f.prototype.deleteRule=function(b,
e){b?this._cloudservice._doJsonRequest("POST","/rules/"+b,null,{},e):e&&e(Error("rule id is null"))};f.prototype.deleteRules=function(b,e){this._cloudservice._doJsonRequest("DELETE","/rules",b,null,e)};var a=function(b){this._cloudservice=b;this._version="v1"};a.prototype.disconenct=function(b,e,k){b?e?this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/disconnect",{id:e},null,function(h,d){k&&k(h,d)}):k&&k(Error("invalid connection id")):k&&k(Error("invalid module"))};a.prototype.getModuleConnectionInfo=
function(b,e,k){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/info/"+e,null,null,function(h,d){k(h,d)})};a.prototype.getModuleInfo=function(b,e){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/info",null,null,function(k,h){e(k,h)})};a.prototype.getModuleDevices=function(b,e){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/devices",null,null,function(k,h){e(k,h)})};a.prototype.getModuleStates=function(b,e){this._cloudservice._doJsonRequest("GET",
"/eapi/"+this._version+"/"+b+"/states",null,null,function(k,h){e(k,h)})};a.prototype.executeModuleCommand=function(b,e,k){this._cloudservice._doJsonRequest("POST","/eapi/"+this._version+"/"+b+"/command",null,e,function(h,d){k(h,d)})};a.prototype.doRequest=function(b,e,k,h,d,l){this._cloudservice._doJsonRequest(e,"/eapi/"+this._version+"/"+b+k,h,d,function(m,p,t,q){l(m,p,t,q)})};var c=function(b){this._cloudservice=b;this._version="v1"};c.prototype.getUserInfo=function(b){this._cloudservice._doJsonRequest("GET",
"/service/userInfo",null,null,function(e,k){b(e,k)})};c.prototype.getModulesInfo=function(b){var e="/service/moduleInfo";this._cloudservice._moduleFlags&&this._cloudservice._moduleFlags.bosch_enabled&&(e+="?bosch_enabled=true");this._cloudservice._doJsonRequest("GET",e,null,null,function(k,h){b(k,h)})};c.prototype.toCloudDevice=function(b,e){this._cloudservice._doJsonRequest("POST","/service/toCloudDevice",null,b,function(k,h){e(k,h)})};var g=function(b,e,k,h,d,l){this._logger=require("x.logger.js").getLogger("xnm.aio.cloudservice.CloudService");
this._ip=b;this._ip||(this._ip="cloud.mediola.com");this._port=e;this._port||(this._port=443);this._username=k;this._password=h;this._moduleInfo=d;this._moduleFlags=l||{};this._protocol="https";this._eapi=new a(this);this._ruleEngine=new f(this);this._service=new c(this)};g.prototype.getIP=function(){return this._ip};g.prototype.getPort=function(){return this._port};g.prototype.getUsername=function(){return this._password};g.prototype.getUserInfo=function(b){this._service.getUserInfo(b)};g.prototype.getModulesInfo=
function(b){this._service.getModulesInfo(b)};g.prototype.toCloudDevice=function(b,e){this._service.toCloudDevice(b,e)};g.prototype.doEAPIRequest=function(b,e,k,h,d,l){this._eapi.doRequest(b,e,k,h,d,l)};g.prototype.disconenct=function(b,e,k){this._eapi.disconenct(b,e,k)};g.prototype.getModuleConnectionInfo=function(b,e,k){this._eapi.getModuleConnectionInfo(b,e,k)};g.prototype.getModuleInfo=function(b,e){this._eapi.getModuleInfo(b,e)};g.prototype.getModuleDevices=function(b,e){this._eapi.getModuleDevices(b,
e)};g.prototype.getModuleStates=function(b,e){this._eapi.getModuleStates(b,e)};g.prototype.executeModuleCommand=function(b,e,k){this._eapi.executeModuleCommand(b,e,k)};g.prototype.getRules=function(b){this._ruleEngine.getRules(b)};g.prototype.addRule=function(b,e){this._ruleEngine.addRule(b,e)};g.prototype.updateRule=function(b,e,k){this._ruleEngine.updateRule(b,e,k)};g.prototype.deleteRule=function(b,e){this._ruleEngine.deleteRule(b,e)};g.prototype.deleteRules=function(b,e){this._ruleEngine.deleteRules(b,
e)};g.prototype.getAccessToken=function(b,e,k){b={sid:b};e&&(b.force=1);this._doJsonRequest("GET","/getAccessToken",b,null,function(h,d){h?k&&k(h):d?k&&k(null,d.at):k&&k(Error("invalid response"))})};g.prototype.executeCommandCreator=function(b,e,k){if(b&&b.module&&b.connection&&b.id)if(e&&e.value){var h={connection:b.connection,device:b.id,command:e.value};if("undefined"!=typeof e.ext&&null!=e.ext)if(Array.isArray(e.ext)){var d={};e.ext.forEach(function(l){l&&l.value&&(d[l.value]=l.ext)});h.value=
d}else h.value=e.ext;this.executeModuleCommand(b.module,h,function(l){k&&k(l)})}else k&&k(Error("command json invalid"));else k&&k(Error("device json invalid"))};g.prototype.getStatesCreator=function(b,e,k){var h=this;b=function(r,n){h.getModuleStates(r,function(w,u){n(w,u,r)})};var d=[],l=0;for(l=0;l<e.length;l++){var m=e[l];m&&m.device&&m.device.module&&-1==d.indexOf(m.device.module)&&d.push(m.device.module)}if(0==d.length)k&&k(null,[]);else{var p=0,t=[],q=[];for(l=0;l<d.length;l++)b(d[l],function(r,
n,w){p++;var u=[];r&&q.push(r);if(!r&&n)for(var x=0;x<e.length;x++){var v=e[x];if(v&&v.id&&v.device&&v.device.module==w){var y=null;if(v.device&&v.device.connection&&v.device.id&&v.status&&v.status.value){var z=n[v.device.connection];z&&z[v.device.id]&&(z=z[v.device.id].states)&&(y=z[v.status.value])}if("undefined"==typeof y||null==y)y="?";t.push({id:v.id,status:y});u.push({id:v.id,status:y})}}"undefined"!=typeof commandhandler&&null!=commandhandler&&"undefined"!=typeof commandhandler.reportStates&&
null!=commandhandler.reportStates&&!r&&u&&0<u.length&&commandhandler.reportStates(null,u);p==d.length&&k&&k(null,t,q)})}};g.prototype.getDeviceList=function(b,e){this.getModuleDevices(b,function(k,h){if(k)e(k);else{k=[];if(h)for(var d in h){var l=h[d],m;for(m in l){var p=l[m];p&&(p.sys="cloudservice",p.module=b,p.connection=d,p.id=m,k.push(p))}}e(null,k)}})};g.prototype._doJsonRequest=function(b,e,k,h,d){var l=null;h&&(l=JSON.stringify(h));this._doRequest(b,e,k,l,function(m,p,t,q){m||p?p&&p.XC_ERR?
(m=p.XC_ERR,q=null,t=m.code,m.msg?q=m.msg:m.error&&"object"===typeof m.error&&("string"===typeof m.error.message&&(q=m.error.message),"undefined"!==typeof m.error.code&&(t=m.error.code)),m=q?Error("[XC_ERR] "+q):Error(JSON.stringify(p)),m.code=t,d&&d(m)):m?d&&d(m):p.XC_SUC?d&&d(null,p.XC_SUC,t,q):d&&d(Error("unknown response")):d&&d(Error("invalid response"))})};g.prototype._resolveServerIP=function(b){if("/eapi/"==b.substr(0,6)&&(b=b.split("/")[3])&&this._moduleInfo&&this._moduleInfo[b]&&this._moduleInfo[b].domain){b=
this._moduleInfo[b].domain;var e=b.indexOf(":");return-1!=e?b.substr(0,e):b}return this._ip};g.prototype._resolveServerPort=function(b){if("/eapi/"==b.substr(0,6)&&(b=b.split("/")[3])&&this._moduleInfo&&this._moduleInfo[b]&&this._moduleInfo[b].domain){b=this._moduleInfo[b].domain;var e=b.indexOf(":");return-1!=e?parseInt(b.substr(e+1)):443}return this._port};g.prototype._doRequest=function(b,e,k,h,d){var l=e;l||(l="/");var m={};k&&(m=JSON.parse(JSON.stringify(k)));k="";for(var p in m)m.hasOwnProperty(p)&&
(k&&(k+="&"),k+=p+"="+encodeURIComponent(m[p]));k&&(l+="?"+k);b={host:this._resolveServerIP(e),port:this._resolveServerPort(e),path:l,method:b,headers:{Connection:"close","Content-Type":"application/json; charset=UTF-8"}};if(this._username||this._password)b.auth=(this._username?this._username:"")+":"+(this._password?this._password:""),b.headers.Authorization="Basic "+(new Buffer((this._username?this._username:"")+":"+(this._password?this._password:""))).toString("base64");l=require(this._protocol);
"https"==this._protocol&&"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");m=JSON.parse(JSON.stringify(b));m.headers&&(m.headers.auth&&(m.headers.auth="*********"),m.headers.Authorization&&(m.headers.Authorization="*********"));m.auth&&(m.auth="********");this._logger.log("trace","do request:"+JSON.stringify(m));var t=this,q=d,r=l.request(b,function(n){n.setEncoding("utf-8");var w="";n.on("data",function(u){w+=u});n.on("end",function(){t._logger.log("trace",
"receive code:"+n.statusCode+" headers:"+JSON.stringify(n.headers)+" response:"+w);var u=null,x=null;if(200==n.statusCode)try{w&&(x=JSON.parse(w))}catch(v){u=v}else{if(w)try{x=JSON.parse(w)}catch(v){}u=Error("HTTP response: "+n.statusCode)}q&&(q(u,x,n.statusCode,n.headers),q=null)})});if(r.on)r.on("error",function(n){t._logger.log("trace","do request error:"+n.message);q&&(q(n),q=null)});if(r.setTimeout){d=3E4;if(e.startsWith("/service/userInfo")||e.startsWith("/service/moduleInfo"))d=12E4;r.setTimeout(d,
function(){t._logger.log("trace","do request timeout");r.abort();q&&(q(Error("timeout")),q=null)})}h&&(this._logger.log("trace","do request send body:"+h),r.write(h));r.end()};g.prototype.toJSON=function(){return{sys:"cloudservice",username:this._username,password:this._password,ip:this._ip,port:this._port}};g.prototype.equalsTo=function(b){return b&&b instanceof g?this._ip==b._ip&&this._port==b._port&&this._username==b._username&&this._password==b._password:!1};g.parseJSON=function(b){return b&&
b.username&&b.password?new g(b.ip,b.port,b.username,b.password,b.moduleInfo,{bosch_enabled:b.bosch_enabled}):null};return g}();
xnm.aio.cloudservice.DM=function(){var f=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};f.prototype=Error();f.prototype.name="cloudserviceDMError";f.prototype.code=0;f.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"cloudservice",getGatewayType:function(){return[{sys:this.SYS,name:"Cloud Service"}]},createGateway:function(a,c,g){c=f.ERROR_CODE;a?a.username?a.password?g(null,a):g(new f(c.INVALID,"password is invalid")):g(new f(c.INVALID,
"username is invalid")):g(new f(c.INVALID,"info is invalid"))},updateGateway:function(a,c,g,b){a=f.ERROR_CODE;c?c.username?c.password?b(null,c):b(new f(a.INVALID,"password is invalid")):b(new f(a.INVALID,"username is invalid")):b(new f(a.INVALID,"update is invalid"))},deleteGateway:function(a,c,g){g()},createDevice:function(a,c,g){var b=f.ERROR_CODE;if(a)if(a.connection)if(a.id)if(a.gateway){c=c.data.gateways;var e;for(e=0;e<c.length;e++)if(c[e].index===a.gateway){var k=c[e];break}k?g&&g(null,a):
g(new f(b.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else g(new f(b.INVALID,"gateway is invalid"));else g(new f(b.INVALID,"id is invalid"));else g(new f(b.INVALID,"connection is invalid"));else g(new f(b.INVALID,"info is invalid"))},updateDevice:function(a,c,g){var b=f.ERROR_CODE;if(a)if(a.connection)if(a.id)if(a.gateway){c=c.data.gateways;var e;for(e=0;e<c.length;e++)if(c[e].index===a.gateway){var k=c[e];break}k?g(null,a):g(new f(b.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else g(new f(b.INVALID,
"gateway is invalid"));else g(new f(b.INVALID,"id is invalid"));else g(new f(b.INVALID,"connection is invalid"));else g(new f(b.INVALID,"info is invalid"))},deleteDevice:function(a,c,g){g()},applyUIFilter:function(a,c,g){var b=this,e=function(m,p){if("*"==m)return!0;for(var t=!1,q=0;q<m.length;q++)if(m[q]==p){t=!0;break}return t},k=function(m,p,t){var q=[];"command"==t.catagory?m.command&&m.command.forEach(function(r){e(t.elems,r.type)&&(r=JSON.parse(JSON.stringify(r)),q.push(r))}):"status"==t.catagory?
m.status&&m.status.forEach(function(r){e(t.elems,r.type)&&(r=JSON.parse(JSON.stringify(r)),q.push(r))}):"ipevt"==t.catagory&&m.ipevt&&m.ipevt.forEach(function(r){e(t.elems,r.type)&&(r=JSON.parse(JSON.stringify(r)),q.push(r))});return q},h=function(m,p){var t=[],q=b.getCommandStatusMap(m,g);q&&(m=k(q,m,p),t=t.concat(m));return t};if(!a.sys)return null;var d=JSON.parse(JSON.stringify(a)),l=null;if("command"==c.catagory)l=h(a,c),d.command=l;else if("status"==c.catagory)l=h(a,c),d.status=l;else if("ipevt"==
c.catagory)l=h(a,c),d.ipevt=l;else return null;return l&&0!=l.length?d:null},applyIPEventFilter:function(a){return a?this.applyUIFilter(a,{catagory:"ipevt",elems:"*"}):null},getCommandStatusMap:function(a,c){var g=function(h,d){var l=null;if(d.values)if(Array.isArray(d.values))l={type:"enum",name:h,ref:{value:h,ext:"%e",extMeta:d.values}};else{if(0<Object.keys(d.values).length){l={type:"multi",name:h,ref:{value:h,ext:"%multi",extMeta:[]}};for(var m in d.values)(h=g(m,d.values[m]))&&l.ref.extMeta.push(h)}}else if(d.value){switch(d.value.type){case "FLOAT":l=
{type:"float",name:h,ref:{value:h,ext:"%f"}};break;case "RGB":l={type:"rgb",name:h,ref:{value:h,ext:"%rgb"}};break;case "RGBW":l={type:"rgbw",name:h,ref:{value:h,ext:"%rgbw"}};break;case "STRING":l={type:"string",name:h,ref:{value:h,ext:"%s"}};break;case "TIME":l={type:"time",name:h,ref:{value:h,ext:"%time"}};break;default:l={type:"int",name:h,ref:{value:h,ext:"%d"}}}void 0!=d.value.min&&null!=d.value.min&&void 0!=d.value.max&&null!=d.value.max&&l&&(l.ref.extMeta=d.value.min+"-"+d.value.max);void 0!=
d.value.step&&null!=d.value.step&&l&&(l.ref.scale=d.value.step)}else l={type:"enum",name:h,ref:{value:h}};d.hasOwnProperty("automation")&&(l=Object.assign({},l,{automation:d.automation}));return l};if(!a)return null;c={command:[],status:[]};var b;if(a.commands)for(b in c.command=[],a.commands){var e=a.commands[b];var k=null;"homematic"==a.module&&"eco"==b?(e=JSON.parse(JSON.stringify(e)),delete e.values.duration,k=g(b,e)):"bosch"==a.module&&"off"==b?(e=JSON.parse(JSON.stringify(e)),e.value&&(e.value.type=
"INT",e.value.min=0),k=g(b,e)):"doorbird"===a.module?"view_image"!==b&&"view_live"!==b&&(k=g(b,e),"view_scheme"===b&&(k.name="view_scheme_doorbird")):k=g(b,e);k&&c.command.push(k)}if(a.states)for(b in c.status=[],c.ipevt=[],a.states)if(e=a.states[b],e.values)0!=e.state&&c.status.push({type:"enum",name:b,ref:{value:b,options:e.values}}),0!=e.event&&c.ipevt.push({type:"enum",name:b,ref:{value:b,options:e.values}});else{k=null;switch(e.type){case "BOOL":k={type:"enum",name:b,ref:{value:b,options:["true",
"false"]}};break;case "FLOAT":k={type:"float",name:b,ref:{value:b}};break;case "RGB":k={type:"rgb",name:b,ref:{value:b}};break;case "RGBW":k={type:"rgbw",name:b,ref:{value:b}};break;case "STRING":k={type:"string",name:b,ref:{value:b}};break;case "TIME":k={type:"int",name:b,ref:{value:b}};break;default:k={type:"int",name:b,ref:{value:b}}}void 0!=e.min&&null!=e.min&&void 0!=e.max&&null!=e.max&&k&&(k.ref.extMeta=e.min+"-"+e.max);void 0!=e.step&&null!=e.step&&k&&(k.ref.scale=e.step);k&&(0!=e.state&&c.status.push(k),
0!=e.event&&c.ipevt.push(k))}return c},toGeneralDevice:function(a,c,g){if(!a||!a.module)return null;c=null;switch(a.module){case "hue":case "lightify":c={type:"dimmer",commands:{},states:{},details:{commands:{},states:{}}};var b;if(a.commands)for(b in a.commands)switch(b){case "on":case "off":case "toggle":case "up":case "down":c.commands[b]={};c.details.commands[b]={value:b};break;case "brightness":case "colorTemperature":c.commands[b]={value:{type:"INT"}};c.details.commands[b]={value:b,ext:"%d"};
a.commands[b]&&a.commands[b].value&&(g=a.commands[b].value,isNaN(g.min)||isNaN(g.max)||(c.commands[b].value.min=g.min,c.commands[b].value.max=g.max,c.details.commands[b].extMeta=g.min+"-"+g.max));break;case "color":c.commands[b]={value:{type:"RGB"}},c.details.commands[b]={value:b,ext:"%rgb"},c.commands.white={},c.details.commands.white={value:"color",ext:"FFFFFF"},a.commands[b]&&a.commands[b].value&&(g=a.commands[b].value,"RGBW"==g.type&&(c.commands[b].value.type="RGBW",c.details.commands[b].ext=
"%rgbw",c.details.commands.white={value:"color",ext:"FFFFFFFF"}))}if(a.states)for(b in a.states)switch(b){case "state":c.states.state={values:["on","off"]};c.details.states.state={value:"state"};break;case "brightness":c.states.brightness={value:{type:"INT",min:0,max:100}};c.details.states.brightness={value:"brightness",ext:"%d",extMeta:"0-100"};break;case "colorTemperature":c.states.colorTemperature={value:{type:"INT",min:154,max:500}};c.details.states.colorTemperature={value:"colorTemperature",
ext:"%d",extMeta:"154-500"};break;case "color":c.states.color={type:"RGB"},c.details.states.color={value:"color",ext:"%rgb"},a.states[b]&&a.states[b].value&&(g=a.states[b].value,"RGBW"==g.type&&(c.states.color.type="RGBW",c.details.states.color.ext="%rgbw"))}break;case "somfy":c={type:"blind",commands:{},states:{},details:{commands:{},states:{}}};if(a.commands)for(b in a.commands)switch(b){case "open":case "close":c=null;break;case "stop":case "up":case "down":c.commands[b]={};c.details.commands[b]=
{value:b};break;case "position":case "rotation":c.commands[b]={value:{type:"INT",min:0,max:100}},c.details.commands[b]={value:b,ext:"%d"}}if(a.states)for(b in a.states)switch(b){case "position":case "rotation":c.states[b]={value:{type:"INT",min:0,max:100}},c.details.states[b]={value:b,ext:"%d",extMeta:"0-100"}}break;case "homematic":switch(a.type){case "switch":c=JSON.parse(JSON.stringify(a));c.details={commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"}}};
c.states.power&&(c.details.states.power={value:"power"});c.states.consumption&&(c.details.states.consumption={value:"consumption"});break;case "dimmer":c=JSON.parse(JSON.stringify(a));c.details={commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"},up:{value:"up"},down:{value:"down"},brightness:{value:"brightness"}},states:{state:{value:"state"},brightness:{value:"brightness"}}};break;case "blind":c=JSON.parse(JSON.stringify(a));c.details={commands:{up:{value:"up"},down:{value:"down"},
stop:{value:"stop"},stepUp:{value:"stepUp"},stepDown:{value:"stepDown"},position:{value:"position"}},states:{position:{value:"position"}}};c.commands.rotation&&(c.details.commands.rotation={value:"rotation"});c.states.rotation&&(c.details.states.rotation={value:"rotation"});break;case "heater":c=JSON.parse(JSON.stringify(a));c.details={};if(!c.commands)return null;c.commands&&(c.details.commands={up:{value:"up"},down:{value:"down"},temperature:{value:"temperature"},mode:{value:"mode"},auto:{value:"mode",
ext:"auto"},manu:{value:"mode",ext:"manu"},boost:{value:"mode",ext:"boost"}});c.states&&(c.details.states={state:{value:"state"},mode:{value:"mode"},temperature:{value:"temperature"},humidity:{value:"humidity"}});break;case "temperature":c=JSON.parse(JSON.stringify(a));c.states&&(c.details={states:{}},c.states.temperature&&(c.details.states.temperature={value:"temperature"}),c.states.humidity&&(c.details.states.humidity={value:"humidity"}));break;case "motion":c=JSON.parse(JSON.stringify(a));c.states&&
(c.details={states:{}},c.states.motion&&(c.details.states.motion={value:"motion"}));break;case "contact":c=JSON.parse(JSON.stringify(a));c.states&&(c.details={states:{}},c.states.contact&&(c.details.states.state={value:"contact"}));break;case "window":c=JSON.parse(JSON.stringify(a)),c.states&&(c.details={states:{}},c.states.window&&(c.details.states.state={value:"window"}))}break;case "bosch":switch(a.type){case "switch":c={type:"switch",commands:{on:{},off:{},toggle:{}},states:{state:{values:["on",
"off"]},power:{type:"FLOAT",unit:"W"},consumption:{type:"FLOAT",unit:"W"}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"},power:{value:"power"},consumption:{value:"energy"}}}};break;case "shutter":c={type:"blind",commands:{up:{},down:{},stop:{},position:{value:{type:"INT",min:0,max:100}}},states:{position:{type:"INT",min:0,max:100}},details:{commands:{up:{value:"up"},down:{value:"down"},stop:{value:"stop"},position:{value:"position"}},states:{position:{value:"position"}}}};
break;case "heater":c={type:"heater",commands:{up:{},down:{},temperature:{value:{type:"FLOAT",min:5,max:30.5,step:.5}}},states:{state:{type:"FLOAT",min:5,max:30.5,step:.5},temperature:{type:"FLOAT"},mode:{values:["automatic","manual"]}},details:{commands:{up:{value:"up"},down:{value:"down"},temperature:{value:"temperature"}},states:{state:{value:"state"},temperature:{value:"temperature"},mode:{value:"mode"}}}};break;case "contact":c={type:"contact",states:{state:{values:["open","closed"]}},details:{states:{state:{value:"state"}}}}}}return c},
supportSmartWidget:function(a,c){if(!a||!a.module)return!1;switch(a.module){case "gardena":case "homeconnect":case "netatmo":case "openweathermap":case "nuki":case "uhoo":return!0;case "enet":return["awning","blind","dimmer","light","switch"].includes(a.type);case "ring":return"doorbell"===a.type;case "homematic":case "hmipc2c":switch(a.type){case "contact":case "dimmer":case "door":case "enviroment":case "environment":case "heater":case "home":case "motion":case "presence":case "room":case "security":case "temperature":case "smoke":case "water":case "weather":return!0}case "novoferm":return"door"===
a.type}return!1},applySmartWidgetFilter:function(a,c,g,b,e){if(!c||!c.module)return null;var k=a=null;g=null;a=function(h,d){switch(h.module){case "bosch":"camera"===h.type&&(h.commands&&h.commands.position?d.push("bosch_cam"):d.push("bosch_cam_eyes"));break;case "gardena":switch(h.type){case "mower":d.push("gardena_mower");break;case "switch":d.push("gardena_switch");break;case "sensor":d.push("gardena_sensor");break;case "ic24":d.push("gardena_ic24");break;case "valve":d.push("gardena_valve")}break;
case "netatmo":switch(h.type){case "NAMain":d.push("netatmo_basestation");break;case "NAModule1":case "NAModule4":d.push("climate");d.push("notification");break;case "NAModule2":d.push("netatmo_wind");d.push("notification");break;case "NAModule3":d.push("netatmo_rain");d.push("notification");break;case "NHC":d.push("climate","notification")}break;case "openweathermap":d.push("openweathermap");break;case "nuki":d.push("nuki");break;case "ring":switch(h.type){case "doorbell":d.push("motion")}break;
case "uhoo":d.push("uhoo");break;case "enet":switch(h.type){case "awning":case "blind":d.push("blind");break;case "dimmer":d.push("dimmer","switch");break;case "light":case "switch":d.push("switch")}break;case "novoferm":"door"===h.type&&d.push("hm_tormatic");break;case "homeconnect":var l={"cleaning robot":["bsh_vacuum"],"coffee maker":["bsh_drinks"],"cook processor":["bsh_oven"],cooktop:["bsh_oven"],"dish washer":["bsh_dishwasher"],dryer:["bsh_dryer"],freezer:["bsh_fridge"],"fridge freezer":["bsh_fridge"],
hob:["bsh_oven"],hood:["bsh_hood","rgb"],oven:["bsh_oven"],refrigerator:["bsh_fridge"],"warming drawer":["bsh_oven"],"washer dryer":["bsh_dryer","bsh_washer"],washer:["bsh_washer"],"wine cooler":["bsh_fridge"]};l[h.type]&&d.push.apply(d,["bsh_general"].concat($jscomp.arrayFromIterable(l[h.type])));break;case "homematic":case "hmipc2c":switch((h.states.battery||h.states.timeout||h.states.sabotage)&&d.push("notification"),h.type){case "dimmer":d.push("dimmer");d.push("switch");break;case "door":d.push("hm_tormatic");
break;case "heater":d.push("thermostat");break;case "home":d.push("weather_station");d.push("climate");d.push("home");break;case "enviroment":case "environment":case "temperature":(h.states.temperature||h.states.humidity)&&d.push("climate");h.states.rain&&d.push("rain");break;case "contact":case "window":d.push("contact");d.push("window");break;case "motion":case "security":h.states.motion&&d.push("motion");(h.states.moisture||h.states.water)&&d.push("sensor_water");h.states.presence&&d.push("motion");
h.states.window&&(d.push("window"),d.push("contact"));h.states.smoke&&d.push("smoke");break;case "presence":h.states.presence&&d.push("motion");break;case "smoke":(h.states.smoke||h.states.smoke_alarm_state)&&d.push("smoke");break;case "water":h.states.water&&d.push("sensor_water");break;case "weather":d.push("weather_station");d.push("climate");break;case "other":h.states.co2Level&&d.push("sensor_co2")}}return d}(c,a?a:[]);k=function(h,d){switch(h.module){case "bosch":"camera"===h.type&&(h=h.commands,
d["%toggle%"]={value:"toggle"},h&&h.position&&(d["%camPosition%"]={value:"position",ext:"%d",extMeta:"-120-120"}));break;case "gardena":if(!h.commands)break;switch(h.type){case "mower":d["%start%"]={value:"start_override_timer",ext:"%d",extMeta:"60-6000",scale:60};d["%park%"]={value:"park_until_next_task"};break;case "switch":d["%on%"]={value:"on"};d["%onFor%"]={value:"on_for",ext:"%d",extMeta:"60-7200",scale:60};d["%off%"]={value:"off"};break;case "ic24":d["%stopAll%"]={value:"stop_all_valve"};break;
case "valve":d["%run%"]={value:"run",ext:"%d",extMeta:"60-3600",scale:60},d["%pause%"]={value:"pause",ext:"%d",extMeta:"60-604800",scale:60},d["%resume%"]={value:"resume"},d["%stop%"]={value:"stop"}}break;case "nuki":d["%unlock%"]={value:"unlock"};d["%lock%"]={value:"lock"};d["%open%"]={value:"lock_n_go"};break;case "enet":if(!h.commands)break;switch(h.type){case "awning":case "blind":d["%moveTo%"]={value:"position",ext:"%d",extMeta:"0-100"};d["%stop%"]={value:"stop"};h.commands.down?d["%moveDown%"]=
{value:"down"}:h.commands.out&&(d["%moveDown%"]={value:"out"});h.commands.up?d["%moveUp%"]={value:"up"}:h.commands.in&&(d["%moveUp%"]={value:"in"});h.commands.rotation&&(d["%lamellaTo%"]={value:"rotation",ext:"%d",extMeta:"0-100"});break;case "dimmer":case "light":case "switch":d["%dimOn%"]={value:"on"},d["%on%"]={value:"on"},d["%dimOff%"]={value:"off"},d["%off%"]={value:"off"},d["%toggle%"]={value:"toggle"},h.commands.brightness&&(d["%dimTo%"]={value:"brightness",ext:"%d",extMeta:"0-100"})}break;
case "novoferm":"door"===h.type&&(d["%open%"]={value:"up"},d["%partialOpen%"]={value:"partial"},d["%close%"]={value:"down"},d["%stop%"]={value:"stop"});break;case "hmipc2c":case "homematic":if(!h.commands)break;switch(h.type){case "switch":h.commands.on&&(d["%on%"]={value:"on"});h.commands.off&&(d["%off%"]={value:"off"});h.commands.toggle&&(d["%toggle%"]={value:"toggle"});break;case "dimmer":h.commands.brightness&&(d["%dimTo%"]={value:"brightness",ext:"%d",extMeta:"0-100"});h.commands.up&&(d["%dimUp%"]=
{value:"up"});h.commands.down&&(d["%dimDown%"]={value:"down"});h.commands.on&&(d["%dimOn%"]={value:"on"},d["%on%"]={value:"on"});h.commands.off&&(d["%dimOff%"]={value:"off"},d["%off%"]={value:"off"});h.commands.toggle&&(d["%toggle%"]={value:"toggle"});break;case "door":d["%open%"]={value:"open"};d["%close%"]={value:"close"};d["%stop%"]={value:"stop"};h.commands.garage_door_state&&(d["%partialOpen%"]={value:"garage_door_state",ext:"ventilation_position"});break;case "heater":h.commands.temperature&&
(d["%thermoTempTo%"]={value:"temperature",ext:"%f",scale:(h.commands.temperature.value||{}).scale||"0.5"});h.commands.down&&(d["%thermoTempDown%"]={value:"down"});h.commands.up&&(d["%thermoTempUp%"]={value:"up"});break;case "home":h.commands.alarm_mode&&(d["%alarmModeDisarm%"]={value:"alarm_mode",ext:"disarmed"},d["%alarmModeProtectExternal%"]={value:"alarm_mode",ext:"external_protection"},d["%alarmModeProtectFull%"]={value:"alarm_mode",ext:"full_protection"}),h.commands.auto&&(d["%thermoAuto%"]=
{value:"auto"}),h.commands.eco&&(d["%thermoEco%"]={value:"eco",extMeta:[{type:"time",name:"start",ref:{value:"start",ext:"%time"}},{type:"time",name:"end",ref:{value:"end",ext:"%time"}}]}),h.commands.vacation&&(d["%thermoVacation%"]={value:"vacation",extMeta:[{type:"float",name:"temperature",ref:{value:"temperature",ext:"%f",extMeta:"5-30",scale:.5}},{type:"time",name:"end",ref:{value:"end",ext:"%time"}}]})}break;case "homeconnect":var l=h.commands;if(l){for(var m in l)l[m].values||(d["%"+m+"%"]=
{value:m});if(l.PowerState){m=l.PowerState.values;if(!m||m.includes("On"))d["%on%"]={value:"PowerState",ext:"On"};if(!m||m.includes("Off"))d["%off%"]={value:"PowerState",ext:"Off"};if(!m||m.includes("Standby"))d["%standby%"]={value:"PowerState",ext:"Standby"}}"dish washer"===h.type&&(d["%Intensiv%"]=d["%Intensiv45%"]||d["%Intensiv70%"],d["%Normal%"]=d["%Normal45%"]||d["%Normal65%"],d["%Quick%"]=d["%Quick45%"]||d["%Quick65%"]);l.AmbientLightBrightness&&(d["%ambientTo%"]=l.AmbientLightBrightness);l.AmbientLightCustomColor&&
(d["%colorTo%"]=l.AmbientLightCustomColor);l.AmbientLightEnabled&&(d["%ambientOn%"]={value:"AmbientLightEnabled",ext:!0},d["%ambientOff%"]={value:"AmbientLightEnabled",ext:!1});l.Lighting&&(d["%dimOn%"]={value:"Lighting",ext:!0},d["%dimOff%"]={value:"Lighting",ext:!1});l.LightingBrightness&&(d["%dimTo%"]=l.LightingBrightness)}}return d}(c,k?k:{});g=function(h,d){switch(h.module){case "bosch":"camera"===h.type&&(d["%camOnline%"]={value:"online"},h.states&&h.states.position&&(d["%camPosition%"]={value:"position",
extMeta:"-120-120"}),d["%camState%"]={value:"state"});break;case "gardena":if(!h.states)break;h.states.online&&(d["%online%"]={value:"online",options:["true","false"]});switch(h.type){case "mower":d["%state%"]={value:"state",options:"paused ok_cutting ok_cutting_timer_overridden ok_searching ok_leaving ok_charging parked_timer parked_park_selected parked_autotimer none".split(" ")};break;case "switch":d["%state%"]={value:"state",options:["off","forever_on","time_limited_on","scheduled_on"]};d["%duration%"]=
{value:"duration"};break;case "sensor":d["%tempAmbient%"]={value:"ambient_temperature"};d["%tempSoil%"]={value:"soil_temperature"};d["%humSoil%"]={value:"soil_humidity"};d["%light%"]={value:"light"};break;case "valve":d["%state%"]={value:"state",options:["closed","manual_watering","scheduled_watering"]},d["%duration%"]={value:"duration"}}break;case "netatmo":switch(h.type){case "NAMain":d["%tempState%"]={value:"temperature"};d["%humState%"]={value:"humidity"};d["%co2State%"]={value:"co2"};d["%noiseState%"]=
{value:"noise"};d["%pressureState%"]={value:"pressure"};break;case "NAModule1":case "NAModule4":d["%tempState%"]={value:"temperature"};d["%humState%"]={value:"humidity"};d["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule2":d["%windspeedState%"]={value:"wind_speed"};d["%windDirection%"]={value:"wind_direction"};d["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule3":d["%rain%"]={value:"rain"};d["%rain_last_hour%"]={value:"rain_last_hour"};
d["%rain_last_day%"]={value:"rain_last_day"};d["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NHC":d["%co2State%"]={value:"co2"},d["%humState%"]={value:"humidity"},d["%noiseState%"]={value:"noise"},d["%pressureState%"]={value:"pressure"},d["%tempState%"]={value:"temperature"}}break;case "openweathermap":d["%tempState%"]={value:"temperature"};d["%humState%"]={value:"humidity"};d["%windspeedState%"]={value:"wind_speed"};d["%windDirection%"]={value:"wind_direction"};break;case "nuki":d["%lockStatus%"]=
{value:"state",conv_s:{locked:"locked",unlocked:"open"}};break;case "ring":switch(h.type){case "doorbell":d["%motionState%"]={value:"state",conv_s:{locked:"locked",unlocked:"open"}}}break;case "uhoo":d["%onlineState%"]={value:"online"};d["%tempState%"]={value:"temperature",extMeta:"-40-85"};d["%tempUnit%"]={value:"temperature_unit"};d["%humState%"]={value:"humidity",extMeta:"0-100"};d["%dustState%"]={value:"dust",extMeta:"0-200"};d["%vocState%"]={value:"voc",extMeta:"0-1200"};d["%co2State%"]={value:"co2",
extMeta:"400-10000"};d["%coState%"]={value:"co",extMeta:"0-1000"};d["%pressureState%"]={value:"pressure",extMeta:"300-1100"};d["%no2State%"]={value:"no2",extMeta:"0-1000"};d["%ozoneState%"]={value:"ozone",extMeta:"0-1000"};d["%measured%"]={value:"measured"};break;case "enet":if(!h.states)break;switch(h.type){case "awning":case "blind":d["%blindState%"]={value:"position",extMeta:"0-100"};h.states.rotation&&(d["%lamellaState%"]={value:"rotation",extMeta:"0-100"});break;case "dimmer":case "light":case "switch":d["%switchState%"]=
{value:"power"},h.states.brightness&&(d["%dimmerState%"]={value:"brightness",extMeta:"0-100"})}break;case "novoferm":"door"===h.type&&(d["%doorState%"]={value:"state"});break;case "hmipc2c":case "homematic":h.states.battery&&(d["%lowbat%"]={value:"battery",conv_i:{"0|30":"true","31|100":"false"}});h.states.timeout&&(d["%timeout%"]={value:"timeout"});h.states.sabotage&&(d["%sabotage%"]={value:"sabotage"});switch(h.type){case "dimmer":h.states.brightness&&(d["%dimmerState%"]={value:"brightness"});h.states.state&&
(d["%switchState%"]={value:"state"});break;case "door":h.states.garage_door_state&&(d["%doorState%"]={value:"garage_door_state"});break;case "switch":h.states.state&&(d["%switchState%"]={value:"state"});break;case "heater":h.states.temperature&&(d["%thermoCurrentTemp%"]={value:"temperature"});h.states.setpoint&&(d["%thermoSetTemp%"]={value:"setpoint"});h.states.humidity&&(d["%thermoHum%"]={value:"humidity"});break;case "home":h.states.temperature&&(d["%tempState%"]={value:"temperature"});h.states.humidity&&
(d["%humState%"]={value:"humidity"});h.states.wind_speed&&(d["%windspeedState%"]={value:"wind_speed"});h.states.wind_direction&&(d["%windDirection%"]={value:"wind_direction"},d["%windDirection%"].conv_i={"0|22":"N","23|67":"NO","68|112":"O","113|157":"SO","158|202":"S","203|247":"SW","248|292":"W","293|337":"NW","338|360":"N"});h.states.alarm_mode&&(d["%alarmMode%"]={value:"alarm_mode"});h.states.mode&&(d["%thermoMode%"]={value:"mode"});break;case "enviroment":case "environment":case "temperature":h.states.temperature&&
(d["%tempState%"]={value:"temperature"});h.states.humidity&&(d["%humState%"]={value:"humidity"});h.states.rain&&(d["%rainState%"]={value:"rain"});break;case "contact":h.states.state&&(d["%contactState%"]={value:"state"},d["%windowState%"]={value:"state"});break;case "motion":case "security":h.states.motion&&(d["%motionState%"]={value:"motion"});if(h.states.moisture||h.states.water)d["%waterState%"]={value:"water",conv_s:{"true":"water","false":"dry"}};h.states.presence&&(d["%motionState%"]||(d["%motionState%"]=
{value:"presence"}));h.states.window&&(d["%windowState%"]={value:"window"},d["%contactState%"]={value:"window"});h.states.smoke&&(d["%smokeState%"]={value:"smoke"});break;case "presence":h.states.presence&&(d["%motionState%"]={value:"presence"});h.states.illumination&&(d["%motionBrightness%"]={value:"illumination"});break;case "smoke":h.states.smoke&&(d["%smokeState%"]={value:"smoke"});h.states.smoke_alarm_state&&(d["%smokeState%"]={value:"smoke_alarm_state",conv_s:{primary_alarm:"true",secondary_alarm:"true",
intrusion_alarm:"true",idle_off:"false"}});break;case "water":h.states.water&&(d["%waterState%"]={value:"water",conv_s:{"true":"water","false":"dry"}});break;case "weather":h.states.temperature&&(d["%tempState%"]={value:"temperature"});h.states.humidity&&(d["%humState%"]={value:"humidity"});h.states.illumination&&(d["%brightnessState%"]={value:"illumination"});h.states.wind_speed&&(d["%windspeedState%"]={value:"wind_speed"});h.states.wind_direction&&(d["%windDirection%"]={value:"wind_direction"},
d["%windDirection%"].conv_i={"0|22":"N","23|67":"NO","68|112":"O","113|157":"SO","158|202":"S","203|247":"SW","248|292":"W","293|337":"NW","338|360":"N"});h.states.rain&&(d["%rainingState%"]={value:"rain"});h.states.rain_total&&(d["%rainingCounterState%"]={value:"rain_total"});h.states.sunshine_total&&(d["%sunshineState%"]={value:"sunshine_total"});break;case "other":h.states.co2Level&&(d["%co2State%"]={value:"co2Level"})}break;case "homeconnect":if(h=h.states){for(var l in h){var m=h[l],p=String(m.type).toLowerCase();
m.state&&(["enum","string"].includes(p)?d["%"+l+"%"]={value:l}:["float","int"].includes(p)&&(p={value:l},"undefined"!==typeof m.min&&(p.min=m.min),"undefined"!==typeof m.max&&(p.max=m.max),d["%"+l+"%"]=p))}h.AmbientLightBrightness&&(k["%ambientState%"]=h.AmbientLightBrightness);h.AmbientLightCustomColor&&(k["%colorState%"]=h.AmbientLightCustomColor);h.LightingBrightness&&(k["%dimmerState%"]=h.LightingBrightness)}}return d}(c,g?g:{});b=this._injectToSmartWidgetTemplate(b,a,e,k,g,c);if(Array.isArray(b)&&
"bosch"===c.module&&"camera"===c.type&&(!c.commands||!c.commands.toggle))for(c=0;c<b.length;c++)if((e=b[c])&&e.meta&&e.elements&&0===String(e.meta.type).indexOf("bosch_cam")&&(e=e.elements.buttons,Array.isArray(e)))for(a=0;a<e.length;a++)(g=e[a])&&g.action&&g.action.ref&&"toggle"===g.action.ref.value&&delete g.action;return b},_injectToSmartWidgetTemplate:function(a,c,g,b,e,k){var h=[];if(!c)return h;a=a||{};b=b||{};e=e||{};for(var d=0;d<a.length;d++){var l=a[d];if(l.meta&&l.elements&&c.includes(l.meta.type)){l=
JSON.parse(JSON.stringify(l));var m=!1,p=!1,t;for(t in l.elements){var q=l.elements[t];if(q&&Array.isArray(q))for(var r=0;r<q.length;r++){var n=q[r];if(n){if(n.action&&("command"==n.action.type||"camera"==n.action.type)&&n.action.ref&&n.action.ref.value){var w=n.action.ref.value,u=n.action.ref.ext;b[w]?(n.action.device=g,m=JSON.parse(JSON.stringify(b[w])),n.action.ref=m,"undefined"!=typeof u&&null!=u&&(m.ext=u),"sliders"!=t&&"roundsliders"!=t||!m.extMeta||(w=m.extMeta.indexOf("-",1),-1!=w&&(u=m.extMeta.substr(0,
w),u=parseFloat(u),m=m.extMeta.substr(w+1),m=parseFloat(m),isNaN(u)||(n.min=u),isNaN(m)||(n.max=m))),m=!0):(p=!0,n.action=null)}n.status&&n.status.ref&&n.status.ref.value&&(e[n.status.ref.value]?(n.status.ref=JSON.parse(JSON.stringify(e[n.status.ref.value])),n.status.device=g,m=!0):(p=!0,n.status=null));n.maxValFromStatus&&n.maxValFromStatus.ref&&n.maxValFromStatus.ref.value&&(e[n.maxValFromStatus.ref.value]?(n.maxValFromStatus.ref=JSON.parse(JSON.stringify(e[n.maxValFromStatus.ref.value])),n.maxValFromStatus.device=
g,m=!0):(p=!0,n.maxValFromStatus=null))}}}!m||p&&"homeconnect"!==k.module||(p&&"homeconnect"===k.module&&(l.meta.note=String(l.meta.note||""),0<l.meta.note.length&&(l.meta.note+=","),l.meta.note+="bsh_incomplete"),h.push(l))}}return h}}}();
xnm.aio.cloudservice.Handler=function(){var f=function(){};f.prototype.devicemanager=xnm.aio.cloudservice.DM;f.prototype.CloudService=xnm.aio.cloudservice.CloudService;f.prototype.Ivideon=xnm.aio.cloudservice.Ivideon;f.prototype.Ring=xnm.aio.cloudservice.Ring;f.prototype.Bosch=xnm.aio.cloudservice.Bosch;f.prototype.DoorBird=xnm.aio.cloudservice.DoorBird;f.prototype.registModule=function(a){a.register("cloudservice","cloudservice")};f.prototype.resolveGateway=function(a){return a?this.CloudService.parseJSON(a):
null};f.prototype.getDeviceCommands=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};f.prototype.getDeviceStatus=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};f.prototype.doCommand=function(a,c,g,b){(a=this.resolveGateway(a))?a.executeCommandCreator(c,g,function(e){b&&b(e)}):b&&b(Error("gateway json format invalid"))};f.prototype.doStatus=function(a,c,g,b,e){(c=this.resolveGateway(c))?
c.getStatesCreator(null,[{id:a,device:g,status:b}],function(k,h){k?e&&e(k):e&&e(null,h[0])}):e&&e(Error("gateway json format invalid"))};f.prototype.getUserInfo=function(a,c){(a=this.resolveGateway(a))?a.getUserInfo(function(g,b){c&&c(g,b)}):c&&c(Error("gateway json format invalid"))};f.prototype.getModulesInfo=function(a,c){(a=this.resolveGateway(a))?a.getModulesInfo(function(g,b){c&&c(g,b)}):c&&c(Error("gateway json format invalid"))};f.prototype.getDeviceList=function(a,c,g){c?(a=this.resolveGateway(a))?
a.getDeviceList(c,function(b,e){g&&g(b,e)}):g&&g(Error("gateway json format invalid")):g&&g(Error("module name invalid"))};f.prototype.getConnectionState=function(a,c,g,b){c?g?(a=this.resolveGateway(a))?a.getModuleConnectionInfo(c,g,function(e,k){b&&b(e,k)}):b&&b(Error("gateway json format invalid")):b&&b(Error("connection id invalid")):b&&b(Error("module name invalid"))};f.prototype.disconnect=function(a,c,g,b){c?g?(a=this.resolveGateway(a))?a.disconenct(c,g,function(e){b&&b(e)}):b&&b(Error("gateway json format invalid")):
b&&b(Error("connection id invalid")):b&&b(Error("module name invalid"))};return f}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.cloudservice.Handler);

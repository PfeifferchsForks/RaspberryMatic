var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.enoceanip=xnm.aio.enoceanip||{};xnm.aio.enoceanip.Util={clearHttpOptionForLog:function(n){try{var f=JSON.parse(JSON.stringify(n));f.auth&&(f.auth="xxxxxx:xxxxxx");if(f.headers)for(var h in headers)if(h&&"authorization"==h.toLocaleLowerCase()){var c=headers[h];if(c){var g=c.indexOf(" ");headers[h]=-1==g?"xxxxxx":c.substr(0,g)+" xxxxxx"}}return f}catch(e){return n}}};
xnm.aio.enoceanip.IP_Profiles=function(){var n=function(){var k=function(){};k.prototype.getMap=function(){return{ipevt:[{type:"enum",name:"button A0 pressed",ref:{value:"btnA0pressed",options:["true"]}},{type:"enum",name:"button A0 released",ref:{value:"btnA0released",options:["true"]}},{type:"enum",name:"button A0 short press",ref:{value:"btnA0shortPress",options:["true"]}},{type:"enum",name:"button A0 long press",ref:{value:"btnA0longPress",options:["true"]}},{type:"enum",name:"button AI pressed",
ref:{value:"btnAIpressed",options:["true"]}},{type:"enum",name:"button AI released",ref:{value:"btnAIreleased",options:["true"]}},{type:"enum",name:"button AI short press",ref:{value:"btnAIshortPress",options:["true"]}},{type:"enum",name:"button AI long press",ref:{value:"btnAIlongPress",options:["true"]}},{type:"enum",name:"button B0 pressed",ref:{value:"btnB0pressed",options:["true"]}},{type:"enum",name:"button B0 released",ref:{value:"btnB0released",options:["true"]}},{type:"enum",name:"button B0 short press",
ref:{value:"btnB0shortPress",options:["true"]}},{type:"enum",name:"button B0 long press",ref:{value:"btnB0longPress",options:["true"]}},{type:"enum",name:"button BI pressed",ref:{value:"btnBIpressed",options:["true"]}},{type:"enum",name:"button BI released",ref:{value:"btnBIreleased",options:["true"]}},{type:"enum",name:"button BI short press",ref:{value:"btnBIshortPress",options:["true"]}},{type:"enum",name:"button BI long press",ref:{value:"btnBIlongPress",options:["true"]}}]}};k.prototype.resolveState=
function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];if(d&&d.key)switch(d.key){case "buttonA0":a||(a={});switch(d.value){case "pressed":a.btnA0pressed=!0;break;case "released":a.btnA0released=!0}break;case "buttonAI":a||(a={});switch(d.value){case "pressed":a.btnAIpressed=!0;break;case "released":a.btnAIreleased=!0}break;case "buttonB0":a||(a={});switch(d.value){case "pressed":a.btnB0pressed=!0;break;case "released":a.btnB0released=!0}break;
case "buttonBI":a||(a={});switch(d.value){case "pressed":a.btnBIpressed=!0;break;case "released":a.btnBIreleased=!0}break;case "multipleButtons":switch(a||(a={}),d.value){case "pressed":a.multiBtnpressed=!0;break;case "released":a.multiBtnreleased=!0}}}return a};return{Version_0_9:new k}}(),f=function(){var k=function(){};k.prototype.getMap=function(){return{ipevt:[{type:"enum",name:"button A0 pressed",ref:{value:"btnA0pressed",options:["true"]}},{type:"enum",name:"button A0 released",ref:{value:"btnA0released",
options:["true"]}},{type:"enum",name:"button A0 short press",ref:{value:"btnA0shortPress",options:["true"]}},{type:"enum",name:"button A0 long press",ref:{value:"btnA0longPress",options:["true"]}},{type:"enum",name:"button AI pressed",ref:{value:"btnAIpressed",options:["true"]}},{type:"enum",name:"button AI released",ref:{value:"btnAIreleased",options:["true"]}},{type:"enum",name:"button AI short press",ref:{value:"btnAIshortPress",options:["true"]}},{type:"enum",name:"button AI long press",ref:{value:"btnAIlongPress",
options:["true"]}},{type:"enum",name:"button B0 pressed",ref:{value:"btnB0pressed",options:["true"]}},{type:"enum",name:"button B0 released",ref:{value:"btnB0released",options:["true"]}},{type:"enum",name:"button B0 short press",ref:{value:"btnB0shortPress",options:["true"]}},{type:"enum",name:"button B0 long press",ref:{value:"btnB0longPress",options:["true"]}},{type:"enum",name:"button BI pressed",ref:{value:"btnBIpressed",options:["true"]}},{type:"enum",name:"button BI released",ref:{value:"btnBIreleased",
options:["true"]}},{type:"enum",name:"button BI short press",ref:{value:"btnBIshortPress",options:["true"]}},{type:"enum",name:"button BI long press",ref:{value:"btnBIlongPress",options:["true"]}},{type:"enum",name:"button C0 pressed",ref:{value:"btnC0pressed",options:["true"]}},{type:"enum",name:"button C0 released",ref:{value:"btnC0released",options:["true"]}},{type:"enum",name:"button C0 short press",ref:{value:"btnC0shortPress",options:["true"]}},{type:"enum",name:"button C0 long press",ref:{value:"btnC0longPress",
options:["true"]}},{type:"enum",name:"button CI pressed",ref:{value:"btnCIpressed",options:["true"]}},{type:"enum",name:"button CI released",ref:{value:"btnCIreleased",options:["true"]}},{type:"enum",name:"button CI short press",ref:{value:"btnCIshortPress",options:["true"]}},{type:"enum",name:"button CI long press",ref:{value:"btnCIlongPress",options:["true"]}},{type:"enum",name:"button D0 pressed",ref:{value:"btnD0pressed",options:["true"]}},{type:"enum",name:"button D0 released",ref:{value:"btnD0released",
options:["true"]}},{type:"enum",name:"button D0 short press",ref:{value:"btnD0shortPress",options:["true"]}},{type:"enum",name:"button D0 long press",ref:{value:"btnD0longPress",options:["true"]}},{type:"enum",name:"button DI pressed",ref:{value:"btnDIpressed",options:["true"]}},{type:"enum",name:"button DI released",ref:{value:"btnDIreleased",options:["true"]}},{type:"enum",name:"button DI short press",ref:{value:"btnDIshortPress",options:["true"]}},{type:"enum",name:"button DI long press",ref:{value:"btnDIlongPress",
options:["true"]}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];if(d&&d.key)switch(d.key){case "buttonA0":a||(a={});switch(d.value){case "pressed":a.btnA0pressed=!0;break;case "released":a.btnA0released=!0}break;case "buttonAI":a||(a={});switch(d.value){case "pressed":a.btnAIpressed=!0;break;case "released":a.btnAIreleased=!0}break;case "buttonB0":a||(a={});switch(d.value){case "pressed":a.btnB0pressed=
!0;break;case "released":a.btnB0released=!0}break;case "buttonBI":a||(a={});switch(d.value){case "pressed":a.btnBIpressed=!0;break;case "released":a.btnBIreleased=!0}break;case "buttonC0":a||(a={});switch(d.value){case "pressed":a.btnC0pressed=!0;break;case "released":a.btnC0released=!0}break;case "buttonCI":a||(a={});switch(d.value){case "pressed":a.btnCIpressed=!0;break;case "released":a.btnCIreleased=!0}break;case "buttonD0":a||(a={});switch(d.value){case "pressed":a.btnD0pressed=!0;break;case "released":a.btnD0released=
!0}break;case "buttonDI":switch(a||(a={}),d.value){case "pressed":a.btnDIpressed=!0;break;case "released":a.btnDIreleased=!0}}}return a};return{Version_0_9:new k}}(),h=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"enum",name:"water detected",ref:{value:"water",options:["true","false"]}}],ipevt:[{type:"enum",name:"water detected",ref:{value:"water",options:["true","false"]}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=
0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&"liquidDetected"==d.key&&(a||(a={}),a.water=d.value)}return a};return{Version_0_9:new k}}(),c=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"enum",name:"alarm",ref:{value:"alarm",options:["off","on"]}},{type:"enum",name:"battery Low",ref:{value:"lowbat",options:["true","false"]}}],ipevt:[{type:"enum",name:"alarm",ref:{value:"alarm",options:["off","on"]}},{type:"enum",name:"battery Low",ref:{value:"lowbat",
options:["true","false"]}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&("alarm"==d.key?(a||(a={}),a.alarm=d.value):"batteryLow"==d.key&&(a||(a={}),a.lowbat=d.value))}return a};return{Version_0_9:new k}}(),g=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"enum",name:"handle",ref:{value:"handle",options:["closed","open","up"]}}],ipevt:[{type:"enum",name:"handle",
ref:{value:"handle",options:["closed","open","up"]}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&"handle"==d.key&&(a||(a={}),a.handle=d.value)}return a};return{Version_0_9:new k}}(),e=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"float",name:"humidity",ref:{value:"humidity",extMeta:"0-100",scale:.4}},{type:"float",name:"temperature",ref:{value:"temperature",
extMeta:"0-40",scale:.16}}],ipevt:[{type:"float",name:"humidity",ref:{value:"humidity",extMeta:"0-100",scale:.4}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.16}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&(a||(a={}),a[d.key]=d.value)}return a};return{Version_0_9:new k}}(),m=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"int",
name:"error code",ref:{value:"errorCode",extMeta:"251-255"}},{type:"int",name:"illumination",ref:{value:"illumination",extMeta:"0-1000"}},{type:"enum",name:"motion detected",ref:{value:"motionDetected",options:["false","true"]}},{type:"float",name:"supply voltage",ref:{value:"supplyVoltage",extMeta:"0-5",scale:.02}}],ipevt:[{type:"int",name:"error code",ref:{value:"errorCode",extMeta:"251-255"}},{type:"int",name:"illumination",ref:{value:"illumination",extMeta:"0-1000"}},{type:"enum",name:"motion detected",
ref:{value:"motionDetected",options:["false","true"]}},{type:"float",name:"supply voltage",ref:{value:"supplyVoltage",extMeta:"0-5",scale:.02}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&(a||(a={}),a[d.key]=d.value)}return a};return{Version_0_9:new k}}(),p=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"int",name:"setpoint",ref:{value:"setpoint",extMeta:"0-255"}},
{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}],ipevt:[{type:"int",name:"setpoint",ref:{value:"setpoint",extMeta:"0-255"}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}]}};k.prototype.resolveState=function(b,l){if(!l||!l.functions)return null;b=null;for(var d=0;d<l.functions.length;d++){var y=l.functions[d];y&&y.key&&(b||(b={}),b[y.key]=y.value)}return b};var a=function(){};a.prototype.getMap=function(){return{status:[{type:"float",
name:"setpoint",ref:{value:"setpoint",extMeta:"-3-3",scale:.5}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.1}}],ipevt:[{type:"float",name:"setpoint",ref:{value:"setpoint",extMeta:"-3-3",scale:.5}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.1}}]}};a.prototype.resolveState=function(b,l){if(!l||!l.functions)return null;b=null;for(var d=0;d<l.functions.length;d++){var y=l.functions[d];y&&y.key&&(b||(b={}),b[y.key]=y.value)}return b};
return{Version_0_9:new k,Version_0_9_Thermokon:new a}}(),r=function(){var k=function(){};k.prototype.getMap=function(){return{command:[{type:"float",name:"set point",ref:{value:"setpoint",ext:"%f",extMeta:"0-40",scale:.5}},{type:"int",name:"set valve",ref:{value:"setvalve",ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"actuator obstructed",ref:{value:"actuatorObstructed",options:["false","true"]}},{type:"enum",name:"battery low",ref:{value:"batteryLow",options:["false","true"]}},{type:"enum",
name:"contact",ref:{value:"contact",options:["closed","open"]}},{type:"enum",name:"energy input enabled",ref:{value:"energyInput",options:["false","true"]}},{type:"enum",name:"energy storage charged",ref:{value:"energyStorageCharged",options:["false","true"]}},{type:"enum",name:"service mode",ref:{value:"serviceMode",options:["off","on"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}},{type:"int",name:"valve",ref:{value:"valve",extMeta:"0-100"}},{type:"enum",
name:"window",ref:{value:"window",options:["closed","open"]}}],ipevt:[{type:"enum",name:"actuator obstructed",ref:{value:"actuatorObstructed",options:["false","true"]}},{type:"enum",name:"battery low",ref:{value:"batteryLow",options:["false","true"]}},{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}},{type:"enum",name:"energy input enabled",ref:{value:"energyInput",options:["false","true"]}},{type:"enum",name:"energy storage charged",ref:{value:"energyStorageCharged",options:["false",
"true"]}},{type:"enum",name:"service mode",ref:{value:"serviceMode",options:["off","on"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}},{type:"int",name:"valve",ref:{value:"valve",extMeta:"0-100"}},{type:"enum",name:"window",ref:{value:"window",options:["closed","open"]}}]}};k.prototype.executeCommand=function(a,b,l,d){b=this.getPutStateBody(a,b);if(!b)return!1;l.setDeviceState(a.deviceId,b,function(y){d&&d(y)});return!0};k.prototype.getPutStateBody=function(a,
b){a=null;switch(b.value){case "setpoint":a={state:{functions:[{key:"switch",value:"on"}]}};break;case "off":a={state:{functions:[{key:"switch",value:"off"}]}};break;case "query":a={state:{functions:[{key:"query",value:"status"}]}}}return a};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&("switch"==d.key?(a||(a={}),a.state=d.value):"localControl"==d.key&&(a||(a={}),a.local_control=d.value))}return a};
return{Version_0_9:new k}}(),t=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"enum",name:"liquid detected",ref:{value:"liquidDetected",options:["false","true"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}],ipevt:[{type:"enum",name:"liquid detected",ref:{value:"liquidDetected",options:["false","true"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}]}};k.prototype.resolveState=function(a,
b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&(a||(a={}),a[d.key]=d.value)}return a};return{Version_0_9_Afriso:new k}}(),q=function(){var k=function(){};k.prototype.getMap=function(){return{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"enum",name:"state",ref:{value:"state",
options:["off","on"]}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["off","on"]}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}]}};k.prototype.executeCommand=function(a,b,l,d){if(b&&"toggle"==b.value){var y=this;l.getDeviceState(a.deviceId,function(A,z){A?d&&d(A):(A=y.resolveState(a,z),z="on",A&&"on"==A.state&&(z="off"),y.executeCommand(a,{value:z},l,d))})}else{b=
this.getPutStateBody(a,b);if(!b)return!1;l.setDeviceState(a.deviceId,b,function(A){d&&d(A)});return!0}};k.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "on":a={state:{functions:[{key:"switch",value:"on"}]}};break;case "off":a={state:{functions:[{key:"switch",value:"off"}]}};break;case "query":a={state:{functions:[{key:"query",value:"status"}]}}}return a};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=
b.functions[l];d&&d.key&&("switch"==d.key?(a||(a={}),a.state=d.value):"localControl"==d.key&&(a||(a={}),a.local_control=d.value))}return a};return{Version_0_9:new k}}(),u=function(){var k=function(){};k.prototype.getMap=function(){return{command:[{type:"int",name:"dim to",ref:{value:"dimTo",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"stop dim",ref:{value:"stop"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"int",name:"state",
ref:{value:"state",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}],ipevt:[{type:"int",name:"state",ref:{value:"state",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}]}};k.prototype.executeCommand=function(a,b,l,d){if(b&&"toggle"==b.value){var y=this;l.getDeviceState(a.deviceId,function(A,z){A?d&&d(A):(A=y.resolveState(a,z),z={value:"dimTo",ext:100},A&&A.state&&(z={value:"dimTo",
ext:0}),y.executeCommand(a,z,l,d))})}else{b=this.getPutStateBody(a,b);if(!b)return!1;l.setDeviceState(a.deviceId,b,function(A){d&&d(A)});return!0}};k.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "dimTo":if("undefined"==typeof b.ext||null==b.ext)return null;b=parseInt(b.ext);0>b&&(b=0);100<b&&(b=100);a={state:{functions:[{key:"dimValue",value:b},{key:"rampingMode",value:"switch"}]}};break;case "stop":a={state:{functions:[{key:"dimValue",value:"invalid"},{key:"rampingMode",value:"stop"}]}};
break;case "query":a={state:{functions:[{key:"query",value:"status"}]}}}return a};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&("dimValue"==d.key?(a||(a={}),a.state=d.value):"localControl"==d.key&&(a||(a={}),a.local_control=d.value))}return a};return{Version_0_9:new k}}(),v=function(){var k=function(){};k.prototype.getMap=function(){return{command:[{type:"enum",name:"channel 1 on",ref:{value:"ch1on"}},
{type:"enum",name:"channel 1 off",ref:{value:"ch1off"}},{type:"enum",name:"channel 1 toggle",ref:{value:"ch1toggle"}},{type:"enum",name:"channel 2 on",ref:{value:"ch2on"}},{type:"enum",name:"channel 2 off",ref:{value:"ch2off"}},{type:"enum",name:"channel 2 toggle",ref:{value:"ch2toggle"}},{type:"enum",name:"all on",ref:{value:"allOn"}},{type:"enum",name:"all off",ref:{value:"allOff"}},{type:"enum",name:"all toggle",ref:{value:"allToggle"}},{type:"enum",name:"query channel 1 status",ref:{value:"ch1query"}},
{type:"enum",name:"query channel 2 status",ref:{value:"ch2query"}},{type:"enum",name:"query all status",ref:{value:"allQuery"}}],status:[{type:"enum",name:"channel 1 state",ref:{value:"ch1state",options:["off","on"]}},{type:"enum",name:"channel 2 state",ref:{value:"ch2state",options:["off","on"]}}],ipevt:[{type:"enum",name:"channel 1 state",ref:{value:"ch1state",options:["off","on"]}},{type:"enum",name:"channel 2 state",ref:{value:"ch2state",options:["off","on"]}}]}};k.prototype.executeCommand=function(a,
b,l,d){if(!b||"ch1toggle"!=b.value&&"ch2toggle"!=b.value&&"allToggle"!=b.value){var y=this.getPutStateBody(a,b);if(!y)return!1;l.setDeviceState(a.deviceId,y,function(z){d&&d(z)});return!0}var A=this;l.getDeviceState(a.deviceId,function(z,B){z?d&&d(z):(z=A.resolveState(a,B),B="ch1on","ch1toggle"==b.value?(B="ch1on",z&&"on"==z.ch1state&&(B="ch1off")):"ch2toggle"==b.value?(B="ch2on",z&&"on"==z.ch2state&&(B="ch2off")):"allToggle"==b.value&&(B="allOn",z&&"on"==z.ch1state&&"on"==z.ch2state&&(B="allOff")),
A.executeCommand(a,{value:B},l,d))})};k.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "ch1on":a={state:{functions:[{key:"channel",value:0},{key:"switch",value:"on"}]}};break;case "ch1off":a={state:{functions:[{key:"channel",value:0},{key:"switch",value:"off"}]}};break;case "ch2on":a={state:{functions:[{key:"channel",value:1},{key:"switch",value:"on"}]}};break;case "ch2off":a={state:{functions:[{key:"channel",value:1},{key:"switch",value:"off"}]}};break;case "allOn":a={state:{functions:[{key:"channel",
value:"all"},{key:"switch",value:"on"}]}};break;case "allOff":a={state:{functions:[{key:"channel",value:"all"},{key:"switch",value:"off"}]}};break;case "ch1query":a={state:{functions:[{key:"channel",value:0},{key:"query",value:"status"}]}};break;case "ch2query":a={state:{functions:[{key:"channel",value:1},{key:"query",value:"status"}]}};break;case "allQuery":a={state:{functions:[{key:"channel",value:"all"},{key:"query",value:"status"}]}}}return a};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;
a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&"switch"==d.key&&(a||(a={}),0==d.channel?a.ch1state=d.value:1==d.channel&&(a.ch2state=d.value))}return a};return{Version_0_9:new k}}(),w=function(){var k=function(){};k.prototype.getMap=function(){return{command:[{type:"int",name:"move to",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle to",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"move up",ref:{value:"moveUp"}},{type:"enum",
name:"move down",ref:{value:"moveDown"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"int",name:"position",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"locking mode",ref:{value:"lockingMode",options:["block","unblock"]}}],ipevt:[{type:"int",name:"position",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle",ref:{value:"angle",
ext:"%d",extMeta:"0-100"}},{type:"enum",name:"locking mode",ref:{value:"lockingMode",options:["block","unblock"]}}]}};k.prototype.executeCommand=function(a,b,l,d){b=this.getPutStateBody(a,b);if(!b)return!1;l.setDeviceState(a.deviceId,b,function(y){d&&d(y)});return!0};k.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "moveUp":a={state:{functions:[{key:"position",value:0},{key:"angle",value:0}]}};break;case "moveDown":a={state:{functions:[{key:"position",value:100},{key:"angle",
value:100}]}};break;case "position":if("undefined"==typeof b.ext||null==b.ext)return null;b=parseInt(b.ext);0>b&&(b=0);100<b&&(b=100);a={state:{functions:[{key:"position",value:b}]}};break;case "angle":if("undefined"==typeof b.ext||null==b.ext)return null;b=parseInt(b.ext);0>b&&(b=0);100<b&&(b=100);a={state:{functions:[{key:"angle",value:b}]}};break;case "stop":a={state:{functions:[{key:"stop",value:!0}]}};break;case "query":a={state:{functions:[{key:"query",value:"status"}]}}}return a};k.prototype.resolveState=
function(a,b){if(!b||!b.functions)return null;a=null;for(var l=0;l<b.functions.length;l++){var d=b.functions[l];if(d&&d.key)switch(d.key){case "buttonA0":a||(a={});switch(d.value){case "pressed":a.btnA0pressed=!0;break;case "released":a.btnA0released=!0}break;case "buttonAI":a||(a={});switch(d.value){case "pressed":a.btnAIpressed=!0;break;case "released":a.btnAIreleased=!0}break;case "buttonB0":a||(a={});switch(d.value){case "pressed":a.btnB0pressed=!0;break;case "released":a.btnB0released=!0}break;
case "buttonBI":a||(a={});switch(d.value){case "pressed":a.btnBIpressed=!0;break;case "released":a.btnBIreleased=!0}break;case "buttonC0":a||(a={});switch(d.value){case "pressed":a.btnC0pressed=!0;break;case "released":a.btnC0released=!0}break;case "buttonCI":a||(a={});switch(d.value){case "pressed":a.btnCIpressed=!0;break;case "released":a.btnCIreleased=!0}break;case "buttonD0":a||(a={});switch(d.value){case "pressed":a.btnD0pressed=!0;break;case "released":a.btnD0released=!0}break;case "buttonDI":a||
(a={});switch(d.value){case "pressed":a.btnDIpressed=!0;break;case "released":a.btnDIreleased=!0}break;default:a||(a={}),a[d.key]=d.value}}return a};return{Version_0_9:new k}}(),x=function(){var k=function(){};k.prototype.getMap=function(){return{status:[{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}}],ipevt:[{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}}]}};k.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var l=
0;l<b.functions.length;l++){var d=b.functions[l];d&&d.key&&(a||(a={}),a[d.key]=d.value)}return a};return{Version_0_9:new k}}();return{F6_02_01:n,F6_03_01:f,F6_05_01:h,F6_05_02:c,F6_10_00:g,A5_04_01:e,A5_07_03:m,A5_10_03:p,A5_20_01:r,A5_30_03:t,D2_01_01:q,D2_01_03:u,D2_01_11:v,D2_05_02:w,D5_00_01:x,getPorfile:function(k,a,b){k=k.replace(/-/g,"_").toUpperCase();a="Version_"+(a+"").replace(/\./g,"_");return b&&this[k]&&this[k][a+"_"+b]?this[k][a+"_"+b]:this[k]?this[k][a]:null}}}();
xnm.aio.enoceanip.IPClient=function(){var n=function(c,g,e){e=Error(e?e:"enocean ip error");e.code=c;e.httpStatus=g;return e},f=function(c,g,e){g=e?e:Error(g?g:"error");g.code=c;return g},h=function(c,g,e,m,p){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.enoceanip.IPClient");this._ip=c;this._port=g;this._username=e;this._password=m;this._useHttps=p;this._port||(this._port=8080)};h.prototype.getIP=function(){return this._ip};h.prototype.getPort=
function(){return this._port};h.prototype.toJSON=function(){return{ip:this._ip,port:this._port,username:this._username,password:this._password,useHttps:this._useHttps}};h.prototype.getSystemInfo=function(c){this._doEnoceanIPRequest("GET","/system/info",null,function(g,e){g?c&&c(g):e.systemInfo?c&&c(null,e.systemInfo):c&&c(n(-1,esponse.header.httpStatus,"invalid get system info response"))})};h.prototype.getProfiles=function(c){this._doEnoceanIPRequest("GET","/profiles",null,function(g,e){g?c&&c(g):
e.profiles?c&&c(null,e.profiles):c&&c(n(-1,esponse.header.httpStatus,"invalid get profiles response"))})};h.prototype.getProfileInfo=function(c,g,e){this._doEnoceanIPRequest("GET","/profiles/"+c+(g?"?version="+g:""),null,function(m,p){m?e&&e(m):p.profile?e&&e(null,p.profile):e&&e(n(-1,esponse.header.httpStatus,"invalid get profile info response"))})};h.prototype.getDevices=function(c){this._doEnoceanIPRequest("GET","/devices",null,function(g,e){g?c&&c(g):e.devices?c&&c(null,e.devices):c&&c(n(-1,esponse.header.httpStatus,
"invalid get devices response"))})};h.prototype.getDevicesStream=function(c,g,e,m){var p="/devices/stream";if(c||g||e)p+="?";c&&(p+="direction="+c+"&");g&&(p+="delimited="+g+"&");e&&(p+="output="+e+"&");return this._doEnoceanIPRequest("GET",p,null,function(r,t){r?m&&m(r):t.devices?m&&m(null,t.devices):m&&m(n(-1,esponse.header.httpStatus,"invalid get devices response"))},!0)};h.prototype.getDevicesStates=function(c){this._doEnoceanIPRequest("GET","/devices/states",null,function(g,e){g?c&&c(g):e.states?
c&&c(null,e.states):c&&c(n(-1,esponse.header.httpStatus,"invalid get devices states response"))})};h.prototype.getDevice=function(c,g){this._doEnoceanIPRequest("GET","/devices/"+c,null,function(e,m){e?g&&g(e):m.device?g&&g(null,m.device):g&&g(n(-1,esponse.header.httpStatus,"invalid get device response"))})};h.prototype.getDeviceProfile=function(c,g){this._doEnoceanIPRequest("GET","/devices/"+c+"/profile",null,function(e,m){e?g&&g(e):m.profile?g&&g(null,m.profile):g&&g(n(-1,esponse.header.httpStatus,
"invalid get device profile response"))})};h.prototype.getDeviceState=function(c,g){this._doEnoceanIPRequest("GET","/devices/"+c+"/state",null,function(e,m){e?g&&g(e):m.state?g&&g(null,m.state):g&&g(n(-1,esponse.header.httpStatus,"invalid get device state response"))})};h.prototype.setDeviceState=function(c,g,e){this._doEnoceanIPRequest("PUT","/devices/"+c+"/state",g,function(m,p){m?e&&e(m):e&&e(null)})};h.prototype._doEnoceanIPRequest=function(c,g,e,m,p){this._logger.log("debug","do EnoceanIP "+
c+" request with path:"+g+(e?" and json:"+JSON.stringify(e):""));var r=this;return this._doJSONRequest(c,g,null,e,function(t,q){r._logger.log("debug","get EnoceanIP response "+(t?"error:"+t.message:JSON.stringify(q)));if(t)m&&m(n(t.code,-1,t.message));else if(q.header){var u=q.header.httpStatus,v=q.header.code?q.header.code:0;200!=u&&202!=u&&(t=n(v,u,q.header.message));m&&m(t,q)}else m&&m(n(-1,-1,"enocean ip response has no 'header'"))},p)};h.prototype._doJSONRequest=function(c,g,e,m,p,r){var t=null;
m&&(t=JSON.stringify(m));return this._doRequest(c,g,e,t,function(q,u,v){if(q)p&&p(q);else if(q=v.statusCode,u)try{var w=JSON.parse(u);w?p&&p(null,w):p&&p(f(q,"invalid repsonse"))}catch(x){p&&p(f(q,null,x))}else p&&p(f(q,"repsonse body empty"))},r)};h.prototype._doRequest=function(c,g,e,m,p,r){c={host:this._ip,port:this._port,path:g,method:c,headers:{Connection:"close","Content-Type":"application/json"}};if(e)for(var t in e)e.hasOwnProperty(t)&&(c.headers[t]=e[t]);if(this._username||this._password)c.auth=
(this._username?this._username:"")+":"+(this._password?this._password:""),c.headers.Authorization="Basic "+(new Buffer((this._username?this._username:"")+":"+(this._password?this._password:""))).toString("base64");m&&(c.headers["Content-Length"]=m.length);e=require("http");this._useHttps&&(e=require("https"),"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"));this._logger.log("trace","do "+(this._useHttps?"HTTPS":"HTTP")+" request:"+JSON.stringify(xnm.aio.enoceanip.Util.clearHttpOptionForLog(c)));
var q=this,u=p,v={_headerListener:null,_chunkListener:null,on:function(x,k){"chunk"==x?this._chunkListener=k:"header"==x&&(this._headerListener=k)},emit:function(x,k){try{"chunk"==x&&this._chunkListener?this._chunkListener(k):"header"==x&&this._headerListener&&this._headerListener(k)}catch(a){}}},w=e.request(c,function(x){x.setEncoding("utf-8");v.emit("header",x);var k="";x.on("data",function(a){k+=a;v.emit("chunk",a)});x.on("end",function(){q._logger.log("trace","receive code:"+x.statusCode+" headers:"+
JSON.stringify(x.headers)+" response:"+k);u&&(u(null,k,x),u=null)})});if(w.on)w.on("error",function(x){q._logger.log("trace","do request error:"+x.message);u&&(u(f(-1,null,x)),u=null)});w.setTimeout&&(p=2E3,r&&(p=6E5),w.setTimeout(p,function(){q._logger.log("trace","do request timeout");w.abort();u&&(u(f(-2,"http timeout")),u=null)}));m&&(this._logger.log("trace","do request send body:"+m),w.write(m));w.end();return v};return h}();
xnm.aio.enoceanip.DCGW=function(){var n=function(f,h,c,g,e){xnm.aio.enoceanip.IPClient.call(this,f,h,c,g,e);this._logger=require("x.logger.js").getLogger("xnm.aio.enoceanip.DCGW")};n.prototype=new xnm.aio.enoceanip.IPClient;n.prototype.constructor=n;n.prototype.listDevices=function(f){this.getDevices(function(h,c){if(h)f&&f(h);else if(c&&0!=c.length){h=[];for(var g=0;g<c.length;g++)h.push({sys:"dcgw",deviceId:c[g].deviceId,friendlyId:c[g].friendlyId,manufacturer:c[g].manufacturer,location:c[g].location,
eeps:c[g].eeps});f&&f(null,h)}else f&&f(null,[])})};n.prototype.executeCommandCreator=function(f,h,c){if(f&&f.deviceId&&f.eeps&&0!=f.eeps.length)if(h&&h.value){for(var g=null,e=0;e<f.eeps.length;e++){var m=f.eeps[e];if((m=xnm.aio.enoceanip.IP_Profiles.getPorfile(m.eep,m.version,m.variation))&&m.executeCommand&&(g=m.executeCommand(f,h,this,c)))break}g||c&&c(Error("command unknown"))}else c&&c(Error("command json invalid"));else c&&c(Error("device json invalid"))};n.prototype.getStatesCreator=function(f,
h,c){if(h&&0!=h.length){var g=this;this.getDevicesStates(function(e,m){if(e)c&&c(e);else{e={};var p;for(p=0;p<m.length;p++){var r=m[p];if(r&&r.deviceId)for(var t=0;t<h.length;t++){var q=h[t];q&&q.device&&q.device.deviceId==r.deviceId&&(e[r.deviceId]||(e[r.deviceId]=g.resolveDeviceState(q.device,r)))}}m=[];for(p=0;p<h.length;p++)(q=h[p])&&q.id&&q.device&&q.device.deviceId&&q.status&&q.status.value&&e[q.device.deviceId]&&(r=e[q.device.deviceId][q.status.value],"undefined"!=typeof r&&null!=r&&m.push({id:q.id,
status:r}));c&&c(null,m)}})}else c&&c(null,[])};n.prototype.resolveDeviceState=function(f,h){if(!f||!f.eeps||0==f.eeps.length)return null;for(var c=null,g=0;g<f.eeps.length;g++){var e=f.eeps[g];if((e=xnm.aio.enoceanip.IP_Profiles.getPorfile(e.eep,e.version,e.variation))&&e.resolveState){var m=e.resolveState(f,h);if(m&&(e=void 0,null!=m&&"undefined"!=typeof m))if(null==c||"undefined"==typeof c)c=m;else for(e in m)m.hasOwnProperty(e)&&(c[e]=m[e])}}return c};n.prototype.toJSON=function(){return{sys:"dcgw",
ip:this._ip,port:this._port,username:this._username,password:this._password,useHttps:this._useHttps}};n.prototype.equalsTo=function(f){return f&&f instanceof n?this._ip==f._ip&&this._port==f._port&&this._username==f._username&&this._password==f._password:!1};n.parseJSON=function(f){return f.ip?new n(f.ip,f.port,f.username,f.password,f.useHttps):null};return n}();
xnm.aio.enoceanip.DCGW.DM=function(){var n=function(f,h){this.code=f;this.message=h;this.stack=Error().stack};n.prototype=Error();n.prototype.name="DCGWDMError";n.prototype.code=0;n.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"dcgw",getGatewayType:function(){return[{sys:this.SYS,name:"OPUS Gateway",port:8080}]},createGateway:function(f,h,c){h=n.ERROR_CODE;f?f.ip?c(null,f):c(new n(h.INVALID,"ip is invalid")):c(new n(h.INVALID,"info is invalid"))},
updateGateway:function(f,h,c,g){f=n.ERROR_CODE;h?h.ip?g(null,h):g(new n(f.INVALID,"ip is invalid")):g(new n(f.INVALID,"update is invalid"))},deleteGateway:function(f,h,c){c()},createDevice:function(f,h,c){var g=n.ERROR_CODE;if(f)if(f.gateway)if(f.deviceId){h=h.data.gateways;var e;for(e=0;e<h.length;e++)if(h[e].index===f.gateway){var m=h[e];break}m?c(null,f):c(new n(g.NOT_FOUND,"gateway with index "+f.gateway+" not exists"))}else c(new n(g.INVALID,"deviceId is invalid"));else c(new n(g.INVALID,"gateway is invalid"));
else c(new n(g.INVALID,"info is invalid"))},updateDevice:function(f,h,c){var g=n.ERROR_CODE;if(f)if(f.gateway)if(f.deviceId){h=h.data.gateways;var e;for(e=0;e<h.length;e++)if(h[e].index===f.gateway){var m=h[e];break}m?c(null,f):c(new n(g.NOT_FOUND,"gateway with index "+f.gateway+" not exists"))}else c(new n(g.INVALID,"deviceId is invalid"));else c(new n(g.INVALID,"gateway is invalid"));else c(new n(g.INVALID,"info is invalid"))},deleteDevice:function(f,h,c){c()},applyUIFilter:function(f,h){var c=
this,g=function(r,t,q){var u=[];r.forEach(function(v){if("root"==v.type){v=JSON.parse(JSON.stringify(v));var w=g(v.children,t,q);w&&0<w.length&&(v.children=w,u.push(v))}else{w=q.elems;if("*"==w)w=!0;else{for(var x=!1,k=0;k<w.length;k++)if(w[k]==v.type){x=!0;break}w=x}w&&(v=JSON.parse(JSON.stringify(v)),u.push(v))}});return u},e=function(r,t){var q=[],u=c.getCommandStatusMap(r);if(u){var v=[];switch(t.catagory){case "command":u.command&&(v=g(u.command,r,t));break;case "status":u.status&&(v=g(u.status,
r,t));break;case "ipevt":u.ipevt&&(v=g(u.ipevt,r,t))}q=q.concat(v)}return q};if(!f.sys)return null;var m=JSON.parse(JSON.stringify(f)),p=null;switch(h.catagory){case "command":p=e(f,h);m.command=p;break;case "status":p=e(f,h);m.status=p;break;case "ipevt":p=e(f,h);m.ipevt=p;break;default:return null}return p&&0!=p.length?m:null},applyIPEventFilter:function(f){return f?this.applyUIFilter(f,{catagory:"ipevt",elems:"*"}):null},getCommandStatusMap:function(f){if(!f||!f.eeps||0==f.eeps.length)return null;
for(var h={command:[],status:[],ipevt:[]},c=0;c<f.eeps.length;c++){var g=f.eeps[c],e=xnm.aio.enoceanip.IP_Profiles.getPorfile(g.eep,g.version,g.variation);e&&(e=e.getMap())&&("to"!=g.direction&&"both"!=g.direction||!e.command||(h.command=h.command.concat(e.command)),"from"==g.direction||"both"==g.direction)&&(e.status&&(h.status=h.status.concat(e.status)),e.ipevt&&(h.ipevt=h.ipevt.concat(e.ipevt)))}return h}}}();
xnm.aio.enoceanip.Handler=function(){var n=function(){};n.prototype.DCGW=xnm.aio.enoceanip.DCGW;n.prototype.devicemanager=xnm.aio.enoceanip.DCGW.DM;n.prototype.registModule=function(f){f.register(this.devicemanager.SYS,"enoceanip")};n.prototype.resolveGateway=function(f){return f?f.sys==this.devicemanager.SYS?this.DCGW.parseJSON(f):null:null};n.prototype.getDeviceCommands=function(f,h){if(!f)return null;var c;f.sys==this.devicemanager.SYS&&(c=this.devicemanager.applyUIFilter(f,{catagory:"command",
elems:"*"}));f=c?c.command:[];h&&h(null,f)};n.prototype.getDeviceStatus=function(f,h){if(!f)return null;var c;f.sys==this.devicemanager.SYS&&(c=this.devicemanager.applyUIFilter(f,{catagory:"status",elems:"*"}));f=c?c.status:[];h&&h(null,f)};n.prototype.doCommand=function(f,h,c,g){(f=this.resolveGateway(f))?f.executeCommandCreator(h,c,function(e){g&&g(e)}):g&&g(Error("gateway json format invalid"))};n.prototype.doStatus=function(f,h,c,g,e){(h=this.resolveGateway(h))?h.getStatesCreator(null,[{id:f,
device:c,status:g}],function(m,p){m?e&&e(m):e&&e(null,p[0])}):e&&e(Error("device json format invalid"))};n.prototype.resolveEvent=function(f,h,c){return(f=this.resolveGateway(f))?f.resolveDeviceState(h,c):null};n.prototype.getDeviceList=function(f,h){(f=this.resolveGateway(f))?f.listDevices(function(c,g){h&&h(c,g)}):h&&h(Error("gateway json format invalid"))};n.prototype.discover=function(f,h){var c=require("x.mdns.js");c.clearRecordBuffer();c.discoverServiceWithTimeout("_enocean._tcp.local",f,function(g,
e){if(g)h&&h(g);else{for(var m=[],p=0;p<e.length;p++){var r=e[p];if(r.target&&r.ip&&0<r.ip.length){var t=r.target.toLowerCase();if(-1!=t.indexOf("dcgw")||-1!=t.indexOf("opus"))r=new xnm.aio.enoceanip.DCGW(r.ip[0]),m.push(r)}}h&&h(g,m)}})};return n}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.enoceanip.Handler);

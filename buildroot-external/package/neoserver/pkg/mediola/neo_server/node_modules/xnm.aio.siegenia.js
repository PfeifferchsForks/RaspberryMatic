var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.siegenia=xnm.aio.siegenia||{};
xnm.aio.siegenia._Session=function(){var b=function(a){this._logger=require("x.logger.js").getLogger("xnm.aio.siegenia._Session");this.ip=a.ip;this.port=a.port;this.user=a.user;this.password=a.password;this._state=0;this._startCallbacks=[];this._autoClose=!1;this._idleTO=this._keepAliveIV=this._connectionTO=this._socket=null;this._reqID=0;this._requests=[];this._deviceParam=this._dataCallback=this._monitor=null};b.prototype.setDataCallback=function(a){this._dataCallback=a};b.prototype.start=function(a){if(this._state==
b.STATE.ESTABLISHED)a&&a(null,this);else if("undefined"!=typeof a&&null!=a&&-1==this._startCallbacks.indexOf(a)&&this._startCallbacks.push(a),this._state==b.STATE.IDLE){this._logger.log("trace","start session "+this.ip);var c=this;this._state=b.STATE.CONNECT;this._connect(function(d){if(d){c._state=b.STATE.IDLE;for(var e=0;e<c._startCallbacks.length;e++){var f=c._startCallbacks[e];f&&f(d)}c._startCallbacks=[]}else c._state=b.STATE.LOGIN,c._login(function(g){var h=c._startCallbacks;c._startCallbacks=
[];g?c.stop():(c._state=b.STATE.ESTABLISHED,c._keepAliveIV=setInterval(function(){c._keepAlive()},5E3),c._autoClose&&(c._idleTO=setTimeout(function(){c.stop()},6E4)));for(var k=0;k<h.length;k++){var l=h[k];l&&l(g)}})})}};b.prototype.stop=function(a){this._state!=b.STATE.IDLE&&(this._logger.log("trace","stop session "+this.ip),this._onSessionClose());a&&a()};b.prototype.send=function(a,c){if(this._autoClose&&this._idleTO){var d=this;clearTimeout(this._idleTO);this._idleTO=setTimeout(function(){d.stop()},
6E4)}this._logger.log("trace","send data:"+JSON.stringify(a)+" to "+this.ip);this._sendReq(a,c)};b.prototype._connect=function(a){var c=this,d=a;this._connectionTO=setTimeout(function(){d&&(d(Error("connection timeout")),d=null)},2E3);var e=require("websocket").createWebSocket("wss://"+this.ip+"/WebSocket");e.onclose=function(){d?(c._connectionTO&&(clearTimeout(c._connectionTO),c._connectionTO=null),d(Error("connection failed")),d=null):c._onWsClose()};e.onerror=function(f){d?(clearTimeout(c._connectionTO),
c._connectionTO=null,d(Error(f)),d=null):c._onWsError(Error(f))};e.onmessage=function(f){c._onWsData(f)};e.onopen=function(){c._socket=e;c._connectionTO&&(clearTimeout(c._connectionTO),c._connectionTO=null);d&&(d(),d=null)};e.open()};b.prototype._login=function(a){var c=this;this._state=b.STATE.LOGIN;this._logger.log("trace","login with user:"+this.user+" password:"+this.password);this._sendReq({command:"login",user:this.user,password:this.password,long_life:!0},function(d,e){d?(c._logger.log("warn",
"login error:"+d.message),a&&a(d)):e&&"ok"==e.status?a&&a():(c._logger.log("warn","login failed:"+(e?e.status:"login response invalid")),d=Error(e?e.status:"login response invalid"),d.code=401,a&&a(d))})};b.prototype._keepAlive=function(a){this._sendReq({id:512,command:"keepAlive",extend_session:!1},function(c,d){})};b.prototype._sendReq=function(a,c){a.id||(this._reqID++,512<=this._reqID&&(this._reqID=1),a.id=this._reqID);var d=this,e={req:a,callback:c,to:setTimeout(function(){var f=d._requests.indexOf(e);
-1!=f&&d._requests.splice(f,1);c(Error("request timeout"))},2E3)};this._requests.push(e);this._socket.sendJSON(a)};b.prototype._onSessionClose=function(a){if(this._state!=b.STATE.IDLE){this._logger.log("trace","session closed "+this.ip);this._state=b.STATE.IDLE;a||(a=Error("session stopped"));this._socket&&(this._socket.close(),this._socket=null);this._connectionTO&&(clearTimeout(this._connectionTO),this._connectionTO=null);this._keepAliveIV&&(clearInterval(this._keepAliveIV),this._keepAliveIV=null);
var c;if(this._startCallbacks){var d=this._startCallbacks;this._startCallbacks=[];for(c=0;c<d.length;c++){var e=d[c];e&&e(a)}}if(this._requests)for(d=this._requests,this._requests=[],c=0;c<d.length;c++)if(e=d[c])e.to&&clearTimeout(e.to),e.callback&&e.callback(a);this._deviceParam=this._dataCallback=null;if("undefined"!=typeof this._monitor&&null!=this._monitor)this._monitor.onClose()}};b.prototype._onWsData=function(a){this._logger.log("trace","receive data:"+a+" from "+this.ip);try{var c=JSON.parse(a);
if(c){a=-1;for(var d=null,e=0;e<this._requests.length;e++){var f=this._requests[e];f&&f.req&&f.req.id==c.id&&("getDeviceParams"==f.req.command&&(this._deviceParam=c.data),d=f.callback,a=e,f.to&&clearTimeout(f.to))}-1!=a&&this._requests.splice(a,1);"update"==c.status&&"deviceParams"==c.command&&c.data&&(this._deviceParam||(this._deviceParam={}),this._deepMerge(this._deviceParam,c.data));if("undefined"!=typeof this._monitor&&null!=this._monitor&&this._state==b.STATE.ESTABLISHED&&512!=c.id)this._monitor.onData(c,
this._deviceParam);d&&d(null,c);this._state==b.STATE.ESTABLISHED&&512!=c.id&&this._dataCallback&&this._dataCallback(c,this._deviceParam)}}catch(g){}};b.prototype._onWsError=function(a){this._logger.log("warn","websocket "+this.ip+" error:"+(a?a.message:""));this._onSessionClose(a)};b.prototype._onWsClose=function(){this._logger.log("trace","websocket "+this.ip+" closed");this._socket=null;this._onSessionClose(Error("socket closed"))};b.prototype._deepMerge=function(a,c){if(!a)return c;if(!c)return a;
for(var d in c)c.hasOwnProperty(d)&&(this._isObject(c[d])?this._deepMerge(a[d],c[d]):a[d]=c[d]);return a};b.prototype._isObject=function(a){return a&&"object"===typeof a&&!Array.isArray(a)};b.STATE={IDLE:0,CONNECT:1,LOGIN:2,ESTABLISHED:3};return b}();
xnm.aio.siegenia._SessionMonitor=function(){var b=function(a){this._logger=require("x.logger.js").getLogger("xnm.aio.siegenia._SessionMonitor");this._device=a;this._callbacks=[];this._session=null;this._running=!1;this._autoRestartTO=null};b.prototype.addCallback=function(a){a&&-1==this._callbacks.indexOf(a)&&this._callbacks.push(a)};b.prototype.start=function(a){if(this._autoRestartTO)this._logger.log("trace","start monitor (restarting):"+this._device.ip),a&&a();else{this._logger.log("trace","start monitor:"+
this._device.ip);var c=this;this._running=!0;xnm.aio.siegenia._SessionManager.startSession(this._device,function(d,e){d?(c._session=null,c._logger.log("warn","start monitor "+c._device.ip+" error:"+d.message+" code:"+d.code),c._running?(c._restart(d.code?120:30),a&&a(null,c)):a&&a(d)):(c._session=e,c._session._monitor=c,c._session.send({command:"getDeviceParams"},function(){}),a&&a(null,c))})}};b.prototype.stop=function(a){this._logger.log("trace","stop monitor:"+this._device.ip);this._autoRestartTO&&
(clearTimeout(this._autoRestartTO),this._autoRestartTO=null);this._running=!1;var c=xnm.aio.siegenia._SessionManager.getSession(this._device.ip);c?(c._monitor=null,c.stop(function(){a&&a()})):a&&a()};b.prototype._restart=function(a){this._logger.log("trace","restart monitor "+this._device.ip+" in "+a+"sec");var c=this;this._autoRestartTO=setTimeout(function(){c._running&&(c._logger.log("trace","restart monitor "+c._device.ip),c._autoRestartTO=null,c.start())},1E3*a)};b.prototype.onClose=function(){this._session=
null;this._running&&this._restart()};b.prototype.onData=function(a,c){this._logger.log("trace","receive data:"+JSON.stringify(a));for(var d=0;d<this._callbacks.length;d++)this._callbacks[d](a,c)};return b}();
xnm.aio.siegenia._SessionManager={_sessions:{},_monitors:{},getSession:function(b){return this._sessions[b]},setSession:function(b,a){this._sessions[b]=a},startSession:function(b,a){if(b&&b.ip){var c=b.ip,d=this.getSession(c);if("undefined"==typeof d||null==d)d=new xnm.aio.siegenia._Session(b),this.setSession(c,d);d.start(function(e){a&&a(e,d)})}else a&&a(Error("ws device invalid"))},stopSession:function(b,a){b&&b.ip?(b=this.getSession(b.ip),("undefined"==typeof b||null==b)&&a&&a(),b.stop(function(c){a&&
a(c)})):a&&a(Error("ws device invalid"))},startMonitorSession:function(b,a,c){if(b&&b.ip){var d=b.ip;if(this._monitors[d])this._monitors[d].addCallback(a);else{b=new xnm.aio.siegenia._SessionMonitor(b);b.addCallback(a);var e=this;b.start(function(f,g){f?c&&c(f):e._monitors[d]=g})}}else c&&c(Error("ws device invalid"))},stopMonitorSession:function(b,a){console.log("=======>","stop monitor session");if(b&&b.ip){var c=b.ip;if(this._monitors[c]){var d=this;this._monitors[c].stop(function(){d._monitors[c]=
null;a&&a()})}else a&&a()}else a&&a(Error("ws device invalid"))}};xnm.aio.siegenia._IQONTROLStateCallbacks={};
xnm.aio.siegenia.WSDevice=function(){var b=function(){this.ip=null;this.port=443;this.user="user";this.password="0000";this._serial=this._subvariant=this._variant=this._type=this._data=null};b.prototype.CONNECTION_ERROR=513;b.prototype.connect=function(a){var c=this;xnm.aio.siegenia._SessionManager.startSession(this,function(d,e){d?a&&a(d):(c._session=e,a&&a(null,e))})};b.prototype.send=function(a,c,d){a?a.send(c,function(e,f){e?d&&d(e):f&&"ok"==f.status?d&&d(null,f.data):d&&d(Error(f?f.status:"response invalid"))}):
d&&d(Error("session invalid"))};b.prototype.disconnect=function(a){xnm.aio.siegenia._SessionManager.stopSession(this,function(c){a&&a(c)})};b.prototype.startMonitoring=function(a,c){var d=this;xnm.aio.siegenia._SessionManager.startMonitorSession(this,function(e,f){(e=d._resolveData(e,f))&&a(e)},function(e){c&&c(e)})};b.prototype._resolveData=function(a,c){var d=null;a&&512!=a.id&&a.data&&!a.data.token&&c&&(d=this.computeStates(c));return d};b.prototype.toJSON=function(){return{sys:"siegenia",ip:this.ip,
port:this.port,username:this.user,password:this.password,data:this._data,type:this._type,variant:this._variant,subvariant:this._subvariant,serial:this._serial}};b.prototype.equalsTo=function(a){return a&&a instanceof xnm.aio.siegenia.WSDevice?this.ip==a.ip&&this.port==a.port:!1};return b}();
xnm.aio.siegenia.Genius=function(b,a,c,d,e){this.ip=b;a&&(this.user=a);c&&(this.password=c);e&&(this.port=e);this.type="B";d&&(this.type=d);var f=this;this._dataCallback=function(g,h){g=f._resolveData(g,h);h=xnm.aio.siegenia._IQONTROLStateCallbacks[f.ip];g&&h&&h.id&&h.ch&&f._doStateCallback(h.id,h.ch,g)}};xnm.aio.siegenia.Genius.prototype=new xnm.aio.siegenia.WSDevice;xnm.aio.siegenia.Genius.prototype.constructor=xnm.aio.siegenia.Genius;xnm.aio.siegenia.Genius.prototype.CMD_GETDEVICE=256;
xnm.aio.siegenia.Genius.prototype.CMD_KEEPALIVE=257;xnm.aio.siegenia.Genius.prototype.CMD_GETPARAMS=258;xnm.aio.siegenia.Genius.prototype.CMD_OPEN=259;xnm.aio.siegenia.Genius.prototype.CMD_CLOSE=260;xnm.aio.siegenia.Genius.prototype.CMD_SETDAYMODE=261;xnm.aio.siegenia.Genius.prototype.CMD_SETNIGHTMODE=262;xnm.aio.siegenia.Genius.prototype.CMD_IMPULSE_ON=263;xnm.aio.siegenia.Genius.prototype.CMD_IMPULSE_OFF=264;xnm.aio.siegenia.Genius.prototype.CMD_SETIMPULSE=265;
xnm.aio.siegenia.Genius.prototype.CMD_SETTIMER=266;xnm.aio.siegenia.Genius.prototype.CMD_POSITION1=267;xnm.aio.siegenia.Genius.prototype.CMD_POSITION2=268;xnm.aio.siegenia.Genius.prototype.CMD_LOCK=269;xnm.aio.siegenia.Genius.prototype.CMD_STOPTIMER=270;xnm.aio.siegenia.Genius.prototype.CMD_STOP=271;xnm.aio.siegenia.Genius.prototype.CMD_STARTTIMER=272;xnm.aio.siegenia.Genius.prototype.CMD_WING1_OPEN=273;xnm.aio.siegenia.Genius.prototype.CMD_WING1_CLOSE=274;
xnm.aio.siegenia.Genius.prototype.CMD_WING1_POSITION1=275;xnm.aio.siegenia.Genius.prototype.CMD_WING1_POSITION2=276;xnm.aio.siegenia.Genius.prototype.CMD_WING1_STOP=277;xnm.aio.siegenia.Genius.prototype.CMD_WING1_LOCK=278;xnm.aio.siegenia.Genius.prototype.CMD_WING2_OPEN=279;xnm.aio.siegenia.Genius.prototype.CMD_WING2_CLOSE=280;xnm.aio.siegenia.Genius.prototype.CMD_WING2_STOP=281;xnm.aio.siegenia.Genius.prototype.CMD_WING2_LOCK=282;xnm.aio.siegenia.Genius.prototype.CMD_SET_STOPOVER=288;
xnm.aio.siegenia.Genius.prototype.CMD_OPEN_TO_TURN=289;xnm.aio.siegenia.Genius.prototype.CMD_SILENT_ON=290;xnm.aio.siegenia.Genius.prototype.CMD_SILENT_OFF=291;
xnm.aio.siegenia.Genius.prototype.execute=function(b,a,c){var d=this,e=null;if(b==this.CMD_KEEPALIVE)e={command:"keepAlive",extend_session:!1};else if(b==this.CMD_GETDEVICE)e={command:"getDevice"};else if(b==this.CMD_GETPARAMS)e={command:"getDeviceParams"};else if(b==this.CMD_OPEN)e={command:"setDeviceParams"},e.params="axxentDK"==this.type?{openclose:"OPEN"}:"axxentHSA"==this.type?{openclose:{0:"OPEN"}}:"axxentHSA2"==this.type?{openclose:{0:"OPEN",1:"OPEN"}}:{relais1:!0};else if(b==this.CMD_CLOSE)if(e=
{command:"setDeviceParams"},"axxentDK"==this.type)e.params={openclose:"CLOSE"};else if("axxentHSA"==this.type)e.params={openclose:{0:"CLOSE_WO_LOCK"}};else{if("axxentHSA2"==this.type){this.execute(this.CMD_WING1_CLOSE,null,function(h,k){h?c&&c(h,k):d.execute(d.CMD_WING2_CLOSE,null,function(l,m){c&&c(l,m)})});return}e.params="mh10"==this.type?{relais2:!0}:{relais1:!1}}else if(b==this.CMD_OPEN_TO_TURN)e={command:"setDeviceParams"},"axxentDK"==this.type&&(e.params={openclose:"OPEN_TO_TURN"});else if(b==
this.CMD_STOP)e={command:"setDeviceParams",params:{stop:!0}},"axxentHSA"==this.type&&(e.params={stop:{0:"true"}}),"axxentHSA2"==this.type&&(e.params={stop:{0:"true",1:"true"}});else if(b==this.CMD_LOCK){if(e={command:"setDeviceParams",params:{openclose:"CLOSE"}},"axxentHSA"==this.type||"axxentHSA2"==this.type)e.params={openclose:{0:"CLOSE"}}}else if(b==this.CMD_POSITION1)e={command:"setDeviceParams",params:{openclose:{0:"STOP_OVER"}}};else if(b==this.CMD_POSITION2)e={command:"setDeviceParams",params:{openclose:{0:"GAP_VENT"}}};
else if(b==this.CMD_SETDAYMODE)e={command:"setDeviceParams",params:{relais2:!0}};else if(b==this.CMD_SETNIGHTMODE)e={command:"setDeviceParams",params:{relais2:!1}};else if(b==this.CMD_IMPULSE_ON)e={command:"setDeviceParams",params:{impulse:!0}};else if(b==this.CMD_IMPULSE_OFF)e={command:"setDeviceParams",params:{impulse:!1}};else if(b==this.CMD_SETIMPULSE)e={command:"setDeviceParams",params:{impulseduration:a}};else if(b==this.CMD_SETTIMER){b=a.indexOf(":");var f=0,g=a;-1!=b&&(f=a.substr(0,b),g=a.substr(b+
1));f=parseInt(f);g=parseInt(g);e={command:"setDeviceParams",params:{timer:{duration:{hour:f,minute:g}}}}}else b==this.CMD_STOPTIMER?e={command:"setDeviceParams",params:{timer:{enabled:!1}}}:b==this.CMD_STARTTIMER?e={command:"setDeviceParams",params:{timer:{enabled:!0}}}:b==this.CMD_WING1_OPEN?e={command:"setDeviceParams",params:{openclose:{0:"OPEN"}}}:b==this.CMD_WING1_CLOSE?e={command:"setDeviceParams",params:{openclose:{0:"CLOSE_WO_LOCK"}}}:b==this.CMD_WING1_STOP?e={command:"setDeviceParams",params:{stop:{0:!0}}}:
b==this.CMD_WING1_POSITION1?e={command:"setDeviceParams",params:{openclose:{0:"STOP_OVER"}}}:b==this.CMD_WING1_POSITION2?e={command:"setDeviceParams",params:{openclose:{0:"GAP_VENT"}}}:b==this.CMD_WING1_LOCK?e={command:"setDeviceParams",params:{openclose:{0:"CLOSE"}}}:b==this.CMD_WING2_OPEN?e={command:"setDeviceParams",params:{openclose:{1:"OPEN"}}}:b==this.CMD_WING2_CLOSE?e={command:"setDeviceParams",params:{openclose:{1:"CLOSE_WO_LOCK"}}}:b==this.CMD_WING2_STOP?e={command:"setDeviceParams",params:{stop:{1:!0}}}:
b==this.CMD_WING2_LOCK?e={command:"setDeviceParams",params:{openclose:{1:"CLOSE"}}}:b==this.CMD_SET_STOPOVER?(f=Math.round(parseInt(a)/10),3>f&&(f=3),e={command:"setDeviceParams",params:{stopover:f}}):b==this.CMD_SILENT_ON?e={command:"setDeviceParams",params:{silent_state:!0}}:b==this.CMD_SILENT_OFF&&(e={command:"setDeviceParams",params:{silent_state:!1}});e?(d=this,this.connect(function(h,k){h?(h.code=d.CONNECTION_ERROR,c&&c(h)):(k.setDataCallback(d._dataCallback),d.send(k,e,function(l,m){setTimeout(function(){c&&
c(l,m)},250)}))})):c&&c(Error("no such command"))};xnm.aio.siegenia.Genius.prototype.getDevice=function(b){this.execute(this.CMD_GETDEVICE,null,function(a,c){b&&b(a,c)})};xnm.aio.siegenia.Genius.prototype.getState=function(b){this.execute(this.CMD_GETPARAMS,null,function(a,c){b&&b(a,c)})};
xnm.aio.siegenia.Genius.prototype.executeCommand=function(b,a,c){var d=b=null;"keepAlive"==a?b=this.CMD_KEEPALIVE:"nightmode"==a?b=this.CMD_SETNIGHTMODE:"daymode"==a?b=this.CMD_SETDAYMODE:"open"==a?b=this.CMD_OPEN:"close"==a?b=this.CMD_CLOSE:"open_to_turn"==a?b=this.CMD_OPEN_TO_TURN:"stop"==a?b=this.CMD_STOP:"position1"==a?b=this.CMD_POSITION1:"position2"==a?b=this.CMD_POSITION2:"lock"==a?b=this.CMD_LOCK:"impulseOn"==a?b=this.CMD_IMPULSE_ON:"impulseOff"==a?b=this.CMD_IMPULSE_OFF:"startTimer"==a?b=
this.CMD_STARTTIMER:"stopTimer"==a?b=this.CMD_STOPTIMER:"setImpulse"==a.substr(0,10)?(a=a.replace(/setImpulse/g,""),b=this.CMD_SETIMPULSE,d=parseInt(a),0>d?d=0:86400<d&&(d=86400)):"wing1open"==a?b=this.CMD_WING1_OPEN:"wing1close"==a?b=this.CMD_WING1_CLOSE:"wing1stop"==a?b=this.CMD_WING1_STOP:"wing1lock"==a?b=this.CMD_WING1_LOCK:"wing1position1"==a?b=this.CMD_WING1_POSITION1:"wing1position2"==a?b=this.CMD_WING1_POSITION2:"wing2open"==a?b=this.CMD_WING2_OPEN:"wing2close"==a?b=this.CMD_WING2_CLOSE:"wing2stop"==
a?b=this.CMD_WING2_STOP:"wing2lock"==a?b=this.CMD_WING2_LOCK:"silentOn"==a?b=this.CMD_SILENT_ON:"silentOff"==a?b=this.CMD_SILENT_OFF:"setTimer"==a.substr(0,8)?(b=this.CMD_SETTIMER,d=a=a.replace(/setTimer/g,"")):"setStopover"==a.substr(0,11)&&(b=this.CMD_SET_STOPOVER,d=a=a.replace(/setStopover/g,""));b?this.execute(b,d,function(e,f){c(e,f)}):c&&c()};
xnm.aio.siegenia.Genius.prototype.computeStates=function(b){var a={};"mh10"==this.type&&(1==b.relais1?a.state="open":1==b.relais2&&(a.state="closed"));"mh10"!=this.type&&(0==b.relais1?a.state="closed":1==b.relais1&&(a.state="open"));if("axxentDK"==this.type)a.state="OPEN"==b.state?"open":"CLOSED"==b.state?"closed":"MOVING"==b.state?"moving":b.state.toLowerCase(),a.silent_state=1==b.silent_state?"on":"off";else if("axxentHSA"==this.type&&b.states)switch(b.states["0"]){case "OPEN":a.state="open";break;
case "CLOSED_WO_LOCK":a.state="closed";break;case "CLOSED":a.state="locked";break;case "GAP_VENT":a.state="gap";break;case "STOP_OVER":a.state="stopover";break;case "STOPPED":a.state="stop";break;case "MOVING":a.state="moving"}else if("axxentHSA2"==this.type&&b.states){switch(b.states["0"]){case "OPEN":a.wing1state="open";break;case "CLOSED_WO_LOCK":a.wing1state="closed";break;case "CLOSED":a.wing1state="locked";break;case "GAP_VENT":a.wing1state="gap";break;case "STOP_OVER":a.wing1state="stopover";
break;case "STOPPED":a.wing1state="stop";break;case "MOVING":a.wing1state="moving"}switch(b.states["1"]){case "OPEN":a.wing2state="open";break;case "CLOSED_WO_LOCK":a.wing2state="closed";break;case "CLOSED":a.wing2state="locked";break;case "GAP_VENT":a.wing2state="gap";break;case "STOP_OVER":a.wing2state="stopover";break;case "STOPPED":a.wing2state="stop";break;case "MOVING":a.wing2state="moving"}}else"B"==this.type&&(1==b.relais2?a.mode="day":0==b.relais2&&(a.mode="night"),"night"==a.mode&&"closed"==
a.state&&(a.state="locked"));"undefined"!=typeof b.stopover&&null!=b.stopover&&(a.stopover=10*parseInt(b.stopover));a.maxStopover=b.max_stopover;b.timer&&(1==b.timer.enabled?a.timerEnabled="enabled":0==b.timer.enabled&&(a.timerEnabled="disabled"),b.timer.duration&&(a.duration=(10>b.timer.duration.hour?"0":"")+b.timer.duration.hour+":"+(10>b.timer.duration.minute?"0":"")+b.timer.duration.minute,a.durationM=60*parseInt(b.timer.duration.hour)+parseInt(b.timer.duration.minute)),b.timer.remainingtime&&
(a.remainingTime=(10>b.timer.remainingtime.hour?"0":"")+b.timer.remainingtime.hour+":"+(10>b.timer.remainingtime.minute?"0":"")+b.timer.remainingtime.minute,a.remainingTimeM=60*parseInt(b.timer.remainingtime.hour)+parseInt(b.timer.remainingtime.minute)));"mh10"!=this.type&&(1==b.impulse?a.impulse="enabled":0==b.impulse&&(a.impulse="disabled"),void 0!=b.impulseduration&&(a.impulseduration=b.impulseduration));b.warnings&&(a.warnings=b.warnings);return a};
xnm.aio.siegenia.Genius.prototype.getStates=function(b,a,c){var d=this;a&&a.id&&b&&(xnm.aio.siegenia._IQONTROLStateCallbacks[this.ip]={id:a?a.id:null,ch:b});this.getState(function(e,f){var g=null;e?g={error:e.message}:f&&(g=d.computeStates(f));g&&d._doStateCallback(a?a.id:null,b,g);c&&g&&c(g)})};xnm.aio.siegenia.Genius.prototype.getStateValues=function(b){return b};
xnm.aio.siegenia.Genius.prototype._doStateCallback=function(b,a,c){c.error||(c.error="");if(b&&a&&a.setState){c.state&&a.setState(b,c.state);for(var d in c)"state"!=d&&"warnings"!=d?a.setState(b+":"+d,c[d]):"warnings"==d&&c[d]&&a.setState(b+":warnings",c[d].toString())}else a&&a.receivedState&&a.receivedState("siegenia",this.ip,c)};
xnm.aio.siegenia.Genius.prototype.executeCommandCreator=function(b,a,c){if(a&&a.value){var d=a.value;switch(d){case "setImpulse":case "setTimer":case "setStopover":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("command ext invalid"));return}d+=a.ext}this.executeCommand(b,d,function(e){c&&c(e)})}else c&&c(Error("command value is empty"))};
xnm.aio.siegenia.Genius.prototype.getStatesCreator=function(b,a,c){var d=this;this._getState(function(e,f){if(f){var g=null;e?g={error:e.message}:f&&(g=d.computeStates(f));e=[];for(f=0;f<a.length;f++){var h=a[f];if(h&&h.id&&h.status&&h.status.value){var k=g[h.status.value];"undefined"!=typeof k&&null!=k&&e.push({id:h.id,status:k})}}c&&c(null,e)}else c&&c(Error("get state error"))})};
xnm.aio.siegenia.Genius.prototype.getSingleDeviceStatesCreator=function(b,a,c,d){var e=this;this._getState(function(f,g){if(g){var h=null;f?h={error:f.message}:g&&(h=e.computeStates(g));d&&d(null,h)}else d&&d(Error("get state error"))})};xnm.aio.siegenia.Genius.prototype._getState=function(b){var a=this;this.connect(function(c,d){c?(c.code=a.CONNECTION_ERROR,b&&b(c)):d&&d._deviceParam?b&&b(null,d._deviceParam):a.send(d,{command:"getDeviceParams"},function(e,f){setTimeout(function(){b&&b(e,f)},250)})})};
xnm.aio.siegenia.AEROPAC=function(b,a,c,d,e){this.ip=b;a&&(this.user=a);c&&(this.password=c);e&&(this.port=e);this.type="aeropac";d&&(this.type=d);this.CommandHandler=null;var f=this;this._dataCallback=function(g,h){g=f._resolveData(g,h);h=xnm.aio.siegenia._IQONTROLStateCallbacks[f.ip];g&&h&&h.id&&h.ch&&f._doStateCallback(h.id,h.ch,g)}};xnm.aio.siegenia.AEROPAC.prototype=new xnm.aio.siegenia.WSDevice;xnm.aio.siegenia.AEROPAC.prototype.constructor=xnm.aio.siegenia.Genius;
xnm.aio.siegenia.AEROPAC.prototype.CMD_KEEPALIVE=257;xnm.aio.siegenia.AEROPAC.prototype.CMD_GETPARAMS=258;xnm.aio.siegenia.AEROPAC.prototype.CMD_GETSTATE=259;xnm.aio.siegenia.AEROPAC.prototype.CMD_ON=260;xnm.aio.siegenia.AEROPAC.prototype.CMD_OFF=261;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANLEVEL=262;xnm.aio.siegenia.AEROPAC.prototype.CMD_AUTOMODE_ON=263;xnm.aio.siegenia.AEROPAC.prototype.CMD_AUTOMODE_OFF=264;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANPOWER=265;
xnm.aio.siegenia.AEROPAC.prototype.CMD_SETAUTOFANPOWER=266;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_IN=267;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_OUT=268;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_INOUT=269;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETFANMODE_INOUT_WRG=270;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETSENSORSENSITIVITY=271;xnm.aio.siegenia.AEROPAC.prototype.CMD_SETTIMER=272;xnm.aio.siegenia.AEROPAC.prototype.CMD_STOPTIMER=273;
xnm.aio.siegenia.AEROPAC.prototype.CMD_STARTTIMER=274;xnm.aio.siegenia.AEROPAC.prototype.CMD_SET_DAILYTIMER=275;xnm.aio.siegenia.AEROPAC.prototype.CMD_START_DAILYTIMER=276;xnm.aio.siegenia.AEROPAC.prototype.CMD_STOP_DAILYTIMER=277;xnm.aio.siegenia.AEROPAC.prototype.CMD_LEDS_ON=278;xnm.aio.siegenia.AEROPAC.prototype.CMD_LEDS_OFF=279;xnm.aio.siegenia.AEROPAC.prototype.CMD_ADD_TIMER=280;xnm.aio.siegenia.AEROPAC.prototype.CMD_DELETE_TIMER=281;xnm.aio.siegenia.AEROPAC.prototype.CMD_UPDATE_TIMER=288;
xnm.aio.siegenia.AEROPAC.prototype.execute=function(b,a,c){var d=null;if(b==this.CMD_KEEPALIVE)d={command:"keepAlive",extend_session:!1};else if(b==this.CMD_GETPARAMS)d={command:"getDeviceParams"};else if(b==this.CMD_GETSTATE)d={command:"getDeviceState"};else if(b==this.CMD_ON)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!0}}};else if(b==this.CMD_OFF)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!1}}};else if(b==this.CMD_LEDS_ON)d={command:"setDeviceParams",params:{leds:!0}};
else if(b==this.CMD_LEDS_OFF)d={command:"setDeviceParams",params:{leds:!1}};else if(b==this.CMD_SETFANLEVEL)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!0},fanlevel:a}};else if(b==this.CMD_SETFANPOWER)d={command:"setDeviceParams",params:{devicestate:{deviceactive:!0},fanpower:a}};else if(b==this.CMD_SETAUTOFANPOWER)d={command:"setDeviceParams",params:{automode_maxairflow:a}};else if(b==this.CMD_SETSENSORSENSITIVITY)d={command:"setDeviceParams",params:{automode_co2sensity:a}};else if(b==
this.CMD_AUTOMODE_ON)d={command:"setDeviceParams",params:{automode:!0}};else if(b==this.CMD_AUTOMODE_OFF)d={command:"setDeviceParams",params:{automode:!1}};else if(b==this.CMD_SETFANMODE_IN)d={command:"setDeviceParams",params:{fanmode:"IN"}};else if(b==this.CMD_SETFANMODE_OUT)d={command:"setDeviceParams",params:{fanmode:"OUT"}};else if(b==this.CMD_SETFANMODE_INOUT)d={command:"setDeviceParams",params:{fanmode:"IN_OUT"}};else if(b==this.CMD_SETFANMODE_INOUT_WRG)d={command:"setDeviceParams",params:{fanmode:"IN_OUT_WRG"}};
else if(b==this.CMD_SETTIMER){b=-1;var e=a,f=0;a.indexOf&&(b=a.indexOf(":"));-1!=b&&(e=a.substr(0,b),f=a.substr(b+1));e=parseInt(e);f=parseInt(f);d={command:"setDeviceParams",params:{timer:{duration:{hour:e,minute:f}}}}}else b==this.CMD_STOPTIMER?d={command:"setDeviceParams",params:{timer:{enabled:!1}}}:b==this.CMD_STARTTIMER?d={command:"setDeviceParams",params:{timer:{enabled:!0}}}:b==this.CMD_SET_DAILYTIMER?(b=a.indexOf(":"),e=a,f=0,-1!=b&&(e=a.substr(0,b),f=a.substr(b+1)),e=parseInt(e),f=parseInt(f),
d={command:"setDeviceParams",params:{timer:{poweron_time:{hour:e,minute:f}}}}):b==this.CMD_START_DAILYTIMER?d={command:"setDeviceParams",params:{timer:{repeat:!0}}}:b==this.CMD_STOP_DAILYTIMER?d={command:"setDeviceParams",params:{timer:{repeat:!1}}}:b==this.CMD_ADD_TIMER?d={command:"setDeviceParams",params:{timer:a}}:b==this.CMD_DELETE_TIMER?d={command:"setDeviceParams",params:{timer:a}}:b==this.CMD_UPDATE_TIMER&&(d={command:"setDeviceParams",params:{timer:a}});if(d){var g=this;this.connect(function(h,
k){h?(h.code=g.CONNECTION_ERROR,c&&c(h)):(k.setDataCallback(g._dataCallback),g.send(k,d,function(l,m){setTimeout(function(){c&&c(l,m)},250)}))})}else c&&c(Error("no such command"))};xnm.aio.siegenia.AEROPAC.prototype.getState=function(b){this.execute(this.CMD_GETPARAMS,null,function(a,c){b&&b(a,c)})};
xnm.aio.siegenia.AEROPAC.prototype.executeCommand=function(b,a,c){var d=b=null;"keepAlive"==a?b=this.CMD_KEEPALIVE:"on"==a?b=this.CMD_ON:"off"==a?b=this.CMD_OFF:"ledsOn"==a?b=this.CMD_LEDS_ON:"ledsOff"==a?b=this.CMD_LEDS_OFF:"automodeOn"==a?b=this.CMD_AUTOMODE_ON:"automodeOff"==a?b=this.CMD_AUTOMODE_OFF:"fanmodeIn"==a?b=this.CMD_SETFANMODE_IN:"fanmodeOut"==a?b=this.CMD_SETFANMODE_OUT:"fanmodeInOut"==a?b=this.CMD_SETFANMODE_INOUT:"fanmodeInOutWRG"==a?b=this.CMD_SETFANMODE_INOUT_WRG:"startTimer"==a?
b=this.CMD_STARTTIMER:"stopTimer"==a?b=this.CMD_STOPTIMER:0==a.indexOf("setTimer")?(b=this.CMD_SETTIMER,a=a.replace(/setTimer/g,""),-1!=a.indexOf(":")?d=a:(d=parseInt(a),1>d&&(d=1),18<d&&(d=18))):"startDailyPowerOn"==a?b=this.CMD_START_DAILYTIMER:"stopDailyPowerOn"==a?b=this.CMD_STOP_DAILYTIMER:0==a.indexOf("setDailyPowerOn")?(b=this.CMD_SET_DAILYTIMER,d=a=a.replace(/setDailyPowerOn/g,"")):(0==a.indexOf("setTo")?(b=this.CMD_SETFANPOWER,a=a.replace(/setTo/g,"")):0==a.indexOf("setAutoTo")?(b=this.CMD_SETAUTOFANPOWER,
a=a.replace(/setAutoTo/g,"")):0==a.indexOf("setSensorTo")&&(b=this.CMD_SETSENSORSENSITIVITY,a=a.replace(/setSensorTo/g,"")),d=parseInt(a),"aerotube"==this.type?(15>d&&(d=15),100<d&&(d=100)):"aerovital"==this.type?(0>d&&(d=0),100<d&&(d=100)):"aeromatVT"==this.type?(b=this.CMD_SETFANPOWER,0==d&&(d=1),100<d&&(d=100)):(b=this.CMD_SETFANLEVEL,7<d&&(d=7)));b?this.execute(b,d,function(e,f){c(e,f)}):c&&c()};
xnm.aio.siegenia.AEROPAC.prototype.computeStates=function(b){var a={};1==b.automode?a.automode="on":0==b.automode&&(a.automode="off");"undefined"!=typeof b.airquality&&null!=b.airquality&&(a.airquality=""+b.airquality);void 0!=b.fanpower&&(a.fanpower="aerotube"==this.type?(b.fanpower/100*45).toFixed(1):"aerovital"==this.type?(b.fanpower/100*60).toFixed(1):(b.fanpower/100*21).toFixed(1),a.state=0==b.fanpower?1==a.automode?"on":"off":"on");void 0!=b.fanlevel&&(a.fanlevel=""+b.fanlevel,a.state=0==b.fanlevel?
"off":"on");b.devicestate&&void 0!=b.devicestate.deviceactive&&(a.state=1==b.devicestate.deviceactive?"on":"off");b.automode_maxairflow&&("aerotube"==this.type?a.autoairflow=(b.automode_maxairflow/100*45).toFixed(1):"aerovital"==this.type&&(a.autoairflow=(b.automode_maxairflow/100*60).toFixed(1)));void 0!=b.automode_co2sensity&&(a.autosensitivity=""+b.automode_co2sensity);void 0!=b.fanmode&&(a.fanmode=b.fanmode.toLowerCase());if(b.timer){a.activeTimer=b.timer.activetimer;var c=[];b.timer.timer_valid>>
7&1&&c.push(1);b.timer.timer_valid>>6&1&&c.push(2);b.timer.timer_valid>>5&1&&c.push(3);b.timer.timer_valid>>4&1&&c.push(4);b.timer.timer_valid>>3&1&&c.push(5);a.validTimers=c;1==b.timer.enabled?a.timerEnabled="enabled":0==b.timer.enabled&&(a.timerEnabled="disabled");b.timer.remainingtime&&(a.remainingTimeM=60*parseInt(b.timer.remainingtime.hour)+parseInt(b.timer.remainingtime.minute),a.remainingTime=10>b.timer.remainingtime.minute?b.timer.remainingtime.hour+":0"+b.timer.remainingtime.minute:b.timer.remainingtime.hour+
":"+b.timer.remainingtime.minute);1==b.timer.repeat?a.dailyPowerOnEnabled="enabled":0==b.timer.repeat&&(a.dailyPowerOnEnabled="disabled");if(b.timer.poweron_time){c=b.timer.poweron_time.hour+"";2>c.length&&(c="0"+c);var d=b.timer.poweron_time.minute+"";2>d.length&&(d="0"+d);a.dailyPowerOnTime=c+":"+d}b.timer.duration&&(c=b.timer.duration.hour+"",2>c.length&&(c="0"+c),d=b.timer.duration.minute+"",2>d.length&&(d="0"+d),a.duration=c+":"+d,a.durationH=parseInt(b.timer.duration.hour))}if(b.list_timers){a.timers=
[];for(var e=0;e<b.list_timers.length;e++){var f=b.list_timers[e],g=f;"object"==typeof f.duration&&(c=f.duration.hour+"",2>c.length&&(c="0"+c),d=f.duration.minute+"",2>d.length&&(d="0"+d),g.duration=c+":"+d);"object"==typeof f.poweron_time&&(c=f.poweron_time.hour+"",2>c.length&&(c="0"+c),d=f.poweron_time.minute+"",2>d.length&&(d="0"+d),g.poweron_time=c+":"+d);for(g.poweron_weekday=f.poweron_weekday.toString(2);7>g.poweron_weekday.length;)g.poweron_weekday="0"+g.poweron_weekday;a.timers.push(g)}}b.airbase&&
(b.airbase.humidity||b.airbase.temperature)&&(b.airbase.temperature&&b.airbase.temperature.indoor&&(a.indoorTemp=b.airbase.temperature.indoor.toFixed(1)),b.airbase.temperature&&b.airbase.temperature.outdoor&&(a.outdoorTemp=b.airbase.temperature.outdoor.toFixed(1)),b.airbase.humidity&&b.airbase.humidity.indoor&&(a.indoorHum=b.airbase.humidity.indoor.toFixed(1)),b.airbase.humidity&&b.airbase.humidity.outdoor&&(a.outdoorHum=b.airbase.humidity.outdoor.toFixed(1)));"undefined"!=typeof b.leds&&null!=b.leds&&
(a.leds=b.leds?"on":"off");b.warnings&&(a.warnings=b.warnings);return a};xnm.aio.siegenia.AEROPAC.prototype.getStates=function(b,a,c){var d=this;a&&a.id&&b&&(xnm.aio.siegenia._IQONTROLStateCallbacks[this.ip]={id:a?a.id:null,ch:b});this.getState(function(e,f){var g=null;e?g={error:e.message}:f&&(d.state=f,g=d.computeStates(f));g&&d._doStateCallback(a?a.id:null,b,g);c&&g&&c(g)})};xnm.aio.siegenia.AEROPAC.prototype.getStateValues=function(b){return b};
xnm.aio.siegenia.AEROPAC.prototype._doStateCallback=function(b,a,c){c.error||(c.error="");if(b&&a&&a.setState){c.state&&a.setState(b,c.state);for(var d in c)"state"!=d&&"warnings"!=d?a.setState(b+":"+d,c[d]):"warnings"==d&&c[d]&&a.setState(b+":warnings",c[d].toString())}else a&&a.receivedState&&a.receivedState("siegenia",this.ip,c)};
xnm.aio.siegenia.AEROPAC.prototype.addTimer=function(b,a){if(b.duration){var c=b.duration.split(":")[0],d=b.duration.split(":")[1];b.duration={hour:parseInt(c),minute:parseInt(d)}}b.poweron_time&&(c=b.poweron_time.split(":")[0],d=b.poweron_time.split(":")[1],b.poweron_time={hour:parseInt(c),minute:parseInt(d)});b.poweron_weekday&&(b.poweron_weekday=parseInt(b.poweron_weekday,2));this.execute(this.CMD_ADD_TIMER,b,a)};
xnm.aio.siegenia.AEROPAC.prototype.deleteTimer=function(b,a){b.timer_id?this.execute(this.CMD_DELETE_TIMER,{timer_delete:!0,timer_id:b.timer_id},a):a&&a(Error("no timer id"))};
xnm.aio.siegenia.AEROPAC.prototype.updateTimer=function(b,a){if(b.timer_id){if(b.duration){var c=b.duration.split(":")[0],d=b.duration.split(":")[1];b.duration={hour:parseInt(c),minute:parseInt(d)}}b.poweron_time&&(c=b.poweron_time.split(":")[0],d=b.poweron_time.split(":")[1],b.poweron_time={hour:parseInt(c),minute:parseInt(d)});b.poweron_weekday&&(b.poweron_weekday=parseInt(b.poweron_weekday,2));this.execute(this.CMD_UPDATE_TIMER,b,a)}else a&&a(Error("no timer id"))};
xnm.aio.siegenia.AEROPAC.prototype.executeCommandCreator=function(b,a,c){if(a&&a.value){var d=a.value;switch(d){case "setTo":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("command ext invalid"));return}var e=parseInt(a.ext);"aeromatVT"==this.type&&(e=Math.round(parseInt(a.ext)/21*100));"aerovital"==this.type&&(e=Math.round(parseInt(a.ext)/60*100));"aerotube"==this.type&&(e=Math.round(parseInt(a.ext)/45*100));d+=e;break;case "setAutoTo":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("command ext invalid"));
return}e=parseInt(a.ext);"aerovital"==this.type&&(e=Math.round(parseInt(a.ext)/60*100));"aerotube"==this.type&&(e=Math.round(parseInt(a.ext)/45*100));d+=e;break;case "setSensorTo":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("command ext invalid"));return}e=parseInt(a.ext);d+=e;break;case "setTimer":case "setDailyPowerOn":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("command ext invalid"));return}e=a.ext;d+=e}this.executeCommand(b,d,function(f){c&&c(f)})}else c&&c(Error("command value is empty"))};
xnm.aio.siegenia.AEROPAC.prototype.getStatesCreator=function(b,a,c){var d=this;this._getState(function(e,f){if(f){var g=null;e?g={error:e.message}:f&&(g=d.computeStates(f));e=[];for(f=0;f<a.length;f++){var h=a[f];if(h&&h.id&&h.status&&h.status.value){var k=g[h.status.value];"undefined"!=typeof k&&null!=k&&e.push({id:h.id,status:k})}}c&&c(null,e)}else c&&c(Error("get state error"))})};
xnm.aio.siegenia.AEROPAC.prototype.getSingleDeviceStatesCreator=function(b,a,c,d){var e=this;this._getState(function(f,g){if(g){var h=null;f?h={error:f.message}:g&&(h=e.computeStates(g));d&&d(null,h)}else d&&d(Error("get state error"))})};xnm.aio.siegenia.AEROPAC.prototype._getState=function(b){var a=this;this.connect(function(c,d){c?(c.code=a.CONNECTION_ERROR,b&&b(c)):d&&d._deviceParam?b&&b(null,d._deviceParam):a.send(d,{command:"getDeviceParams"},function(e,f){setTimeout(function(){b&&b(e,f)},250)})})};
xnm.aio.siegenia.RulesManager=function(){};
xnm.aio.siegenia.RulesManager.prototype.getOperations=function(b,a,c,d){c||(c="trigger");d||(d="state");b=[];if("sensoair"==a)a={trigger:[window.XC_Text["<="],window.XC_Text[">="]],condition:[window.XC_Text["<="],window.XC_Text[">="]]},"airquality"==d&&(b.push({id:a[c][0],value:"<="}),b.push({id:a[c][1],value:">="}));else if("geniusA"==a||"geniusB"==a||"aeropac"==a)a={trigger:window.XC_Text.changesto,condition:window.XC_Text.is},b.push({id:a[c],value:"="});else if("mh10"==a||"axxentHSA"==a||"axxentHSA2"==
a||"axxentDK"==a)a={trigger:window.XC_Text.changesto,condition:window.XC_Text.is},b.push({id:a[c],value:"="});else if("aeromatVT"==a||"aerovital"==a)a={trigger:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.changesto],condition:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.is]},"indoorHum"==d||"outdoorHum"==d||"outdoorTemp"==d||"indoorTemp"==d||"airquality"==d?(b.push({id:a[c][0],value:"<="}),b.push({id:a[c][1],value:">="})):"state"!=d&&"automode"!=d&&"fanmode"!=d&&"warning"!=
d||b.push({id:a[c][2],value:"="});else if("aerotube"==a)if(a={trigger:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.changesto],condition:[window.XC_Text["<="],window.XC_Text[">="],window.XC_Text.is]},"fanmode"==d||"automode"==d||"state"==d||"warning"==d)b.push({id:a[c][2],value:"="});else if("fanpower"==d|"autoairflow"==d||"indoorTemp"==d||"indoorHum"==d)b.push({id:a[c][0],value:"<="}),b.push({id:a[c][1],value:">="});return b};
xnm.aio.siegenia.RulesManager.prototype.getDeviceChannels=function(b,a,c){b=[];if("sensoair"==a){if("trigger"==c||"condition"==c)b=["airquality"]}else if("geniusB"==a)"trigger"==c?b=["mode","state"]:"condition"==c?b=["mode","state"]:"action"==c&&(b=["state"]);else if("geniusA"==a)"action"==c&&(b=["state"]);else if("axxentDK"==a||"axxentHSA"==a||"axxentHSA2"==a)"trigger"==c?b=["state","warning"]:"condition"==c?b=["state"]:"action"==c&&(b=["state"]);else if("mh10"==a)"trigger"==c?b=["state"]:"condition"==
c?b=["state"]:"action"==c&&(b=["state"]);else if("aeropac"==a)"trigger"==c?b=["state","warning"]:"condition"==c?b=["state"]:"action"==c&&(b=["state"]);else if("aerotube"==a)"trigger"==c?b="indoorHum indoorTemp autoairflow fanpower automode fanmode state warning".split(" "):"condition"==c?b="indoorHum indoorTemp autoairflow fanpower automode fanmode state".split(" "):"action"==c&&(b=["state"]);else if("aeromatVT"==a||"aerovital"==a)"trigger"==c?(b="automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state warning".split(" "),
"aerovital"==a&&(b="fanmode automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state warning".split(" "))):"condition"==c?(b="automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state".split(" "),"aerovital"==a&&(b="fanmode automode indoorHum outdoorHum outdoorTemp indoorTemp airquality state".split(" "))):"action"==c&&(b=["state"]);return b};
xnm.aio.siegenia.RulesManager.prototype.getCommands=function(b,a,c,d){b=[];if("sensoair"==a)"trigger"!=c&&"condition"!=c||"airquality"!=d||b.push({id:"?",value:"?",hysteresis:!0,status:"airquality",type:"device.status",sys:"siegenia"});else if("geniusA"==a||"axxentDK"==a||"axxentHSA"==a)if("action"==c)b.push({id:window.XC_Text.open.toLowerCase(),value:"open",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.close.toLowerCase(),value:"close",action:"",sys:"siegenia",
subtype:"command",type:"action"}),"axxentHSA"==a&&(b.push({id:window.XC_Text.lock.toLowerCase(),value:"lock",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.open_gap,value:"position1",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.open_to_position,value:"position2",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.activate_timer10,value:"startTimer",action:"",sys:"siegenia",subtype:"command",
type:"action"}),b.push({id:window.XC_Text.deactivate_timer10,value:"stopTimer",action:"",sys:"siegenia",subtype:"command",type:"action"})),"axxentDK"==a&&(b.push({id:window.XC_Text.automode_on.toLowerCase(),value:"automodeOn",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.automode_off.toLowerCase(),value:"automodeOff",action:"",sys:"siegenia",subtype:"command",type:"action"}));else{if("condition"==c||"trigger"==c)"axxentDK"!=a&&"axxentHSA"!=a&&"geniusA"!=a||"state"!=
d?"axxentDK"==a&&"trigger"==c&&"warning"==d&&b.push({id:window.XC_Text.CLOSE_FAILED,value:"CLOSE_FAILED",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}):(b.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.closed.toLowerCase(),value:"closed",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),"axxentHSA"==a&&(b.push({id:window.XC_Text.stop.toLowerCase(),value:"stop",
hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.locked.toLowerCase(),value:"locked",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.gap_vent,value:"gap",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),"trigger"==c&&b.push({id:window.XC_Text.ENGINE_OVERHEATING,value:"ENGINE_OVERHEATING",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})))}else if("axxentHSA2"==a)if("action"==
c)b.push({id:window.XC_Text.wing1open,value:"wing1open",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.wing2open,value:"wing2open",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.close_wing1,value:"wing1close",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.close_wing2,value:"wing2close",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.stop_wing1,value:"wing1stop",
hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.stop_wing2,value:"wing2stop",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.lock.toLowerCase(),value:"wing1lock",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.open_gap,value:"wing1position1",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.open_to_position,value:"wing1position2",action:"",
sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.activate_timer10,value:"startTimer",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.deactivate_timer10,value:"stopTimer",action:"",sys:"siegenia",subtype:"command",type:"action"});else{if("condition"==c||"trigger"==c)"state"==d?(b.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.closed.toLowerCase(),
value:"closed",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.locked.toLowerCase(),value:"locked",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.gap_vent,value:"gap",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"})):"warning"==d&&"trigger"==c&&b.push({id:window.XC_Text.ENGINE_OVERHEATING,value:"ENGINE_OVERHEATING",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})}else if("geniusB"==
a)"action"==c?(b.push({id:window.XC_Text.open.toLowerCase(),value:"open",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.close.toLowerCase(),value:"close",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.in_day_mode,value:"daymode",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.in_night_mode,value:"nightmode",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",
type:"action"})):"condition"!=c&&"trigger"!=c||"state"!=d?"condition"==c&&"mode"==d?(b.push({id:window.XC_Text.in_day_mode,value:"day",hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.in_night_mode,value:"night",hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"})):"trigger"==c&&"mode"==d&&(b.push({id:window.XC_Text.day_mode,value:"day",hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.night_mode,value:"night",
hysteresis:!1,status:"mode",type:"device.status",sys:"siegenia"})):(b.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.closed.toLowerCase(),value:"closed",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.locked.toLowerCase(),value:"locked",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("mh10"==a)"action"==c?(b.push({id:window.XC_Text.open.toLowerCase(),
value:"open",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.close.toLowerCase(),value:"close",action:"",sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.stop.toLowerCase(),value:"stop",action:"",sys:"siegenia",subtype:"command",type:"action"})):"condition"==c&&"state"==d&&(b.push({id:window.XC_Text.opened.toLowerCase(),value:"open",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.closed.toLowerCase(),
value:"close",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("aeropac"==a)"action"==c?(b.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"})):"trigger"!=c&&"condition"!=c||"state"!=d?"trigger"==c&&"warning"==d&&b.push({id:window.XC_Text.REPLACE_AIRFILTER,
value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}):(b.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("aeromatVT"==a)if("action"==c)for(b.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",
subtype:"command",type:"action"}),b.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.automode_on,value:"automodeOn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),b.push({id:window.XC_Text.automode_off,value:"automodeOff",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"}),a=0;21>a;a++)c=10*Math.round(a/21*100)/10,
b.push({id:a+1+" m3/h ",value:"setTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});else"trigger"!=c&&"condition"!=c||"state"!=d?"trigger"!=c&&"condition"!=c||"automode"!=d?"trigger"!=c&&"condition"!=c||"indoorHum"!=d?"trigger"!=c&&"condition"!=c||"outdoorHum"!=d?"trigger"!=c&&"condition"!=c||"indoorTemp"!=d?"trigger"!=c&&"condition"!=c||"outdoorTemp"!=d?"trigger"!=c&&"condition"!=c||"airquality"!=d?"trigger"==c&&"warning"==d&&(b.push({id:window.XC_Text.REPLACE_AIRFILTER,
value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.FROST_PROTECTION,value:"FROST_PROTECTION",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})):b.push({id:"?",value:"?",hysteresis:!0,status:"airquality",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"outdoorTemp",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"indoorTemp",type:"device.status",
sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"outdoorHum",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"indoorHum",type:"device.status",sys:"siegenia"}):(b.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"})):(b.push({id:window.XC_Text.switchedon.toLowerCase(),
value:"on",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));else if("aerotube"==a)if("action"==c){b.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",
type:"action"});b.push({id:window.XC_Text.automode_on,value:"automodeOn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.automode_off,value:"automodeOff",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_in,value:"fanmodeIn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_out,value:"fanmodeOut",action:window.XC_Text.action_switch,
sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_inout,value:"fanmodeInOut",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(a=7;45>a;a++)c=10*Math.round(a/45*100)/10,b.push({id:window.XC_Text.fan_power+" "+(a+1)+" m3/h",value:"setTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(a=7;45>a;a++)c=10*Math.round(a/45*100)/10,b.push({id:window.XC_Text.auto_fan_power+" "+(a+1)+" m3/h",
value:"setAutoTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"})}else"trigger"==c&&"warning"==d?b.push({id:window.XC_Text.REPLACE_AIRFILTER,value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}):"trigger"!=c&&"condition"!=c||"fanmode"!=d?"trigger"!=c&&"condition"!=c||"automode"!=d?"trigger"!=c&&"condition"!=c||"fanpower"!=d?"trigger"!=c&&"condition"!=c||"autoairflow"!=d?"trigger"!=c&&"condition"!=c||"indoorTemp"!=d?"trigger"!=
c&&"condition"!=c||"indoorHum"!=d||b.push({id:"?",value:"?",hysteresis:!0,status:"indoorHum",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"indoorTemp",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"autoairflow",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"fanpower",type:"device.status",sys:"siegenia"}):(b.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"automode",
type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"})):(b.push({id:window.XC_Text.fanmode_in,value:"in",hysteresis:!1,status:"fanmode",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.fanmode_out,value:"out",hysteresis:!1,status:"fanmode",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.fanmode_inout,value:"in_out",hysteresis:!1,status:"fanmode",type:"device.status",
sys:"siegenia"}));else if("aerovital"==a)if("action"==c){b.push({id:window.XC_Text.on.toLowerCase(),value:"on",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.off.toLowerCase(),value:"off",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.automode_on,value:"automodeOn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.automode_off,
value:"automodeOff",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_in.toLowerCase(),value:"fanmodeIn",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_out,value:"fanmodeOut",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_inout,value:"fanmodeInOut",action:window.XC_Text.action_switch,sys:"siegenia",
subtype:"command",type:"action"});b.push({id:window.XC_Text.fanmode_inout_wrg,value:"fanmodeInOutWRG",action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(a=0;60>a;a++)c=10*Math.round(a/60*100)/10,b.push({id:window.XC_Text.fan_power+" "+(a+1)+" m3/h",value:"setTo"+c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(a=0;60>a;a++)c=10*Math.round(a/60*100)/10,b.push({id:window.XC_Text.auto_fan_power+" "+(a+1)+" m3/h",value:"setAutoTo"+
c,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"});for(a=0;100>a;a+=5)b.push({id:window.XC_Text.auto_fan_power+" Sensor "+(a+1)+" m3/h",value:"setSensorTo"+a,action:window.XC_Text.action_switch,sys:"siegenia",subtype:"command",type:"action"})}else"trigger"!=c&&"condition"!=c||"state"!=d?"trigger"!=c&&"condition"!=c||"automode"!=d?"trigger"!=c&&"condition"!=c||"indoorHum"!=d?"trigger"!=c&&"condition"!=c||"outdoorHum"!=d?"trigger"!=c&&"condition"!=c||"indoorTemp"!=
d?"trigger"!=c&&"condition"!=c||"outdoorTemp"!=d?"trigger"!=c&&"condition"!=c||"airquality"!=d?"trigger"==c&&"warning"==d&&(b.push({id:window.XC_Text.REPLACE_AIRFILTER,value:"REPLACE_AIRFILTER",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.FROST_PROTECTION,value:"FROST_PROTECTION",hysteresis:!1,status:"warning",type:"device.status",sys:"siegenia"})):b.push({id:"?",value:"?",hysteresis:!0,status:"airquality",type:"device.status",sys:"siegenia"}):b.push({id:"?",
value:"?",hysteresis:!0,status:"outdoorTemp",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"indoorTemp",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"outdoorHum",type:"device.status",sys:"siegenia"}):b.push({id:"?",value:"?",hysteresis:!0,status:"indoorHum",type:"device.status",sys:"siegenia"}):(b.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"}),
b.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"automode",type:"device.status",sys:"siegenia"})):(b.push({id:window.XC_Text.switchedon.toLowerCase(),value:"on",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}),b.push({id:window.XC_Text.switchedoff.toLowerCase(),value:"off",hysteresis:!1,status:"state",type:"device.status",sys:"siegenia"}));return b};
xnm.aio.siegenia.DM=function(){var b=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};b.prototype=Error();b.prototype.name="SiegeniaDMError";b.prototype.code=0;b.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"siegenia",MAP:{geniusA:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}},{type:"string",
name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}}]},aOpener:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"impulse on",ref:{value:"impulseOn"}},{type:"enum",name:"impulse off",ref:{value:"impulseOff"}},{type:"int",name:"set impulse duration",ref:{value:"setImpulse",ext:"%d",extMeta:"1-86400",unit:"s"}}],status:[{type:"enum",name:"state",ref:{value:"state",
options:["open","closed"]}},{type:"enum",name:"impulse",ref:{value:"impulse",options:["enabled","disabled"]}},{type:"int",name:"impulse duration",ref:{value:"impulseduration",ext:"%d",extMeta:"1-86400",unit:"s"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}]},axxentDK:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"open to turn",ref:{value:"open_to_turn"}},{type:"enum",name:"silent on",ref:{value:"silentOn"}},
{type:"enum",name:"silent off",ref:{value:"silentOff"}},{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-60",unit:"min"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed","moving","turning_position"]}},{type:"enum",name:"silent state",ref:{value:"silent_state",options:["on","off"]}},{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",
options:["enabled","disabled"]}},{type:"int",name:"timer duration",ref:{value:"durationM",ext:"%d",unit:"min"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed","moving","turning_position"]}},{type:"enum",name:"warning",ref:{value:"warning",options:["CLOSE_FAILED"]}}]},axxentHSA:{command:[{type:"enum",name:"open",ref:{value:"open"}},
{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"lock",ref:{value:"lock"}},{type:"enum",name:"open to stopover",ref:{value:"position1"}},{type:"enum",name:"open gap",ref:{value:"position2"}},{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-60",unit:"min"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}},{type:"int",name:"set stopover",ref:{value:"setStopover",
ext:"%d",unit:"cm"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}},{type:"int",name:"timer duration",ref:{value:"durationM",ext:"%d",unit:"min"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"int",name:"stopover",ref:{value:"stopover",ext:"%d",unit:"cm"}},{type:"string",name:"warnings",ref:{value:"warnings",
ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"warning",ref:{value:"warning",options:["ENGINE_OVERHEATING"]}}]},axxentHSA2:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"lock",ref:{value:"lock"}},{type:"enum",name:"open to stopover",ref:{value:"position1"}},{type:"enum",name:"open gap",
ref:{value:"position2"}},{type:"enum",name:"sash 1 stop",ref:{value:"wing1stop"}},{type:"enum",name:"sash 1 open",ref:{value:"wing1open"}},{type:"enum",name:"sash 1 close",ref:{value:"wing1close"}},{type:"enum",name:"sash 1 open to stopover",ref:{value:"wing1position1"}},{type:"enum",name:"sash 1 open gap",ref:{value:"wing1position2"}},{type:"enum",name:"sash 2 stop",ref:{value:"wing2stop"}},{type:"enum",name:"sash 2 open",ref:{value:"wing2open"}},{type:"enum",name:"sash 2 close",ref:{value:"wing2close"}},
{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-60",unit:"min"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}},{type:"int",name:"set stopover",ref:{value:"setStopover",ext:"%d",unit:"cm"}}],status:[{type:"enum",name:"1. sash state",ref:{value:"wing1state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"2. sash state",ref:{value:"wing2state",options:"open closed locked gap stopover stop moving".split(" ")}},
{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}},{type:"int",name:"timer duration",ref:{value:"durationM",ext:"%d",unit:"min"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"int",name:"stopover",ref:{value:"stopover",ext:"%d",unit:"cm"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"1. sash state",ref:{value:"wing1state",options:"open closed locked gap stopover stop moving".split(" ")}},
{type:"enum",name:"2. sash state",ref:{value:"wing2state",options:"open closed locked gap stopover stop moving".split(" ")}},{type:"enum",name:"warning",ref:{value:"warning",options:["ENGINE_OVERHEATING"]}}]},geniusB:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"day",ref:{value:"daymode"}},{type:"enum",name:"night",ref:{value:"nightmode"}},{type:"enum",name:"impulse on",ref:{value:"impulseOn"}},{type:"enum",name:"impulse off",
ref:{value:"impulseOff"}},{type:"int",name:"set impulse duration",ref:{value:"setImpulse",ext:"%d",extMeta:"1-86400",unit:"s"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed","locked"]}},{type:"enum",name:"mode",ref:{value:"mode",options:["day","night"]}},{type:"enum",name:"impulse",ref:{value:"impulse",options:["enabled","disabled"]}},{type:"int",name:"impulse duration",ref:{value:"impulseduration",ext:"%d",extMeta:"1-86400",unit:"s"}}],ipevt:[{type:"enum",name:"state",
ref:{value:"state",options:["open","closed","locked"]}},{type:"enum",name:"mode",ref:{value:"mode",options:["day","night"]}}]},mh10:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}]},aeropac:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",
ref:{value:"off"}},{type:"enum",name:"activate timer",ref:{value:"startTimer"}},{type:"int",name:"set timer",ref:{value:"setTimer",ext:"%d",extMeta:"1-18",unit:"hour"}},{type:"enum",name:"deactivate timer",ref:{value:"stopTimer"}},{type:"enum",name:"activate daily power on",ref:{value:"startDailyPowerOn"}},{type:"enum",name:"deactivate daily power on",ref:{value:"stopDailyPowerOn"}},{type:"string",name:"set daily power on time",ref:{value:"setDailyPowerOn",ext:"%s"}},{type:"int",name:"set fan level",
ref:{value:"setTo",ext:"%d",extMeta:"1-7"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"int",name:"fan level",ref:{value:"fanlevel"}},{type:"int",name:"timer duration",ref:{value:"durationH",ext:"%d",unit:"hour"}},{type:"int",name:"timer remain",ref:{value:"remainingTimeM",ext:"%d",unit:"min"}},{type:"string",name:"time remain text",ref:{value:"remainingTime"}},{type:"enum",name:"timer enabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}},{type:"string",
name:"daily power on time",ref:{value:"dailyPowerOnTime"}},{type:"enum",name:"daily power on enabled",ref:{value:"dailyPowerOnEnabled",options:["enabled","disabled"]}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"warning",ref:{value:"warning",options:["REPLACE_AIRFILTER"]}}]},aeromatVT:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",
name:"automode on",ref:{value:"automodeOn"}},{type:"enum",name:"automode off",ref:{value:"automodeOff"}},{type:"int",name:"set fan power",ref:{value:"setTo",ext:"%d",extMeta:"0-21",unit:"m3/h"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},
{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",
ref:{value:"indoorTemp"}},{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"enum",name:"warning",ref:{value:"warning",options:["REPLACE_AIRFILTER","FROST_PROTECTION"]}}]},aerotube:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"automode on",ref:{value:"automodeOn"}},{type:"enum",name:"automode off",
ref:{value:"automodeOff"}},{type:"enum",name:"fan mode in",ref:{value:"fanmodeIn"}},{type:"enum",name:"fan mode out",ref:{value:"fanmodeOut"}},{type:"enum",name:"fan mode in-out",ref:{value:"fanmodeInOut"}},{type:"int",name:"set fan power",ref:{value:"setTo",ext:"%d",extMeta:"7-45",unit:"m3/h"}},{type:"int",name:"auto max fan power",ref:{value:"setAutoTo",ext:"%d",extMeta:"7-45",unit:"m3/h"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"fan mode",
ref:{value:"fanmode",options:["in","out","in_out"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"float",name:"auto max fan power",ref:{value:"autoairflow"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on",
"off"]}},{type:"enum",name:"fan mode",ref:{value:"fanmode",options:["in","out","in_out"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"float",name:"auto max fan power",ref:{value:"autoairflow"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"enum",name:"warning",ref:{value:"warning",options:["REPLACE_AIRFILTER"]}}]},aerovital:{command:[{type:"enum",
name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"automode on",ref:{value:"automodeOn"}},{type:"enum",name:"automode off",ref:{value:"automodeOff"}},{type:"enum",name:"fanmode in",ref:{value:"fanmodeIn"}},{type:"enum",name:"fanmode out",ref:{value:"fanmodeOut"}},{type:"enum",name:"fanmode in/out",ref:{value:"fanmodeInOut"}},{type:"enum",name:"fanmode in/out (wrg)",ref:{value:"fanmodeInOutWRG"}},{type:"int",name:"set fan power",ref:{value:"setTo",ext:"%d",extMeta:"0-60",
unit:"m3/h"}},{type:"int",name:"auto max fan power",ref:{value:"setAutoTo",ext:"%d",extMeta:"9-60",unit:"m3/h"}},{type:"int",name:"auto sensor sensitivity",ref:{value:"setSensorTo",ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"float",name:"fan power",ref:{value:"fanpower"}},{type:"enum",name:"fan mode",ref:{value:"fanmode",options:["in","out","in_out","in_out_wrg",
"auto"]}},{type:"float",name:"auto max fan power",ref:{value:"autoairflow"}},{type:"int",name:"auto sensor sensitivity",ref:{value:"autosensitivity"}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"string",name:"warnings",ref:{value:"warnings",
ext:"%s"}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}},{type:"int",name:"air quality",ref:{value:"airquality"}},{type:"float",name:"indoor temperature",ref:{value:"indoorTemp"}},{type:"float",name:"outdoor temperature",ref:{value:"outdoorTemp"}},{type:"float",name:"indoor humidity",ref:{value:"indoorHum"}},{type:"float",name:"outdoor humidity",ref:{value:"outdoorHum"}},{type:"enum",name:"warning",
ref:{value:"warning",options:["REPLACE_AIRFILTER","FROST_PROTECTION"]}}]},sensoair:{command:[{type:"enum",name:"leds on",ref:{value:"ledsOn"}},{type:"enum",name:"leds off",ref:{value:"ledsOff"}}],status:[{type:"enum",name:"leds",ref:{value:"leds",options:["on","off"]}},{type:"int",name:"airquality",ref:{value:"airquality",extMeta:"1-7"}},{type:"string",name:"warnings",ref:{value:"warnings",ext:"%s"}}],ipevt:[{type:"int",name:"airquality",ref:{value:"airquality"}}]}},registModule:function(a){a.register(this.SYS,
"SIEGENIA Comfort")},getIPDeviceType:function(){return[{sys:this.SYS,name:"AEROPAC",data:"aeropac",model:1,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"AEROMAT VT",data:"aeromatVT",model:2,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent DK",data:"axxentDK",model:3,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent MH",data:"axxentDK",model:3,variant:1,subvariant:0,port:443},{sys:this.SYS,name:"SENSOAIR",data:"sensoair",model:4,variant:0,subvariant:0,port:443},
{sys:this.SYS,name:"AEROVITAL Ambience",data:"aerovital",model:5,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"MHS400 Schema A",data:"axxentHSA",model:6,variant:1,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent HSA Schema A",data:"axxentHSA",model:6,variant:1,subvariant:1,port:443},{sys:this.SYS,name:"MHS400 Schema C",data:"geniusB",model:6,variant:2,subvariant:0,port:443},{sys:this.SYS,name:"DRIVE axxent HSA Schema C",data:"axxentHSA2",model:6,variant:2,subvariant:1,port:443},{sys:this.SYS,
name:"MSA",data:"geniusB",model:6,variant:3,subvariant:0,port:443},{sys:this.SYS,name:"MSA HiFinity",data:"geniusB",model:6,variant:3,subvariant:1,port:443},{sys:this.SYS,name:"MSA Sapa",data:"geniusB",model:6,variant:3,subvariant:2,port:443},{sys:this.SYS,name:"MSA Keller",data:"geniusB",model:6,variant:3,subvariant:3,port:443},{sys:this.SYS,name:"AEROTUBE",data:"aerotube",model:8,variant:0,subvariant:0,port:443},{sys:this.SYS,name:"Universal",data:"axxentHSA",model:10,variant:0,subvariant:0,port:443},
{sys:this.SYS,name:"A-opener",data:"aOpener",model:10,variant:1,subvariant:0,port:443},{sys:this.SYS,name:"GENIUS A",data:"geniusA",model:10,variant:2,subvariant:0,port:443},{sys:this.SYS,name:"GENIUS B",data:"geniusB",model:10,variant:3,subvariant:0,port:443},{sys:this.SYS,name:"MH10",data:"mh10",model:10,variant:4,subvariant:0,port:443}]},createDevice:function(a,c,d){c=b.ERROR_CODE;a?a.ip?a.data?d(null,a):d(new b(c.INVALID,"data is invalid")):d(new b(c.INVALID,"ip is invalid")):d(new b(c.INVALID,
"info is invalid"))},updateDevice:function(a,c,d){c=b.ERROR_CODE;a?a.ip?a.data?d(null,a):d(new b(c.INVALID,"data is invalid")):d(new b(c.INVALID,"ip is invalid")):d(new b(c.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var e=function(l,m){if("*"==l)return!0;for(var n=!1,p=0;p<l.length;p++)if(l[p]==m){n=!0;break}return n},f=function(l,m,n){var p=[];switch(n.catagory){case "command":l.command&&l.command.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),
p.push(q))});break;case "status":l.status&&l.status.forEach(function(q){e(n.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),p.push(q))})}return p},g=function(l,m){var n=[],p=xnm.aio.siegenia.DM.getCommandStatusMap(l,d);p&&(l=f(p,l,m),n=n.concat(l));return n};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),k=null;switch(c.catagory){case "command":k=g(a,c);h.command=k;break;case "status":k=g(a,c);h.status=k;break;default:return null}return k&&0!=k.length?h:null},applyIPEventFilter:function(a,
c){c=xnm.aio.siegenia.DM.getCommandStatusMap(a);if(!c)return null;a=JSON.parse(JSON.stringify(a));a.ipevt=c.ipevt;return a},getCommandStatusMap:function(a){return a&&a.data?this.MAP[a.data]:null}}}();
xnm.aio.siegenia.Handler=function(){var b=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.siegenia.Handler");var a=this;this._discoverCallbacks=[];this._mdnsCallback=function(c,d){a._findSiegeniaDevice(c,d)};this._discoverTO=null;this._discoverRunning=!1};b.prototype.SessionManager=xnm.aio.siegenia._SessionManager;b.prototype.getStateValues=function(a,c){return"genius"==a.type?(new xnm.aio.siegenia.Genius).getStateValues(c):"aeropac"==a.type?(new xnm.aio.siegenia.AEROPAC).getStateValues(c):
{}};b.prototype.getDeviceStatesList=function(a){var c=[];"geniusA"==a.data?c.push({type:"enum",name:"state",ref:{value:"state",options:["open","closed"]}}):"geniusB"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["open","closed","locked"]}}),c.push({type:"enum",name:"mode",ref:{value:"mode",options:["day","night"]}})):"axxentDK"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["open","closed","moving","turning_position"]}}),c.push({type:"enum",name:"silent state",
ref:{value:"silent_state",options:["on","off"]}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"remainingTime",ref:{value:"remainingTime"}})):"axxentHSA"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:"open closed locked gap stopover stop moving".split(" ")}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"remainingTime",
ref:{value:"remainingTime"}})):"axxentHSA2"==a.data?(c.push({type:"enum",name:"1. wing state",ref:{value:"wing1state",options:"open closed locked gap stopover stop moving".split(" ")}}),c.push({type:"enum",name:"2. wing state",ref:{value:"wing2state",options:"open closed locked gap stopover stop moving".split(" ")}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"remainingTime",ref:{value:"remainingTime"}})):"mh10"!=
a.data&&("aeropac"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"int",name:"fanlevel",ref:{value:"fanlevel"}}),c.push({type:"string",name:"timeRemaining",ref:{value:"timeRemaining"}}),c.push({type:"enum",name:"timerEnabled",ref:{value:"timerEnabled",options:["enabled","disabled"]}}),c.push({type:"string",name:"dailyPowerOnTime",ref:{value:"dailyPowerOnTime"}}),c.push({type:"enum",name:"dailyPowerOnEnabled",ref:{value:"dailyPowerOnEnabled",options:["enabled",
"disabled"]}})):"aeromatVT"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}}),c.push({type:"float",name:"fanpower",ref:{value:"fanpower"}}),c.push({type:"int",name:"airquality",ref:{value:"airquality"}}),c.push({type:"float",name:"indoorTemp",ref:{value:"indoorTemp"}}),c.push({type:"float",name:"outdoorTemp",ref:{value:"outdoorTemp"}}),c.push({type:"float",name:"indoorHum",ref:{value:"indoorHum"}}),
c.push({type:"float",name:"outdoorHum",ref:{value:"outdoorHum"}})):"aerotube"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"enum",name:"fanmode",ref:{value:"fanmode",options:["in","out","in_out"]}}),c.push({type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}}),c.push({type:"float",name:"fanpower",ref:{value:"fanpower"}}),c.push({type:"float",name:"autoairflow",ref:{value:"autoairflow"}}),c.push({type:"float",name:"indoorTemp",
ref:{value:"indoorTemp"}}),c.push({type:"float",name:"indoorHum",ref:{value:"indoorHum"}})):"aerovital"==a.data?(c.push({type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}),c.push({type:"enum",name:"fanmode",ref:{value:"fanmode",options:["in","out","in_out","in_out_wrg"]}}),c.push({type:"enum",name:"automode",ref:{value:"automode",options:["on","off"]}}),c.push({type:"float",name:"fanpower",ref:{value:"fanpower"}}),c.push({type:"float",name:"autoairflow",ref:{value:"autoairflow"}}),
c.push({type:"int",name:"autosensitivity",ref:{value:"autosensitivity"}}),c.push({type:"float",name:"indoorTemp",ref:{value:"indoorTemp"}}),c.push({type:"float",name:"outdoorTemp",ref:{value:"outdoorTemp"}}),c.push({type:"float",name:"indoorHum",ref:{value:"indoorHum"}}),c.push({type:"float",name:"outdoorHum",ref:{value:"outdoorHum"}}),c.push({type:"int",name:"airquality",ref:{value:"airquality"}})):"sensoair"==a.data&&(c.push({type:"enum",name:"leds",ref:{value:"leds",options:["on","off"]}}),c.push({type:"int",
name:"airquality",ref:{value:"airquality"}})));c.push({type:"array",name:"warnings",ref:{value:"warnings"}});return c};b.prototype.getDeviceCommandList=function(a,c){c=[];if("geniusA"==a.data||"axxentDK"==a.data||"axxentHSA"==a.data||"aOpener"==a.data||"axxentHSA2"==a.data)c.push({id:window.XC_Text.open,cmd:"open"}),c.push({id:window.XC_Text.close,cmd:"close"}),"axxentHSA"==a.data&&(c.push({id:window.XC_Text.stop,cmd:"stop"}),c.push({id:window.XC_Text.lock,cmd:"lock"}),c.push({id:window.XC_Text.open_gap,
cmd:"position1"}),c.push({id:window.XC_Text.open_to_position,cmd:"position2"}),c.push({id:window.XC_Text.activate_timer10,cmd:"setTimer10"}),c.push({id:window.XC_Text.deactivate_timer10,cmd:"stopTimer"}),c.push({id:window.XC_Text.activate_timer,cmd:"startTimer"}),c.push({id:window.XC_Text.set_timer,cmd:"setTimer"}),c.push({id:window.XC_Text.deactivate_timer,cmd:"stopTimer"}),c.push({id:window.XC_Text.set_stopover,cmd:"setStopover"})),"axxentHSA2"==a.data&&(c.push({id:window.XC_Text.stop,cmd:"stop"}),
c.push({id:window.XC_Text.open,cmd:"open"}),c.push({id:window.XC_Text.lock,cmd:"lock"}),c.push({id:window.XC_Text.open_gap,cmd:"position1"}),c.push({id:window.XC_Text.open_to_position,cmd:"position2"}),c.push({id:window.XC_Text.stop,cmd:"wing1stop"}),c.push({id:window.XC_Text.open,cmd:"wing1open"}),c.push({id:window.XC_Text.close,cmd:"wing1close"}),c.push({id:window.XC_Text.open_gap,cmd:"wing1position1"}),c.push({id:window.XC_Text.open_to_position,cmd:"wing1position2"}),c.push({id:window.XC_Text.stop,
cmd:"wing2stop"}),c.push({id:window.XC_Text.open,cmd:"wing2open"}),c.push({id:window.XC_Text.close,cmd:"wing2close"}),c.push({id:window.XC_Text.activate_timer10,cmd:"setTimer10"}),c.push({id:window.XC_Text.deactivate_timer10,cmd:"stopTimer"}),c.push({id:window.XC_Text.activate_timer,cmd:"startTimer"}),c.push({id:window.XC_Text.set_timer,cmd:"setTimer"}),c.push({id:window.XC_Text.deactivate_timer,cmd:"stopTimer"})),"axxentDK"==a.data&&(c.push({id:window.XC_Text.open_to_turn,cmd:"open_to_turn"}),c.push({id:window.XC_Text.silent_on,
cmd:"silentOn"}),c.push({id:window.XC_Text.silent_off,cmd:"silentOff"}),c.push({id:window.XC_Text.automode_on,cmd:"automodeOn"}),c.push({id:window.XC_Text.automode_off,cmd:"automodeOff"}),c.push({id:window.XC_Text.activate_timer,cmd:"startTimer"}),c.push({id:window.XC_Text.set_timer,cmd:"setTimer"}),c.push({id:window.XC_Text.deactivate_timer,cmd:"stopTimer"}));else if("geniusB"==a.data)c.push({id:window.XC_Text.open,cmd:"open"}),c.push({id:window.XC_Text.close,cmd:"close"}),c.push({id:window.XC_Text.day,
cmd:"daymode"}),c.push({id:window.XC_Text.night,cmd:"nightmode"});else if("mh10"==a.data)c.push({id:window.XC_Text.open,cmd:"open"}),c.push({id:window.XC_Text.close,cmd:"close"}),c.push({id:window.XC_Text.stop,cmd:"stop"});else if("aeropac"==a.data){c.push({id:window.XC_Text.on,cmd:"on"});c.push({id:window.XC_Text.off,cmd:"off"});c.push({id:window.XC_Text.activate_timer10,cmd:"startTimer"});c.push({id:window.XC_Text.deactivate_timer10,cmd:"stopTimer"});c.push({id:window.XC_Text.set_timer,cmd:"setTimer"});
c.push({id:window.XC_Text.activate_daily,cmd:"startDailyPowerOn"});c.push({id:window.XC_Text.deactivate_daily,cmd:"stopDailyPowerOn"});c.push({id:window.XC_Text.set_daily,cmd:"setDailyPowerOn"});for(a=1;18>=a;a++)c.push({id:window.XC_Text.activate_timer10+" "+a,cmd:"setTimer"+a});for(a=1;7>=a;a++)c.push({id:window.XC_Text.fan_power+" "+a,cmd:"setTo"+a})}else if("aeromatVT"==a.data)for(c.push({id:window.XC_Text.on,cmd:"on"}),c.push({id:window.XC_Text.off,cmd:"off"}),c.push({id:window.XC_Text.automode_on,
cmd:"automodeOn"}),c.push({id:window.XC_Text.automode_off,cmd:"automodeOff"}),a=0;21>a;a++){var d=10*Math.round(a/21*100)/10;c.push({id:window.XC_Text.fan_power+" "+(a+1)+" m3/h",cmd:"setTo"+d})}else if("aerotube"==a.data){c.push({id:window.XC_Text.on,cmd:"on"});c.push({id:window.XC_Text.off,cmd:"off"});c.push({id:window.XC_Text.automode_on,cmd:"automodeOn"});c.push({id:window.XC_Text.automode_off,cmd:"automodeOff"});c.push({id:window.XC_Text.fanmode_in,cmd:"fanmodeIn"});c.push({id:window.XC_Text.fanmode_out,
cmd:"fanmodeOut"});c.push({id:window.XC_Text.fanmode_inout,cmd:"fanmodeInOut"});for(a=7;45>a;a++)d=10*Math.round(a/45*100)/10,c.push({id:window.XC_Text.fan_power+" "+(a+1)+" m3/h",cmd:"setTo"+d});for(a=7;45>a;a++)d=10*Math.round(a/45*100)/10,c.push({id:window.XC_Text.auto_fan_power+" "+(a+1)+" m3/h",cmd:"setAutoTo"+d})}else if("aerovital"==a.data){c.push({id:window.XC_Text.on,cmd:"on"});c.push({id:window.XC_Text.off,cmd:"off"});c.push({id:window.XC_Text.automode_on,cmd:"automodeOn"});c.push({id:window.XC_Text.automode_off,
cmd:"automodeOff"});c.push({id:window.XC_Text.fanmode_in,cmd:"fanmodeIn"});c.push({id:window.XC_Text.fanmode_out,cmd:"fanmodeOut"});c.push({id:window.XC_Text.fanmode_inout,cmd:"fanmodeInOut"});c.push({id:window.XC_Text.fanmode_inout_wrg,cmd:"fanmodeInOutWRG"});for(a=0;60>a;a++)d=10*Math.round(a/60*100)/10,c.push({id:window.XC_Text.fan_power+" "+(a+1)+" m3/h",cmd:"setTo"+d});for(a=0;60>a;a++)d=10*Math.round(a/60*100)/10,c.push({id:window.XC_Text.auto_fan_power+" "+(a+1)+" m3/h",cmd:"setAutoTo"+d});
for(a=0;100>a;a+=5)c.push({id:window.XC_Text.auto_fan_power+" "+(a+1)+" m3/h",cmd:"setSensorTo"+a})}else"sensoair"==a.data&&(c.push({id:window.XC_Text.ledsOn,cmd:"ledsOn"}),c.push({id:window.XC_Text.ledsOff,cmd:"ledsOff"}));return c};b.prototype.getDevice=function(a){return"geniusA"==a.data?new this.Genius(a.address,"user",a.pwd,"A"):"geniusB"==a.data?new this.Genius(a.address,"user",a.pwd,"B"):"mh10"==a.data?new this.Genius(a.address,"user",a.pwd,"mh10"):"axxentDK"==a.data?new this.Genius(a.address,
"user",a.pwd,"axxentDK"):"axxentHSA"==a.data?new this.Genius(a.address,"user",a.pwd,"axxentHSA"):"axxentHSA2"==a.data?new this.Genius(a.address,"user",a.pwd,"axxentHSA2"):"aOpener"==a.data?new this.Genius(a.address,"user",a.pwd,"aOpener"):"aeropac"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"aeropac"):"aeromatVT"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"aeromatVT"):"aerotube"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"aerotube"):"aerovital"==a.data?new this.AEROPAC(a.address,"user",
a.pwd,"aerovital"):"sensoair"==a.data?new this.AEROPAC(a.address,"user",a.pwd,"sensoair"):null};b.prototype.Genius=xnm.aio.siegenia.Genius;b.prototype.AEROPAC=xnm.aio.siegenia.AEROPAC;b.prototype.RulesManager=xnm.aio.siegenia.RulesManager;b.prototype.discoveryStart=function(a){a&&-1==this._discoverCallbacks.indexOf(a)&&this._discoverCallbacks.push(a);require("x.mdns.js").discoverService("_siegenia._tcp.local",this._mdnsCallback)};b.prototype.discoveryStop=function(a){a&&(a=this._discoverCallbacks.indexOf(a),
-1!=a&&(XC.debugf("stop siegenia discovery with the correct callback"),this._discoverCallbacks.splice(a,1)));require("x.mdns.js").stopDiscover("_siegenia._tcp.local",this._mdnsCallback)};b.prototype._findSiegeniaDevice=function(a,c){if(a)for(c=0;c<this._discoverCallbacks.length;c++)(g=this._discoverCallbacks[c])&&g(a,e);else if(c){this._logger.log("trace","receive mdns response:"+JSON.stringify(c));var d=g=null;if(c.ip&&c.ip[0]&&c.domain&&c.info){1==c.info.model?g="aeropac":2==c.info.model?g="aeromatVT":
3==c.info.model?g="axxentDK":4==c.info.model?g="sensoair":5==c.info.model?g="aerovital":6==c.info.model?(1==c.info.variant&&0==c.info.subvariant?(g="axxentHSA",d="MHS400 Schema A"):1==c.info.variant&&1==c.info.subvariant?(g="axxentHSA",d="DRIVE axxent HSA Schema A"):2==c.info.variant&&1==c.info.subvariant&&(g="axxentHSA2",d="DRIVE axxent HSA Schema C"),g||(g="geniusB")):8==c.info.model?g="aerotube":10==c.info.model&&(1==c.info.variant?(g="aOpener",d="A-opener"):2==c.info.variant?(g="geniusA",d="GENIUS A"):
3==c.info.variant?(g="geniusB",d="GENIUS B"):4==c.info.variant&&(g="mh10",d="MH10"),g||(g="axxentHSA"));var e=c.domain.split(".")[0];var f=c.ip[0];e={sys:"siegenia",ip:f,port:443,username:"user",password:null,data:g,model:c.info.model,variant:c.info.variant,subvariant:c.info.subvariant,serial:c.info.serial,address:f,name:e,subtype:d}}if(e)for(this._logger.log("trace","find siegenia device:"+JSON.stringify(e)),c=0;c<this._discoverCallbacks.length;c++){var g=this._discoverCallbacks[c];g&&g(a,e)}}};
b.prototype.devicemanager=xnm.aio.siegenia.DM;b.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"siegenia")};b.prototype.resolveDevice=function(a){if(!a||!a.ip||!a.data)return null;var c=null;switch(a.data){case "geniusA":case "geniusB":case "mh10":case "axxentDK":case "axxentHSA":case "axxentHSA2":case "aOpener":var d=this.Genius;var e=a.data;"geniusA"==a.data?e="A":"geniusB"==a.data&&(e="B");break;case "aeropac":case "aeromatVT":case "aerotube":case "aerovital":case "sensoair":d=
this.AEROPAC,e=a.data}d&&e&&(c=new d(a.ip,a.username,a.password,e,a.port));c&&(c._data=a.data,c._type=a.type,c._variant=a.variant,c._subvariant=a.subvariant,c._serial=a.serial);return c};b.prototype.getDeviceCommands=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};b.prototype.getDeviceStatus=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};b.prototype.doCommand=function(a,
c,d){var e=this.resolveDevice(a);e?e.executeCommandCreator(a,c,function(f){d&&d(f)}):d&&d(Error("device json format invalid"))};b.prototype.doStatus=function(a,c,d,e){var f=this.resolveDevice(c);f?f.getStatesCreator(null,[{id:a,device:c,status:d}],function(g,h){g?e&&e(g):e&&e(null,h[0])}):e&&e(Error("device json format invalid"))};b.prototype.discoverWithTimeout=function(a,c){if(!this._discoverRunning){var d={},e=function(g,h){!g&&h&&h.ip&&!d[h.ip]&&(d[h.ip]=h)},f=this;this.discoveryStart(e);this._discoverTO=
setTimeout(function(){f.discoveryStop(e);var g=[],h;for(h in d)d.hasOwnProperty(h)&&g.push(d[h]);c&&c(null,g)},a)}};return b}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.siegenia.Handler);

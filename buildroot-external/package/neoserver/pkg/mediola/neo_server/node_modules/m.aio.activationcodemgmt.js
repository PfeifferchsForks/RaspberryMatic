var m=m||{};m.aio=m.aio||{};m.aio.activationcdemgmt=m.aio.activationcdemgmt||{};m.aio.activationcdemgmt.ActivateManager=function(){this._logger=require("x.logger.js").getLogger("m.aio.activationcdemgmt.ActivateManager");this._configmanager=null;this._serverport=8080;this._serverhost="127.0.0.1";this._serverpath="/creatorneo/activate/feature";process&&"local"==process.env.CLOUD&&(m.aio.activationcdemgmt.ActivateManager.PROTOCOL="http",this._serverpath="/webservice"+this._serverpath)};
m.aio.activationcdemgmt.ActivateManager.PROTOCOL="https";
m.aio.activationcdemgmt.ActivateManager.prototype={init:function(b,e,d,a){this._configmanager=b;this._serverhost=e?e:this._serverhost;this._serverport=d?d:this._serverport;process&&"local"!=process.env.CLOUD&&80==d&&(this._serverport=443);a&&a()},activateFeature:function(b,e,d,a){if(b)if(d){var f=this,c="config/tenants/"+b+"/license",g=this._configmanager;g.execute("read",c,null,function(l,h){l?a&&a(l):h&&h.license?h.valid?f._doRequest(d,h.license,function(n,q){if(n)a&&a(n);else try{var p=JSON.parse(q);
g.execute("update",c,{classid:"license",license:p.license},function(k){a&&a(k,p.license)})}catch(k){a&&a(k)}}):a&&a(Error("tenant license is invalid")):a&&a(Error("tenant has no license"))})}else a&&a(Error("invalid activation code"));else a&&a(Error("invalid tenant index"))},_doRequest:function(b,e,d){var a=d;b={host:this._serverhost,port:this._serverport,path:this._serverpath+"?license="+e+"&code="+b,method:"GET",timeout:2E4,headers:{"User-Agent":"mediola",Connection:"close"}};var f="";b=require(m.aio.activationcdemgmt.ActivateManager.PROTOCOL).request(b,
function(c){c.setEncoding("binary");c.on("data",function(g){f+=g});c.on("end",function(){a&&(200==c.statusCode?a(null,f):a(Error(f)));a=null})});if(b.on&&"function"==typeof b.on)b.on("error",function(c){a&&a(c);a=null});b.setTimeout&&b.setTimeout(2E4);b.end()}};m.aio.activationcdemgmt.AM=new m.aio.activationcdemgmt.ActivateManager;"undefined"!=typeof module&&null!=module&&(module.exports=m.aio.activationcdemgmt.AM);

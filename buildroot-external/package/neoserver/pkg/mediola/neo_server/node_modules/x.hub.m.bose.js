var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,c,a){if(null==d)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,a){if(d==Array.prototype||d==Object.prototype)return d;d[c]=a.value;return d};
$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<d.length;++c){var a=d[c];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(d,c){var a=$jscomp.propertyToPolyfillSymbol[c];if(null==a)return d[c];a=d[a];return void 0!==a?a:d[c]};$jscomp.polyfill=function(d,c,a,b){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(d,c,a,b):$jscomp.polyfillUnisolated(d,c,a,b))};
$jscomp.polyfillUnisolated=function(d,c,a,b){a=$jscomp.global;d=d.split(".");for(b=0;b<d.length-1;b++){var e=d[b];if(!(e in a))return;a=a[e]}d=d[d.length-1];b=a[d];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(d,c,a,b){var e=d.split(".");d=1===e.length;b=e[0];b=!d&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in b))return;b=b[f]}e=e[e.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?b[e]:null;c=c(a);null!=c&&(d?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:c}):c!==a&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(a=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+a+"$"+e),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("String.prototype.repeat",function(d){return d?d:function(c){var a=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var b="";c;)if(c&1&&(b+=a),c>>>=1)a+=a;return b}},"es6","es3");var util=require("util"),EventEmitter=require("events"),x=x||{};
x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.bose=x.hub.m.bose||{};x.hub.m.bose.MODULE=require("xnm.aio.bose.js");
x.hub.m.bose.AudioPlayer=function(){var d=function(){this._process={}};d.prototype.playFile=function(c,a,b){if(a&&a.file){var e=require("x.hub.resource.js").getFileURL(a.file,c.ip);e?(a.url=e,this.playUrl(c,a,b)):b&&b(Error("no such file"))}else b&&b(Error("invalid file"))};d.prototype.playUrl=function(c,a,b){if(a&&a.url){var e=x.hub.m.bose.MODULE.resolveDevice(c);if(e){var g=a.url,f=this;this._cancelPlay(e,function(h){h?b&&b(h):f._setVolume(e,a.volume,function(k){k?b&&b(k):f._setRepeat(e,a.repeat,
function(l){l?b&&b(l):f._unmute(e,function(m){m?b&&b(m):f._playUrl(e,g,function(n){n?b&&b(n):a.repeat&&-1!=a.repeat&&(f._process[e.getIP()]={url:g},f._process[e.getIP()].timeout=setTimeout(function(){var p=f._process[e.getIP()].url;f._process[e.getIP()]=null;f._stopPlay(e,p)},1E3*parseInt(a.repeat)))})})})})});b&&b(null,1)}else b&&b(Error("invalid device json"))}else b&&b(Error("invalid url"))};d.prototype._cancelPlay=function(c,a){var b=c.getIP();if(b&&this._process[b]){this._process[b].timeout&&
clearTimeout(this._process[b].timeout);var e=this._process[b].url;this._process[b]=null;e?this._stopPlay(c,e,a):a&&a()}else a&&a()};d.prototype._stopPlay=function(c,a,b){c._getNowPlaying(function(e,g){e||!g?c._clickKey("STOP",b):g.currentURI&&g.currentURI!=a?b&&b():c._clickKey("STOP",b)})};d.prototype._setVolume=function(c,a,b){a?c._setVolume(a,b):b&&b()};d.prototype._setRepeat=function(c,a,b){a?c._clickKey("REPEAT_ONE",b):b&&b()};d.prototype._unmute=function(c,a){a&&a()};d.prototype._playUrl=function(c,
a,b){a?c.playUrl(a,b):b&&b(Error("invalid url"))};return d}();
x.hub.m.bose.Handler=function(){var d=function(){this._audioPlayer=new x.hub.m.bose.AudioPlayer};util.inherits(d,EventEmitter);d.prototype.init=function(c){c&&c()};d.prototype.getSystems=function(){return["bose"]};d.prototype.executeCommand=function(c,a,b){a?"playFile"==a.value?this._audioPlayer.playFile(c,a,function(e){b&&b({error:e})}):"playUrl"==a.value&&(a.repeat||a.volume)?this._audioPlayer.playUrl(c,a,function(e){b&&b({error:e})}):x.hub.m.bose.MODULE.doCommand(c,a,b):b&&b({error:Error("invalid command")})};
return d}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.bose.Handler);
